(()=>{(self.webpackChunkapp=self.webpackChunkapp||[]).push([[4267],{44267:function(Z,oe,w){"use strict";w.r(oe),w.d(oe,{Router:function(){return Aj}});var m=w(2784),z=w(10289),R=w(49558),I=w(30705),$=w(73495),Y=w(73409),de=w(34520),X=w(79692),M=w(90436),F=w(80030),V=w(86689),Q=w(60364),ee=w(94339),ye=w(16111),ae=w(24579),_e=w(95544),At=w(7089),qt=w(14503),He=w(61837),De=w(31625),ti=w(31377),K=w(34546),Kt=w(67471),yi=w(77277),Ui=w(27556),Rs=w(67358),mn=w(89571),qi=w(15584),gn=w(91256),H=w(37390),ce=w(58987),gt=w(97485),Ee=w(60905),Qi=w(42494),Je=w(56939),ii=w(73698),ni=w(12231),Wr=w(49462),Oo=w(39781),Ff=w(26655),wr=w(56563),Ls=w(86136),El=w(49378),Ah=w(50758),Nf=w(79784),Tl=w(30254),Oh=w(27604),Pl=w(43054),If=w(19126),_h=w.n(If),Bl=w(64279),Dh=w(13888),Mh=w.n(Dh),Rl=w(72579),Eh=w.n(Rl),Wf=w(45455),Ne=w.n(Wf);function Ll(n){var e=n.errors;return m.createElement("div",{className:"panel panel-danger errors"},m.createElement("div",{className:"panel-heading"},m.createElement("h3",{className:"panel-title"},"Errors")),m.createElement("ul",{className:"list-group"},e.map(function(t,i){return m.createElement("li",{key:i,className:"list-group-item text-danger"},t.stack)})))}var E=w(38294),G=w(76485),se=w.n(G),Se=w(67553),Me=w.n(Se),ve=w(26139),Be=w.n(ve),ot=w(404);function Ze(){return Ze=Object.assign||function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])}return n},Ze.apply(this,arguments)}function yt(n,e){if(n==null)return{};var t=vt(n,e),i,r;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);for(r=0;r<s.length;r++)i=s[r],!(e.indexOf(i)>=0)&&(!Object.prototype.propertyIsEnumerable.call(n,i)||(t[i]=n[i]))}return t}function vt(n,e){if(n==null)return{};var t={},i=Object.keys(n),r,s;for(s=0;s<i.length;s++)r=i[s],!(e.indexOf(r)>=0)&&(t[r]=n[r]);return t}function Ot(n){var e=n.type,t=e===void 0?"default":e,i=n.icon,r=n.className,s=yt(n,["type","icon","className"]);return m.createElement("button",Ze({type:"button",className:"btn btn-".concat(t," ").concat(r)},s),m.createElement("i",{className:"glyphicon glyphicon-".concat(i)}))}function ri(n){var e=n.className,t=n.onClick,i=n.disabled;return m.createElement("div",{className:"row"},m.createElement("p",{className:"col-xs-3 col-xs-offset-9 text-right ".concat(e)},m.createElement(Ot,{type:"info",icon:"plus",className:"btn-add col-xs-12","aria-label":"Add",tabIndex:"0",onClick:t,disabled:i})))}var En=w(5594),ze=w.n(En),Fl=w(13980),Ae=w.n(Fl),Th=Ae().shape({ArrayFieldTemplate:Ae().elementType,FieldTemplate:Ae().elementType,ObjectFieldTemplate:Ae().elementType,definitions:Ae().object.isRequired,rootSchema:Ae().object,fields:Ae().objectOf(Ae().elementType).isRequired,formContext:Ae().object.isRequired,widgets:Ae().objectOf(Ae().oneOfType([Ae().func,Ae().object])).isRequired}),Ph={autofocus:Ae().bool,disabled:Ae().bool,errorSchema:Ae().object,formData:Ae().any,idSchema:Ae().object,onBlur:Ae().func,onChange:Ae().func.isRequired,onFocus:Ae().func,rawErrors:Ae().arrayOf(Ae().string),readonly:Ae().bool,registry:Th.isRequired,required:Ae().bool,schema:Ae().object.isRequired,uiSchema:Ae().shape({"ui:options":Ae().shape({addable:Ae().bool,orderable:Ae().bool,removable:Ae().bool})})};let Bh=n=>crypto.getRandomValues(new Uint8Array(n)),br=(n,e,t)=>{let i=(2<<Math.log(n.length-1)/Math.LN2)-1,r=-~(1.6*i*e/n.length);return(s=e)=>{let o="";for(;;){let l=t(r),a=r;for(;a--;)if(o+=n[l[a]&i]||"",o.length===s)return o}}},_j=(n,e=21)=>br(n,e,Bh),$M=(n=21)=>crypto.getRandomValues(new Uint8Array(n)).reduce((e,t)=>(t&=63,t<36?e+=t.toString(36):t<62?e+=(t-26).toString(36).toUpperCase():t>62?e+="-":e+="_",e),"");function Rh(n){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Rh=function(t){return typeof t}:Rh=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Rh(n)}function Qy(n,e){if(n==null)return{};var t=UM(n,e),i,r;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);for(r=0;r<s.length;r++)i=s[r],!(e.indexOf(i)>=0)&&(!Object.prototype.propertyIsEnumerable.call(n,i)||(t[i]=n[i]))}return t}function UM(n,e){if(n==null)return{};var t={},i=Object.keys(n),r,s;for(s=0;s<i.length;s++)r=i[s],!(e.indexOf(r)>=0)&&(t[r]=n[r]);return t}function Vf(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{},i=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(i=i.concat(Object.getOwnPropertySymbols(t).filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable}))),i.forEach(function(r){In(n,r,t[r])})}return n}function ev(n){return GM(n)||KM(n)||qM()}function qM(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function KM(n){if(Symbol.iterator in Object(n)||Object.prototype.toString.call(n)==="[object Arguments]")return Array.from(n)}function GM(n){if(Array.isArray(n)){for(var e=0,t=new Array(n.length);e<n.length;e++)t[e]=n[e];return t}}function JM(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function tv(n,e){for(var t=0;t<e.length;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}}function ZM(n,e,t){return e&&tv(n.prototype,e),t&&tv(n,t),n}function YM(n,e){return e&&(Rh(e)==="object"||typeof e=="function")?e:Vr(n)}function Hf(n){return Hf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Hf(n)}function Vr(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function XM(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),e&&zf(n,e)}function zf(n,e){return zf=Object.setPrototypeOf||function(i,r){return i.__proto__=r,i},zf(n,e)}function In(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function iv(n){var e=n.TitleField,t=n.idSchema,i=n.title,r=n.required;if(!i)return null;var s="".concat(t.$id,"__title");return m.createElement(e,{id:s,title:i,required:r})}function QM(n){var e=n.DescriptionField,t=n.idSchema,i=n.description;if(!i)return null;var r="".concat(t.$id,"__description");return m.createElement(e,{id:r,description:i})}function nv(n){var e={flex:1,paddingLeft:6,paddingRight:6,fontWeight:"bold"};return m.createElement("div",{key:n.key,className:n.className},m.createElement("div",{className:n.hasToolbar?"col-xs-9":"col-xs-12"},n.children),n.hasToolbar&&m.createElement("div",{className:"col-xs-3 array-item-toolbox"},m.createElement("div",{className:"btn-group",style:{display:"flex",justifyContent:"space-around"}},(n.hasMoveUp||n.hasMoveDown)&&m.createElement(Ot,{icon:"arrow-up","aria-label":"Move up",className:"array-item-move-up",tabIndex:"-1",style:e,disabled:n.disabled||n.readonly||!n.hasMoveUp,onClick:n.onReorderClick(n.index,n.index-1)}),(n.hasMoveUp||n.hasMoveDown)&&m.createElement(Ot,{icon:"arrow-down",className:"array-item-move-down","aria-label":"Move down",tabIndex:"-1",style:e,disabled:n.disabled||n.readonly||!n.hasMoveDown,onClick:n.onReorderClick(n.index,n.index+1)}),n.hasRemove&&m.createElement(Ot,{type:"danger",icon:"remove","aria-label":"Remove",className:"array-item-remove",tabIndex:"-1",style:e,disabled:n.disabled||n.readonly,onClick:n.onDropIndexClick(n.index)}))))}function eE(n){return m.createElement("fieldset",{className:n.className,id:n.idSchema.$id},m.createElement(iv,{key:"array-field-title-".concat(n.idSchema.$id),TitleField:n.TitleField,idSchema:n.idSchema,title:n.uiSchema["ui:title"]||n.title,required:n.required}),(n.uiSchema["ui:description"]||n.schema.description)&&m.createElement("div",{className:"field-description",key:"field-description-".concat(n.idSchema.$id)},n.uiSchema["ui:description"]||n.schema.description),m.createElement("div",{className:"row array-item-list",key:"array-item-list-".concat(n.idSchema.$id)},n.items&&n.items.map(nv)),n.canAdd&&m.createElement(ri,{className:"array-item-add",onClick:n.onAddClick,disabled:n.disabled||n.readonly}))}function tE(n){return m.createElement("fieldset",{className:n.className,id:n.idSchema.$id},m.createElement(iv,{key:"array-field-title-".concat(n.idSchema.$id),TitleField:n.TitleField,idSchema:n.idSchema,title:n.uiSchema["ui:title"]||n.title,required:n.required}),(n.uiSchema["ui:description"]||n.schema.description)&&m.createElement(QM,{key:"array-field-description-".concat(n.idSchema.$id),DescriptionField:n.DescriptionField,idSchema:n.idSchema,description:n.uiSchema["ui:description"]||n.schema.description}),m.createElement("div",{className:"row array-item-list",key:"array-item-list-".concat(n.idSchema.$id)},n.items&&n.items.map(function(e){return nv(e)})),n.canAdd&&m.createElement(ri,{className:"array-item-add",onClick:n.onAddClick,disabled:n.disabled||n.readonly}))}function jf(){return $M()}function rv(n){return Array.isArray(n)?n.map(function(e){return{key:jf(),item:e}}):[]}function Nl(n){return n.map(function(e){return e.item})}var sv=function(n){XM(e,n);function e(t){var i;JM(this,e),i=YM(this,Hf(e).call(this,t)),In(Vr(i),"_getNewFormDataRow",function(){var o=i.props,l=o.schema,a=o.registry,h=a===void 0?Si():a,c=h.rootSchema,u=l.items;return _d(l)&&Kv(l)&&(u=l.additionalItems),qh(u,void 0,c)}),In(Vr(i),"onAddClick",function(o){o&&o.preventDefault();var l=i.props.onChange,a={key:jf(),item:i._getNewFormDataRow()},h=[].concat(ev(i.state.keyedFormData),[a]);i.setState({keyedFormData:h,updatedKeyedFormData:!0},function(){return l(Nl(h))})}),In(Vr(i),"onAddIndexClick",function(o){return function(l){l&&l.preventDefault();var a=i.props.onChange,h={key:jf(),item:i._getNewFormDataRow()},c=ev(i.state.keyedFormData);c.splice(o,0,h),i.setState({keyedFormData:c,updatedKeyedFormData:!0},function(){return a(Nl(c))})}}),In(Vr(i),"onDropIndexClick",function(o){return function(l){l&&l.preventDefault();var a=i.props.onChange,h=i.state.keyedFormData,c;if(i.props.errorSchema){c={};var u=i.props.errorSchema;for(var f in u)f=parseInt(f),f<o?c[f]=u[f]:f>o&&(c[f-1]=u[f])}var d=h.filter(function(p,g){return g!==o});i.setState({keyedFormData:d,updatedKeyedFormData:!0},function(){return a(Nl(d),c)})}}),In(Vr(i),"onReorderClick",function(o,l){return function(a){a&&(a.preventDefault(),a.target.blur());var h=i.props.onChange,c;if(i.props.errorSchema){c={};var u=i.props.errorSchema;for(var f in u)f==o?c[l]=u[o]:f==l?c[o]=u[l]:c[f]=u[f]}var d=i.state.keyedFormData;function p(){var y=d.slice();return y.splice(o,1),y.splice(l,0,d[o]),y}var g=p();i.setState({keyedFormData:g},function(){return h(Nl(g),c)})}}),In(Vr(i),"onChangeForIndex",function(o){return function(l,a){var h=i.props,c=h.formData,u=h.onChange,f=c.map(function(d,p){var g=typeof l=="undefined"?null:l;return o===p?g:d});u(f,a&&i.props.errorSchema&&Vf({},i.props.errorSchema,In({},o,a)))}}),In(Vr(i),"onSelectChange",function(o){i.props.onChange(o)});var r=t.formData,s=rv(r);return i.state={keyedFormData:s,updatedKeyedFormData:!1},i}return ZM(e,[{key:"isItemRequired",value:function(i){return Array.isArray(i.type)?!ze()(i.type,"null"):i.type!=="null"}},{key:"canAddItem",value:function(i){var r=this.props,s=r.schema,o=r.uiSchema,l=$r(o),a=l.addable;return a!==!1&&(s.maxItems!==void 0?a=i.length<s.maxItems:a=!0),a}},{key:"render",value:function(){var i=this.props,r=i.schema,s=i.uiSchema,o=i.idSchema,l=i.registry,a=l===void 0?Si():l,h=a.rootSchema;if(!r.hasOwnProperty("items")){var c=a.fields,u=c.UnsupportedField;return m.createElement(u,{schema:r,idSchema:o,reason:"Missing items definition"})}return _d(r)?this.renderFixedArray():qv(r,s,h)?this.renderFiles():Gh(r,h)?this.renderMultiSelect():this.renderNormalArray()}},{key:"renderNormalArray",value:function(){var i=this,r=this.props,s=r.schema,o=r.uiSchema,l=r.errorSchema,a=r.idSchema,h=r.name,c=r.required,u=r.disabled,f=r.readonly,d=r.autofocus,p=r.registry,g=p===void 0?Si():p,y=r.onBlur,v=r.onFocus,C=r.idPrefix,x=r.rawErrors,b=s.title===void 0?h:s.title,S=g.ArrayFieldTemplate,k=g.rootSchema,A=g.fields,_=g.formContext,O=A.TitleField,D=A.DescriptionField,T=Ye(s.items,k),B=Nl(this.state.keyedFormData),N={canAdd:this.canAddItem(B),items:this.state.keyedFormData.map(function(W,J){var re=W.key,ie=W.item,Ce=Ye(s.items,k,ie),Oe=l?l[J]:void 0,Ve=a.$id+"_"+J,st=Ws(Ce,Ve,k,ie,C);return i.renderArrayFieldItem({key:re,index:J,canMoveUp:J>0,canMoveDown:J<B.length-1,itemSchema:Ce,itemIdSchema:st,itemErrorSchema:Oe,itemData:ie,itemUiSchema:o.items,autofocus:d&&J===0,onBlur:y,onFocus:v})}),className:"field field-array field-array-of-".concat(T.type),DescriptionField:D,disabled:u,idSchema:a,uiSchema:o,onAddClick:this.onAddClick,readonly:f,required:c,schema:s,title:b,TitleField:O,formContext:_,formData:B,rawErrors:x,registry:g},ne=o["ui:ArrayFieldTemplate"]||S||tE;return m.createElement(ne,N)}},{key:"renderMultiSelect",value:function(){var i=this.props,r=i.schema,s=i.idSchema,o=i.uiSchema,l=i.formData,a=i.disabled,h=i.readonly,c=i.required,u=i.placeholder,f=i.autofocus,d=i.onBlur,p=i.onFocus,g=i.registry,y=g===void 0?Si():g,v=i.rawErrors,C=i.name,x=this.props.formData,b=y.widgets,S=y.rootSchema,k=y.formContext,A=Ye(r.items,S,l),_=r.title||C,O=Jh(A),D=Vf({},$r(o),{enumOptions:O}),T=D.widget,B=T===void 0?"select":T,N=Qy(D,["widget"]),ne=zr(r,B,b);return m.createElement(ne,{id:s&&s.$id,multiple:!0,onChange:this.onSelectChange,onBlur:d,onFocus:p,options:N,schema:r,registry:y,value:x,disabled:a,readonly:h,required:c,label:_,placeholder:u,formContext:k,autofocus:f,rawErrors:v})}},{key:"renderFiles",value:function(){var i=this.props,r=i.schema,s=i.uiSchema,o=i.idSchema,l=i.name,a=i.disabled,h=i.readonly,c=i.autofocus,u=i.onBlur,f=i.onFocus,d=i.registry,p=d===void 0?Si():d,g=i.rawErrors,y=r.title||l,v=this.props.formData,C=p.widgets,x=p.formContext,b=$r(s),S=b.widget,k=S===void 0?"files":S,A=Qy(b,["widget"]),_=zr(r,k,C);return m.createElement(_,{options:A,id:o&&o.$id,multiple:!0,onChange:this.onSelectChange,onBlur:u,onFocus:f,schema:r,title:y,value:v,disabled:a,readonly:h,formContext:x,autofocus:c,rawErrors:g})}},{key:"renderFixedArray",value:function(){var i=this,r=this.props,s=r.schema,o=r.uiSchema,l=r.formData,a=r.errorSchema,h=r.idPrefix,c=r.idSchema,u=r.name,f=r.required,d=r.disabled,p=r.readonly,g=r.autofocus,y=r.registry,v=y===void 0?Si():y,C=r.onBlur,x=r.onFocus,b=r.rawErrors,S=s.title||u,k=this.props.formData,A=v.ArrayFieldTemplate,_=v.rootSchema,O=v.fields,D=v.formContext,T=O.TitleField,B=s.items.map(function(J,re){return Ye(J,_,l[re])}),N=Kv(s)?Ye(s.additionalItems,_,l):null;(!k||k.length<B.length)&&(k=k||[],k=k.concat(new Array(B.length-k.length)));var ne={canAdd:this.canAddItem(k)&&N,className:"field field-array field-array-fixed-items",disabled:d,idSchema:c,formData:l,items:this.state.keyedFormData.map(function(J,re){var ie=J.key,Ce=J.item,Oe=re>=B.length,Ve=Oe?Ye(s.additionalItems,_,Ce):B[re],st=c.$id+"_"+re,jt=Ws(Ve,st,_,Ce,h),vr=Oe?o.additionalItems||{}:Array.isArray(o.items)?o.items[re]:o.items||{},Oj=a?a[re]:void 0;return i.renderArrayFieldItem({key:ie,index:re,canRemove:Oe,canMoveUp:re>=B.length+1,canMoveDown:Oe&&re<k.length-1,itemSchema:Ve,itemData:Ce,itemUiSchema:vr,itemIdSchema:jt,itemErrorSchema:Oj,autofocus:g&&re===0,onBlur:C,onFocus:x})}),onAddClick:this.onAddClick,readonly:p,required:f,schema:s,uiSchema:o,title:S,TitleField:T,formContext:D,rawErrors:b},W=o["ui:ArrayFieldTemplate"]||A||eE;return m.createElement(W,ne)}},{key:"renderArrayFieldItem",value:function(i){var r=i.key,s=i.index,o=i.canRemove,l=o===void 0?!0:o,a=i.canMoveUp,h=a===void 0?!0:a,c=i.canMoveDown,u=c===void 0?!0:c,f=i.itemSchema,d=i.itemData,p=i.itemUiSchema,g=i.itemIdSchema,y=i.itemErrorSchema,v=i.autofocus,C=i.onBlur,x=i.onFocus,b=i.rawErrors,S=this.props,k=S.disabled,A=S.readonly,_=S.uiSchema,O=S.registry,D=O===void 0?Si():O,T=D.fields.SchemaField,B=Vf({orderable:!0,removable:!0},_["ui:options"]),N=B.orderable,ne=B.removable,W={moveUp:N&&h,moveDown:N&&u,remove:ne&&l};return W.toolbar=Object.keys(W).some(function(J){return W[J]}),{children:m.createElement(T,{index:s,schema:f,uiSchema:p,formData:d,errorSchema:y,idSchema:g,required:this.isItemRequired(f),onChange:this.onChangeForIndex(s),onBlur:C,onFocus:x,registry:this.props.registry,disabled:this.props.disabled,readonly:this.props.readonly,autofocus:v,rawErrors:b}),className:"array-item",disabled:k,hasToolbar:W.toolbar,hasMoveUp:W.moveUp,hasMoveDown:W.moveDown,hasRemove:W.remove,index:s,key:r,onAddIndexClick:this.onAddIndexClick,onDropIndexClick:this.onDropIndexClick,onReorderClick:this.onReorderClick,readonly:A}}},{key:"itemTitle",get:function(){var i=this.props.schema;return i.items.title||i.items.description||"Item"}}],[{key:"getDerivedStateFromProps",value:function(i,r){if(r.updatedKeyedFormData)return{updatedKeyedFormData:!1};var s=i.formData||[],o=r.keyedFormData||[],l=s.length===o.length?o.map(function(a,h){return{key:a.key,item:s[h]}}):rv(s);return{keyedFormData:l}}}]),e}(m.Component);In(sv,"defaultProps",{uiSchema:{},formData:[],idSchema:{},required:!1,disabled:!1,readonly:!1,autofocus:!1});var iE=sv;function ov(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{},i=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(i=i.concat(Object.getOwnPropertySymbols(t).filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable}))),i.forEach(function(r){nE(n,r,t[r])})}return n}function nE(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function rE(n,e){if(n==null)return{};var t=sE(n,e),i,r;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);for(r=0;r<s.length;r++)i=s[r],!(e.indexOf(i)>=0)&&(!Object.prototype.propertyIsEnumerable.call(n,i)||(t[i]=n[i]))}return t}function sE(n,e){if(n==null)return{};var t={},i=Object.keys(n),r,s;for(s=0;s<i.length;s++)r=i[s],!(e.indexOf(r)>=0)&&(t[r]=n[r]);return t}function lv(n){var e=n.schema,t=n.name,i=n.uiSchema,r=n.idSchema,s=n.formData,o=n.registry,l=o===void 0?Si():o,a=n.required,h=n.disabled,c=n.readonly,u=n.autofocus,f=n.onChange,d=n.onFocus,p=n.onBlur,g=n.rawErrors,y=e.title,v=l.widgets,C=l.formContext,x=l.fields,b=$r(i),S=b.widget,k=S===void 0?"checkbox":S,A=rE(b,["widget"]),_=zr(e,k,v),O;return Array.isArray(e.oneOf)?O=Jh({oneOf:e.oneOf.map(function(D){return ov({},D,{title:D.title||(D.const===!0?"Yes":"No")})})}):O=Jh({enum:e.enum||[!0,!1],enumNames:e.enumNames||(e.enum&&e.enum[0]===!1?["No","Yes"]:["Yes","No"])}),m.createElement(_,{options:ov({},A,{enumOptions:O}),schema:e,uiSchema:i,id:r&&r.$id,onChange:f,onFocus:d,onBlur:p,label:y===void 0?t:y,value:s,required:a,disabled:h,readonly:c,registry:l,formContext:C,autofocus:u,rawErrors:g,DescriptionField:x.DescriptionField})}lv.defaultProps={uiSchema:{},disabled:!1,readonly:!1,autofocus:!1};var oE=lv;function lE(n){var e=n.id,t=n.description;return t?typeof t=="string"?m.createElement("p",{id:e,className:"field-description"},t):m.createElement("div",{id:e,className:"field-description"},t):null}var aE=lE;function Lh(n){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Lh=function(t){return typeof t}:Lh=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Lh(n)}function $f(){return $f=Object.assign||function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])}return n},$f.apply(this,arguments)}function hE(n,e){if(n==null)return{};var t=cE(n,e),i,r;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);for(r=0;r<s.length;r++)i=s[r],!(e.indexOf(i)>=0)&&(!Object.prototype.propertyIsEnumerable.call(n,i)||(t[i]=n[i]))}return t}function cE(n,e){if(n==null)return{};var t={},i=Object.keys(n),r,s;for(s=0;s<i.length;s++)r=i[s],!(e.indexOf(r)>=0)&&(t[r]=n[r]);return t}function uE(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function av(n,e){for(var t=0;t<e.length;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}}function fE(n,e,t){return e&&av(n.prototype,e),t&&av(n,t),n}function dE(n,e){return e&&(Lh(e)==="object"||typeof e=="function")?e:hv(n)}function Uf(n){return Uf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Uf(n)}function hv(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function pE(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),e&&qf(n,e)}function qf(n,e){return qf=Object.setPrototypeOf||function(i,r){return i.__proto__=r,i},qf(n,e)}function mE(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}var cv=function(n){pE(e,n);function e(t){var i;uE(this,e),i=dE(this,Uf(e).call(this,t)),mE(hv(i),"onOptionChange",function(l){var a=parseInt(l,10),h=i.props,c=h.formData,u=h.onChange,f=h.options,d=h.registry,p=d.rootSchema,g=Ye(f[a],p,c),y=void 0;if(To(c)==="object"&&(g.type==="object"||g.properties)){y=Object.assign({},c);var v=f.slice();v.splice(a,1);var C=!0,x=!1,b=void 0;try{for(var S=v[Symbol.iterator](),k;!(C=(k=S.next()).done);C=!0){var A=k.value;if(A.properties)for(var _ in A.properties)y.hasOwnProperty(_)&&delete y[_]}}catch(O){x=!0,b=O}finally{try{!C&&S.return!=null&&S.return()}finally{if(x)throw b}}}u(qh(f[a],y,p)),i.setState({selectedOption:parseInt(l,10)})});var r=i.props,s=r.formData,o=r.options;return i.state={selectedOption:i.getMatchingOption(s,o)},i}return fE(e,[{key:"componentDidUpdate",value:function(i,r){if(!Tn(this.props.formData,i.formData)&&this.props.idSchema.$id===i.idSchema.$id){var s=this.getMatchingOption(this.props.formData,this.props.options);if(!r||s===this.state.selectedOption)return;this.setState({selectedOption:s})}}},{key:"getMatchingOption",value:function(i,r){var s=this.props.registry.rootSchema,o=zl(i,r,s);return o!==0?o:this&&this.state?this.state.selectedOption:0}},{key:"render",value:function(){var i=this.props,r=i.baseType,s=i.disabled,o=i.errorSchema,l=i.formData,a=i.idPrefix,h=i.idSchema,c=i.onBlur,u=i.onChange,f=i.onFocus,d=i.options,p=i.registry,g=i.uiSchema,y=i.schema,v=p.fields.SchemaField,C=p.widgets,x=this.state.selectedOption,b=$r(g),S=b.widget,k=S===void 0?"select":S,A=hE(b,["widget"]),_=zr({type:"number"},k,C),O=d[x]||null,D;O&&(D=O.type?O:Object.assign({},O,{type:r}));var T=d.map(function(B,N){return{label:B.title||"Option ".concat(N+1),value:N}});return m.createElement("div",{className:"panel panel-default panel-body"},m.createElement("div",{className:"form-group"},m.createElement(_,$f({id:"".concat(h.$id).concat(y.oneOf?"__oneof_select":"__anyof_select"),schema:{type:"number",default:0},onChange:this.onOptionChange,onBlur:c,onFocus:f,value:x,options:{enumOptions:T}},A))),O!==null&&m.createElement(v,{schema:D,uiSchema:g,errorSchema:o,idSchema:h,idPrefix:a,formData:l,onChange:u,onBlur:c,onFocus:f,registry:p,disabled:s}))}}]),e}(m.Component);cv.defaultProps={disabled:!1,errorSchema:{},idSchema:{},uiSchema:{}};var uv=cv;function Fh(n){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Fh=function(t){return typeof t}:Fh=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Fh(n)}function Kf(){return Kf=Object.assign||function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])}return n},Kf.apply(this,arguments)}function gE(n,e){if(n==null)return{};var t=yE(n,e),i,r;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);for(r=0;r<s.length;r++)i=s[r],!(e.indexOf(i)>=0)&&(!Object.prototype.propertyIsEnumerable.call(n,i)||(t[i]=n[i]))}return t}function yE(n,e){if(n==null)return{};var t={},i=Object.keys(n),r,s;for(s=0;s<i.length;s++)r=i[s],!(e.indexOf(r)>=0)&&(t[r]=n[r]);return t}function vE(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function fv(n,e){for(var t=0;t<e.length;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}}function wE(n,e,t){return e&&fv(n.prototype,e),t&&fv(n,t),n}function bE(n,e){return e&&(Fh(e)==="object"||typeof e=="function")?e:dv(n)}function Gf(n){return Gf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Gf(n)}function dv(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function xE(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),e&&Jf(n,e)}function Jf(n,e){return Jf=Object.setPrototypeOf||function(i,r){return i.__proto__=r,i},Jf(n,e)}function SE(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}var kE=/\.([0-9]*0)*$/,CE=/[0.]0*$/,pv=function(n){xE(e,n);function e(t){var i;return vE(this,e),i=bE(this,Gf(e).call(this,t)),SE(dv(i),"handleChange",function(r){i.setState({lastValue:r}),"".concat(r).charAt(0)==="."&&(r="0".concat(r));var s=typeof r=="string"&&r.match(kE)?Eo(r.replace(CE,"")):Eo(r);i.props.onChange(s)}),i.state={lastValue:t.value},i}return wE(e,[{key:"render",value:function(){var i=this.props.registry.fields.StringField,r=this.props,s=r.formData,o=gE(r,["formData"]),l=this.state.lastValue,a=s;if(typeof l=="string"&&typeof a=="number"){var h=new RegExp("".concat(a).replace(".","\\.")+"\\.?0*$");l.match(h)&&(a=l)}return m.createElement(i,Kf({},o,{formData:a,onChange:this.handleChange}))}}]),e}(m.Component);pv.defaultProps={uiSchema:{}};var AE=pv;function Nh(n){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Nh=function(t){return typeof t}:Nh=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Nh(n)}function Zf(){return Zf=Object.assign||function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])}return n},Zf.apply(this,arguments)}function OE(n){return ME(n)||DE(n)||_E()}function _E(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function DE(n){if(Symbol.iterator in Object(n)||Object.prototype.toString.call(n)==="[object Arguments]")return Array.from(n)}function ME(n){if(Array.isArray(n)){for(var e=0,t=new Array(n.length);e<n.length;e++)t[e]=n[e];return t}}function _o(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{},i=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(i=i.concat(Object.getOwnPropertySymbols(t).filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable}))),i.forEach(function(r){en(n,r,t[r])})}return n}function EE(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function mv(n,e){for(var t=0;t<e.length;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}}function TE(n,e,t){return e&&mv(n.prototype,e),t&&mv(n,t),n}function PE(n,e){return e&&(Nh(e)==="object"||typeof e=="function")?e:Fs(n)}function Yf(n){return Yf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Yf(n)}function Fs(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function BE(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),e&&Xf(n,e)}function Xf(n,e){return Xf=Object.setPrototypeOf||function(i,r){return i.__proto__=r,i},Xf(n,e)}function en(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function RE(n){var e=n.TitleField,t=n.DescriptionField;return m.createElement("fieldset",{id:n.idSchema.$id},(n.uiSchema["ui:title"]||n.title)&&m.createElement(e,{id:"".concat(n.idSchema.$id,"__title"),title:n.title||n.uiSchema["ui:title"],required:n.required,formContext:n.formContext}),n.description&&m.createElement(t,{id:"".concat(n.idSchema.$id,"__description"),description:n.description,formContext:n.formContext}),n.properties.map(function(i){return i.content}),$v(n.schema,n.uiSchema,n.formData)&&m.createElement(ri,{className:"object-property-expand",onClick:n.onAddClick(n.schema),disabled:n.disabled||n.readonly}))}var gv=function(n){BE(e,n);function e(){var t,i;EE(this,e);for(var r=arguments.length,s=new Array(r),o=0;o<r;o++)s[o]=arguments[o];return i=PE(this,(t=Yf(e)).call.apply(t,[this].concat(s))),en(Fs(i),"state",{wasPropertyKeyModified:!1,additionalProperties:{}}),en(Fs(i),"onPropertyChange",function(l){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return function(h,c){h===void 0&&a&&(h="");var u=_o({},i.props.formData,en({},l,h));i.props.onChange(u,c&&i.props.errorSchema&&_o({},i.props.errorSchema,en({},l,c)))}}),en(Fs(i),"onDropPropertyClick",function(l){return function(a){a.preventDefault();var h=i.props,c=h.onChange,u=h.formData,f=_o({},u);delete f[l],c(f)}}),en(Fs(i),"getAvailableKey",function(l,a){for(var h=0,c=l;a.hasOwnProperty(c);)c="".concat(l,"-").concat(++h);return c}),en(Fs(i),"onKeyChange",function(l){return function(a,h){if(l!==a){a=i.getAvailableKey(a,i.props.formData);var c=_o({},i.props.formData),u=en({},l,a),f=Object.keys(c).map(function(p){var g=u[p]||p;return en({},g,c[p])}),d=Object.assign.apply(Object,[{}].concat(OE(f)));i.setState({wasPropertyKeyModified:!0}),i.props.onChange(d,h&&i.props.errorSchema&&_o({},i.props.errorSchema,en({},a,h)))}}}),en(Fs(i),"handleAddClick",function(l){return function(){var a=l.additionalProperties.type,h=_o({},i.props.formData);if(l.additionalProperties.hasOwnProperty("$ref")){var c=i.props.registry,u=c===void 0?Si():c,f=Ye({$ref:l.additionalProperties.$ref},u.rootSchema,i.props.formData);a=f.type}h[i.getAvailableKey("newKey",h)]=i.getDefaultValue(a),i.props.onChange(h)}}),i}return TE(e,[{key:"isRequired",value:function(i){var r=this.props.schema;return Array.isArray(r.required)&&r.required.indexOf(i)!==-1}},{key:"getDefaultValue",value:function(i){switch(i){case"string":return"New Value";case"array":return[];case"boolean":return!1;case"null":return null;case"number":return 0;case"object":return{};default:return"New Value"}}},{key:"render",value:function(){var i=this,r=this.props,s=r.uiSchema,o=r.formData,l=r.errorSchema,a=r.idSchema,h=r.name,c=r.required,u=r.disabled,f=r.readonly,d=r.idPrefix,p=r.onBlur,g=r.onFocus,y=r.registry,v=y===void 0?Si():y,C=v.rootSchema,x=v.fields,b=v.formContext,S=x.SchemaField,k=x.TitleField,A=x.DescriptionField,_=Ye(this.props.schema,C,o),O=_.title===void 0?h:_.title,D=s["ui:description"]||_.description,T;try{var B=Object.keys(_.properties||{});T=FP(B,s["ui:order"])}catch(W){return m.createElement("div",null,m.createElement("p",{className:"config-error",style:{color:"red"}},"Invalid ",h||"root"," object field configuration:",m.createElement("em",null,W.message),"."),m.createElement("pre",null,JSON.stringify(_)))}var N=s["ui:ObjectFieldTemplate"]||v.ObjectFieldTemplate||RE,ne={title:s["ui:title"]||O,description:D,TitleField:k,DescriptionField:A,properties:T.map(function(W){var J=_.properties[W].hasOwnProperty(Uh),re=J?s.additionalProperties:s[W],ie=re&&re["ui:widget"]==="hidden";return{content:m.createElement(S,{key:W,name:W,required:i.isRequired(W),schema:_.properties[W],uiSchema:re,errorSchema:l[W],idSchema:a[W],idPrefix:d,formData:(o||{})[W],wasPropertyKeyModified:i.state.wasPropertyKeyModified,onKeyChange:i.onKeyChange(W),onChange:i.onPropertyChange(W,J),onBlur:p,onFocus:g,registry:v,disabled:u,readonly:f,onDropPropertyClick:i.onDropPropertyClick}),name:W,readonly:f,disabled:u,required:c,hidden:ie}}),readonly:f,disabled:u,required:c,idSchema:a,uiSchema:s,schema:_,formData:o,formContext:b,registry:v};return m.createElement(N,Zf({},ne,{onAddClick:this.handleAddClick}))}}]),e}(m.Component);en(gv,"defaultProps",{uiSchema:{},formData:{},errorSchema:{},idSchema:{},required:!1,disabled:!1,readonly:!1});var LE=gv;function Ih(n){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Ih=function(t){return typeof t}:Ih=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ih(n)}function FE(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function yv(n,e){for(var t=0;t<e.length;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}}function NE(n,e,t){return e&&yv(n.prototype,e),t&&yv(n,t),n}function IE(n,e){return e&&(Ih(e)==="object"||typeof e=="function")?e:WE(n)}function WE(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function Qf(n){return Qf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Qf(n)}function VE(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),e&&ed(n,e)}function ed(n,e){return ed=Object.setPrototypeOf||function(i,r){return i.__proto__=r,i},ed(n,e)}function td(){return td=Object.assign||function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])}return n},td.apply(this,arguments)}function HE(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{},i=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(i=i.concat(Object.getOwnPropertySymbols(t).filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable}))),i.forEach(function(r){zE(n,r,t[r])})}return n}function zE(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function jE(n,e){if(n==null)return{};var t=$E(n,e),i,r;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);for(r=0;r<s.length;r++)i=s[r],!(e.indexOf(i)>=0)&&(!Object.prototype.propertyIsEnumerable.call(n,i)||(t[i]=n[i]))}return t}function $E(n,e){if(n==null)return{};var t={},i=Object.keys(n),r,s;for(s=0;s<i.length;s++)r=i[s],!(e.indexOf(r)>=0)&&(t[r]=n[r]);return t}var UE="*",qE={array:"ArrayField",boolean:"BooleanField",integer:"NumberField",number:"NumberField",object:"ObjectField",string:"StringField",null:"NullField"};function KE(n,e,t,i){var r=e["ui:field"];if(typeof r=="function")return r;if(typeof r=="string"&&r in i)return i[r];var s=qE[Mo(n)];return!s&&(n.anyOf||n.oneOf)?function(){return null}:s in i?i[s]:function(){var o=i.UnsupportedField;return m.createElement(o,{schema:n,idSchema:t,reason:"Unknown field type ".concat(n.type)})}}function vv(n){var e=n.label,t=n.required,i=n.id;return e?m.createElement("label",{className:"control-label",htmlFor:i},e,t&&m.createElement("span",{className:"required"},UE)):null}function GE(n){var e=n.id,t=n.label,i=n.onChange;return m.createElement("input",{className:"form-control",type:"text",id:e,onBlur:function(s){return i(s.target.value)},defaultValue:t})}function JE(n){var e=n.id,t=n.help;return t?typeof t=="string"?m.createElement("p",{id:e,className:"help-block"},t):m.createElement("div",{id:e,className:"help-block"},t):null}function ZE(n){var e=n.errors,t=e===void 0?[]:e;return t.length===0?null:m.createElement("div",null,m.createElement("ul",{className:"error-detail bs-callout bs-callout-info"},t.filter(function(i){return!!i}).map(function(i,r){return m.createElement("li",{className:"text-danger",key:r},i)})))}function wv(n){var e=n.id,t=n.label,i=n.children,r=n.errors,s=n.help,o=n.description,l=n.hidden,a=n.required,h=n.displayLabel;return l?m.createElement("div",{className:"hidden"},i):m.createElement(YE,n,h&&m.createElement(vv,{label:t,required:a,id:e}),h&&o?o:null,i,r,s)}wv.defaultProps={hidden:!1,readonly:!1,required:!1,displayLabel:!0};function YE(n){var e=n.id,t=n.classNames,i=n.disabled,r=n.label,s=n.onKeyChange,o=n.onDropPropertyClick,l=n.readonly,a=n.required,h=n.schema,c="".concat(r," Key"),u=h.hasOwnProperty(Uh);return u?m.createElement("div",{className:t},m.createElement("div",{className:"row"},m.createElement("div",{className:"col-xs-5 form-additional"},m.createElement("div",{className:"form-group"},m.createElement(vv,{label:c,required:a,id:"".concat(e,"-key")}),m.createElement(GE,{label:r,required:a,id:"".concat(e,"-key"),onChange:s}))),m.createElement("div",{className:"form-additional form-group col-xs-5"},n.children),m.createElement("div",{className:"col-xs-2"},m.createElement(Ot,{type:"danger",icon:"remove",className:"array-item-remove btn-block",tabIndex:"-1",style:{border:"0"},disabled:i||l,onClick:o(r)})))):m.createElement("div",{className:t},n.children)}function XE(n){var e=n.uiSchema,t=n.formData,i=n.errorSchema,r=n.idPrefix,s=n.name,o=n.onChange,l=n.onKeyChange,a=n.onDropPropertyClick,h=n.required,c=n.registry,u=c===void 0?Si():c,f=n.wasPropertyKeyModified,d=f===void 0?!1:f,p=u.rootSchema,g=u.fields,y=u.formContext,v=e["ui:FieldTemplate"]||u.FieldTemplate||wv,C=n.idSchema,x=Ye(n.schema,p,t);C=Ur(Ws(x,null,p,t,r),C);var b=KE(x,e,C,g),S=g.DescriptionField,k=Boolean(n.disabled||e["ui:disabled"]),A=Boolean(n.readonly||e["ui:readonly"]||n.schema.readOnly||x.readOnly),_=Boolean(n.autofocus||e["ui:autofocus"]);if(Object.keys(x).length===0)return null;var O=Uv(x,e,p),D=i.__errors,T=jE(i,["__errors"]),B=m.createElement(b,td({},n,{idSchema:C,schema:x,uiSchema:HE({},e,{classNames:void 0}),disabled:k,readonly:A,autofocus:_,errorSchema:T,formContext:y,rawErrors:D})),N=C.$id,ne;d?ne=s:ne=e["ui:title"]||n.schema.title||x.title||s;var W=e["ui:description"]||n.schema.description||x.description,J=D,re=e["ui:help"],ie=e["ui:widget"]==="hidden",Ce=["form-group","field","field-".concat(x.type),J&&J.length>0?"field-error has-error has-danger":"",e.classNames].join(" ").trim(),Oe={description:m.createElement(S,{id:N+"__description",description:W,formContext:y}),rawDescription:W,help:m.createElement(JE,{id:N+"__help",help:re}),rawHelp:typeof re=="string"?re:void 0,errors:m.createElement(ZE,{errors:J}),rawErrors:J,id:N,label:ne,hidden:ie,onChange:o,onKeyChange:l,onDropPropertyClick:a,required:h,disabled:k,readonly:A,displayLabel:O,classNames:Ce,formContext:y,formData:t,fields:g,schema:x,uiSchema:e,registry:u},Ve=u.fields.AnyOfField,st=u.fields.OneOfField;return m.createElement(v,Oe,m.createElement(m.Fragment,null,B,x.anyOf&&!Kh(x)&&m.createElement(Ve,{disabled:k,errorSchema:i,formData:t,idPrefix:r,idSchema:C,onBlur:n.onBlur,onChange:n.onChange,onFocus:n.onFocus,options:x.anyOf.map(function(jt){return Ye(jt,p,t)}),baseType:x.type,registry:u,schema:x,uiSchema:e}),x.oneOf&&!Kh(x)&&m.createElement(st,{disabled:k,errorSchema:i,formData:t,idPrefix:r,idSchema:C,onBlur:n.onBlur,onChange:n.onChange,onFocus:n.onFocus,options:x.oneOf.map(function(jt){return Ye(jt,p,t)}),baseType:x.type,registry:u,schema:x,uiSchema:e})))}var bv=function(n){VE(e,n);function e(){return FE(this,e),IE(this,Qf(e).apply(this,arguments))}return NE(e,[{key:"shouldComponentUpdate",value:function(i,r){return!Tn(this.props,i)}},{key:"render",value:function(){return XE(this.props)}}]),e}(m.Component);bv.defaultProps={uiSchema:{},errorSchema:{},idSchema:{},disabled:!1,readonly:!1,autofocus:!1};var QE=bv;function eT(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{},i=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(i=i.concat(Object.getOwnPropertySymbols(t).filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable}))),i.forEach(function(r){tT(n,r,t[r])})}return n}function tT(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function iT(n,e){if(n==null)return{};var t=nT(n,e),i,r;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);for(r=0;r<s.length;r++)i=s[r],!(e.indexOf(i)>=0)&&(!Object.prototype.propertyIsEnumerable.call(n,i)||(t[i]=n[i]))}return t}function nT(n,e){if(n==null)return{};var t={},i=Object.keys(n),r,s;for(s=0;s<i.length;s++)r=i[s],!(e.indexOf(r)>=0)&&(t[r]=n[r]);return t}function xv(n){var e=n.schema,t=n.name,i=n.uiSchema,r=n.idSchema,s=n.formData,o=n.required,l=n.disabled,a=n.readonly,h=n.autofocus,c=n.onChange,u=n.onBlur,f=n.onFocus,d=n.registry,p=d===void 0?Si():d,g=n.rawErrors,y=e.title,v=e.format,C=p.widgets,x=p.formContext,b=Kh(e)&&Jh(e),S=b?"select":"text";v&&LP(e,v,C)&&(S=v);var k=$r(i),A=k.widget,_=A===void 0?S:A,O=k.placeholder,D=O===void 0?"":O,T=iT(k,["widget","placeholder"]),B=zr(e,_,C);return m.createElement(B,{options:eT({},T,{enumOptions:b}),schema:e,uiSchema:i,id:r&&r.$id,label:y===void 0?t:y,value:s,onChange:c,onBlur:u,onFocus:f,required:o,disabled:l,readonly:a,formContext:x,autofocus:h,registry:p,placeholder:D,rawErrors:g})}xv.defaultProps={uiSchema:{},disabled:!1,readonly:!1,autofocus:!1};var rT=xv,sT="*";function oT(n){var e=n.id,t=n.title,i=n.required;return m.createElement("legend",{id:e},t,i&&m.createElement("span",{className:"required"},sT))}var lT=oT;function Wh(n){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Wh=function(t){return typeof t}:Wh=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Wh(n)}function aT(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function Sv(n,e){for(var t=0;t<e.length;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}}function hT(n,e,t){return e&&Sv(n.prototype,e),t&&Sv(n,t),n}function cT(n,e){return e&&(Wh(e)==="object"||typeof e=="function")?e:uT(n)}function uT(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function id(n){return id=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},id(n)}function fT(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),e&&nd(n,e)}function nd(n,e){return nd=Object.setPrototypeOf||function(i,r){return i.__proto__=r,i},nd(n,e)}var dT=function(n){fT(e,n);function e(){return aT(this,e),cT(this,id(e).apply(this,arguments))}return hT(e,[{key:"componentDidMount",value:function(){this.props.formData===void 0&&this.props.onChange(null)}},{key:"render",value:function(){return null}}]),e}(m.Component),pT=dT;function mT(n){var e=n.schema,t=n.idSchema,i=n.reason;return m.createElement("div",{className:"unsupported-field"},m.createElement("p",null,"Unsupported field schema",t&&t.$id&&m.createElement("span",null," for"," field ",m.createElement("code",null,t.$id)),i&&m.createElement("em",null,": ",i),"."),e&&m.createElement("pre",null,JSON.stringify(e,null,2)))}var gT=mT,yT={AnyOfField:uv,ArrayField:iE,BooleanField:oE,DescriptionField:aE,NumberField:AE,ObjectField:LE,OneOfField:uv,SchemaField:QE,StringField:rT,TitleField:lT,NullField:pT,UnsupportedField:gT};function Vh(n){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Vh=function(t){return typeof t}:Vh=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Vh(n)}function rd(){return rd=Object.assign||function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])}return n},rd.apply(this,arguments)}function vT(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function kv(n,e){for(var t=0;t<e.length;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}}function wT(n,e,t){return e&&kv(n.prototype,e),t&&kv(n,t),n}function bT(n,e){return e&&(Vh(e)==="object"||typeof e=="function")?e:Hh(n)}function sd(n){return sd=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},sd(n)}function Hh(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function xT(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),e&&od(n,e)}function od(n,e){return od=Object.setPrototypeOf||function(i,r){return i.__proto__=r,i},od(n,e)}function Il(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function ST(n,e){for(var t=[],i=n;i<=e;i++)t.push({value:i,label:qr(i,2)});return t}function kT(n){return Object.keys(n).every(function(e){return n[e]!==-1})}function CT(n){var e=n.type,t=n.range,i=n.value,r=n.select,s=n.rootId,o=n.disabled,l=n.readonly,a=n.autofocus,h=n.registry,c=n.onBlur,u=s+"_"+e,f=h.widgets.SelectWidget;return m.createElement(f,{schema:{type:"integer"},id:u,className:"form-control",options:{enumOptions:ST(t[0],t[1])},placeholder:e,value:i,disabled:o,readonly:l,autofocus:a,onChange:function(p){return r(e,p)},onBlur:c})}var Cv=function(n){xT(e,n);function e(t){var i;return vT(this,e),i=bT(this,sd(e).call(this,t)),Il(Hh(i),"onChange",function(r,s){i.setState(Il({},r,typeof s=="undefined"?-1:s),function(){kT(i.state)&&i.props.onChange(Yv(i.state,i.props.time))})}),Il(Hh(i),"setNow",function(r){r.preventDefault();var s=i.props,o=s.time,l=s.disabled,a=s.readonly,h=s.onChange;if(!(l||a)){var c=Hl(new Date().toJSON(),o);i.setState(c,function(){return h(Yv(i.state,o))})}}),Il(Hh(i),"clear",function(r){r.preventDefault();var s=i.props,o=s.time,l=s.disabled,a=s.readonly,h=s.onChange;l||a||i.setState(Hl("",o),function(){return h(void 0)})}),i.state=Hl(t.value,t.time),i}return wT(e,[{key:"componentDidUpdate",value:function(i,r){i.value&&i.value!==Hl(this.props.value,this.props.time)&&this.setState(Hl(this.props.value,this.props.time))}},{key:"shouldComponentUpdate",value:function(i,r){return Ed(this,i,r)}},{key:"render",value:function(){var i=this,r=this.props,s=r.id,o=r.disabled,l=r.readonly,a=r.autofocus,h=r.registry,c=r.onBlur,u=r.options;return m.createElement("ul",{className:"list-inline"},this.dateElementProps.map(function(f,d){return m.createElement("li",{key:d},m.createElement(CT,rd({rootId:s,select:i.onChange},f,{disabled:o,readonly:l,registry:h,onBlur:c,autofocus:a&&d===0})))}),(u.hideNowButton!=="undefined"?!u.hideNowButton:!0)&&m.createElement("li",null,m.createElement("a",{href:"#",className:"btn btn-info btn-now",onClick:this.setNow},"Now")),(u.hideClearButton!=="undefined"?!u.hideClearButton:!0)&&m.createElement("li",null,m.createElement("a",{href:"#",className:"btn btn-warning btn-clear",onClick:this.clear},"Clear")))}},{key:"dateElementProps",get:function(){var i=this.props,r=i.time,s=i.options,o=this.state,l=o.year,a=o.month,h=o.day,c=o.hour,u=o.minute,f=o.second,d=[{type:"year",range:s.yearsRange,value:l},{type:"month",range:[1,12],value:a},{type:"day",range:[1,31],value:h}];return r&&d.push({type:"hour",range:[0,23],value:c},{type:"minute",range:[0,59],value:u},{type:"second",range:[0,59],value:f}),d}}]),e}(m.Component);Il(Cv,"defaultProps",{time:!1,disabled:!1,readonly:!1,autofocus:!1,options:{yearsRange:[1900,new Date().getFullYear()+2]}});var Av=Cv;function AT(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{},i=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(i=i.concat(Object.getOwnPropertySymbols(t).filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable}))),i.forEach(function(r){OT(n,r,t[r])})}return n}function OT(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function ld(){return ld=Object.assign||function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])}return n},ld.apply(this,arguments)}function Ov(n){var e=n.registry.widgets.AltDateWidget;return m.createElement(e,ld({time:!0},n))}Ov.defaultProps=AT({},Av.defaultProps,{time:!0});var _T=Ov;function DT(n){return TT(n)||ET(n)||MT()}function MT(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function ET(n){if(Symbol.iterator in Object(n)||Object.prototype.toString.call(n)==="[object Arguments]")return Array.from(n)}function TT(n){if(Array.isArray(n)){for(var e=0,t=new Array(n.length);e<n.length;e++)t[e]=n[e];return t}}function ad(){return ad=Object.assign||function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])}return n},ad.apply(this,arguments)}function PT(n,e){if(n==null)return{};var t=BT(n,e),i,r;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);for(r=0;r<s.length;r++)i=s[r],!(e.indexOf(i)>=0)&&(!Object.prototype.propertyIsEnumerable.call(n,i)||(t[i]=n[i]))}return t}function BT(n,e){if(n==null)return{};var t={},i=Object.keys(n),r,s;for(s=0;s<i.length;s++)r=i[s],!(e.indexOf(r)>=0)&&(t[r]=n[r]);return t}function _v(n){if(!n.id)throw console.log("No id for",n),new Error("no id for props ".concat(JSON.stringify(n)));var e=n.value,t=n.readonly,i=n.disabled,r=n.autofocus,s=n.onBlur,o=n.onFocus,l=n.options,a=n.schema,h=n.uiSchema,c=n.formContext,u=n.registry,f=n.rawErrors,d=PT(n,["value","readonly","disabled","autofocus","onBlur","onFocus","options","schema","uiSchema","formContext","registry","rawErrors"]);l.inputType?d.type=l.inputType:d.type||(a.type==="number"?(d.type="number",d.step="any"):a.type==="integer"?(d.type="number",d.step="1"):d.type="text"),l.autocomplete&&(d.autoComplete=l.autocomplete),a.multipleOf&&(d.step=a.multipleOf),typeof a.minimum!="undefined"&&(d.min=a.minimum),typeof a.maximum!="undefined"&&(d.max=a.maximum);var p=function(y){var v=y.target.value;return n.onChange(v===""?l.emptyValue:v)};return[m.createElement("input",ad({key:d.id,className:"form-control",readOnly:t,disabled:i,autoFocus:r,value:e==null?"":e},d,{list:a.examples?"examples_".concat(d.id):null,onChange:p,onBlur:s&&function(g){return s(d.id,g.target.value)},onFocus:o&&function(g){return o(d.id,g.target.value)}})),a.examples?m.createElement("datalist",{key:"datalist_".concat(d.id),id:"examples_".concat(d.id)},DT(new Set(a.examples.concat(a.default?[a.default]:[]))).map(function(g){return m.createElement("option",{key:g,value:g})})):null]}_v.defaultProps={required:!1,disabled:!1,readonly:!1,autofocus:!1};var RT=_v;function Dv(n){var e=n.schema,t=n.id,i=n.value,r=n.disabled,s=n.readonly,o=n.label,l=n.autofocus,a=n.onBlur,h=n.onFocus,c=n.onChange,u=n.DescriptionField,f=jl(e);return m.createElement("div",{className:"checkbox ".concat(r||s?"disabled":"")},e.description&&m.createElement(u,{description:e.description}),m.createElement("label",null,m.createElement("input",{type:"checkbox",id:t,checked:typeof i=="undefined"?!1:i,required:f,disabled:r||s,autoFocus:l,onChange:function(p){return c(p.target.checked)},onBlur:a&&function(d){return a(t,d.target.checked)},onFocus:h&&function(d){return h(t,d.target.checked)}}),m.createElement("span",null,o)))}Dv.defaultProps={autofocus:!1};var LT=Dv;function FT(n,e,t){var i=t.indexOf(n),r=e.slice(0,i).concat(n,e.slice(i));return r.sort(function(s,o){return t.indexOf(s)>t.indexOf(o)})}function NT(n,e){return e.filter(function(t){return t!==n})}function Mv(n){var e=n.id,t=n.disabled,i=n.options,r=n.value,s=n.autofocus,o=n.readonly,l=n.onChange,a=i.enumOptions,h=i.enumDisabled,c=i.inline;return m.createElement("div",{className:"checkboxes",id:e},a.map(function(u,f){var d=r.indexOf(u.value)!==-1,p=h&&h.indexOf(u.value)!=-1,g=t||p||o?"disabled":"",y=m.createElement("span",null,m.createElement("input",{type:"checkbox",id:"".concat(e,"_").concat(f),checked:d,disabled:t||p||o,autoFocus:s&&f===0,onChange:function(C){var x=a.map(function(b){var S=b.value;return S});C.target.checked?l(FT(u.value,r,x)):l(NT(u.value,r))}}),m.createElement("span",null,u.label));return c?m.createElement("label",{key:f,className:"checkbox-inline ".concat(g)},y):m.createElement("div",{key:f,className:"checkbox ".concat(g)},m.createElement("label",null,y))}))}Mv.defaultProps={autofocus:!1,options:{inline:!1}};var IT=Mv;function hd(){return hd=Object.assign||function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])}return n},hd.apply(this,arguments)}function WT(n){var e=n.disabled,t=n.readonly,i=n.registry.widgets.BaseInput;return m.createElement(i,hd({type:"color"},n,{disabled:e||t}))}var VT=WT;function cd(){return cd=Object.assign||function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])}return n},cd.apply(this,arguments)}function HT(n){var e=n.onChange,t=n.registry.widgets.BaseInput;return m.createElement(t,cd({type:"date"},n,{onChange:function(r){return e(r||void 0)}}))}var zT=HT;function ud(){return ud=Object.assign||function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])}return n},ud.apply(this,arguments)}function jT(n){var e=n.value,t=n.onChange,i=n.registry.widgets.BaseInput;return m.createElement(i,ud({type:"datetime-local"},n,{value:Xv(e),onChange:function(s){return t(Qv(s))}}))}var $T=jT;function fd(){return fd=Object.assign||function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])}return n},fd.apply(this,arguments)}function UT(n){var e=n.registry.widgets.BaseInput;return m.createElement(e,fd({type:"email"},n))}var qT=UT;function zh(n){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?zh=function(t){return typeof t}:zh=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},zh(n)}function KT(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function Ev(n,e){for(var t=0;t<e.length;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}}function GT(n,e,t){return e&&Ev(n.prototype,e),t&&Ev(n,t),n}function JT(n,e){return e&&(zh(e)==="object"||typeof e=="function")?e:Tv(n)}function dd(n){return dd=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},dd(n)}function Tv(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function ZT(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),e&&pd(n,e)}function pd(n,e){return pd=Object.setPrototypeOf||function(i,r){return i.__proto__=r,i},pd(n,e)}function YT(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function XT(n,e){return n.replace(";base64",";name=".concat(encodeURIComponent(e),";base64"))}function QT(n){var e=n.name,t=n.size,i=n.type;return new Promise(function(r,s){var o=new window.FileReader;o.onerror=s,o.onload=function(l){r({dataURL:XT(l.target.result,e),name:e,size:t,type:i})},o.readAsDataURL(n)})}function eP(n){return Promise.all([].map.call(n,QT))}function tP(n){var e=n.filesInfo;return e.length===0?null:m.createElement("ul",{className:"file-info"},e.map(function(t,i){var r=t.name,s=t.size,o=t.type;return m.createElement("li",{key:i},m.createElement("strong",null,r)," (",o,", ",s," bytes)")}))}function iP(n){return n.filter(function(e){return typeof e!="undefined"}).map(function(e){var t=$P(e),i=t.blob,r=t.name;return{name:r,size:i.size,type:i.type}})}var Pv=function(n){ZT(e,n);function e(t){var i;KT(this,e),i=JT(this,dd(e).call(this,t)),YT(Tv(i),"onChange",function(o){var l=i.props,a=l.multiple,h=l.onChange;eP(o.target.files).then(function(c){var u={values:c.map(function(f){return f.dataURL}),filesInfo:c};i.setState(u,function(){h(a?u.values:u.values[0])})})});var r=t.value,s=Array.isArray(r)?r:[r];return i.state={values:s,filesInfo:iP(s)},i}return GT(e,[{key:"shouldComponentUpdate",value:function(i,r){return Ed(this,i,r)}},{key:"render",value:function(){var i=this,r=this.props,s=r.multiple,o=r.id,l=r.readonly,a=r.disabled,h=r.autofocus,c=r.options,u=this.state.filesInfo;return m.createElement("div",null,m.createElement("p",null,m.createElement("input",{ref:function(d){return i.inputRef=d},id:o,type:"file",disabled:l||a,onChange:this.onChange,defaultValue:"",autoFocus:h,multiple:s,accept:c.accept})),m.createElement(tP,{filesInfo:u}))}}]),e}(m.Component);Pv.defaultProps={autofocus:!1};var nP=Pv;function rP(n){var e=n.id,t=n.value;return m.createElement("input",{type:"hidden",id:e,value:typeof t=="undefined"?"":t})}var sP=rP;function md(){return md=Object.assign||function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])}return n},md.apply(this,arguments)}function oP(n){var e=n.registry.widgets.BaseInput;return m.createElement(e,md({type:"password"},n))}var lP=oP;function Bv(n){var e=n.options,t=n.value,i=n.required,r=n.disabled,s=n.readonly,o=n.autofocus,l=n.onBlur,a=n.onFocus,h=n.onChange,c=n.id,u=Math.random().toString(),f=e.enumOptions,d=e.enumDisabled,p=e.inline;return m.createElement("div",{className:"field-radio-group",id:c},f.map(function(g,y){var v=g.value===t,C=d&&d.indexOf(g.value)!=-1,x=r||C||s?"disabled":"",b=m.createElement("span",null,m.createElement("input",{type:"radio",checked:v,name:u,required:i,value:g.value,disabled:r||C||s,autoFocus:o&&y===0,onChange:function(k){return h(g.value)},onBlur:l&&function(S){return l(c,S.target.value)},onFocus:a&&function(S){return a(c,S.target.value)}}),m.createElement("span",null,g.label));return p?m.createElement("label",{key:y,className:"radio-inline ".concat(x)},b):m.createElement("div",{key:y,className:"radio ".concat(x)},m.createElement("label",null,b))}))}Bv.defaultProps={autofocus:!1};var aP=Bv;function gd(){return gd=Object.assign||function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])}return n},gd.apply(this,arguments)}function hP(n){var e=n.schema,t=n.value,i=n.registry.widgets.BaseInput;return m.createElement("div",{className:"field-range-wrapper"},m.createElement(i,gd({type:"range"},n,Td(e))),m.createElement("span",{className:"range-view"},t))}var cP=hP,uP=new Set(["number","integer"]);function yd(n,e){var t=n.type,i=n.items;if(e!==""){{if(t==="array"&&i&&uP.has(i.type))return e.map(Eo);if(t==="boolean")return e==="true";if(t==="number")return Eo(e)}if(n.enum){if(n.enum.every(function(r){return To(r)==="number"}))return Eo(e);if(n.enum.every(function(r){return To(r)==="boolean"}))return e==="true"}return e}}function vd(n,e){return e?[].slice.call(n.target.options).filter(function(t){return t.selected}).map(function(t){return t.value}):n.target.value}function Rv(n){var e=n.schema,t=n.id,i=n.options,r=n.value,s=n.required,o=n.disabled,l=n.readonly,a=n.multiple,h=n.autofocus,c=n.onChange,u=n.onBlur,f=n.onFocus,d=n.placeholder,p=i.enumOptions,g=i.enumDisabled,y=a?[]:"";return m.createElement("select",{id:t,multiple:a,className:"form-control",value:typeof r=="undefined"?y:r,required:s,disabled:o||l,autoFocus:h,onBlur:u&&function(v){var C=vd(v,a);u(t,yd(e,C))},onFocus:f&&function(v){var C=vd(v,a);f(t,yd(e,C))},onChange:function(C){var x=vd(C,a);c(yd(e,x))}},!a&&e.default===void 0&&m.createElement("option",{value:""},d),p.map(function(v,C){var x=v.value,b=v.label,S=g&&g.indexOf(x)!=-1;return m.createElement("option",{key:C,value:x,disabled:S},b)}))}Rv.defaultProps={autofocus:!1};var fP=Rv;function Lv(n){var e=n.id,t=n.options,i=n.placeholder,r=n.value,s=n.required,o=n.disabled,l=n.readonly,a=n.autofocus,h=n.onChange,c=n.onBlur,u=n.onFocus,f=function(p){var g=p.target.value;return h(g===""?t.emptyValue:g)};return m.createElement("textarea",{id:e,className:"form-control",value:r||"",placeholder:i,required:s,disabled:o,readOnly:l,autoFocus:a,rows:t.rows,onBlur:c&&function(d){return c(e,d.target.value)},onFocus:u&&function(d){return u(e,d.target.value)},onChange:f})}Lv.defaultProps={autofocus:!1,options:{}};var dP=Lv;function pP(n){var e=n.registry.widgets.BaseInput;return m.createElement(e,n)}var mP=pP;function wd(){return wd=Object.assign||function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])}return n},wd.apply(this,arguments)}function gP(n){var e=n.registry.widgets.BaseInput;return m.createElement(e,wd({type:"url"},n))}var yP=gP;function bd(){return bd=Object.assign||function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])}return n},bd.apply(this,arguments)}function vP(n){var e=n.registry.widgets.BaseInput;return m.createElement(e,bd({type:"number"},n,Td(n.schema)))}var wP=vP,bP={BaseInput:RT,PasswordWidget:lP,RadioWidget:aP,UpDownWidget:wP,RangeWidget:cP,SelectWidget:fP,TextWidget:mP,DateWidget:zT,DateTimeWidget:$T,AltDateWidget:Av,AltDateTimeWidget:_T,EmailWidget:qT,URLWidget:yP,TextareaWidget:dP,HiddenWidget:sP,ColorWidget:VT,FileWidget:nP,CheckboxWidget:LT,CheckboxesWidget:IT},xP=w(25497),SP=w.n(xP),kP=w(84778),CP=w.n(kP);function Fv(n){return _P(n)||OP(n)||AP()}function AP(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function OP(n){if(Symbol.iterator in Object(n)||Object.prototype.toString.call(n)==="[object Arguments]")return Array.from(n)}function _P(n){if(Array.isArray(n)){for(var e=0,t=new Array(n.length);e<n.length;e++)t[e]=n[e];return t}}function Do(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{},i=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(i=i.concat(Object.getOwnPropertySymbols(t).filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable}))),i.forEach(function(r){Wl(n,r,t[r])})}return n}function Wl(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}var Hr=Wv(),Nv=null,Iv=null,xd="__rjsf_rootSchema";function Wv(){var n=new(CP())({errorDataPath:"property",allErrors:!0,multipleOfPrecision:8,schemaId:"auto",unknownFormats:"ignore"});return n.addFormat("data-url",/^data:([a-z]+\/[a-z0-9-+.]+)?;(?:name=(.*);)?base64,(.*)$/),n.addFormat("color",/^(#?([0-9A-Fa-f]{3}){1,2}\b|aqua|black|blue|fuchsia|gray|green|lime|maroon|navy|olive|orange|purple|red|silver|teal|white|yellow|(rgb\(\s*\b([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\b\s*,\s*\b([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\b\s*,\s*\b([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\b\s*\))|(rgb\(\s*(\d?\d%|100%)+\s*,\s*(\d?\d%|100%)+\s*,\s*(\d?\d%|100%)+\s*\)))$/),n}function DP(n){return n.length?n.reduce(function(e,t){var i=t.property,r=t.message,s=SP()(i),o=e;s.length>0&&s[0]===""&&s.splice(0,1);var l=!0,a=!1,h=void 0;try{for(var c=s.slice(0)[Symbol.iterator](),u;!(l=(u=c.next()).done);l=!0){var f=u.value;f in o||(o[f]={}),o=o[f]}}catch(d){a=!0,h=d}finally{try{!l&&c.return!=null&&c.return()}finally{if(a)throw h}}return Array.isArray(o.__errors)?o.__errors=o.__errors.concat(r):r&&(o.__errors=[r]),e},{}):{}}function Ns(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"root",t=[];return"__errors"in n&&(t=t.concat(n.__errors.map(function(i){return{stack:"".concat(e,": ").concat(i)}}))),Object.keys(n).reduce(function(i,r){return r!=="__errors"&&(i=i.concat(Ns(n[r],r))),i},t)}function Sd(n){var e={__errors:[],addError:function(i){this.__errors.push(i)}};return It(n)?Object.keys(n).reduce(function(t,i){return Do({},t,Wl({},i,Sd(n[i])))},e):Array.isArray(n)?n.reduce(function(t,i,r){return Do({},t,Wl({},r,Sd(i)))},e):e}function Vv(n){return Object.keys(n).reduce(function(e,t){return t==="addError"?e:t==="__errors"?Do({},e,Wl({},t,n[t])):Do({},e,Wl({},t,Vv(n[t])))},{})}function MP(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return n===null?[]:n.map(function(e){var t=e.dataPath,i=e.keyword,r=e.message,s=e.params,o=e.schemaPath,l="".concat(t);return{name:i,property:l,message:r,params:s,stack:"".concat(l," ").concat(r).trim(),schemaPath:o}})}function Hv(n,e,t,i){var r=arguments.length>4&&arguments[4]!==void 0?arguments[4]:[],s=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{},o=e;n=qh(e,n,o,!0);var l=!Tn(Iv,r),a=!Tn(Nv,s);(l||a)&&(Hr=Wv()),r&&l&&Array.isArray(r)&&(Hr.addMetaSchema(r),Iv=r),s&&a&&It(s)&&(Object.keys(s).forEach(function(v){Hr.addFormat(v,s[v])}),Nv=s);var h=null;try{Hr.validate(e,n)}catch(v){h=v}var c=MP(Hr.errors);Hr.errors=null;var u=h&&h.message&&typeof h.message=="string"&&h.message.includes("no schema with key or ref ");u&&(c=[].concat(Fv(c),[{stack:h.message}])),typeof i=="function"&&(c=i(c));var f=DP(c);if(u&&(f=Do({},f,{$schema:{__errors:[h.message]}})),typeof t!="function")return{errors:c,errorSchema:f};var d=t(n,Sd(n)),p=Vv(d),g=Ur(f,p,!0),y=Ns(g);return{errors:y,errorSchema:g}}function kd(n){var e=n;if(n.constructor===Object){e=Do({},n);for(var t in e){var i=e[t];t==="$ref"&&typeof i=="string"&&i.startsWith("#")?e[t]=xd+i:e[t]=kd(i)}}else if(Array.isArray(n)){e=Fv(n);for(var r=0;r<e.length;r++)e[r]=kd(e[r])}return e}function zv(n,e,t){try{return Hr.addSchema(t,xd).validate(kd(n),e)}catch{return!1}finally{Hr.removeSchema(xd)}}function jv(n){var e=EP(n,"string");return yn(e)==="symbol"?e:String(e)}function EP(n,e){if(yn(n)!=="object"||n===null)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var i=t.call(n,e||"default");if(yn(i)!=="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function jh(n){return BP(n)||PP(n)||TP()}function TP(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function PP(n){if(Symbol.iterator in Object(n)||Object.prototype.toString.call(n)==="[object Arguments]")return Array.from(n)}function BP(n){if(Array.isArray(n)){for(var e=0,t=new Array(n.length);e<n.length;e++)t[e]=n[e];return t}}function yn(n){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?yn=function(t){return typeof t}:yn=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},yn(n)}function $h(){return $h=Object.assign||function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])}return n},$h.apply(this,arguments)}function vn(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{},i=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(i=i.concat(Object.getOwnPropertySymbols(t).filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable}))),i.forEach(function(r){Cd(n,r,t[r])})}return n}function Cd(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function Is(n,e){if(n==null)return{};var t=RP(n,e),i,r;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);for(r=0;r<s.length;r++)i=s[r],!(e.indexOf(i)>=0)&&(!Object.prototype.propertyIsEnumerable.call(n,i)||(t[i]=n[i]))}return t}function RP(n,e){if(n==null)return{};var t={},i=Object.keys(n),r,s;for(s=0;s<i.length;s++)r=i[s],!(e.indexOf(r)>=0)&&(t[r]=n[r]);return t}var Uh="__additional_property",Ad={boolean:{checkbox:"CheckboxWidget",radio:"RadioWidget",select:"SelectWidget",hidden:"HiddenWidget"},string:{text:"TextWidget",password:"PasswordWidget",email:"EmailWidget",hostname:"TextWidget",ipv4:"TextWidget",ipv6:"TextWidget",uri:"URLWidget","data-url":"FileWidget",radio:"RadioWidget",select:"SelectWidget",textarea:"TextareaWidget",hidden:"HiddenWidget",date:"DateWidget",datetime:"DateTimeWidget","date-time":"DateTimeWidget","alt-date":"AltDateWidget","alt-datetime":"AltDateTimeWidget",color:"ColorWidget",file:"FileWidget"},number:{text:"TextWidget",select:"SelectWidget",updown:"UpDownWidget",range:"RangeWidget",radio:"RadioWidget",hidden:"HiddenWidget"},integer:{text:"TextWidget",select:"SelectWidget",updown:"UpDownWidget",range:"RangeWidget",radio:"RadioWidget",hidden:"HiddenWidget"},array:{select:"SelectWidget",checkboxes:"CheckboxesWidget",files:"FileWidget",hidden:"HiddenWidget"}};function $v(n,e,t){if(!n.additionalProperties)return!1;var i=$r(e),r=i.expandable;return r===!1?r:n.maxProperties!==void 0?Object.keys(t).length<n.maxProperties:!0}function Si(){return{fields:yT,widgets:bP,definitions:{},rootSchema:{},formContext:{}}}function Mo(n){var e=n.type;return!e&&n.const?To(n.const):!e&&n.enum?"string":!e&&(n.properties||n.additionalProperties)?"object":e instanceof Array&&e.length===2&&e.includes("null")?e.find(function(t){return t!=="null"}):e}function zr(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i=Mo(n);function r(l){if(!l.MergedWidget){var a=l.defaultProps&&l.defaultProps.options||{};l.MergedWidget=function(h){var c=h.options,u=c===void 0?{}:c,f=Is(h,["options"]);return m.createElement(l,$h({options:vn({},a,u)},f))}}return l.MergedWidget}if(typeof e=="function"||E.isForwardRef(m.createElement(e))||E.isMemo(e))return r(e);if(typeof e!="string")throw new Error("Unsupported widget definition: ".concat(yn(e)));if(t.hasOwnProperty(e)){var s=t[e];return zr(n,s,t)}if(!Ad.hasOwnProperty(i))throw new Error('No widget for type "'.concat(i,'"'));if(Ad[i].hasOwnProperty(e)){var o=t[Ad[i][e]];return zr(n,o,t)}throw new Error('No widget "'.concat(e,'" for type "').concat(i,'"'))}function LP(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};try{return zr(n,e,t),!0}catch(i){if(i.message&&(i.message.startsWith("No widget")||i.message.startsWith("Unsupported widget")))return!1;throw i}}function jr(n,e,t){var i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{},r=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1,s=It(n)?n:{},o=It(i)?i:{},l=e;if(It(l)&&It(s.default))l=Ur(l,s.default);else if("default"in s)l=s.default;else if("$ref"in s){var a=Dd(s.$ref,t);return jr(a,l,t,o,r)}else if("dependencies"in s){var h=Jv(s,t,o);return jr(h,l,t,o,r)}else _d(s)?l=s.items.map(function(p,g){return jr(p,Array.isArray(e)?e[g]:void 0,t,o,r)}):"oneOf"in s?s=s.oneOf[zl(void 0,s.oneOf,t)]:"anyOf"in s&&(s=s.anyOf[zl(void 0,s.anyOf,t)]);switch(typeof l=="undefined"&&(l=s.default),Mo(s)){case"object":return Object.keys(s.properties||{}).reduce(function(p,g){var y=jr(s.properties[g],(l||{})[g],t,(o||{})[g],r);return(r||y!==void 0)&&(p[g]=y),p},{});case"array":if(Array.isArray(l)&&(l=l.map(function(p,g){return jr(s.items[g]||s.additionalItems||{},p,t)})),Array.isArray(i)&&(l=i.map(function(p,g){return jr(s.items,(l||{})[g],t,p)})),s.minItems){if(Gh(s,t))return l||[];var c=l?l.length:0;if(s.minItems>c){var u=l||[],f=Array.isArray(s.items)?s.additionalItems:s.items,d=Me()(new Array(s.minItems-c),jr(f,f.defaults,t));return u.concat(d)}}}return l}function qh(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if(!It(n))throw new Error("Invalid schema: "+n);var r=Ye(n,t,e),s=jr(r,n.default,t,e,i);return typeof e=="undefined"?s:It(e)||Array.isArray(e)?Od(s,e):e===0||e===!1||e===""?e:e||s}function Od(n,e){if(Array.isArray(e))return Array.isArray(n)||(n=[]),e.map(function(i,r){return n[r]?Od(n[r],i):i});if(It(e)){var t=Object.assign({},n);return Object.keys(e).reduce(function(i,r){return i[r]=Od(n?n[r]:{},e[r]),i},t)}else return e}function $r(n){return Object.keys(n).filter(function(e){return e.indexOf("ui:")===0}).reduce(function(e,t){var i=n[t];return t==="ui:widget"&&It(i)?(console.warn("Setting options via ui:widget object is deprecated, use ui:options instead"),vn({},e,i.options||{},{widget:i.component})):t==="ui:options"&&It(i)?vn({},e,i):vn({},e,Cd({},t.substring(3),i))},{})}function Uv(n,e,t){var i=$r(e),r=i.label,s=r===void 0?!0:r,o=Mo(n);return o==="array"&&(s=Gh(n,t)||qv(n,e,t)),o==="object"&&(s=!1),o==="boolean"&&!e["ui:widget"]&&(s=!1),e["ui:field"]&&(s=!1),s}function It(n){return typeof File!="undefined"&&n instanceof File?!1:yn(n)==="object"&&n!==null&&!Array.isArray(n)}function Ur(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=Object.assign({},n);return Object.keys(e).reduce(function(r,s){var o=n?n[s]:{},l=e[s];return n&&n.hasOwnProperty(s)&&It(l)?r[s]=Ur(o,l,t):t&&Array.isArray(o)&&Array.isArray(l)?r[s]=o.concat(l):r[s]=l,r},i)}function Eo(n){if(n!==""){if(n===null)return null;if(/\.$/.test(n)||/\.0$/.test(n))return n;var e=Number(n),t=typeof e=="number"&&!Number.isNaN(e);return/\.\d*0$/.test(n)?n:t?e:n}}function FP(n,e){if(!Array.isArray(e))return n;var t=function(u){return u.reduce(function(f,d){return f[d]=!0,f},{})},i=function(u){return u.length>1?"properties '".concat(u.join("', '"),"'"):"property '".concat(u[0],"'")},r=t(n),s=e.filter(function(c){return c==="*"||r[c]}),o=t(s),l=n.filter(function(c){return!o[c]}),a=s.indexOf("*");if(a===-1){if(l.length)throw new Error("uiSchema order list does not contain ".concat(i(l)));return s}if(a!==s.lastIndexOf("*"))throw new Error("uiSchema order list contains more than one wildcard item");var h=jh(s);return h.splice.apply(h,[a,1].concat(jh(l))),h}function NP(n){return Array.isArray(n.enum)&&n.enum.length===1||n.hasOwnProperty("const")}function IP(n){if(Array.isArray(n.enum)&&n.enum.length===1)return n.enum[0];if(n.hasOwnProperty("const"))return n.const;throw new Error("schema cannot be inferred as a constant")}function Kh(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=Ye(n,e),i=t.oneOf||t.anyOf;return Array.isArray(t.enum)?!0:Array.isArray(i)?i.every(function(r){return NP(r)}):!1}function Gh(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return!n.uniqueItems||!n.items?!1:Kh(n.items,e)}function qv(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(e["ui:widget"]==="files")return!0;if(n.items){var i=Ye(n.items,t);return i.type==="string"&&i.format==="data-url"}return!1}function _d(n){return Array.isArray(n.items)&&n.items.length>0&&n.items.every(function(e){return It(e)})}function Kv(n){return n.additionalItems===!0&&console.warn("additionalItems=true is currently not supported"),It(n.additionalItems)}function Jh(n){if(n.enum)return n.enum.map(function(t,i){var r=n.enumNames&&n.enumNames[i]||String(t);return{label:r,value:t}});var e=n.oneOf||n.anyOf;return e.map(function(t,i){var r=IP(t),s=t.title||String(r);return{schema:t,label:s,value:r}})}function Dd(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=n;if(n.startsWith("#"))n=decodeURIComponent(n.substring(1));else throw new Error("Could not find a definition for ".concat(t,"."));var i=ot.get(e,n);if(i===void 0)throw new Error("Could not find a definition for ".concat(t,"."));return i.hasOwnProperty("$ref")?Dd(i.$ref,e):i}var To=function(e){if(Array.isArray(e))return"array";if(typeof e=="string")return"string";if(e==null)return"null";if(typeof e=="boolean")return"boolean";if(isNaN(e)){if(yn(e)==="object")return"object"}else return"number";return"string"};function WP(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return n=vn({},n,{properties:vn({},n.properties)}),t=It(t)?t:{},Object.keys(t).forEach(function(i){if(!n.properties.hasOwnProperty(i)){var r;n.additionalProperties.hasOwnProperty("$ref")?r=Ye({$ref:n.additionalProperties.$ref},e,t):n.additionalProperties.hasOwnProperty("type")?r=vn({},n.additionalProperties):r={type:To(t[i])},n.properties[i]=r,n.properties[i][Uh]=!0}}),n}function VP(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(n.hasOwnProperty("$ref"))return Gv(n,e,t);if(n.hasOwnProperty("dependencies")){var i=Jv(n,e,t);return Ye(i,e,t)}else return n.hasOwnProperty("allOf")?vn({},n,{allOf:n.allOf.map(function(r){return Ye(r,e,t)})}):n}function Gv(n,e,t){var i=Dd(n.$ref,e),r=n.$ref,s=Is(n,["$ref"]);return Ye(vn({},i,s),e,t)}function Ye(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(!It(n))return{};var i=VP(n,e,t);if("allOf"in n)try{i=se()(vn({},i,{allOf:i.allOf}))}catch(a){console.warn(`could not merge subschemas in allOf:
`+a);var r=i,s=r.allOf,o=Is(r,["allOf"]);return o}var l=i.hasOwnProperty("additionalProperties")&&i.additionalProperties!==!1;return l?WP(i,e,t):i}function Jv(n,e,t){var i=n.dependencies,r=i===void 0?{}:i,s=Is(n,["dependencies"]);return"oneOf"in s?s=s.oneOf[zl(t,s.oneOf,e)]:"anyOf"in s&&(s=s.anyOf[zl(t,s.anyOf,e)]),Zv(r,s,e,t)}function Zv(n,e,t,i){for(var r in n)if(i[r]!==void 0&&!(e.properties&&!(r in e.properties))){var s=n[r],o=Is(n,[r].map(jv));return Array.isArray(s)?e=HP(e,s):It(s)&&(e=zP(e,t,i,r,s)),Zv(o,e,t,i)}return e}function HP(n,e){if(!e)return n;var t=Array.isArray(n.required)?Array.from(new Set([].concat(jh(n.required),jh(e)))):e;return vn({},n,{required:t})}function zP(n,e,t,i,r){var s=Ye(r,e,t),o=s.oneOf,l=Is(s,["oneOf"]);if(n=Md(n,l),o===void 0)return n;if(!Array.isArray(o))throw new Error("invalid: it is some ".concat(yn(o)," instead of an array"));var a=o.map(function(h){return h.hasOwnProperty("$ref")?Gv(h,e,t):h});return jP(n,e,t,i,a)}function jP(n,e,t,i,r){var s=r.filter(function(u){if(!u.properties)return!1;var f=u.properties[i];if(f){var d={type:"object",properties:Cd({},i,f)},p=Hv(t,d),g=p.errors;return g.length===0}});if(s.length!==1)return console.warn("ignoring oneOf in dependencies because there isn't exactly one subschema that is valid"),n;var o=s[0],l=o.properties,a=l[i],h=Is(l,[i].map(jv)),c=vn({},o,{properties:h});return Md(n,Ye(c,e,t))}function Md(n,e){var t=Object.assign({},n);return Object.keys(e).reduce(function(i,r){var s=n?n[r]:{},o=e[r];return n&&n.hasOwnProperty(r)&&It(o)?i[r]=Md(s,o):n&&e&&(Mo(n)==="object"||Mo(e)==="object")&&r==="required"&&Array.isArray(s)&&Array.isArray(o)?i[r]=Be()(s,o):i[r]=o,i},t)}function Zh(n){return Object.prototype.toString.call(n)==="[object Arguments]"}function Tn(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[];if(n===e)return!0;if(typeof n=="function"||typeof e=="function")return!0;if(yn(n)!=="object"||yn(e)!=="object")return!1;if(n===null||e===null)return!1;if(n instanceof Date&&e instanceof Date)return n.getTime()===e.getTime();if(n instanceof RegExp&&e instanceof RegExp)return n.source===e.source&&n.global===e.global&&n.multiline===e.multiline&&n.lastIndex===e.lastIndex&&n.ignoreCase===e.ignoreCase;if(Zh(n)||Zh(e)){if(!(Zh(n)&&Zh(e)))return!1;var r=Array.prototype.slice;return Tn(r.call(n),r.call(e),t,i)}else{if(n.constructor!==e.constructor)return!1;var s=Object.keys(n),o=Object.keys(e);if(s.length===0&&o.length===0)return!0;if(s.length!==o.length)return!1;for(var l=t.length;l--;)if(t[l]===n)return i[l]===e;t.push(n),i.push(e),s.sort(),o.sort();for(var a=s.length-1;a>=0;a--)if(s[a]!==o[a])return!1;for(var h,c=s.length-1;c>=0;c--)if(h=s[c],!Tn(n[h],e[h],t,i))return!1;return t.pop(),i.pop(),!0}}function Ed(n,e,t){var i=n.props,r=n.state;return!Tn(i,e)||!Tn(r,t)}function Ws(n,e,t){var i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{},r=arguments.length>4&&arguments[4]!==void 0?arguments[4]:"root",s={$id:e||r};if("$ref"in n||"dependencies"in n||"allOf"in n){var o=Ye(n,t,i);return Ws(o,e,t,i,r)}if("items"in n&&!n.items.$ref)return Ws(n.items,e,t,i,r);if(n.type!=="object")return s;for(var l in n.properties||{}){var a=n.properties[l],h=s.$id+"_"+l;s[l]=Ws(It(a)?a:{},h,t,(i||{})[l],r)}return s}function Vl(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",t=arguments.length>2?arguments[2]:void 0,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{},r={$name:e.replace(/^\./,"")};if("$ref"in n||"dependencies"in n||"allOf"in n){var s=Ye(n,t,i);return Vl(s,e,t,i)}if(n.hasOwnProperty("additionalProperties")&&(r.__rjsf_additionalProperties=!0),n.hasOwnProperty("items")&&Array.isArray(i))i.forEach(function(l,a){r[a]=Vl(n.items,"".concat(e,".").concat(a),t,l)});else if(n.hasOwnProperty("properties"))for(var o in n.properties)r[o]=Vl(n.properties[o],"".concat(e,".").concat(o),t,(i||{})[o]);return r}function Hl(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(!n)return{year:-1,month:-1,day:-1,hour:e?-1:0,minute:e?-1:0,second:e?-1:0};var t=new Date(n);if(Number.isNaN(t.getTime()))throw new Error("Unable to parse date "+n);return{year:t.getUTCFullYear(),month:t.getUTCMonth()+1,day:t.getUTCDate(),hour:e?t.getUTCHours():0,minute:e?t.getUTCMinutes():0,second:e?t.getUTCSeconds():0}}function Yv(n){var e=n.year,t=n.month,i=n.day,r=n.hour,s=r===void 0?0:r,o=n.minute,l=o===void 0?0:o,a=n.second,h=a===void 0?0:a,c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,u=Date.UTC(e,t-1,i,s,l,h),f=new Date(u).toJSON();return c?f:f.slice(0,10)}function Xv(n){if(!n)return"";var e=new Date(n),t=qr(e.getFullYear(),4),i=qr(e.getMonth()+1,2),r=qr(e.getDate(),2),s=qr(e.getHours(),2),o=qr(e.getMinutes(),2),l=qr(e.getSeconds(),2),a=qr(e.getMilliseconds(),3);return"".concat(t,"-").concat(i,"-").concat(r,"T").concat(s,":").concat(o,":").concat(l,".").concat(a)}function Qv(n){if(n)return new Date(n).toJSON()}function qr(n,e){for(var t=String(n);t.length<e;)t="0"+t;return t}function $P(n){var e=n.split(","),t=e[0].split(";"),i=t[0].replace("data:",""),r=t.filter(function(c){return c.split("=")[0]==="name"}),s;r.length!==1?s="unknown":s=r[0].split("=")[1];for(var o=atob(e[1]),l=[],a=0;a<o.length;a++)l.push(o.charCodeAt(a));var h=new window.Blob([new Uint8Array(l)],{type:i});return{blob:h,name:s}}function Td(n){var e={};return n.multipleOf&&(e.step=n.multipleOf),(n.minimum||n.minimum===0)&&(e.min=n.minimum),(n.maximum||n.maximum===0)&&(e.max=n.maximum),e}function zl(n,e,t){for(var i=0;i<e.length;i++){var r=e[i];if(r.properties){var s={anyOf:Object.keys(r.properties).map(function(a){return{required:[a]}})},o=void 0;if(r.anyOf){var l=$h({},r);l.allOf?l.allOf=l.allOf.slice():l.allOf=[],l.allOf.push(s),o=l}else o=Object.assign({},r,s);if(delete o.required,zv(o,n,t))return i}else if(zv(r,n,t))return i}return 0}function jl(n){return n.const||n.enum&&n.enum.length===1&&n.enum[0]===!0?!0:n.anyOf&&n.anyOf.length===1?jl(n.anyOf[0]):n.oneOf&&n.oneOf.length===1?jl(n.oneOf[0]):n.allOf?n.allOf.some(jl):!1}function Pd(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{},i=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(i=i.concat(Object.getOwnPropertySymbols(t).filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable}))),i.forEach(function(r){Kr(n,r,t[r])})}return n}function Vs(n){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Vs=function(t){return typeof t}:Vs=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Vs(n)}function UP(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function ew(n,e){for(var t=0;t<e.length;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}}function qP(n,e,t){return e&&ew(n.prototype,e),t&&ew(n,t),n}function KP(n,e){return e&&(Vs(e)==="object"||typeof e=="function")?e:Hs(n)}function Bd(n){return Bd=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Bd(n)}function Hs(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function GP(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),e&&Rd(n,e)}function Rd(n,e){return Rd=Object.setPrototypeOf||function(i,r){return i.__proto__=r,i},Rd(n,e)}function Kr(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}var tw=function(n){GP(e,n);function e(t){var i;return UP(this,e),i=KP(this,Bd(e).call(this,t)),Kr(Hs(i),"getUsedFormData",function(r,s){if(s.length===0&&Vs(r)!=="object")return r;var o=Mh()(r,s);return Array.isArray(r)?Object.keys(o).map(function(l){return o[l]}):o}),Kr(Hs(i),"getFieldNames",function(r,s){var o=function l(a){var h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],c=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[""];return Object.keys(a).forEach(function(u){if(Vs(a[u])==="object"){var f=c.map(function(d){return"".concat(d,".").concat(u)});a[u].__rjsf_additionalProperties&&a[u].$name!==""?h.push(a[u].$name):l(a[u],h,f)}else u==="$name"&&a[u]!==""&&c.forEach(function(d){d=d.replace(/^\./,"");var p=Eh()(s,d);(Vs(p)!=="object"||Ne()(p))&&h.push(d)})}),h};return o(r)}),Kr(Hs(i),"onChange",function(r,s){if(It(r)||Array.isArray(r)){var o=i.getStateFromProps(i.props,r);r=o.formData}var l=!i.props.noValidate&&i.props.liveValidate,a={formData:r},h=r;if(i.props.omitExtraData===!0&&i.props.liveOmit===!0){var c=Ye(i.state.schema,i.state.schema,r),u=Vl(c,"",i.state.schema,r),f=i.getFieldNames(u,r);h=i.getUsedFormData(r,f),a={formData:h}}if(l){var d=i.validate(h),p=d.errors,g=d.errorSchema,y=p,v=g;i.props.extraErrors&&(g=Ur(g,i.props.extraErrors,!0),p=Ns(g)),a={formData:h,errors:p,errorSchema:g,schemaValidationErrors:y,schemaValidationErrorSchema:v}}else if(!i.props.noValidate&&s){var C=i.props.extraErrors?Ur(s,i.props.extraErrors,!0):s;a={formData:h,errorSchema:C,errors:Ns(C)}}i.setState(a,function(){return i.props.onChange&&i.props.onChange(i.state)})}),Kr(Hs(i),"onBlur",function(){if(i.props.onBlur){var r;(r=i.props).onBlur.apply(r,arguments)}}),Kr(Hs(i),"onFocus",function(){if(i.props.onFocus){var r;(r=i.props).onFocus.apply(r,arguments)}}),Kr(Hs(i),"onSubmit",function(r){if(r.preventDefault(),r.target===r.currentTarget){r.persist();var s=i.state.formData;if(i.props.omitExtraData===!0){var o=Ye(i.state.schema,i.state.schema,s),l=Vl(o,"",i.state.schema,s),a=i.getFieldNames(l,s);s=i.getUsedFormData(s,a)}if(!i.props.noValidate){var h=i.validate(s),c=h.errors,u=h.errorSchema,f=c,d=u;if(Object.keys(c).length>0){i.props.extraErrors&&(u=Ur(u,i.props.extraErrors,!0),c=Ns(u)),i.setState({errors:c,errorSchema:u,schemaValidationErrors:f,schemaValidationErrorSchema:d},function(){i.props.onError?i.props.onError(c):console.error("Form validation failed",c)});return}}var p,g;i.props.extraErrors?(p=i.props.extraErrors,g=Ns(p)):(p={},g=[]),i.setState({formData:s,errors:g,errorSchema:p,schemaValidationErrors:[],schemaValidationErrorSchema:{}},function(){i.props.onSubmit&&i.props.onSubmit(Pd({},i.state,{formData:s,status:"submitted"}),r)})}}),i.state=i.getStateFromProps(t,t.formData),i.props.onChange&&!Tn(i.state.formData,i.props.formData)&&i.props.onChange(i.state),i.formElement=null,i}return qP(e,[{key:"UNSAFE_componentWillReceiveProps",value:function(i){var r=this.getStateFromProps(i,i.formData);!Tn(r.formData,i.formData)&&!Tn(r.formData,this.state.formData)&&this.props.onChange&&this.props.onChange(r),this.setState(r)}},{key:"getStateFromProps",value:function(i,r){var s=this.state||{},o="schema"in i?i.schema:this.props.schema,l="uiSchema"in i?i.uiSchema:this.props.uiSchema,a=typeof r!="undefined",h="liveValidate"in i?i.liveValidate:this.props.liveValidate,c=a&&!i.noValidate&&h,u=o,f=qh(o,r,u),d=Ye(o,u,f),p=i.customFormats,g=i.additionalMetaSchemas,y=function(){return i.noValidate?{errors:[],errorSchema:{}}:i.liveValidate?{errors:s.errors||[],errorSchema:s.errorSchema||{}}:{errors:s.schemaValidationErrors||[],errorSchema:s.schemaValidationErrorSchema||{}}},v,C,x,b;if(c){var S=this.validate(f,o,g,p);v=S.errors,C=S.errorSchema,x=v,b=C}else{var k=y();v=k.errors,C=k.errorSchema,x=s.schemaValidationErrors,b=s.schemaValidationErrorSchema}i.extraErrors&&(C=Ur(C,i.extraErrors,!0),v=Ns(C));var A=Ws(d,l["ui:rootFieldId"],u,f,i.idPrefix),_={schema:o,uiSchema:l,idSchema:A,formData:f,edit:a,errors:v,errorSchema:C,additionalMetaSchemas:g};return x&&(_.schemaValidationErrors=x,_.schemaValidationErrorSchema=b),_}},{key:"shouldComponentUpdate",value:function(i,r){return Ed(this,i,r)}},{key:"validate",value:function(i){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.props.schema,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.props.additionalMetaSchemas,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:this.props.customFormats,l=this.props,a=l.validate,h=l.transformErrors,c=this.getRegistry(),u=c.rootSchema,f=Ye(r,u,i);return Hv(i,f,a,h,s,o)}},{key:"renderErrors",value:function(){var i=this.state,r=i.errors,s=i.errorSchema,o=i.schema,l=i.uiSchema,a=this.props,h=a.ErrorList,c=a.showErrorList,u=a.formContext;return r.length&&c!=!1?m.createElement(h,{errors:r,errorSchema:s,schema:o,uiSchema:l,formContext:u}):null}},{key:"getRegistry",value:function(){var i=Si(),r=i.fields,s=i.widgets;return{fields:Pd({},r,this.props.fields),widgets:Pd({},s,this.props.widgets),ArrayFieldTemplate:this.props.ArrayFieldTemplate,ObjectFieldTemplate:this.props.ObjectFieldTemplate,FieldTemplate:this.props.FieldTemplate,definitions:this.props.schema.definitions||{},rootSchema:this.props.schema,formContext:this.props.formContext||{}}}},{key:"submit",value:function(){this.formElement&&this.formElement.dispatchEvent(new CustomEvent("submit",{cancelable:!0}))}},{key:"render",value:function(){var i=this,r=this.props,s=r.children,o=r.id,l=r.idPrefix,a=r.className,h=r.tagName,c=r.name,u=r.method,f=r.target,d=r.action,p=r.autocomplete,g=r.autoComplete,y=r.enctype,v=r.acceptcharset,C=r.noHtml5Validate,x=r.disabled,b=r.readonly,S=r.formContext,k=this.state,A=k.schema,_=k.uiSchema,O=k.formData,D=k.errorSchema,T=k.idSchema,B=this.getRegistry(),N=B.fields.SchemaField,ne=h||"form";p&&console.warn("Using autocomplete property of Form is deprecated, use autoComplete instead.");var W=g||p;return m.createElement(ne,{className:a||"rjsf",id:o,name:c,method:u,target:f,action:d,autoComplete:W,encType:y,acceptCharset:v,noValidate:C,onSubmit:this.onSubmit,ref:function(re){i.formElement=re}},this.renderErrors(),m.createElement(N,{schema:A,uiSchema:_,errorSchema:D,idSchema:T,idPrefix:l,formContext:S,formData:O,onChange:this.onChange,onBlur:this.onBlur,onFocus:this.onFocus,registry:B,disabled:x,readonly:b}),s||m.createElement("div",null,m.createElement("button",{type:"submit",className:"btn btn-info"},"Submit")))}}]),e}(m.Component);Kr(tw,"defaultProps",{uiSchema:{},noValidate:!1,liveValidate:!1,disabled:!1,readonly:!1,noHtml5Validate:!1,ErrorList:Ll,omitExtraData:!1});function Ld(){return Ld=Object.assign||function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])}return n},Ld.apply(this,arguments)}function iw(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{},i=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(i=i.concat(Object.getOwnPropertySymbols(t).filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable}))),i.forEach(function(r){JP(n,r,t[r])})}return n}function JP(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function ZP(n,e){if(n==null)return{};var t=YP(n,e),i,r;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);for(r=0;r<s.length;r++)i=s[r],!(e.indexOf(i)>=0)&&(!Object.prototype.propertyIsEnumerable.call(n,i)||(t[i]=n[i]))}return t}function YP(n,e){if(n==null)return{};var t={},i=Object.keys(n),r,s;for(s=0;s<i.length;s++)r=i[s],!(e.indexOf(r)>=0)&&(t[r]=n[r]);return t}function nw(n){return(0,m.forwardRef)(function(e,t){var i=e.fields,r=e.widgets,s=ZP(e,["fields","widgets"]);return i=iw({},n.fields,i),r=iw({},n.widgets,r),m.createElement(QP,Ld({},n,s,{fields:i,widgets:r,ref:t}))})}nw.propTypes={widgets:Ae().object,fields:Ae().object};var XP=nw,QP=tw,rw=w(65549),eB=w(90324),tB=w(70595),iB=w(17373),sw=w(11776),ow=w(38402),nB=w(16715),lw=w(64860),rB=w(85256),aw=w(74828),hw=w(29611),cw=w(21324),Fd=w(5806),Nd=w(84899),sB=w(64326),oB=w(44962),lB=w(2682),aB=w(11433),Id=w(86619);function $l(){return $l=Object.assign||function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])}return n},$l.apply(this,arguments)}function Wd(n){if(n==null)throw new TypeError("Cannot destructure undefined")}function uw(n,e){if(n==null)return{};var t={},i=Object.keys(n),r,s;for(s=0;s<i.length;s++)r=i[s],!(e.indexOf(r)>=0)&&(t[r]=n[r]);return t}var Vd=function(e){return m.createElement(yi.Z,Object.assign({},e,{color:"secondary"}),m.createElement(rw.Z,null)," Add Item")},hB={remove:iB.Z,plus:rw.Z,"arrow-up":eB.Z,"arrow-down":tB.Z},Yh=function(e){var t=e.icon,i=e.iconProps,r=uw(e,["icon","className","iconProps"]),s=hB[t];return m.createElement(yi.Z,Object.assign({},r,{size:"small"}),m.createElement(s,Object.assign({},i)))},cB=Gh,uB=Si,fB=function(e){var t=e.schema,i=e.registry,r=i===void 0?uB():i;return cB(t,r.rootSchema)?m.createElement(pB,Object.assign({},e)):m.createElement(mB,Object.assign({},e))},fw=function(e){var t=e.TitleField,i=e.idSchema,r=e.title,s=e.required;if(!r)return null;var o=i.$id+"__title";return m.createElement(t,{id:o,title:r,required:s})},dB=function(e){var t=e.DescriptionField,i=e.idSchema,r=e.description;if(!r)return null;var s=i.$id+"__description";return m.createElement(t,{id:s,description:r})},dw=function(e){var t={flex:1,paddingLeft:6,paddingRight:6,fontWeight:"bold",minWidth:0};return m.createElement(Ee.Z,{container:!0,key:e.key,alignItems:"center"},m.createElement(Ee.Z,{item:!0,xs:!0,style:{overflow:"auto"}},m.createElement(_e.Z,{mb:2},m.createElement(Ui.Z,{elevation:2},m.createElement(_e.Z,{p:2},e.children)))),e.hasToolbar&&m.createElement(Ee.Z,{item:!0},(e.hasMoveUp||e.hasMoveDown)&&m.createElement(Yh,{icon:"arrow-up",className:"array-item-move-up",tabIndex:-1,style:t,iconProps:{fontSize:"small"},disabled:e.disabled||e.readonly||!e.hasMoveUp,onClick:e.onReorderClick(e.index,e.index-1)}),(e.hasMoveUp||e.hasMoveDown)&&m.createElement(Yh,{icon:"arrow-down",tabIndex:-1,style:t,iconProps:{fontSize:"small"},disabled:e.disabled||e.readonly||!e.hasMoveDown,onClick:e.onReorderClick(e.index,e.index+1)}),e.hasRemove&&m.createElement(Yh,{icon:"remove",tabIndex:-1,style:t,iconProps:{fontSize:"small"},disabled:e.disabled||e.readonly,onClick:e.onDropIndexClick(e.index)})))},pB=function(e){return m.createElement("fieldset",{className:e.className},m.createElement(fw,{key:"array-field-title-"+e.idSchema.$id,TitleField:e.TitleField,idSchema:e.idSchema,title:e.uiSchema["ui:title"]||e.title,required:e.required}),(e.uiSchema["ui:description"]||e.schema.description)&&m.createElement("div",{className:"field-description",key:"field-description-"+e.idSchema.$id},e.uiSchema["ui:description"]||e.schema.description),m.createElement("div",{className:"row array-item-list",key:"array-item-list-"+e.idSchema.$id},e.items&&e.items.map(dw)),e.canAdd&&m.createElement(Vd,{className:"array-item-add",onClick:e.onAddClick,disabled:e.disabled||e.readonly}))},mB=function(e){return m.createElement(Ui.Z,{elevation:2},m.createElement(_e.Z,{p:2},m.createElement(fw,{key:"array-field-title-"+e.idSchema.$id,TitleField:e.TitleField,idSchema:e.idSchema,title:e.uiSchema["ui:title"]||e.title,required:e.required}),(e.uiSchema["ui:description"]||e.schema.description)&&m.createElement(dB,{key:"array-field-description-"+e.idSchema.$id,DescriptionField:e.DescriptionField,idSchema:e.idSchema,description:e.uiSchema["ui:description"]||e.schema.description}),m.createElement(Ee.Z,{container:!0,key:"array-item-list-"+e.idSchema.$id},e.items&&e.items.map(function(t){return dw(t)}),e.canAdd&&m.createElement(Ee.Z,{container:!0,justify:"flex-end"},m.createElement(Ee.Z,{item:!0},m.createElement(_e.Z,{mt:2},m.createElement(Vd,{className:"array-item-add",onClick:e.onAddClick,disabled:e.disabled||e.readonly})))))))},gB=function(e){var t=e.errors;return m.createElement(Ui.Z,{elevation:2},m.createElement(_e.Z,{mb:2,p:2},m.createElement(M.Z,{variant:"h6"},"Errors"),m.createElement(sw.Z,{dense:!0},t.map(function(i,r){return m.createElement(ow.Z,{key:r},m.createElement(Ls.Z,null,m.createElement(nB.Z,{color:"error"})),m.createElement(El.Z,{primary:i.stack}))}))))},yB=(0,lw.Z)({root:{marginTop:5}}),vB=function(e){var t=e.description;if(t){var i=yB();return m.createElement(M.Z,{variant:"subtitle2",className:i.root},t)}return null},wB=function(e){var t=e.title;return m.createElement(m.Fragment,null,m.createElement(_e.Z,{mb:1,mt:1},m.createElement(M.Z,{variant:"h5"},t),m.createElement(rB.Z,null)))},bB={DescriptionField:vB,TitleField:wB},xB=Uh,SB=function(e){var t=e.children,i=e.disabled,r=e.id,s=e.label,o=e.onDropPropertyClick,l=e.onKeyChange,a=e.readonly,h=e.required,c=e.schema,u=s+" Key",f=c.hasOwnProperty(xB),d={flex:1,paddingLeft:6,paddingRight:6,fontWeight:"bold"};if(!f)return m.createElement(m.Fragment,null,t);var p=function(y){var v=y.target;return l(v.value)};return m.createElement(Ee.Z,{container:!0,key:r+"-key",alignItems:"center",spacing:2},m.createElement(Ee.Z,{item:!0,xs:!0},m.createElement(Qi.Z,{fullWidth:!0,required:h},m.createElement(Je.Z,null,u),m.createElement(hw.Z,{defaultValue:s,disabled:i||a,id:r+"-key",name:r+"-key",onBlur:a?void 0:p,type:"text"}))),m.createElement(Ee.Z,{item:!0,xs:!0},t),m.createElement(Ee.Z,{item:!0},m.createElement(Yh,{icon:"remove",tabIndex:-1,style:d,disabled:i||a,onClick:o(s)})))},kB=function(e){var t=e.id,i=e.children,r=e.classNames,s=e.disabled,o=e.displayLabel,l=e.hidden,a=e.label,h=e.onDropPropertyClick,c=e.onKeyChange,u=e.readonly,f=e.required,d=e.rawErrors,p=d===void 0?[]:d,g=e.rawHelp,y=e.rawDescription,v=e.schema;return l?i:m.createElement(SB,{classNames:r,disabled:s,id:t,label:a,onDropPropertyClick:h,onKeyChange:c,readonly:u,required:f,schema:v},m.createElement(Qi.Z,{fullWidth:!0,error:!!p.length,required:f},i,o&&y?m.createElement(M.Z,{variant:"caption",color:"textSecondary"},y):null,p.length>0&&m.createElement(sw.Z,{dense:!0,disablePadding:!0},p.map(function(C,x){return m.createElement(ow.Z,{key:x,disableGutters:!0},m.createElement(aw.Z,{id:t},C))})),g&&m.createElement(aw.Z,{id:t},g)))},CB=$v,AB=(0,lw.Z)({root:{marginTop:10}}),OB=function(e){var t=e.DescriptionField,i=e.description,r=e.TitleField,s=e.title,o=e.properties,l=e.required,a=e.disabled,h=e.readonly,c=e.uiSchema,u=e.idSchema,f=e.schema,d=e.formData,p=e.onAddClick,g=AB();return m.createElement(m.Fragment,null,(c["ui:title"]||s)&&m.createElement(r,{id:u.$id+"-title",title:s,required:l}),i&&m.createElement(t,{id:u.$id+"-description",description:i}),m.createElement(Ee.Z,{container:!0,spacing:2,className:g.root},o.map(function(y,v){return y.hidden?y.content:m.createElement(Ee.Z,{item:!0,xs:12,key:v,style:{marginBottom:"10px"}},y.content)}),CB(f,c,d)&&m.createElement(Ee.Z,{container:!0,justify:"flex-end"},m.createElement(Ee.Z,{item:!0},m.createElement(Vd,{className:"object-property-expand",onClick:p(f),disabled:a||h})))))},_B=jl,DB=function(e){var t=e.schema,i=e.id,r=e.value,s=e.disabled,o=e.readonly,l=e.label,a=e.autofocus,h=e.onChange,c=e.onBlur,u=e.onFocus,f=_B(t),d=function(v,C){return Wd(v),h(C)},p=function(v){var C=v.target.value;return c(i,C)},g=function(v){var C=v.target.value;return u(i,C)};return m.createElement(Fd.Z,{control:m.createElement(cw.Z,{id:i,checked:typeof r=="undefined"?!1:r,required:f,disabled:s||o,autoFocus:a,onChange:d,onBlur:p,onFocus:g}),label:l})},MB=function(e,t,i){var r=i.indexOf(e),s=t.slice(0,r).concat(e,t.slice(r));return s.sort(function(o,l){return i.indexOf(o)>i.indexOf(l)})},EB=function(e,t){return t.filter(function(i){return i!==e})},TB=function(e){var t=e.schema,i=e.label,r=e.id,s=e.disabled,o=e.options,l=e.value,a=e.autofocus,h=e.readonly,c=e.required,u=e.onChange,f=e.onBlur,d=e.onFocus,p=o.enumOptions,g=o.enumDisabled,y=o.inline,v=function(S){return function(k){var A=k.target.checked,_=p.map(function(O){var D=O.value;return D});u(A?MB(S.value,l,_):EB(S.value,l))}},C=function(S){var k=S.target.value;return f(r,k)},x=function(S){var k=S.target.value;return d(r,k)};return m.createElement(m.Fragment,null,m.createElement(Nd.Z,{required:c,htmlFor:r},i||t.title),m.createElement(sB.Z,{row:!!y},p.map(function(b,S){var k=l.indexOf(b.value)!==-1,A=g&&g.indexOf(b.value)!=-1,_=m.createElement(cw.Z,{id:r+"_"+S,checked:k,disabled:s||A||h,autoFocus:a&&S===0,onChange:v(b),onBlur:C,onFocus:x});return m.createElement(Fd.Z,{control:_,key:S,label:b.label})})))},PB=function(e){var t=e.registry,i=t.widgets.TextWidget;return m.createElement(i,Object.assign({type:"color"},e))},BB=function(e){var t=e.registry,i=t.widgets.TextWidget;return m.createElement(i,Object.assign({type:"date",InputLabelProps:{shrink:!0}},e))},RB=Qv,LB=Xv,FB=function(e){var t=e.registry,i=t.widgets.TextWidget,r=LB(e.value),s=function(l){e.onChange(RB(l))};return m.createElement(i,Object.assign({type:"datetime-local",InputLabelProps:{shrink:!0}},e,{value:r,onChange:s}))},NB=function(e){var t=e.registry,i=t.widgets.TextWidget;return m.createElement(i,Object.assign({type:"email"},e))},IB=function(e){var t=e.registry,i=t.widgets.TextWidget;return m.createElement(i,Object.assign({type:"password"},e))},WB=function(e){var t=e.id,i=e.schema,r=e.options,s=e.value,o=e.required,l=e.disabled,a=e.readonly,h=e.label,c=e.onChange,u=e.onBlur,f=e.onFocus,d=r.enumOptions,p=r.enumDisabled,g=function(b,S){return Wd(b),c(i.type=="boolean"?S!=="false":S)},y=function(b){var S=b.target.value;return u(t,S)},v=function(b){var S=b.target.value;return f(t,S)},C=r?r.inline:!1;return m.createElement(m.Fragment,null,m.createElement(Nd.Z,{required:o,htmlFor:t},h||i.title),m.createElement(lB.Z,{value:""+s,row:C,onChange:g,onBlur:y,onFocus:v},d.map(function(x,b){var S=p&&p.indexOf(x.value)!=-1,k=m.createElement(Fd.Z,{control:m.createElement(oB.Z,{color:"primary",key:b}),label:""+x.label,value:""+x.value,key:b,disabled:l||S||a});return k})))},VB=Td,HB=function(e){var t=e.value,i=e.readonly,r=e.disabled,s=e.onBlur,o=e.onFocus,l=e.options,a=e.schema,h=e.onChange,c=e.required,u=e.label,f=e.id,d=$l({value:t,label:u,id:f},VB(a)),p=function(C,x){return Wd(C),h(x===""?l.emptyValue:x)},g=function(C){var x=C.target.value;return s(f,x)},y=function(C){var x=C.target.value;return o(f,x)};return m.createElement(m.Fragment,null,m.createElement(Nd.Z,{required:c,id:f},u),m.createElement(aB.Z,Object.assign({disabled:r||i,onChange:p,onBlur:g,onFocus:y,valueLabelDisplay:"auto"},d)))},Hd=Eo,pw=To,zB=new Set(["number","integer"]),zd=function(e,t){var i=e.type,r=e.items;if(t!==""){{if(i==="array"&&r&&zB.has(r.type))return t.map(Hd);if(i==="boolean")return t==="true";if(i==="number")return Hd(t)}if(e.enum){if(e.enum.every(function(s){return pw(s)==="number"}))return Hd(t);if(e.enum.every(function(s){return pw(s)==="boolean"}))return t==="true"}return t}},jB=function(e){var t=e.schema,i=e.id,r=e.options,s=e.label,o=e.required,l=e.disabled,a=e.readonly,h=e.value,c=e.multiple,u=e.autofocus,f=e.onChange,d=e.onBlur,p=e.onFocus,g=e.rawErrors,y=g===void 0?[]:g,v=r.enumOptions,C=r.enumDisabled,x=c?[]:"",b=function(_){var O=_.target.value;return f(zd(t,O))},S=function(_){var O=_.target.value;return d(i,zd(t,O))},k=function(_){var O=_.target.value;return p(i,zd(t,O))};return m.createElement(Id.Z,{id:i,label:s||t.title,select:!0,value:typeof h=="undefined"?x:h,required:o,disabled:l||a,autoFocus:u,error:y.length>0,onChange:b,onBlur:S,onFocus:k,InputLabelProps:{shrink:!0},SelectProps:{multiple:typeof c=="undefined"?!1:c}},v.map(function(A,_){var O=A.value,D=A.label,T=C&&C.indexOf(O)!=-1;return m.createElement(ni.Z,{key:_,value:O,disabled:T},D)}))},$B=function(e){var t=e.id,i=e.placeholder,r=e.value,s=e.required,o=e.disabled,l=e.autofocus,a=e.label,h=e.readonly,c=e.onBlur,u=e.onFocus,f=e.onChange,d=e.options,p=e.schema,g=e.rawErrors,y=g===void 0?[]:g,v=function(S){var k=S.target.value;return f(k===""?d.emptyValue:k)},C=function(S){var k=S.target.value;return c(t,k)},x=function(S){var k=S.target.value;return u(t,k)};return m.createElement(Id.Z,{id:t,label:a||p.title,placeholder:i,disabled:o||h,value:r,required:s,autoFocus:l,multiline:!0,rows:d.rows||5,error:y.length>0,onChange:v,onBlur:C,onFocus:x})},UB=Uv,qB=function(e){var t=e.id,i=e.placeholder,r=e.required,s=e.readonly,o=e.disabled,l=e.type,a=e.label,h=e.value,c=e.onChange,u=e.onBlur,f=e.onFocus,d=e.autofocus,p=e.options,g=e.schema,y=e.uiSchema,v=e.rawErrors,C=v===void 0?[]:v,x=uw(e,["id","placeholder","required","readonly","disabled","type","label","value","onChange","onBlur","onFocus","autofocus","options","schema","uiSchema","rawErrors","formContext","registry"]),b=function(D){var T=D.target.value;return c(T===""?p.emptyValue:T)},S=function(D){var T=D.target.value;return u(t,T)},k=function(D){var T=D.target.value;return f(t,T)},A=UB(g,y),_=(l||g.type)==="string"?"text":""+(l||g.type);return m.createElement(Id.Z,Object.assign({id:t,placeholder:i,label:A?a||g.title:!1,autoFocus:d,required:r,disabled:o||s,type:_,value:h||h===0?h:"",error:C.length>0,onChange:b,onBlur:S,onFocus:k},x))},KB=function(e){var t=e.id,i=e.required,r=e.readonly,s=e.disabled,o=e.label,l=e.value,a=e.onChange,h=e.onBlur,c=e.onFocus,u=e.autofocus,f=function(y){var v=y.target.value;return a(v)},d=function(y){var v=y.target.value;return h(t,v)},p=function(y){var v=y.target.value;return c(t,v)};return m.createElement(Qi.Z,{fullWidth:!0,required:i},m.createElement(Je.Z,null,o),m.createElement(hw.Z,{id:t,autoFocus:u,required:i,type:"number",disabled:s||r,value:l||l===0?l:"",onChange:f,onBlur:d,onFocus:p}))},GB=function(e){var t=e.registry,i=t.widgets.TextWidget;return m.createElement(i,Object.assign({type:"url"},e))},JB={CheckboxWidget:DB,CheckboxesWidget:TB,ColorWidget:PB,DateWidget:BB,DateTimeWidget:FB,EmailWidget:NB,PasswordWidget:IB,RadioWidget:WB,RangeWidget:HB,SelectWidget:jB,TextareaWidget:$B,TextWidget:qB,UpDownWidget:KB,URLWidget:GB},ZB=Si,mw=ZB(),YB=mw.fields,XB=mw.widgets,QB=function(){return m.createElement(_e.Z,{marginTop:3},m.createElement(yi.Z,{type:"submit",variant:"contained",color:"primary"},"Submit"))},eR={children:m.createElement(QB,null),ArrayFieldTemplate:fB,fields:$l({},YB,bB),FieldTemplate:kB,ObjectFieldTemplate:OB,widgets:$l({},XB,JB),ErrorList:gB},Dj=null,Mj=null,tR=w(9850),iR=w.n(tR),nR=w(72779),rR=w.n(nR),sR=w(48760),oR=["true","false","on","off","yes","no"],lR=new RegExp("\\b(("+oR.join(")|(")+"))$","i");const aR={token:function(n,e){var t=n.peek(),i=e.escaped;if(e.escaped=!1,t=="#"&&(n.pos==0||/\s/.test(n.string.charAt(n.pos-1))))return n.skipToEnd(),"comment";if(n.match(/^('([^']|\\.)*'?|"([^"]|\\.)*"?)/))return"string";if(e.literal&&n.indentation()>e.keyCol)return n.skipToEnd(),"string";if(e.literal&&(e.literal=!1),n.sol()){if(e.keyCol=0,e.pair=!1,e.pairStart=!1,n.match("---")||n.match("..."))return"def";if(n.match(/^\s*-\s+/))return"meta"}if(n.match(/^(\{|\}|\[|\])/))return t=="{"?e.inlinePairs++:t=="}"?e.inlinePairs--:t=="["?e.inlineList++:e.inlineList--,"meta";if(e.inlineList>0&&!i&&t==",")return n.next(),"meta";if(e.inlinePairs>0&&!i&&t==",")return e.keyCol=0,e.pair=!1,e.pairStart=!1,n.next(),"meta";if(e.pairStart){if(n.match(/^\s*(\||\>)\s*/))return e.literal=!0,"meta";if(n.match(/^\s*(\&|\*)[a-z0-9\._-]+\b/i))return"variable";if(e.inlinePairs==0&&n.match(/^\s*-?[0-9\.\,]+\s?$/)||e.inlinePairs>0&&n.match(/^\s*-?[0-9\.\,]+\s?(?=(,|}))/))return"number";if(n.match(lR))return"keyword"}return!e.pair&&n.match(/^\s*(?:[,\[\]{}&*!|>'"%@`][^\s'":]|[^,\[\]{}#&*!|>'"%@`])[^#]*?(?=\s*:($|\s))/)?(e.pair=!0,e.keyCol=n.indentation(),"atom"):e.pair&&n.match(/^:\s*/)?(e.pairStart=!0,"meta"):(e.pairStart=!1,e.escaped=t=="\\",n.next(),null)},startState:function(){return{pair:!1,pairStart:!1,keyCol:0,inlinePairs:0,inlineList:0,literal:!1,escaped:!1}},languageData:{commentTokens:{line:"#"}}};let Po="lc,34,7n,7,7b,19,,,,2,,2,,,20,b,1c,l,g,,2t,7,2,6,2,2,,4,z,,u,r,2j,b,1m,9,9,,o,4,,9,,3,,5,17,3,3b,f,,w,1j,,,,4,8,4,,3,7,a,2,t,,1m,,,,2,4,8,,9,,a,2,q,,2,2,1l,,4,2,4,2,2,3,3,,u,2,3,,b,2,1l,,4,5,,2,4,,k,2,m,6,,,1m,,,2,,4,8,,7,3,a,2,u,,1n,,,,c,,9,,14,,3,,1l,3,5,3,,4,7,2,b,2,t,,1m,,2,,2,,3,,5,2,7,2,b,2,s,2,1l,2,,,2,4,8,,9,,a,2,t,,20,,4,,2,3,,,8,,29,,2,7,c,8,2q,,2,9,b,6,22,2,r,,,,,,1j,e,,5,,2,5,b,,10,9,,2u,4,,6,,2,2,2,p,2,4,3,g,4,d,,2,2,6,,f,,jj,3,qa,3,t,3,t,2,u,2,1s,2,,7,8,,2,b,9,,19,3,3b,2,y,,3a,3,4,2,9,,6,3,63,2,2,,1m,,,7,,,,,2,8,6,a,2,,1c,h,1r,4,1c,7,,,5,,14,9,c,2,w,4,2,2,,3,1k,,,2,3,,,3,1m,8,2,2,48,3,,d,,7,4,,6,,3,2,5i,1m,,5,ek,,5f,x,2da,3,3x,,2o,w,fe,6,2x,2,n9w,4,,a,w,2,28,2,7k,,3,,4,,p,2,5,,47,2,q,i,d,,12,8,p,b,1a,3,1c,,2,4,2,2,13,,1v,6,2,2,2,2,c,,8,,1b,,1f,,,3,2,2,5,2,,,16,2,8,,6m,,2,,4,,fn4,,kh,g,g,g,a6,2,gt,,6a,,45,5,1ae,3,,2,5,4,14,3,4,,4l,2,fx,4,ar,2,49,b,4w,,1i,f,1k,3,1d,4,2,2,1x,3,10,5,,8,1q,,c,2,1g,9,a,4,2,,2n,3,2,,,2,6,,4g,,3,8,l,2,1l,2,,,,,m,,e,7,3,5,5f,8,2,3,,,n,,29,,2,6,,,2,,,2,,2,6j,,2,4,6,2,,2,r,2,2d,8,2,,,2,2y,,,,2,6,,,2t,3,2,4,,5,77,9,,2,6t,,a,2,,,4,,40,4,2,2,4,,w,a,14,6,2,4,8,,9,6,2,3,1a,d,,2,ba,7,,6,,,2a,m,2,7,,2,,2,3e,6,3,,,2,,7,,,20,2,3,,,,9n,2,f0b,5,1n,7,t4,,1r,4,29,,f5k,2,43q,,,3,4,5,8,8,2,7,u,4,44,3,1iz,1j,4,1e,8,,e,,m,5,,f,11s,7,,h,2,7,,2,,5,79,7,c5,4,15s,7,31,7,240,5,gx7k,2o,3k,6o".split(",").map(n=>n?parseInt(n,36):1);for(let n=1;n<Po.length;n++)Po[n]+=Po[n-1];function hR(n){for(let e=1;e<Po.length;e+=2)if(Po[e]>n)return Po[e-1]<=n;return!1}function gw(n){return n>=127462&&n<=127487}const yw=8205;function lt(n,e,t=!0,i=!0){return(t?vw:cR)(n,e,i)}function vw(n,e,t){if(e==n.length)return e;e&&ww(n.charCodeAt(e))&&bw(n.charCodeAt(e-1))&&e--;let i=jd(n,e);for(e+=xw(i);e<n.length;){let r=jd(n,e);if(i==yw||r==yw||t&&hR(r))e+=xw(r),i=r;else if(gw(r)){let s=0,o=e-2;for(;o>=0&&gw(jd(n,o));)s++,o-=2;if(s%2==0)break;e+=2}else break}return e}function cR(n,e,t){for(;e>0;){let i=vw(n,e-2,t);if(i<e)return i;e--}return 0}function ww(n){return n>=56320&&n<57344}function bw(n){return n>=55296&&n<56320}function jd(n,e){let t=n.charCodeAt(e);if(!bw(t)||e+1==n.length)return t;let i=n.charCodeAt(e+1);return ww(i)?(t-55296<<10)+(i-56320)+65536:t}function Ej(n){return n<=65535?String.fromCharCode(n):(n-=65536,String.fromCharCode((n>>10)+55296,(n&1023)+56320))}function xw(n){return n<65536?1:2}function Tj(n,e,t=n.length){let i=0;for(let r=0;r<t;)n.charCodeAt(r)==9?(i+=e-i%e,r++):(i++,r=lt(n,r));return i}function $d(n,e,t,i){for(let r=0,s=0;;){if(s>=e)return r;if(r==n.length)break;s+=n.charCodeAt(r)==9?t-s%t:1,r=lt(n,r)}return i===!0?-1:n.length}class j{constructor(){}lineAt(e){if(e<0||e>this.length)throw new RangeError(`Invalid position ${e} in document of length ${this.length}`);return this.lineInner(e,!1,1,0)}line(e){if(e<1||e>this.lines)throw new RangeError(`Invalid line number ${e} in ${this.lines}-line document`);return this.lineInner(e,!0,1,0)}replace(e,t,i){let r=[];return this.decompose(0,e,r,2),i.length&&i.decompose(0,i.length,r,3),this.decompose(t,this.length,r,1),Wn.from(r,this.length-(t-e)+i.length)}append(e){return this.replace(this.length,this.length,e)}slice(e,t=this.length){let i=[];return this.decompose(e,t,i,0),Wn.from(i,t-e)}eq(e){if(e==this)return!0;if(e.length!=this.length||e.lines!=this.lines)return!1;let t=this.scanIdentical(e,1),i=this.length-this.scanIdentical(e,-1),r=new Ul(this),s=new Ul(e);for(let o=t,l=t;;){if(r.next(o),s.next(o),o=0,r.lineBreak!=s.lineBreak||r.done!=s.done||r.value!=s.value)return!1;if(l+=r.value.length,r.done||l>=i)return!0}}iter(e=1){return new Ul(this,e)}iterRange(e,t=this.length){return new kw(this,e,t)}iterLines(e,t){let i;if(e==null)i=this.iter();else{t==null&&(t=this.lines+1);let r=this.line(e).from;i=this.iterRange(r,Math.max(r,t==this.lines+1?this.length:t<=1?0:this.line(t-1).to))}return new Cw(i)}toString(){return this.sliceString(0)}toJSON(){let e=[];return this.flatten(e),e}static of(e){if(e.length==0)throw new RangeError("A document must have at least one line");return e.length==1&&!e[0]?j.empty:e.length<=32?new Pt(e):Wn.from(Pt.split(e,[]))}}class Pt extends j{constructor(e,t=uR(e)){super(),this.text=e,this.length=t}get lines(){return this.text.length}get children(){return null}lineInner(e,t,i,r){for(let s=0;;s++){let o=this.text[s],l=r+o.length;if((t?i:l)>=e)return new fR(r,l,i,o);r=l+1,i++}}decompose(e,t,i,r){let s=e<=0&&t>=this.length?this:new Pt(Sw(this.text,e,t),Math.min(t,this.length)-Math.max(0,e));if(r&1){let o=i.pop(),l=Xh(s.text,o.text.slice(),0,s.length);if(l.length<=32)i.push(new Pt(l,o.length+s.length));else{let a=l.length>>1;i.push(new Pt(l.slice(0,a)),new Pt(l.slice(a)))}}else i.push(s)}replace(e,t,i){if(!(i instanceof Pt))return super.replace(e,t,i);let r=Xh(this.text,Xh(i.text,Sw(this.text,0,e)),t),s=this.length+i.length-(t-e);return r.length<=32?new Pt(r,s):Wn.from(Pt.split(r,[]),s)}sliceString(e,t=this.length,i=`
`){let r="";for(let s=0,o=0;s<=t&&o<this.text.length;o++){let l=this.text[o],a=s+l.length;s>e&&o&&(r+=i),e<a&&t>s&&(r+=l.slice(Math.max(0,e-s),t-s)),s=a+1}return r}flatten(e){for(let t of this.text)e.push(t)}scanIdentical(){return 0}static split(e,t){let i=[],r=-1;for(let s of e)i.push(s),r+=s.length+1,i.length==32&&(t.push(new Pt(i,r)),i=[],r=-1);return r>-1&&t.push(new Pt(i,r)),t}}class Wn extends j{constructor(e,t){super(),this.children=e,this.length=t,this.lines=0;for(let i of e)this.lines+=i.lines}lineInner(e,t,i,r){for(let s=0;;s++){let o=this.children[s],l=r+o.length,a=i+o.lines-1;if((t?a:l)>=e)return o.lineInner(e,t,i,r);r=l+1,i=a+1}}decompose(e,t,i,r){for(let s=0,o=0;o<=t&&s<this.children.length;s++){let l=this.children[s],a=o+l.length;if(e<=a&&t>=o){let h=r&((o<=e?1:0)|(a>=t?2:0));o>=e&&a<=t&&!h?i.push(l):l.decompose(e-o,t-o,i,h)}o=a+1}}replace(e,t,i){if(i.lines<this.lines)for(let r=0,s=0;r<this.children.length;r++){let o=this.children[r],l=s+o.length;if(e>=s&&t<=l){let a=o.replace(e-s,t-s,i),h=this.lines-o.lines+a.lines;if(a.lines<h>>5-1&&a.lines>h>>5+1){let c=this.children.slice();return c[r]=a,new Wn(c,this.length-(t-e)+i.length)}return super.replace(s,l,a)}s=l+1}return super.replace(e,t,i)}sliceString(e,t=this.length,i=`
`){let r="";for(let s=0,o=0;s<this.children.length&&o<=t;s++){let l=this.children[s],a=o+l.length;o>e&&s&&(r+=i),e<a&&t>o&&(r+=l.sliceString(e-o,t-o,i)),o=a+1}return r}flatten(e){for(let t of this.children)t.flatten(e)}scanIdentical(e,t){if(!(e instanceof Wn))return 0;let i=0,[r,s,o,l]=t>0?[0,0,this.children.length,e.children.length]:[this.children.length-1,e.children.length-1,-1,-1];for(;;r+=t,s+=t){if(r==o||s==l)return i;let a=this.children[r],h=e.children[s];if(a!=h)return i+a.scanIdentical(h,t);i+=a.length+1}}static from(e,t=e.reduce((i,r)=>i+r.length+1,-1)){let i=0;for(let d of e)i+=d.lines;if(i<32){let d=[];for(let p of e)p.flatten(d);return new Pt(d,t)}let r=Math.max(32,i>>5),s=r<<1,o=r>>1,l=[],a=0,h=-1,c=[];function u(d){let p;if(d.lines>s&&d instanceof Wn)for(let g of d.children)u(g);else d.lines>o&&(a>o||!a)?(f(),l.push(d)):d instanceof Pt&&a&&(p=c[c.length-1])instanceof Pt&&d.lines+p.lines<=32?(a+=d.lines,h+=d.length+1,c[c.length-1]=new Pt(p.text.concat(d.text),p.length+1+d.length)):(a+d.lines>r&&f(),a+=d.lines,h+=d.length+1,c.push(d))}function f(){a!=0&&(l.push(c.length==1?c[0]:Wn.from(c,h)),h=-1,a=c.length=0)}for(let d of e)u(d);return f(),l.length==1?l[0]:new Wn(l,t)}}j.empty=new Pt([""],0);function uR(n){let e=-1;for(let t of n)e+=t.length+1;return e}function Xh(n,e,t=0,i=1e9){for(let r=0,s=0,o=!0;s<n.length&&r<=i;s++){let l=n[s],a=r+l.length;a>=t&&(a>i&&(l=l.slice(0,i-r)),r<t&&(l=l.slice(t-r)),o?(e[e.length-1]+=l,o=!1):e.push(l)),r=a+1}return e}function Sw(n,e,t){return Xh(n,[""],e,t)}class Ul{constructor(e,t=1){this.dir=t,this.done=!1,this.lineBreak=!1,this.value="",this.nodes=[e],this.offsets=[t>0?1:(e instanceof Pt?e.text.length:e.children.length)<<1]}nextInner(e,t){for(this.done=this.lineBreak=!1;;){let i=this.nodes.length-1,r=this.nodes[i],s=this.offsets[i],o=s>>1,l=r instanceof Pt?r.text.length:r.children.length;if(o==(t>0?l:0)){if(i==0)return this.done=!0,this.value="",this;t>0&&this.offsets[i-1]++,this.nodes.pop(),this.offsets.pop()}else if((s&1)==(t>0?0:1)){if(this.offsets[i]+=t,e==0)return this.lineBreak=!0,this.value=`
`,this;e--}else if(r instanceof Pt){let a=r.text[o+(t<0?-1:0)];if(this.offsets[i]+=t,a.length>Math.max(0,e))return this.value=e==0?a:t>0?a.slice(e):a.slice(0,a.length-e),this;e-=a.length}else{let a=r.children[o+(t<0?-1:0)];e>a.length?(e-=a.length,this.offsets[i]+=t):(t<0&&this.offsets[i]--,this.nodes.push(a),this.offsets.push(t>0?1:(a instanceof Pt?a.text.length:a.children.length)<<1))}}}next(e=0){return e<0&&(this.nextInner(-e,-this.dir),e=this.value.length),this.nextInner(e,this.dir)}}class kw{constructor(e,t,i){this.value="",this.done=!1,this.cursor=new Ul(e,t>i?-1:1),this.pos=t>i?e.length:0,this.from=Math.min(t,i),this.to=Math.max(t,i)}nextInner(e,t){if(t<0?this.pos<=this.from:this.pos>=this.to)return this.value="",this.done=!0,this;e+=Math.max(0,t<0?this.pos-this.to:this.from-this.pos);let i=t<0?this.pos-this.from:this.to-this.pos;e>i&&(e=i),i-=e;let{value:r}=this.cursor.next(e);return this.pos+=(r.length+e)*t,this.value=r.length<=i?r:t<0?r.slice(r.length-i):r.slice(0,i),this.done=!this.value,this}next(e=0){return e<0?e=Math.max(e,this.from-this.pos):e>0&&(e=Math.min(e,this.to-this.pos)),this.nextInner(e,this.cursor.dir)}get lineBreak(){return this.cursor.lineBreak&&this.value!=""}}class Cw{constructor(e){this.inner=e,this.afterBreak=!0,this.value="",this.done=!1}next(e=0){let{done:t,lineBreak:i,value:r}=this.inner.next(e);return t?(this.done=!0,this.value=""):i?this.afterBreak?this.value="":(this.afterBreak=!0,this.next()):(this.value=r,this.afterBreak=!1),this}get lineBreak(){return!1}}typeof Symbol!="undefined"&&(j.prototype[Symbol.iterator]=function(){return this.iter()},Ul.prototype[Symbol.iterator]=kw.prototype[Symbol.iterator]=Cw.prototype[Symbol.iterator]=function(){return this});class fR{constructor(e,t,i,r){this.from=e,this.to=t,this.number=i,this.text=r}get length(){return this.to-this.from}}const Ud=/\r\n?|\n/;var Pn=function(n){return n[n.Simple=0]="Simple",n[n.TrackDel=1]="TrackDel",n[n.TrackBefore=2]="TrackBefore",n[n.TrackAfter=3]="TrackAfter",n}(Pn||(Pn={}));class Gr{constructor(e){this.sections=e}get length(){let e=0;for(let t=0;t<this.sections.length;t+=2)e+=this.sections[t];return e}get newLength(){let e=0;for(let t=0;t<this.sections.length;t+=2){let i=this.sections[t+1];e+=i<0?this.sections[t]:i}return e}get empty(){return this.sections.length==0||this.sections.length==2&&this.sections[1]<0}iterGaps(e){for(let t=0,i=0,r=0;t<this.sections.length;){let s=this.sections[t++],o=this.sections[t++];o<0?(e(i,r,s),r+=s):r+=o,i+=s}}iterChangedRanges(e,t=!1){qd(this,e,t)}get invertedDesc(){let e=[];for(let t=0;t<this.sections.length;){let i=this.sections[t++],r=this.sections[t++];r<0?e.push(i,r):e.push(r,i)}return new Gr(e)}composeDesc(e){return this.empty?e:e.empty?this:Aw(this,e)}mapDesc(e,t=!1){return e.empty?this:Kd(this,e,t)}mapPos(e,t=-1,i=Pn.Simple){let r=0,s=0;for(let o=0;o<this.sections.length;){let l=this.sections[o++],a=this.sections[o++],h=r+l;if(a<0){if(h>e)return s+(e-r);s+=l}else{if(i!=Pn.Simple&&h>=e&&(i==Pn.TrackDel&&r<e&&h>e||i==Pn.TrackBefore&&r<e||i==Pn.TrackAfter&&h>e))return null;if(h>e||h==e&&t<0&&!l)return e==r||t<0?s:s+a;s+=a}r=h}if(e>r)throw new RangeError(`Position ${e} is out of range for changeset of length ${r}`);return s}touchesRange(e,t=e){for(let i=0,r=0;i<this.sections.length&&r<=t;){let s=this.sections[i++],o=this.sections[i++],l=r+s;if(o>=0&&r<=t&&l>=e)return r<e&&l>t?"cover":!0;r=l}return!1}toString(){let e="";for(let t=0;t<this.sections.length;){let i=this.sections[t++],r=this.sections[t++];e+=(e?" ":"")+i+(r>=0?":"+r:"")}return e}toJSON(){return this.sections}static fromJSON(e){if(!Array.isArray(e)||e.length%2||e.some(t=>typeof t!="number"))throw new RangeError("Invalid JSON representation of ChangeDesc");return new Gr(e)}}class si extends Gr{constructor(e,t){super(e),this.inserted=t}apply(e){if(this.length!=e.length)throw new RangeError("Applying change set to a document with the wrong length");return qd(this,(t,i,r,s,o)=>e=e.replace(r,r+(i-t),o),!1),e}mapDesc(e,t=!1){return Kd(this,e,t,!0)}invert(e){let t=this.sections.slice(),i=[];for(let r=0,s=0;r<t.length;r+=2){let o=t[r],l=t[r+1];if(l>=0){t[r]=l,t[r+1]=o;let a=r>>1;for(;i.length<a;)i.push(j.empty);i.push(o?e.slice(s,s+o):j.empty)}s+=o}return new si(t,i)}compose(e){return this.empty?e:e.empty?this:Aw(this,e,!0)}map(e,t=!1){return e.empty?this:Kd(this,e,t,!0)}iterChanges(e,t=!1){qd(this,e,t)}get desc(){return new Gr(this.sections)}filter(e){let t=[],i=[],r=[],s=new ql(this);e:for(let o=0,l=0;;){let a=o==e.length?1e9:e[o++];for(;l<a||l==a&&s.len==0;){if(s.done)break e;let c=Math.min(s.len,a-l);ki(r,c,-1);let u=s.ins==-1?-1:s.off==0?s.ins:0;ki(t,c,u),u>0&&zs(i,t,s.text),s.forward(c),l+=c}let h=e[o++];for(;l<h;){if(s.done)break e;let c=Math.min(s.len,h-l);ki(t,c,-1),ki(r,c,s.ins==-1?-1:s.off==0?s.ins:0),s.forward(c),l+=c}}return{changes:new si(t,i),filtered:new Gr(r)}}toJSON(){let e=[];for(let t=0;t<this.sections.length;t+=2){let i=this.sections[t],r=this.sections[t+1];r<0?e.push(i):r==0?e.push([i]):e.push([i].concat(this.inserted[t>>1].toJSON()))}return e}static of(e,t,i){let r=[],s=[],o=0,l=null;function a(c=!1){if(!c&&!r.length)return;o<t&&ki(r,t-o,-1);let u=new si(r,s);l=l?l.compose(u.map(l)):u,r=[],s=[],o=0}function h(c){if(Array.isArray(c))for(let u of c)h(u);else if(c instanceof si){if(c.length!=t)throw new RangeError(`Mismatched change set length (got ${c.length}, expected ${t})`);a(),l=l?l.compose(c.map(l)):c}else{let{from:u,to:f=u,insert:d}=c;if(u>f||u<0||f>t)throw new RangeError(`Invalid change range ${u} to ${f} (in doc of length ${t})`);let p=d?typeof d=="string"?j.of(d.split(i||Ud)):d:j.empty,g=p.length;if(u==f&&g==0)return;u<o&&a(),u>o&&ki(r,u-o,-1),ki(r,f-u,g),zs(s,r,p),o=f}}return h(e),a(!l),l}static empty(e){return new si(e?[e,-1]:[],[])}static fromJSON(e){if(!Array.isArray(e))throw new RangeError("Invalid JSON representation of ChangeSet");let t=[],i=[];for(let r=0;r<e.length;r++){let s=e[r];if(typeof s=="number")t.push(s,-1);else{if(!Array.isArray(s)||typeof s[0]!="number"||s.some((o,l)=>l&&typeof o!="string"))throw new RangeError("Invalid JSON representation of ChangeSet");if(s.length==1)t.push(s[0],0);else{for(;i.length<r;)i.push(j.empty);i[r]=j.of(s.slice(1)),t.push(s[0],i[r].length)}}}return new si(t,i)}}function ki(n,e,t,i=!1){if(e==0&&t<=0)return;let r=n.length-2;r>=0&&t<=0&&t==n[r+1]?n[r]+=e:e==0&&n[r]==0?n[r+1]+=t:i?(n[r]+=e,n[r+1]+=t):n.push(e,t)}function zs(n,e,t){if(t.length==0)return;let i=e.length-2>>1;if(i<n.length)n[n.length-1]=n[n.length-1].append(t);else{for(;n.length<i;)n.push(j.empty);n.push(t)}}function qd(n,e,t){let i=n.inserted;for(let r=0,s=0,o=0;o<n.sections.length;){let l=n.sections[o++],a=n.sections[o++];if(a<0)r+=l,s+=l;else{let h=r,c=s,u=j.empty;for(;h+=l,c+=a,a&&i&&(u=u.append(i[o-2>>1])),!(t||o==n.sections.length||n.sections[o+1]<0);)l=n.sections[o++],a=n.sections[o++];e(r,h,s,c,u),r=h,s=c}}}function Kd(n,e,t,i=!1){let r=[],s=i?[]:null,o=new ql(n),l=new ql(e);for(let a=0,h=0;;)if(o.ins==-1)a+=o.len,o.next();else if(l.ins==-1&&h<a){let c=Math.min(l.len,a-h);l.forward(c),ki(r,c,-1),h+=c}else if(l.ins>=0&&(o.done||h<a||h==a&&(l.len<o.len||l.len==o.len&&!t))){for(ki(r,l.ins,-1);a>h&&!o.done&&a+o.len<h+l.len;)a+=o.len,o.next();h+=l.len,l.next()}else if(o.ins>=0){let c=0,u=a+o.len;for(;;)if(l.ins>=0&&h>a&&h+l.len<u)c+=l.ins,h+=l.len,l.next();else if(l.ins==-1&&h<u){let f=Math.min(l.len,u-h);c+=f,l.forward(f),h+=f}else break;ki(r,c,o.ins),s&&zs(s,r,o.text),a=u,o.next()}else{if(o.done&&l.done)return s?new si(r,s):new Gr(r);throw new Error("Mismatched change set lengths")}}function Aw(n,e,t=!1){let i=[],r=t?[]:null,s=new ql(n),o=new ql(e);for(let l=!1;;){if(s.done&&o.done)return r?new si(i,r):new Gr(i);if(s.ins==0)ki(i,s.len,0,l),s.next();else if(o.len==0&&!o.done)ki(i,0,o.ins,l),r&&zs(r,i,o.text),o.next();else{if(s.done||o.done)throw new Error("Mismatched change set lengths");{let a=Math.min(s.len2,o.len),h=i.length;if(s.ins==-1){let c=o.ins==-1?-1:o.off?0:o.ins;ki(i,a,c,l),r&&c&&zs(r,i,o.text)}else o.ins==-1?(ki(i,s.off?0:s.len,a,l),r&&zs(r,i,s.textBit(a))):(ki(i,s.off?0:s.len,o.off?0:o.ins,l),r&&!o.off&&zs(r,i,o.text));l=(s.ins>a||o.ins>=0&&o.len>a)&&(l||i.length>h),s.forward2(a),o.forward(a)}}}}class ql{constructor(e){this.set=e,this.i=0,this.next()}next(){let{sections:e}=this.set;this.i<e.length?(this.len=e[this.i++],this.ins=e[this.i++]):(this.len=0,this.ins=-2),this.off=0}get done(){return this.ins==-2}get len2(){return this.ins<0?this.len:this.ins}get text(){let{inserted:e}=this.set,t=this.i-2>>1;return t>=e.length?j.empty:e[t]}textBit(e){let{inserted:t}=this.set,i=this.i-2>>1;return i>=t.length&&!e?j.empty:t[i].slice(this.off,e==null?void 0:this.off+e)}forward(e){e==this.len?this.next():(this.len-=e,this.off+=e)}forward2(e){this.ins==-1?this.forward(e):e==this.ins?this.next():(this.ins-=e,this.off+=e)}}class Bo{constructor(e,t,i){this.from=e,this.to=t,this.flags=i}get anchor(){return this.flags&16?this.to:this.from}get head(){return this.flags&16?this.from:this.to}get empty(){return this.from==this.to}get assoc(){return this.flags&4?-1:this.flags&8?1:0}get bidiLevel(){let e=this.flags&3;return e==3?null:e}get goalColumn(){let e=this.flags>>5;return e==33554431?void 0:e}map(e,t=-1){let i,r;return this.empty?i=r=e.mapPos(this.from,t):(i=e.mapPos(this.from,1),r=e.mapPos(this.to,-1)),i==this.from&&r==this.to?this:new Bo(i,r,this.flags)}extend(e,t=e){if(e<=this.anchor&&t>=this.anchor)return we.range(e,t);let i=Math.abs(e-this.anchor)>Math.abs(t-this.anchor)?e:t;return we.range(this.anchor,i)}eq(e){return this.anchor==e.anchor&&this.head==e.head}toJSON(){return{anchor:this.anchor,head:this.head}}static fromJSON(e){if(!e||typeof e.anchor!="number"||typeof e.head!="number")throw new RangeError("Invalid JSON representation for SelectionRange");return we.range(e.anchor,e.head)}}class we{constructor(e,t=0){this.ranges=e,this.mainIndex=t}map(e,t=-1){return e.empty?this:we.create(this.ranges.map(i=>i.map(e,t)),this.mainIndex)}eq(e){if(this.ranges.length!=e.ranges.length||this.mainIndex!=e.mainIndex)return!1;for(let t=0;t<this.ranges.length;t++)if(!this.ranges[t].eq(e.ranges[t]))return!1;return!0}get main(){return this.ranges[this.mainIndex]}asSingle(){return this.ranges.length==1?this:new we([this.main])}addRange(e,t=!0){return we.create([e].concat(this.ranges),t?0:this.mainIndex+1)}replaceRange(e,t=this.mainIndex){let i=this.ranges.slice();return i[t]=e,we.create(i,this.mainIndex)}toJSON(){return{ranges:this.ranges.map(e=>e.toJSON()),main:this.mainIndex}}static fromJSON(e){if(!e||!Array.isArray(e.ranges)||typeof e.main!="number"||e.main>=e.ranges.length)throw new RangeError("Invalid JSON representation for EditorSelection");return new we(e.ranges.map(t=>Bo.fromJSON(t)),e.main)}static single(e,t=e){return new we([we.range(e,t)],0)}static create(e,t=0){if(e.length==0)throw new RangeError("A selection needs at least one range");for(let i=0,r=0;r<e.length;r++){let s=e[r];if(s.empty?s.from<=i:s.from<i)return dR(e.slice(),t);i=s.to}return new we(e,t)}static cursor(e,t=0,i,r){return new Bo(e,e,(t==0?0:t<0?4:8)|(i==null?3:Math.min(2,i))|(r!=null?r:33554431)<<5)}static range(e,t,i){let r=(i!=null?i:33554431)<<5;return t<e?new Bo(t,e,16|r|8):new Bo(e,t,r|(t>e?4:0))}}function dR(n,e=0){let t=n[e];n.sort((i,r)=>i.from-r.from),e=n.indexOf(t);for(let i=1;i<n.length;i++){let r=n[i],s=n[i-1];if(r.empty?r.from<=s.to:r.from<s.to){let o=s.from,l=Math.max(r.to,s.to);i<=e&&e--,n.splice(--i,2,r.anchor>r.head?we.range(l,o):we.range(o,l))}}return new we(n,e)}function Ow(n,e){for(let t of n.ranges)if(t.to>e)throw new RangeError("Selection points outside of document")}let Gd=0;class Ie{constructor(e,t,i,r,s){this.combine=e,this.compareInput=t,this.compare=i,this.isStatic=r,this.extensions=s,this.id=Gd++,this.default=e([])}static define(e={}){return new Ie(e.combine||(t=>t),e.compareInput||((t,i)=>t===i),e.compare||(e.combine?(t,i)=>t===i:Jd),!!e.static,e.enables)}of(e){return new Qh([],this,0,e)}compute(e,t){if(this.isStatic)throw new Error("Can't compute a static facet");return new Qh(e,this,1,t)}computeN(e,t){if(this.isStatic)throw new Error("Can't compute a static facet");return new Qh(e,this,2,t)}from(e,t){return t||(t=i=>i),this.compute([e],i=>t(i.field(e)))}}function Jd(n,e){return n==e||n.length==e.length&&n.every((t,i)=>t===e[i])}class Qh{constructor(e,t,i,r){this.dependencies=e,this.facet=t,this.type=i,this.value=r,this.id=Gd++}dynamicSlot(e){var t;let i=this.value,r=this.facet.compareInput,s=this.id,o=e[s]>>1,l=this.type==2,a=!1,h=!1,c=[];for(let u of this.dependencies)u=="doc"?a=!0:u=="selection"?h=!0:(((t=e[u.id])!==null&&t!==void 0?t:1)&1)==0&&c.push(e[u.id]);return{create(u){return u.values[o]=i(u),1},update(u,f){if(a&&f.docChanged||h&&(f.docChanged||f.selection)||c.some(d=>(js(u,d)&1)>0)){let d=i(u);if(l?!_w(d,u.values[o],r):!r(d,u.values[o]))return u.values[o]=d,1}return 0},reconfigure(u,f){let d=i(u),p=f.config.address[s];if(p!=null){let g=ic(f,p);if(l?_w(d,g,r):r(d,g))return u.values[o]=g,0}return u.values[o]=d,1}}}}function _w(n,e,t){if(n.length!=e.length)return!1;for(let i=0;i<n.length;i++)if(!t(n[i],e[i]))return!1;return!0}function pR(n,e,t){let i=t.map(a=>n[a.id]),r=t.map(a=>a.type),s=i.filter(a=>!(a&1)),o=n[e.id]>>1;function l(a){let h=[];for(let c=0;c<i.length;c++){let u=ic(a,i[c]);if(r[c]==2)for(let f of u)h.push(f);else h.push(u)}return e.combine(h)}return{create(a){for(let h of i)js(a,h);return a.values[o]=l(a),1},update(a,h){if(!s.some(u=>js(a,u)&1))return 0;let c=l(a);return e.compare(c,a.values[o])?0:(a.values[o]=c,1)},reconfigure(a,h){let c=i.some(p=>js(a,p)&1),u=h.config.facets[e.id],f=h.facet(e);if(u&&!c&&Jd(t,u))return a.values[o]=f,0;let d=l(a);return e.compare(d,f)?(a.values[o]=f,0):(a.values[o]=d,1)}}}const Dw=Ie.define({static:!0});class Ro{constructor(e,t,i,r,s){this.id=e,this.createF=t,this.updateF=i,this.compareF=r,this.spec=s,this.provides=void 0}static define(e){let t=new Ro(Gd++,e.create,e.update,e.compare||((i,r)=>i===r),e);return e.provide&&(t.provides=e.provide(t)),t}create(e){let t=e.facet(Dw).find(i=>i.field==this);return((t==null?void 0:t.create)||this.createF)(e)}slot(e){let t=e[this.id]>>1;return{create:i=>(i.values[t]=this.create(i),1),update:(i,r)=>{let s=i.values[t],o=this.updateF(s,r);return this.compareF(s,o)?0:(i.values[t]=o,1)},reconfigure:(i,r)=>r.config.address[this.id]!=null?(i.values[t]=r.field(this),0):(i.values[t]=this.create(i),1)}}init(e){return[this,Dw.of({field:this,create:e})]}get extension(){return this}}const xr={lowest:4,low:3,default:2,high:1,highest:0};function Jr(n){return e=>new Mw(e,n)}const mR={lowest:Jr(xr.lowest),low:Jr(xr.low),default:Jr(xr.default),high:Jr(xr.high),highest:Jr(xr.highest),fallback:Jr(xr.lowest),extend:Jr(xr.high),override:Jr(xr.highest)};class Mw{constructor(e,t){this.inner=e,this.prec=t}}class ec{of(e){return new Zd(this,e)}reconfigure(e){return ec.reconfigure.of({compartment:this,extension:e})}get(e){return e.config.compartments.get(this)}}class Zd{constructor(e,t){this.compartment=e,this.inner=t}}class tc{constructor(e,t,i,r,s,o){for(this.base=e,this.compartments=t,this.dynamicSlots=i,this.address=r,this.staticValues=s,this.facets=o,this.statusTemplate=[];this.statusTemplate.length<i.length;)this.statusTemplate.push(0)}staticFacet(e){let t=this.address[e.id];return t==null?e.default:this.staticValues[t>>1]}static resolve(e,t,i){let r=[],s=Object.create(null),o=new Map;for(let f of gR(e,t,o))f instanceof Ro?r.push(f):(s[f.facet.id]||(s[f.facet.id]=[])).push(f);let l=Object.create(null),a=[],h=[];for(let f of r)l[f.id]=h.length<<1,h.push(d=>f.slot(d));let c=i==null?void 0:i.config.facets;for(let f in s){let d=s[f],p=d[0].facet,g=c&&c[f]||[];if(d.every(y=>y.type==0))if(l[p.id]=a.length<<1|1,Jd(g,d))a.push(i.facet(p));else{let y=p.combine(d.map(v=>v.value));a.push(i&&p.compare(y,i.facet(p))?i.facet(p):y)}else{for(let y of d)y.type==0?(l[y.id]=a.length<<1|1,a.push(y.value)):(l[y.id]=h.length<<1,h.push(v=>y.dynamicSlot(v)));l[p.id]=h.length<<1,h.push(y=>pR(y,p,d))}}let u=h.map(f=>f(l));return new tc(e,o,u,l,a,s)}}function gR(n,e,t){let i=[[],[],[],[],[]],r=new Map;function s(o,l){let a=r.get(o);if(a!=null){if(a>=l)return;let h=i[a].indexOf(o);h>-1&&i[a].splice(h,1),o instanceof Zd&&t.delete(o.compartment)}if(r.set(o,l),Array.isArray(o))for(let h of o)s(h,l);else if(o instanceof Zd){if(t.has(o.compartment))throw new RangeError("Duplicate use of compartment in extensions");let h=e.get(o.compartment)||o.inner;t.set(o.compartment,h),s(h,l)}else if(o instanceof Mw)s(o.inner,o.prec);else if(o instanceof Ro)i[l].push(o),o.provides&&s(o.provides,l);else if(o instanceof Qh)i[l].push(o),o.facet.extensions&&s(o.facet.extensions,l);else{let h=o.extension;if(!h)throw new Error(`Unrecognized extension value in extension set (${o}). This sometimes happens because multiple instances of @codemirror/state are loaded, breaking instanceof checks.`);s(h,l)}}return s(n,xr.default),i.reduce((o,l)=>o.concat(l))}function js(n,e){if(e&1)return 2;let t=e>>1,i=n.status[t];if(i==4)throw new Error("Cyclic dependency between fields and/or facets");if(i&2)return i;n.status[t]=4;let r=n.computeSlot(n,n.config.dynamicSlots[t]);return n.status[t]=2|r}function ic(n,e){return e&1?n.config.staticValues[e>>1]:n.values[e>>1]}const Ew=Ie.define(),Tw=Ie.define({combine:n=>n.some(e=>e),static:!0}),Pw=Ie.define({combine:n=>n.length?n[0]:void 0,static:!0}),Bw=Ie.define(),Rw=Ie.define(),Lw=Ie.define(),Fw=Ie.define({combine:n=>n.length?n[0]:!1});class Kl{constructor(e,t){this.type=e,this.value=t}static define(){return new yR}}class yR{of(e){return new Kl(this,e)}}class vR{constructor(e){this.map=e}of(e){return new Wt(this,e)}}class Wt{constructor(e,t){this.type=e,this.value=t}map(e){let t=this.type.map(this.value,e);return t===void 0?void 0:t==this.value?this:new Wt(this.type,t)}is(e){return this.type==e}static define(e={}){return new vR(e.map||(t=>t))}static mapEffects(e,t){if(!e.length)return e;let i=[];for(let r of e){let s=r.map(t);s&&i.push(s)}return i}}Wt.reconfigure=Wt.define(),Wt.appendConfig=Wt.define();class Ci{constructor(e,t,i,r,s,o){this.startState=e,this.changes=t,this.selection=i,this.effects=r,this.annotations=s,this.scrollIntoView=o,this._doc=null,this._state=null,i&&Ow(i,t.newLength),s.some(l=>l.type==Ci.time)||(this.annotations=s.concat(Ci.time.of(Date.now())))}get newDoc(){return this._doc||(this._doc=this.changes.apply(this.startState.doc))}get newSelection(){return this.selection||this.startState.selection.map(this.changes)}get state(){return this._state||this.startState.applyTransaction(this),this._state}annotation(e){for(let t of this.annotations)if(t.type==e)return t.value}get docChanged(){return!this.changes.empty}get reconfigured(){return this.startState.config!=this.state.config}isUserEvent(e){let t=this.annotation(Ci.userEvent);return!!(t&&(t==e||t.length>e.length&&t.slice(0,e.length)==e&&t[e.length]=="."))}}Ci.time=Kl.define(),Ci.userEvent=Kl.define(),Ci.addToHistory=Kl.define(),Ci.remote=Kl.define();function wR(n,e){let t=[];for(let i=0,r=0;;){let s,o;if(i<n.length&&(r==e.length||e[r]>=n[i]))s=n[i++],o=n[i++];else if(r<e.length)s=e[r++],o=e[r++];else return t;!t.length||t[t.length-1]<s?t.push(s,o):t[t.length-1]<o&&(t[t.length-1]=o)}}function Nw(n,e,t){var i;let r,s,o;return t?(r=e.changes,s=si.empty(e.changes.length),o=n.changes.compose(e.changes)):(r=e.changes.map(n.changes),s=n.changes.mapDesc(e.changes,!0),o=n.changes.compose(r)),{changes:o,selection:e.selection?e.selection.map(s):(i=n.selection)===null||i===void 0?void 0:i.map(r),effects:Wt.mapEffects(n.effects,r).concat(Wt.mapEffects(e.effects,s)),annotations:n.annotations.length?n.annotations.concat(e.annotations):e.annotations,scrollIntoView:n.scrollIntoView||e.scrollIntoView}}function Yd(n,e,t){let i=e.selection,r=Lo(e.annotations);return e.userEvent&&(r=r.concat(Ci.userEvent.of(e.userEvent))),{changes:e.changes instanceof si?e.changes:si.of(e.changes||[],t,n.facet(Pw)),selection:i&&(i instanceof we?i:we.single(i.anchor,i.head)),effects:Lo(e.effects),annotations:r,scrollIntoView:!!e.scrollIntoView}}function Iw(n,e,t){let i=Yd(n,e.length?e[0]:{},n.doc.length);e.length&&e[0].filter===!1&&(t=!1);for(let s=1;s<e.length;s++){e[s].filter===!1&&(t=!1);let o=!!e[s].sequential;i=Nw(i,Yd(n,e[s],o?i.changes.newLength:n.doc.length),o)}let r=new Ci(n,i.changes,i.selection,i.effects,i.annotations,i.scrollIntoView);return xR(t?bR(r):r)}function bR(n){let e=n.startState,t=!0;for(let r of e.facet(Bw)){let s=r(n);if(s===!1){t=!1;break}Array.isArray(s)&&(t=t===!0?s:wR(t,s))}if(t!==!0){let r,s;if(t===!1)s=n.changes.invertedDesc,r=si.empty(e.doc.length);else{let o=n.changes.filter(t);r=o.changes,s=o.filtered.invertedDesc}n=new Ci(e,r,n.selection&&n.selection.map(s),Wt.mapEffects(n.effects,s),n.annotations,n.scrollIntoView)}let i=e.facet(Rw);for(let r=i.length-1;r>=0;r--){let s=i[r](n);s instanceof Ci?n=s:Array.isArray(s)&&s.length==1&&s[0]instanceof Ci?n=s[0]:n=Iw(e,Lo(s),!1)}return n}function xR(n){let e=n.startState,t=e.facet(Lw),i=n;for(let r=t.length-1;r>=0;r--){let s=t[r](n);s&&Object.keys(s).length&&(i=Nw(n,Yd(e,s,n.changes.newLength),!0))}return i==n?n:new Ci(e,n.changes,n.selection,i.effects,i.annotations,i.scrollIntoView)}const SR=[];function Lo(n){return n==null?SR:Array.isArray(n)?n:[n]}var Sr=function(n){return n[n.Word=0]="Word",n[n.Space=1]="Space",n[n.Other=2]="Other",n}(Sr||(Sr={}));const kR=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;let Xd;try{Xd=new RegExp("[\\p{Alphabetic}\\p{Number}_]","u")}catch{}function CR(n){if(Xd)return Xd.test(n);for(let e=0;e<n.length;e++){let t=n[e];if(/\w/.test(t)||t>"\x80"&&(t.toUpperCase()!=t.toLowerCase()||kR.test(t)))return!0}return!1}function AR(n){return e=>{if(!/\S/.test(e))return Sr.Space;if(CR(e))return Sr.Word;for(let t=0;t<n.length;t++)if(e.indexOf(n[t])>-1)return Sr.Word;return Sr.Other}}class at{constructor(e,t,i,r,s,o){this.config=e,this.doc=t,this.selection=i,this.values=r,this.status=e.statusTemplate.slice(),this.computeSlot=s,o&&(o._state=this);for(let l=0;l<this.config.dynamicSlots.length;l++)js(this,l<<1);this.computeSlot=null}field(e,t=!0){let i=this.config.address[e.id];if(i==null){if(t)throw new RangeError("Field is not present in this state");return}return js(this,i),ic(this,i)}update(...e){return Iw(this,e,!0)}applyTransaction(e){let t=this.config,{base:i,compartments:r}=t;for(let o of e.effects)o.is(ec.reconfigure)?(t&&(r=new Map,t.compartments.forEach((l,a)=>r.set(a,l)),t=null),r.set(o.value.compartment,o.value.extension)):o.is(Wt.reconfigure)?(t=null,i=o.value):o.is(Wt.appendConfig)&&(t=null,i=Lo(i).concat(o.value));let s;t?s=e.startState.values.slice():(t=tc.resolve(i,r,this),s=new at(t,this.doc,this.selection,t.dynamicSlots.map(()=>null),(l,a)=>a.reconfigure(l,this),null).values),new at(t,e.newDoc,e.newSelection,s,(o,l)=>l.update(o,e),e)}replaceSelection(e){return typeof e=="string"&&(e=this.toText(e)),this.changeByRange(t=>({changes:{from:t.from,to:t.to,insert:e},range:we.cursor(t.from+e.length)}))}changeByRange(e){let t=this.selection,i=e(t.ranges[0]),r=this.changes(i.changes),s=[i.range],o=Lo(i.effects);for(let l=1;l<t.ranges.length;l++){let a=e(t.ranges[l]),h=this.changes(a.changes),c=h.map(r);for(let f=0;f<l;f++)s[f]=s[f].map(c);let u=r.mapDesc(h,!0);s.push(a.range.map(u)),r=r.compose(c),o=Wt.mapEffects(o,c).concat(Wt.mapEffects(Lo(a.effects),u))}return{changes:r,selection:we.create(s,t.mainIndex),effects:o}}changes(e=[]){return e instanceof si?e:si.of(e,this.doc.length,this.facet(at.lineSeparator))}toText(e){return j.of(e.split(this.facet(at.lineSeparator)||Ud))}sliceDoc(e=0,t=this.doc.length){return this.doc.sliceString(e,t,this.lineBreak)}facet(e){let t=this.config.address[e.id];return t==null?e.default:(js(this,t),ic(this,t))}toJSON(e){let t={doc:this.sliceDoc(),selection:this.selection.toJSON()};if(e)for(let i in e){let r=e[i];r instanceof Ro&&(t[i]=r.spec.toJSON(this.field(e[i]),this))}return t}static fromJSON(e,t={},i){if(!e||typeof e.doc!="string")throw new RangeError("Invalid JSON representation for EditorState");let r=[];if(i)for(let s in i){let o=i[s],l=e[s];r.push(o.init(a=>o.spec.fromJSON(l,a)))}return at.create({doc:e.doc,selection:we.fromJSON(e.selection),extensions:t.extensions?r.concat([t.extensions]):r})}static create(e={}){let t=tc.resolve(e.extensions||[],new Map),i=e.doc instanceof j?e.doc:j.of((e.doc||"").split(t.staticFacet(at.lineSeparator)||Ud)),r=e.selection?e.selection instanceof we?e.selection:we.single(e.selection.anchor,e.selection.head):we.single(0);return Ow(r,i.length),t.staticFacet(Tw)||(r=r.asSingle()),new at(t,i,r,t.dynamicSlots.map(()=>null),(s,o)=>o.create(s),null)}get tabSize(){return this.facet(at.tabSize)}get lineBreak(){return this.facet(at.lineSeparator)||`
`}get readOnly(){return this.facet(Fw)}phrase(e){for(let t of this.facet(at.phrases))if(Object.prototype.hasOwnProperty.call(t,e))return t[e];return e}languageDataAt(e,t,i=-1){let r=[];for(let s of this.facet(Ew))for(let o of s(this,t,i))Object.prototype.hasOwnProperty.call(o,e)&&r.push(o[e]);return r}charCategorizer(e){return AR(this.languageDataAt("wordChars",e).join(""))}wordAt(e){let{text:t,from:i,length:r}=this.doc.lineAt(e),s=this.charCategorizer(e),o=e-i,l=e-i;for(;o>0;){let a=lt(t,o,!1);if(s(t.slice(a,o))!=Sr.Word)break;o=a}for(;l<r;){let a=lt(t,l);if(s(t.slice(l,a))!=Sr.Word)break;l=a}return o==l?null:we.range(o+i,l+i)}}at.allowMultipleSelections=Tw,at.tabSize=Ie.define({combine:n=>n.length?n[0]:4}),at.lineSeparator=Pw,at.readOnly=Fw,at.phrases=Ie.define(),at.languageData=Ew,at.changeFilter=Bw,at.transactionFilter=Rw,at.transactionExtender=Lw,ec.reconfigure=Wt.define();function Ww(n,e,t={}){let i={};for(let r of n)for(let s of Object.keys(r)){let o=r[s],l=i[s];if(l===void 0)i[s]=o;else if(!(l===o||o===void 0))if(Object.hasOwnProperty.call(t,s))i[s]=t[s](l,o);else throw new Error("Config merge conflict for field "+s)}for(let r in e)i[r]===void 0&&(i[r]=e[r]);return i}const Qd="\u037C",Vw=typeof Symbol=="undefined"?"__"+Qd:Symbol.for(Qd),ep=typeof Symbol=="undefined"?"__styleSet"+Math.floor(Math.random()*1e8):Symbol("styleSet"),Hw=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:{};class Ue{constructor(e,t){this.rules=[];let{finish:i}=t||{};function r(o){return/^@/.test(o)?[o]:o.split(/,\s*/)}function s(o,l,a,h){let c=[],u=/^@(\w+)\b/.exec(o[0]),f=u&&u[1]=="keyframes";if(u&&l==null)return a.push(o[0]+";");for(let d in l){let p=l[d];if(/&/.test(d))s(d.split(/,\s*/).map(g=>o.map(y=>g.replace(/&/,y))).reduce((g,y)=>g.concat(y)),p,a);else if(p&&typeof p=="object"){if(!u)throw new RangeError("The value of a property ("+d+") should be a primitive value.");s(r(d),p,c,f)}else p!=null&&c.push(d.replace(/_.*/,"").replace(/[A-Z]/g,g=>"-"+g.toLowerCase())+": "+p+";")}(c.length||f)&&a.push((i&&!u&&!h?o.map(i):o).join(", ")+" {"+c.join(" ")+"}")}for(let o in e)s(r(o),e[o],this.rules)}getRules(){return this.rules.join(`
`)}static newName(){let e=Hw[Vw]||1;return Hw[Vw]=e+1,Qd+e.toString(36)}static mount(e,t){(e[ep]||new OR(e)).mount(Array.isArray(t)?t:[t])}}let nc=null;class OR{constructor(e){if(!e.head&&e.adoptedStyleSheets&&typeof CSSStyleSheet!="undefined"){if(nc)return e.adoptedStyleSheets=[nc.sheet].concat(e.adoptedStyleSheets),e[ep]=nc;this.sheet=new CSSStyleSheet,e.adoptedStyleSheets=[this.sheet].concat(e.adoptedStyleSheets),nc=this}else{this.styleTag=(e.ownerDocument||e).createElement("style");let t=e.head||e;t.insertBefore(this.styleTag,t.firstChild)}this.modules=[],e[ep]=this}mount(e){let t=this.sheet,i=0,r=0;for(let s=0;s<e.length;s++){let o=e[s],l=this.modules.indexOf(o);if(l<r&&l>-1&&(this.modules.splice(l,1),r--,l=-1),l==-1){if(this.modules.splice(r++,0,o),t)for(let a=0;a<o.rules.length;a++)t.insertRule(o.rules[a],i++)}else{for(;r<l;)i+=this.modules[r++].rules.length;i+=o.rules.length,r++}}if(!t){let s="";for(let o=0;o<this.modules.length;o++)s+=this.modules[o].getRules()+`
`;this.styleTag.textContent=s}}}const tp=/\r\n?|\n/;var Zr=function(n){return n[n.Simple=0]="Simple",n[n.TrackDel=1]="TrackDel",n[n.TrackBefore=2]="TrackBefore",n[n.TrackAfter=3]="TrackAfter",n}(Zr||(Zr={}));class Yr{constructor(e){this.sections=e}get length(){let e=0;for(let t=0;t<this.sections.length;t+=2)e+=this.sections[t];return e}get newLength(){let e=0;for(let t=0;t<this.sections.length;t+=2){let i=this.sections[t+1];e+=i<0?this.sections[t]:i}return e}get empty(){return this.sections.length==0||this.sections.length==2&&this.sections[1]<0}iterGaps(e){for(let t=0,i=0,r=0;t<this.sections.length;){let s=this.sections[t++],o=this.sections[t++];o<0?(e(i,r,s),r+=s):r+=o,i+=s}}iterChangedRanges(e,t=!1){ip(this,e,t)}get invertedDesc(){let e=[];for(let t=0;t<this.sections.length;){let i=this.sections[t++],r=this.sections[t++];r<0?e.push(i,r):e.push(r,i)}return new Yr(e)}composeDesc(e){return this.empty?e:e.empty?this:zw(this,e)}mapDesc(e,t=!1){return e.empty?this:np(this,e,t)}mapPos(e,t=-1,i=Zr.Simple){let r=0,s=0;for(let o=0;o<this.sections.length;){let l=this.sections[o++],a=this.sections[o++],h=r+l;if(a<0){if(h>e)return s+(e-r);s+=l}else{if(i!=Zr.Simple&&h>=e&&(i==Zr.TrackDel&&r<e&&h>e||i==Zr.TrackBefore&&r<e||i==Zr.TrackAfter&&h>e))return null;if(h>e||h==e&&t<0&&!l)return e==r||t<0?s:s+a;s+=a}r=h}if(e>r)throw new RangeError(`Position ${e} is out of range for changeset of length ${r}`);return s}touchesRange(e,t=e){for(let i=0,r=0;i<this.sections.length&&r<=t;){let s=this.sections[i++],o=this.sections[i++],l=r+s;if(o>=0&&r<=t&&l>=e)return r<e&&l>t?"cover":!0;r=l}return!1}toString(){let e="";for(let t=0;t<this.sections.length;){let i=this.sections[t++],r=this.sections[t++];e+=(e?" ":"")+i+(r>=0?":"+r:"")}return e}toJSON(){return this.sections}static fromJSON(e){if(!Array.isArray(e)||e.length%2||e.some(t=>typeof t!="number"))throw new RangeError("Invalid JSON representation of ChangeDesc");return new Yr(e)}}class Ai extends Yr{constructor(e,t){super(e),this.inserted=t}apply(e){if(this.length!=e.length)throw new RangeError("Applying change set to a document with the wrong length");return ip(this,(t,i,r,s,o)=>e=e.replace(r,r+(i-t),o),!1),e}mapDesc(e,t=!1){return np(this,e,t,!0)}invert(e){let t=this.sections.slice(),i=[];for(let r=0,s=0;r<t.length;r+=2){let o=t[r],l=t[r+1];if(l>=0){t[r]=l,t[r+1]=o;let a=r>>1;for(;i.length<a;)i.push(j.empty);i.push(o?e.slice(s,s+o):j.empty)}s+=o}return new Ai(t,i)}compose(e){return this.empty?e:e.empty?this:zw(this,e,!0)}map(e,t=!1){return e.empty?this:np(this,e,t,!0)}iterChanges(e,t=!1){ip(this,e,t)}get desc(){return new Yr(this.sections)}filter(e){let t=[],i=[],r=[],s=new Gl(this);e:for(let o=0,l=0;;){let a=o==e.length?1e9:e[o++];for(;l<a||l==a&&s.len==0;){if(s.done)break e;let c=Math.min(s.len,a-l);Oi(r,c,-1);let u=s.ins==-1?-1:s.off==0?s.ins:0;Oi(t,c,u),u>0&&$s(i,t,s.text),s.forward(c),l+=c}let h=e[o++];for(;l<h;){if(s.done)break e;let c=Math.min(s.len,h-l);Oi(t,c,-1),Oi(r,c,s.ins==-1?-1:s.off==0?s.ins:0),s.forward(c),l+=c}}return{changes:new Ai(t,i),filtered:new Yr(r)}}toJSON(){let e=[];for(let t=0;t<this.sections.length;t+=2){let i=this.sections[t],r=this.sections[t+1];r<0?e.push(i):r==0?e.push([i]):e.push([i].concat(this.inserted[t>>1].toJSON()))}return e}static of(e,t,i){let r=[],s=[],o=0,l=null;function a(c=!1){if(!c&&!r.length)return;o<t&&Oi(r,t-o,-1);let u=new Ai(r,s);l=l?l.compose(u.map(l)):u,r=[],s=[],o=0}function h(c){if(Array.isArray(c))for(let u of c)h(u);else if(c instanceof Ai){if(c.length!=t)throw new RangeError(`Mismatched change set length (got ${c.length}, expected ${t})`);a(),l=l?l.compose(c.map(l)):c}else{let{from:u,to:f=u,insert:d}=c;if(u>f||u<0||f>t)throw new RangeError(`Invalid change range ${u} to ${f} (in doc of length ${t})`);let p=d?typeof d=="string"?j.of(d.split(i||tp)):d:j.empty,g=p.length;if(u==f&&g==0)return;u<o&&a(),u>o&&Oi(r,u-o,-1),Oi(r,f-u,g),$s(s,r,p),o=f}}return h(e),a(!l),l}static empty(e){return new Ai(e?[e,-1]:[],[])}static fromJSON(e){if(!Array.isArray(e))throw new RangeError("Invalid JSON representation of ChangeSet");let t=[],i=[];for(let r=0;r<e.length;r++){let s=e[r];if(typeof s=="number")t.push(s,-1);else{if(!Array.isArray(s)||typeof s[0]!="number"||s.some((o,l)=>l&&typeof o!="string"))throw new RangeError("Invalid JSON representation of ChangeSet");if(s.length==1)t.push(s[0],0);else{for(;i.length<r;)i.push(j.empty);i[r]=j.of(s.slice(1)),t.push(s[0],i[r].length)}}}return new Ai(t,i)}}function Oi(n,e,t,i=!1){if(e==0&&t<=0)return;let r=n.length-2;r>=0&&t<=0&&t==n[r+1]?n[r]+=e:e==0&&n[r]==0?n[r+1]+=t:i?(n[r]+=e,n[r+1]+=t):n.push(e,t)}function $s(n,e,t){if(t.length==0)return;let i=e.length-2>>1;if(i<n.length)n[n.length-1]=n[n.length-1].append(t);else{for(;n.length<i;)n.push(j.empty);n.push(t)}}function ip(n,e,t){let i=n.inserted;for(let r=0,s=0,o=0;o<n.sections.length;){let l=n.sections[o++],a=n.sections[o++];if(a<0)r+=l,s+=l;else{let h=r,c=s,u=j.empty;for(;h+=l,c+=a,a&&i&&(u=u.append(i[o-2>>1])),!(t||o==n.sections.length||n.sections[o+1]<0);)l=n.sections[o++],a=n.sections[o++];e(r,h,s,c,u),r=h,s=c}}}function np(n,e,t,i=!1){let r=[],s=i?[]:null,o=new Gl(n),l=new Gl(e);for(let a=0,h=0;;)if(o.ins==-1)a+=o.len,o.next();else if(l.ins==-1&&h<a){let c=Math.min(l.len,a-h);l.forward(c),Oi(r,c,-1),h+=c}else if(l.ins>=0&&(o.done||h<a||h==a&&(l.len<o.len||l.len==o.len&&!t))){for(Oi(r,l.ins,-1);a>h&&!o.done&&a+o.len<h+l.len;)a+=o.len,o.next();h+=l.len,l.next()}else if(o.ins>=0){let c=0,u=a+o.len;for(;;)if(l.ins>=0&&h>a&&h+l.len<u)c+=l.ins,h+=l.len,l.next();else if(l.ins==-1&&h<u){let f=Math.min(l.len,u-h);c+=f,l.forward(f),h+=f}else break;Oi(r,c,o.ins),s&&$s(s,r,o.text),a=u,o.next()}else{if(o.done&&l.done)return s?new Ai(r,s):new Yr(r);throw new Error("Mismatched change set lengths")}}function zw(n,e,t=!1){let i=[],r=t?[]:null,s=new Gl(n),o=new Gl(e);for(let l=!1;;){if(s.done&&o.done)return r?new Ai(i,r):new Yr(i);if(s.ins==0)Oi(i,s.len,0,l),s.next();else if(o.len==0&&!o.done)Oi(i,0,o.ins,l),r&&$s(r,i,o.text),o.next();else{if(s.done||o.done)throw new Error("Mismatched change set lengths");{let a=Math.min(s.len2,o.len),h=i.length;if(s.ins==-1){let c=o.ins==-1?-1:o.off?0:o.ins;Oi(i,a,c,l),r&&c&&$s(r,i,o.text)}else o.ins==-1?(Oi(i,s.off?0:s.len,a,l),r&&$s(r,i,s.textBit(a))):(Oi(i,s.off?0:s.len,o.off?0:o.ins,l),r&&!o.off&&$s(r,i,o.text));l=(s.ins>a||o.ins>=0&&o.len>a)&&(l||i.length>h),s.forward2(a),o.forward(a)}}}}class Gl{constructor(e){this.set=e,this.i=0,this.next()}next(){let{sections:e}=this.set;this.i<e.length?(this.len=e[this.i++],this.ins=e[this.i++]):(this.len=0,this.ins=-2),this.off=0}get done(){return this.ins==-2}get len2(){return this.ins<0?this.len:this.ins}get text(){let{inserted:e}=this.set,t=this.i-2>>1;return t>=e.length?j.empty:e[t]}textBit(e){let{inserted:t}=this.set,i=this.i-2>>1;return i>=t.length&&!e?j.empty:t[i].slice(this.off,e==null?void 0:this.off+e)}forward(e){e==this.len?this.next():(this.len-=e,this.off+=e)}forward2(e){this.ins==-1?this.forward(e):e==this.ins?this.next():(this.ins-=e,this.off+=e)}}class Fo{constructor(e,t,i){this.from=e,this.to=t,this.flags=i}get anchor(){return this.flags&16?this.to:this.from}get head(){return this.flags&16?this.from:this.to}get empty(){return this.from==this.to}get assoc(){return this.flags&4?-1:this.flags&8?1:0}get bidiLevel(){let e=this.flags&3;return e==3?null:e}get goalColumn(){let e=this.flags>>5;return e==33554431?void 0:e}map(e,t=-1){let i,r;return this.empty?i=r=e.mapPos(this.from,t):(i=e.mapPos(this.from,1),r=e.mapPos(this.to,-1)),i==this.from&&r==this.to?this:new Fo(i,r,this.flags)}extend(e,t=e){if(e<=this.anchor&&t>=this.anchor)return ut.range(e,t);let i=Math.abs(e-this.anchor)>Math.abs(t-this.anchor)?e:t;return ut.range(this.anchor,i)}eq(e){return this.anchor==e.anchor&&this.head==e.head}toJSON(){return{anchor:this.anchor,head:this.head}}static fromJSON(e){if(!e||typeof e.anchor!="number"||typeof e.head!="number")throw new RangeError("Invalid JSON representation for SelectionRange");return ut.range(e.anchor,e.head)}}class ut{constructor(e,t=0){this.ranges=e,this.mainIndex=t}map(e,t=-1){return e.empty?this:ut.create(this.ranges.map(i=>i.map(e,t)),this.mainIndex)}eq(e){if(this.ranges.length!=e.ranges.length||this.mainIndex!=e.mainIndex)return!1;for(let t=0;t<this.ranges.length;t++)if(!this.ranges[t].eq(e.ranges[t]))return!1;return!0}get main(){return this.ranges[this.mainIndex]}asSingle(){return this.ranges.length==1?this:new ut([this.main])}addRange(e,t=!0){return ut.create([e].concat(this.ranges),t?0:this.mainIndex+1)}replaceRange(e,t=this.mainIndex){let i=this.ranges.slice();return i[t]=e,ut.create(i,this.mainIndex)}toJSON(){return{ranges:this.ranges.map(e=>e.toJSON()),main:this.mainIndex}}static fromJSON(e){if(!e||!Array.isArray(e.ranges)||typeof e.main!="number"||e.main>=e.ranges.length)throw new RangeError("Invalid JSON representation for EditorSelection");return new ut(e.ranges.map(t=>Fo.fromJSON(t)),e.main)}static single(e,t=e){return new ut([ut.range(e,t)],0)}static create(e,t=0){if(e.length==0)throw new RangeError("A selection needs at least one range");for(let i=0,r=0;r<e.length;r++){let s=e[r];if(s.empty?s.from<=i:s.from<i)return _R(e.slice(),t);i=s.to}return new ut(e,t)}static cursor(e,t=0,i,r){return new Fo(e,e,(t==0?0:t<0?4:8)|(i==null?3:Math.min(2,i))|(r!=null?r:33554431)<<5)}static range(e,t,i){let r=(i!=null?i:33554431)<<5;return t<e?new Fo(t,e,16|r|8):new Fo(e,t,r|(t>e?4:0))}}function _R(n,e=0){let t=n[e];n.sort((i,r)=>i.from-r.from),e=n.indexOf(t);for(let i=1;i<n.length;i++){let r=n[i],s=n[i-1];if(r.empty?r.from<=s.to:r.from<s.to){let o=s.from,l=Math.max(r.to,s.to);i<=e&&e--,n.splice(--i,2,r.anchor>r.head?ut.range(l,o):ut.range(o,l))}}return new ut(n,e)}function jw(n,e){for(let t of n.ranges)if(t.to>e)throw new RangeError("Selection points outside of document")}let rp=0;class wn{constructor(e,t,i,r,s){this.combine=e,this.compareInput=t,this.compare=i,this.isStatic=r,this.extensions=s,this.id=rp++,this.default=e([])}static define(e={}){return new wn(e.combine||(t=>t),e.compareInput||((t,i)=>t===i),e.compare||(e.combine?(t,i)=>t===i:sp),!!e.static,e.enables)}of(e){return new rc([],this,0,e)}compute(e,t){if(this.isStatic)throw new Error("Can't compute a static facet");return new rc(e,this,1,t)}computeN(e,t){if(this.isStatic)throw new Error("Can't compute a static facet");return new rc(e,this,2,t)}from(e,t){return t||(t=i=>i),this.compute([e],i=>t(i.field(e)))}}function sp(n,e){return n==e||n.length==e.length&&n.every((t,i)=>t===e[i])}class rc{constructor(e,t,i,r){this.dependencies=e,this.facet=t,this.type=i,this.value=r,this.id=rp++}dynamicSlot(e){var t;let i=this.value,r=this.facet.compareInput,s=this.id,o=e[s]>>1,l=this.type==2,a=!1,h=!1,c=[];for(let u of this.dependencies)u=="doc"?a=!0:u=="selection"?h=!0:(((t=e[u.id])!==null&&t!==void 0?t:1)&1)==0&&c.push(e[u.id]);return{create(u){return u.values[o]=i(u),1},update(u,f){if(a&&f.docChanged||h&&(f.docChanged||f.selection)||c.some(d=>(Us(u,d)&1)>0)){let d=i(u);if(l?!$w(d,u.values[o],r):!r(d,u.values[o]))return u.values[o]=d,1}return 0},reconfigure(u,f){let d=i(u),p=f.config.address[s];if(p!=null){let g=lc(f,p);if(l?$w(d,g,r):r(d,g))return u.values[o]=g,0}return u.values[o]=d,1}}}}function $w(n,e,t){if(n.length!=e.length)return!1;for(let i=0;i<n.length;i++)if(!t(n[i],e[i]))return!1;return!0}function DR(n,e,t){let i=t.map(a=>n[a.id]),r=t.map(a=>a.type),s=i.filter(a=>!(a&1)),o=n[e.id]>>1;function l(a){let h=[];for(let c=0;c<i.length;c++){let u=lc(a,i[c]);if(r[c]==2)for(let f of u)h.push(f);else h.push(u)}return e.combine(h)}return{create(a){for(let h of i)Us(a,h);return a.values[o]=l(a),1},update(a,h){if(!s.some(u=>Us(a,u)&1))return 0;let c=l(a);return e.compare(c,a.values[o])?0:(a.values[o]=c,1)},reconfigure(a,h){let c=i.some(p=>Us(a,p)&1),u=h.config.facets[e.id],f=h.facet(e);if(u&&!c&&sp(t,u))return a.values[o]=f,0;let d=l(a);return e.compare(d,f)?(a.values[o]=f,0):(a.values[o]=d,1)}}}const Uw=wn.define({static:!0});class Jl{constructor(e,t,i,r,s){this.id=e,this.createF=t,this.updateF=i,this.compareF=r,this.spec=s,this.provides=void 0}static define(e){let t=new Jl(rp++,e.create,e.update,e.compare||((i,r)=>i===r),e);return e.provide&&(t.provides=e.provide(t)),t}create(e){let t=e.facet(Uw).find(i=>i.field==this);return((t==null?void 0:t.create)||this.createF)(e)}slot(e){let t=e[this.id]>>1;return{create:i=>(i.values[t]=this.create(i),1),update:(i,r)=>{let s=i.values[t],o=this.updateF(s,r);return this.compareF(s,o)?0:(i.values[t]=o,1)},reconfigure:(i,r)=>r.config.address[this.id]!=null?(i.values[t]=r.field(this),0):(i.values[t]=this.create(i),1)}}init(e){return[this,Uw.of({field:this,create:e})]}get extension(){return this}}const kr={lowest:4,low:3,default:2,high:1,highest:0};function Xr(n){return e=>new qw(e,n)}const Pj={lowest:Xr(kr.lowest),low:Xr(kr.low),default:Xr(kr.default),high:Xr(kr.high),highest:Xr(kr.highest),fallback:Xr(kr.lowest),extend:Xr(kr.high),override:Xr(kr.highest)};class qw{constructor(e,t){this.inner=e,this.prec=t}}class sc{of(e){return new op(this,e)}reconfigure(e){return sc.reconfigure.of({compartment:this,extension:e})}get(e){return e.config.compartments.get(this)}}class op{constructor(e,t){this.compartment=e,this.inner=t}}class oc{constructor(e,t,i,r,s,o){for(this.base=e,this.compartments=t,this.dynamicSlots=i,this.address=r,this.staticValues=s,this.facets=o,this.statusTemplate=[];this.statusTemplate.length<i.length;)this.statusTemplate.push(0)}staticFacet(e){let t=this.address[e.id];return t==null?e.default:this.staticValues[t>>1]}static resolve(e,t,i){let r=[],s=Object.create(null),o=new Map;for(let f of MR(e,t,o))f instanceof Jl?r.push(f):(s[f.facet.id]||(s[f.facet.id]=[])).push(f);let l=Object.create(null),a=[],h=[];for(let f of r)l[f.id]=h.length<<1,h.push(d=>f.slot(d));let c=i==null?void 0:i.config.facets;for(let f in s){let d=s[f],p=d[0].facet,g=c&&c[f]||[];if(d.every(y=>y.type==0))if(l[p.id]=a.length<<1|1,sp(g,d))a.push(i.facet(p));else{let y=p.combine(d.map(v=>v.value));a.push(i&&p.compare(y,i.facet(p))?i.facet(p):y)}else{for(let y of d)y.type==0?(l[y.id]=a.length<<1|1,a.push(y.value)):(l[y.id]=h.length<<1,h.push(v=>y.dynamicSlot(v)));l[p.id]=h.length<<1,h.push(y=>DR(y,p,d))}}let u=h.map(f=>f(l));return new oc(e,o,u,l,a,s)}}function MR(n,e,t){let i=[[],[],[],[],[]],r=new Map;function s(o,l){let a=r.get(o);if(a!=null){if(a>=l)return;let h=i[a].indexOf(o);h>-1&&i[a].splice(h,1),o instanceof op&&t.delete(o.compartment)}if(r.set(o,l),Array.isArray(o))for(let h of o)s(h,l);else if(o instanceof op){if(t.has(o.compartment))throw new RangeError("Duplicate use of compartment in extensions");let h=e.get(o.compartment)||o.inner;t.set(o.compartment,h),s(h,l)}else if(o instanceof qw)s(o.inner,o.prec);else if(o instanceof Jl)i[l].push(o),o.provides&&s(o.provides,l);else if(o instanceof rc)i[l].push(o),o.facet.extensions&&s(o.facet.extensions,l);else{let h=o.extension;if(!h)throw new Error(`Unrecognized extension value in extension set (${o}). This sometimes happens because multiple instances of @codemirror/state are loaded, breaking instanceof checks.`);s(h,l)}}return s(n,kr.default),i.reduce((o,l)=>o.concat(l))}function Us(n,e){if(e&1)return 2;let t=e>>1,i=n.status[t];if(i==4)throw new Error("Cyclic dependency between fields and/or facets");if(i&2)return i;n.status[t]=4;let r=n.computeSlot(n,n.config.dynamicSlots[t]);return n.status[t]=2|r}function lc(n,e){return e&1?n.config.staticValues[e>>1]:n.values[e>>1]}const Kw=wn.define(),Gw=wn.define({combine:n=>n.some(e=>e),static:!0}),Jw=wn.define({combine:n=>n.length?n[0]:void 0,static:!0}),Zw=wn.define(),Yw=wn.define(),Xw=wn.define(),Qw=wn.define({combine:n=>n.length?n[0]:!1});class Zl{constructor(e,t){this.type=e,this.value=t}static define(){return new ER}}class ER{of(e){return new Zl(this,e)}}class TR{constructor(e){this.map=e}of(e){return new _i(this,e)}}class _i{constructor(e,t){this.type=e,this.value=t}map(e){let t=this.type.map(this.value,e);return t===void 0?void 0:t==this.value?this:new _i(this.type,t)}is(e){return this.type==e}static define(e={}){return new TR(e.map||(t=>t))}static mapEffects(e,t){if(!e.length)return e;let i=[];for(let r of e){let s=r.map(t);s&&i.push(s)}return i}}_i.reconfigure=_i.define(),_i.appendConfig=_i.define();class Ki{constructor(e,t,i,r,s,o){this.startState=e,this.changes=t,this.selection=i,this.effects=r,this.annotations=s,this.scrollIntoView=o,this._doc=null,this._state=null,i&&jw(i,t.newLength),s.some(l=>l.type==Ki.time)||(this.annotations=s.concat(Ki.time.of(Date.now())))}get newDoc(){return this._doc||(this._doc=this.changes.apply(this.startState.doc))}get newSelection(){return this.selection||this.startState.selection.map(this.changes)}get state(){return this._state||this.startState.applyTransaction(this),this._state}annotation(e){for(let t of this.annotations)if(t.type==e)return t.value}get docChanged(){return!this.changes.empty}get reconfigured(){return this.startState.config!=this.state.config}isUserEvent(e){let t=this.annotation(Ki.userEvent);return!!(t&&(t==e||t.length>e.length&&t.slice(0,e.length)==e&&t[e.length]=="."))}}Ki.time=Zl.define(),Ki.userEvent=Zl.define(),Ki.addToHistory=Zl.define(),Ki.remote=Zl.define();function PR(n,e){let t=[];for(let i=0,r=0;;){let s,o;if(i<n.length&&(r==e.length||e[r]>=n[i]))s=n[i++],o=n[i++];else if(r<e.length)s=e[r++],o=e[r++];else return t;!t.length||t[t.length-1]<s?t.push(s,o):t[t.length-1]<o&&(t[t.length-1]=o)}}function eb(n,e,t){var i;let r,s,o;return t?(r=e.changes,s=Ai.empty(e.changes.length),o=n.changes.compose(e.changes)):(r=e.changes.map(n.changes),s=n.changes.mapDesc(e.changes,!0),o=n.changes.compose(r)),{changes:o,selection:e.selection?e.selection.map(s):(i=n.selection)===null||i===void 0?void 0:i.map(r),effects:_i.mapEffects(n.effects,r).concat(_i.mapEffects(e.effects,s)),annotations:n.annotations.length?n.annotations.concat(e.annotations):e.annotations,scrollIntoView:n.scrollIntoView||e.scrollIntoView}}function lp(n,e,t){let i=e.selection,r=No(e.annotations);return e.userEvent&&(r=r.concat(Ki.userEvent.of(e.userEvent))),{changes:e.changes instanceof Ai?e.changes:Ai.of(e.changes||[],t,n.facet(Jw)),selection:i&&(i instanceof ut?i:ut.single(i.anchor,i.head)),effects:No(e.effects),annotations:r,scrollIntoView:!!e.scrollIntoView}}function tb(n,e,t){let i=lp(n,e.length?e[0]:{},n.doc.length);e.length&&e[0].filter===!1&&(t=!1);for(let s=1;s<e.length;s++){e[s].filter===!1&&(t=!1);let o=!!e[s].sequential;i=eb(i,lp(n,e[s],o?i.changes.newLength:n.doc.length),o)}let r=new Ki(n,i.changes,i.selection,i.effects,i.annotations,i.scrollIntoView);return RR(t?BR(r):r)}function BR(n){let e=n.startState,t=!0;for(let r of e.facet(Zw)){let s=r(n);if(s===!1){t=!1;break}Array.isArray(s)&&(t=t===!0?s:PR(t,s))}if(t!==!0){let r,s;if(t===!1)s=n.changes.invertedDesc,r=Ai.empty(e.doc.length);else{let o=n.changes.filter(t);r=o.changes,s=o.filtered.invertedDesc}n=new Ki(e,r,n.selection&&n.selection.map(s),_i.mapEffects(n.effects,s),n.annotations,n.scrollIntoView)}let i=e.facet(Yw);for(let r=i.length-1;r>=0;r--){let s=i[r](n);s instanceof Ki?n=s:Array.isArray(s)&&s.length==1&&s[0]instanceof Ki?n=s[0]:n=tb(e,No(s),!1)}return n}function RR(n){let e=n.startState,t=e.facet(Xw),i=n;for(let r=t.length-1;r>=0;r--){let s=t[r](n);s&&Object.keys(s).length&&(i=eb(n,lp(e,s,n.changes.newLength),!0))}return i==n?n:new Ki(e,n.changes,n.selection,i.effects,i.annotations,i.scrollIntoView)}const LR=[];function No(n){return n==null?LR:Array.isArray(n)?n:[n]}var Qr=function(n){return n[n.Word=0]="Word",n[n.Space=1]="Space",n[n.Other=2]="Other",n}(Qr||(Qr={}));const FR=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;let ap;try{ap=new RegExp("[\\p{Alphabetic}\\p{Number}_]","u")}catch{}function NR(n){if(ap)return ap.test(n);for(let e=0;e<n.length;e++){let t=n[e];if(/\w/.test(t)||t>"\x80"&&(t.toUpperCase()!=t.toLowerCase()||FR.test(t)))return!0}return!1}function IR(n){return e=>{if(!/\S/.test(e))return Qr.Space;if(NR(e))return Qr.Word;for(let t=0;t<n.length;t++)if(e.indexOf(n[t])>-1)return Qr.Word;return Qr.Other}}class Vt{constructor(e,t,i,r,s,o){this.config=e,this.doc=t,this.selection=i,this.values=r,this.status=e.statusTemplate.slice(),this.computeSlot=s,o&&(o._state=this);for(let l=0;l<this.config.dynamicSlots.length;l++)Us(this,l<<1);this.computeSlot=null}field(e,t=!0){let i=this.config.address[e.id];if(i==null){if(t)throw new RangeError("Field is not present in this state");return}return Us(this,i),lc(this,i)}update(...e){return tb(this,e,!0)}applyTransaction(e){let t=this.config,{base:i,compartments:r}=t;for(let o of e.effects)o.is(sc.reconfigure)?(t&&(r=new Map,t.compartments.forEach((l,a)=>r.set(a,l)),t=null),r.set(o.value.compartment,o.value.extension)):o.is(_i.reconfigure)?(t=null,i=o.value):o.is(_i.appendConfig)&&(t=null,i=No(i).concat(o.value));let s;t?s=e.startState.values.slice():(t=oc.resolve(i,r,this),s=new Vt(t,this.doc,this.selection,t.dynamicSlots.map(()=>null),(l,a)=>a.reconfigure(l,this),null).values),new Vt(t,e.newDoc,e.newSelection,s,(o,l)=>l.update(o,e),e)}replaceSelection(e){return typeof e=="string"&&(e=this.toText(e)),this.changeByRange(t=>({changes:{from:t.from,to:t.to,insert:e},range:ut.cursor(t.from+e.length)}))}changeByRange(e){let t=this.selection,i=e(t.ranges[0]),r=this.changes(i.changes),s=[i.range],o=No(i.effects);for(let l=1;l<t.ranges.length;l++){let a=e(t.ranges[l]),h=this.changes(a.changes),c=h.map(r);for(let f=0;f<l;f++)s[f]=s[f].map(c);let u=r.mapDesc(h,!0);s.push(a.range.map(u)),r=r.compose(c),o=_i.mapEffects(o,c).concat(_i.mapEffects(No(a.effects),u))}return{changes:r,selection:ut.create(s,t.mainIndex),effects:o}}changes(e=[]){return e instanceof Ai?e:Ai.of(e,this.doc.length,this.facet(Vt.lineSeparator))}toText(e){return j.of(e.split(this.facet(Vt.lineSeparator)||tp))}sliceDoc(e=0,t=this.doc.length){return this.doc.sliceString(e,t,this.lineBreak)}facet(e){let t=this.config.address[e.id];return t==null?e.default:(Us(this,t),lc(this,t))}toJSON(e){let t={doc:this.sliceDoc(),selection:this.selection.toJSON()};if(e)for(let i in e){let r=e[i];r instanceof Jl&&(t[i]=r.spec.toJSON(this.field(e[i]),this))}return t}static fromJSON(e,t={},i){if(!e||typeof e.doc!="string")throw new RangeError("Invalid JSON representation for EditorState");let r=[];if(i)for(let s in i){let o=i[s],l=e[s];r.push(o.init(a=>o.spec.fromJSON(l,a)))}return Vt.create({doc:e.doc,selection:ut.fromJSON(e.selection),extensions:t.extensions?r.concat([t.extensions]):r})}static create(e={}){let t=oc.resolve(e.extensions||[],new Map),i=e.doc instanceof j?e.doc:j.of((e.doc||"").split(t.staticFacet(Vt.lineSeparator)||tp)),r=e.selection?e.selection instanceof ut?e.selection:ut.single(e.selection.anchor,e.selection.head):ut.single(0);return jw(r,i.length),t.staticFacet(Gw)||(r=r.asSingle()),new Vt(t,i,r,t.dynamicSlots.map(()=>null),(s,o)=>o.create(s),null)}get tabSize(){return this.facet(Vt.tabSize)}get lineBreak(){return this.facet(Vt.lineSeparator)||`
`}get readOnly(){return this.facet(Qw)}phrase(e){for(let t of this.facet(Vt.phrases))if(Object.prototype.hasOwnProperty.call(t,e))return t[e];return e}languageDataAt(e,t,i=-1){let r=[];for(let s of this.facet(Kw))for(let o of s(this,t,i))Object.prototype.hasOwnProperty.call(o,e)&&r.push(o[e]);return r}charCategorizer(e){return IR(this.languageDataAt("wordChars",e).join(""))}wordAt(e){let{text:t,from:i,length:r}=this.doc.lineAt(e),s=this.charCategorizer(e),o=e-i,l=e-i;for(;o>0;){let a=lt(t,o,!1);if(s(t.slice(a,o))!=Qr.Word)break;o=a}for(;l<r;){let a=lt(t,l);if(s(t.slice(l,a))!=Qr.Word)break;l=a}return o==l?null:ut.range(o+i,l+i)}}Vt.allowMultipleSelections=Gw,Vt.tabSize=wn.define({combine:n=>n.length?n[0]:4}),Vt.lineSeparator=Jw,Vt.readOnly=Qw,Vt.phrases=wn.define(),Vt.languageData=Kw,Vt.changeFilter=Zw,Vt.transactionFilter=Yw,Vt.transactionExtender=Xw,sc.reconfigure=_i.define();function Bj(n,e,t={}){let i={};for(let r of n)for(let s of Object.keys(r)){let o=r[s],l=i[s];if(l===void 0)i[s]=o;else if(!(l===o||o===void 0))if(Object.hasOwnProperty.call(t,s))i[s]=t[s](l,o);else throw new Error("Config merge conflict for field "+s)}for(let r in e)i[r]===void 0&&(i[r]=e[r]);return i}class qs{eq(e){return this==e}range(e,t=e){return new hp(e,t,this)}}qs.prototype.startSide=qs.prototype.endSide=0,qs.prototype.point=!1,qs.prototype.mapMode=Zr.TrackDel;class hp{constructor(e,t,i){this.from=e,this.to=t,this.value=i}}function cp(n,e){return n.from-e.from||n.value.startSide-e.value.startSide}class up{constructor(e,t,i,r){this.from=e,this.to=t,this.value=i,this.maxPoint=r}get length(){return this.to[this.to.length-1]}findIndex(e,t,i,r=0){let s=i?this.to:this.from;for(let o=r,l=s.length;;){if(o==l)return o;let a=o+l>>1,h=s[a]-e||(i?this.value[a].endSide:this.value[a].startSide)-t;if(a==o)return h>=0?o:l;h>=0?l=a:o=a+1}}between(e,t,i,r){for(let s=this.findIndex(t,-1e9,!0),o=this.findIndex(i,1e9,!1,s);s<o;s++)if(r(this.from[s]+e,this.to[s]+e,this.value[s])===!1)return!1}map(e,t){let i=[],r=[],s=[],o=-1,l=-1;for(let a=0;a<this.value.length;a++){let h=this.value[a],c=this.from[a]+e,u=this.to[a]+e,f,d;if(c==u){let p=t.mapPos(c,h.startSide,h.mapMode);if(p==null||(f=d=p,h.startSide!=h.endSide&&(d=t.mapPos(c,h.endSide),d<f)))continue}else if(f=t.mapPos(c,h.startSide),d=t.mapPos(u,h.endSide),f>d||f==d&&h.startSide>0&&h.endSide<=0)continue;(d-f||h.endSide-h.startSide)<0||(o<0&&(o=f),h.point&&(l=Math.max(l,d-f)),i.push(h),r.push(f-o),s.push(d-o))}return{mapped:i.length?new up(r,s,i,l):null,pos:o}}}class Te{constructor(e,t,i=Te.empty,r){this.chunkPos=e,this.chunk=t,this.nextLayer=i,this.maxPoint=r}get length(){let e=this.chunk.length-1;return e<0?0:Math.max(this.chunkEnd(e),this.nextLayer.length)}get size(){if(this.isEmpty)return 0;let e=this.nextLayer.size;for(let t of this.chunk)e+=t.value.length;return e}chunkEnd(e){return this.chunkPos[e]+this.chunk[e].length}update(e){let{add:t=[],sort:i=!1,filterFrom:r=0,filterTo:s=this.length}=e,o=e.filter;if(t.length==0&&!o)return this;if(i&&(t=t.slice().sort(cp)),this.isEmpty)return t.length?Te.of(t):this;let l=new nb(this,null,-1).goto(0),a=0,h=[],c=new Yl;for(;l.value||a<t.length;)if(a<t.length&&(l.from-t[a].from||l.startSide-t[a].value.startSide)>=0){let u=t[a++];c.addInner(u.from,u.to,u.value)||h.push(u)}else l.rangeIndex==1&&l.chunkIndex<this.chunk.length&&(a==t.length||this.chunkEnd(l.chunkIndex)<t[a].from)&&(!o||r>this.chunkEnd(l.chunkIndex)||s<this.chunkPos[l.chunkIndex])&&c.addChunk(this.chunkPos[l.chunkIndex],this.chunk[l.chunkIndex])?l.nextChunk():((!o||r>l.to||s<l.from||o(l.from,l.to,l.value))&&(c.addInner(l.from,l.to,l.value)||h.push(new hp(l.from,l.to,l.value))),l.next());return c.finishInner(this.nextLayer.isEmpty&&!h.length?Te.empty:this.nextLayer.update({add:h,filter:o,filterFrom:r,filterTo:s}))}map(e){if(e.empty||this.isEmpty)return this;let t=[],i=[],r=-1;for(let o=0;o<this.chunk.length;o++){let l=this.chunkPos[o],a=this.chunk[o],h=e.touchesRange(l,l+a.length);if(h===!1)r=Math.max(r,a.maxPoint),t.push(a),i.push(e.mapPos(l));else if(h===!0){let{mapped:c,pos:u}=a.map(l,e);c&&(r=Math.max(r,c.maxPoint),t.push(c),i.push(u))}}let s=this.nextLayer.map(e);return t.length==0?s:new Te(i,t,s,r)}between(e,t,i){if(!this.isEmpty){for(let r=0;r<this.chunk.length;r++){let s=this.chunkPos[r],o=this.chunk[r];if(t>=s&&e<=s+o.length&&o.between(s,e-s,t-s,i)===!1)return}this.nextLayer.between(e,t,i)}}iter(e=0){return Xl.from([this]).goto(e)}get isEmpty(){return this.nextLayer==this}static iter(e,t=0){return Xl.from(e).goto(t)}static compare(e,t,i,r,s=-1){let o=e.filter(u=>u.maxPoint>0||!u.isEmpty&&u.maxPoint>=s),l=t.filter(u=>u.maxPoint>0||!u.isEmpty&&u.maxPoint>=s),a=ib(o,l,i),h=new Ql(o,a,s),c=new Ql(l,a,s);i.iterGaps((u,f,d)=>rb(h,u,c,f,d,r)),i.empty&&i.length==0&&rb(h,0,c,0,0,r)}static eq(e,t,i=0,r){r==null&&(r=1e9);let s=e.filter(c=>!c.isEmpty&&t.indexOf(c)<0),o=t.filter(c=>!c.isEmpty&&e.indexOf(c)<0);if(s.length!=o.length)return!1;if(!s.length)return!0;let l=ib(s,o),a=new Ql(s,l,0).goto(i),h=new Ql(o,l,0).goto(i);for(;;){if(a.to!=h.to||!dp(a.active,h.active)||a.point&&(!h.point||!a.point.eq(h.point)))return!1;if(a.to>r)return!0;a.next(),h.next()}}static spans(e,t,i,r,s=-1){var o;let l=new Ql(e,null,s,(o=r.filterPoint)===null||o===void 0?void 0:o.bind(r)).goto(t),a=t,h=l.openStart;for(;;){let c=Math.min(l.to,i);if(l.point?(r.point(a,c,l.point,l.activeForPoint(l.to),h),h=l.openEnd(c)+(l.to>c?1:0)):c>a&&(r.span(a,c,l.active,h),h=l.openEnd(c)),l.to>i)break;a=l.to,l.next()}return h}static of(e,t=!1){let i=new Yl;for(let r of e instanceof hp?[e]:t?WR(e):e)i.add(r.from,r.to,r.value);return i.finish()}}Te.empty=new Te([],[],null,-1);function WR(n){if(n.length>1)for(let e=n[0],t=1;t<n.length;t++){let i=n[t];if(cp(e,i)>0)return n.slice().sort(cp);e=i}return n}Te.empty.nextLayer=Te.empty;class Yl{constructor(){this.chunks=[],this.chunkPos=[],this.chunkStart=-1,this.last=null,this.lastFrom=-1e9,this.lastTo=-1e9,this.from=[],this.to=[],this.value=[],this.maxPoint=-1,this.setMaxPoint=-1,this.nextLayer=null}finishChunk(e){this.chunks.push(new up(this.from,this.to,this.value,this.maxPoint)),this.chunkPos.push(this.chunkStart),this.chunkStart=-1,this.setMaxPoint=Math.max(this.setMaxPoint,this.maxPoint),this.maxPoint=-1,e&&(this.from=[],this.to=[],this.value=[])}add(e,t,i){this.addInner(e,t,i)||(this.nextLayer||(this.nextLayer=new Yl)).add(e,t,i)}addInner(e,t,i){let r=e-this.lastTo||i.startSide-this.last.endSide;if(r<=0&&(e-this.lastFrom||i.startSide-this.last.startSide)<0)throw new Error("Ranges must be added sorted by `from` position and `startSide`");return r<0?!1:(this.from.length==250&&this.finishChunk(!0),this.chunkStart<0&&(this.chunkStart=e),this.from.push(e-this.chunkStart),this.to.push(t-this.chunkStart),this.last=i,this.lastFrom=e,this.lastTo=t,this.value.push(i),i.point&&(this.maxPoint=Math.max(this.maxPoint,t-e)),!0)}addChunk(e,t){if((e-this.lastTo||t.value[0].startSide-this.last.endSide)<0)return!1;this.from.length&&this.finishChunk(!0),this.setMaxPoint=Math.max(this.setMaxPoint,t.maxPoint),this.chunks.push(t),this.chunkPos.push(e);let i=t.value.length-1;return this.last=t.value[i],this.lastFrom=t.from[i]+e,this.lastTo=t.to[i]+e,!0}finish(){return this.finishInner(Te.empty)}finishInner(e){if(this.from.length&&this.finishChunk(!1),this.chunks.length==0)return e;let t=new Te(this.chunkPos,this.chunks,this.nextLayer?this.nextLayer.finishInner(e):e,this.setMaxPoint);return this.from=null,t}}function ib(n,e,t){let i=new Map;for(let s of n)for(let o=0;o<s.chunk.length;o++)s.chunk[o].maxPoint<=0&&i.set(s.chunk[o],s.chunkPos[o]);let r=new Set;for(let s of e)for(let o=0;o<s.chunk.length;o++){let l=i.get(s.chunk[o]);l!=null&&(t?t.mapPos(l):l)==s.chunkPos[o]&&!(t!=null&&t.touchesRange(l,l+s.chunk[o].length))&&r.add(s.chunk[o])}return r}class nb{constructor(e,t,i,r=0){this.layer=e,this.skip=t,this.minPoint=i,this.rank=r}get startSide(){return this.value?this.value.startSide:0}get endSide(){return this.value?this.value.endSide:0}goto(e,t=-1e9){return this.chunkIndex=this.rangeIndex=0,this.gotoInner(e,t,!1),this}gotoInner(e,t,i){for(;this.chunkIndex<this.layer.chunk.length;){let r=this.layer.chunk[this.chunkIndex];if(!(this.skip&&this.skip.has(r)||this.layer.chunkEnd(this.chunkIndex)<e||r.maxPoint<this.minPoint))break;this.chunkIndex++,i=!1}if(this.chunkIndex<this.layer.chunk.length){let r=this.layer.chunk[this.chunkIndex].findIndex(e-this.layer.chunkPos[this.chunkIndex],t,!0);(!i||this.rangeIndex<r)&&this.setRangeIndex(r)}this.next()}forward(e,t){(this.to-e||this.endSide-t)<0&&this.gotoInner(e,t,!0)}next(){for(;;)if(this.chunkIndex==this.layer.chunk.length){this.from=this.to=1e9,this.value=null;break}else{let e=this.layer.chunkPos[this.chunkIndex],t=this.layer.chunk[this.chunkIndex],i=e+t.from[this.rangeIndex];if(this.from=i,this.to=e+t.to[this.rangeIndex],this.value=t.value[this.rangeIndex],this.setRangeIndex(this.rangeIndex+1),this.minPoint<0||this.value.point&&this.to-this.from>=this.minPoint)break}}setRangeIndex(e){if(e==this.layer.chunk[this.chunkIndex].value.length){if(this.chunkIndex++,this.skip)for(;this.chunkIndex<this.layer.chunk.length&&this.skip.has(this.layer.chunk[this.chunkIndex]);)this.chunkIndex++;this.rangeIndex=0}else this.rangeIndex=e}nextChunk(){this.chunkIndex++,this.rangeIndex=0,this.next()}compare(e){return this.from-e.from||this.startSide-e.startSide||this.rank-e.rank||this.to-e.to||this.endSide-e.endSide}}class Xl{constructor(e){this.heap=e}static from(e,t=null,i=-1){let r=[];for(let s=0;s<e.length;s++)for(let o=e[s];!o.isEmpty;o=o.nextLayer)o.maxPoint>=i&&r.push(new nb(o,t,i,s));return r.length==1?r[0]:new Xl(r)}get startSide(){return this.value?this.value.startSide:0}goto(e,t=-1e9){for(let i of this.heap)i.goto(e,t);for(let i=this.heap.length>>1;i>=0;i--)fp(this.heap,i);return this.next(),this}forward(e,t){for(let i of this.heap)i.forward(e,t);for(let i=this.heap.length>>1;i>=0;i--)fp(this.heap,i);(this.to-e||this.value.endSide-t)<0&&this.next()}next(){if(this.heap.length==0)this.from=this.to=1e9,this.value=null,this.rank=-1;else{let e=this.heap[0];this.from=e.from,this.to=e.to,this.value=e.value,this.rank=e.rank,e.value&&e.next(),fp(this.heap,0)}}}function fp(n,e){for(let t=n[e];;){let i=(e<<1)+1;if(i>=n.length)break;let r=n[i];if(i+1<n.length&&r.compare(n[i+1])>=0&&(r=n[i+1],i++),t.compare(r)<0)break;n[i]=t,n[e]=r,e=i}}class Ql{constructor(e,t,i,r=()=>!0){this.minPoint=i,this.filterPoint=r,this.active=[],this.activeTo=[],this.activeRank=[],this.minActive=-1,this.point=null,this.pointFrom=0,this.pointRank=0,this.to=-1e9,this.endSide=0,this.openStart=-1,this.cursor=Xl.from(e,t,i)}goto(e,t=-1e9){return this.cursor.goto(e,t),this.active.length=this.activeTo.length=this.activeRank.length=0,this.minActive=-1,this.to=e,this.endSide=t,this.openStart=-1,this.next(),this}forward(e,t){for(;this.minActive>-1&&(this.activeTo[this.minActive]-e||this.active[this.minActive].endSide-t)<0;)this.removeActive(this.minActive);this.cursor.forward(e,t)}removeActive(e){ac(this.active,e),ac(this.activeTo,e),ac(this.activeRank,e),this.minActive=sb(this.active,this.activeTo)}addActive(e){let t=0,{value:i,to:r,rank:s}=this.cursor;for(;t<this.activeRank.length&&this.activeRank[t]<=s;)t++;hc(this.active,t,i),hc(this.activeTo,t,r),hc(this.activeRank,t,s),e&&hc(e,t,this.cursor.from),this.minActive=sb(this.active,this.activeTo)}next(){let e=this.to,t=this.point;this.point=null;let i=this.openStart<0?[]:null,r=0;for(;;){let s=this.minActive;if(s>-1&&(this.activeTo[s]-this.cursor.from||this.active[s].endSide-this.cursor.startSide)<0){if(this.activeTo[s]>e){this.to=this.activeTo[s],this.endSide=this.active[s].endSide;break}this.removeActive(s),i&&ac(i,s)}else if(this.cursor.value)if(this.cursor.from>e){this.to=this.cursor.from,this.endSide=this.cursor.startSide;break}else{let o=this.cursor.value;if(!o.point)this.addActive(i),this.cursor.next();else if(t&&this.cursor.to==this.to&&this.cursor.from<this.cursor.to)this.cursor.next();else if(!this.filterPoint(this.cursor.from,this.cursor.to,this.cursor.value,this.cursor.rank))this.cursor.next();else{this.point=o,this.pointFrom=this.cursor.from,this.pointRank=this.cursor.rank,this.to=this.cursor.to,this.endSide=o.endSide,this.cursor.from<e&&(r=1),this.cursor.next(),this.forward(this.to,this.endSide);break}}else{this.to=this.endSide=1e9;break}}if(i){let s=0;for(;s<i.length&&i[s]<e;)s++;this.openStart=s+r}}activeForPoint(e){if(!this.active.length)return this.active;let t=[];for(let i=this.active.length-1;i>=0&&!(this.activeRank[i]<this.pointRank);i--)(this.activeTo[i]>e||this.activeTo[i]==e&&this.active[i].endSide>=this.point.endSide)&&t.push(this.active[i]);return t.reverse()}openEnd(e){let t=0;for(let i=this.activeTo.length-1;i>=0&&this.activeTo[i]>e;i--)t++;return t}}function rb(n,e,t,i,r,s){n.goto(e),t.goto(i);let o=i+r,l=i,a=i-e;for(;;){let h=n.to+a-t.to||n.endSide-t.endSide,c=h<0?n.to+a:t.to,u=Math.min(c,o);if(n.point||t.point?n.point&&t.point&&(n.point==t.point||n.point.eq(t.point))&&dp(n.activeForPoint(n.to+a),t.activeForPoint(t.to))||s.comparePoint(l,u,n.point,t.point):u>l&&!dp(n.active,t.active)&&s.compareRange(l,u,n.active,t.active),c>o)break;l=c,h<=0&&n.next(),h>=0&&t.next()}}function dp(n,e){if(n.length!=e.length)return!1;for(let t=0;t<n.length;t++)if(n[t]!=e[t]&&!n[t].eq(e[t]))return!1;return!0}function ac(n,e){for(let t=e,i=n.length-1;t<i;t++)n[t]=n[t+1];n.pop()}function hc(n,e,t){for(let i=n.length-1;i>=e;i--)n[i+1]=n[i];n[e]=t}function sb(n,e){let t=-1,i=1e9;for(let r=0;r<e.length;r++)(e[r]-i||n[r].endSide-n[t].endSide)<0&&(t=r,i=e[r]);return t}for(var Bn={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",229:"q"},cc={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"',229:"Q"},ob=typeof navigator!="undefined"&&/Chrome\/(\d+)/.exec(navigator.userAgent),VR=typeof navigator!="undefined"&&/Apple Computer/.test(navigator.vendor),HR=typeof navigator!="undefined"&&/Gecko\/\d+/.test(navigator.userAgent),lb=typeof navigator!="undefined"&&/Mac/.test(navigator.platform),zR=typeof navigator!="undefined"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent),jR=ob&&(lb||+ob[1]<57)||HR&&lb,oi=0;oi<10;oi++)Bn[48+oi]=Bn[96+oi]=String(oi);for(var oi=1;oi<=24;oi++)Bn[oi+111]="F"+oi;for(var oi=65;oi<=90;oi++)Bn[oi]=String.fromCharCode(oi+32),cc[oi]=String.fromCharCode(oi);for(var pp in Bn)cc.hasOwnProperty(pp)||(cc[pp]=Bn[pp]);function uc(n){var e=jR&&(n.ctrlKey||n.altKey||n.metaKey)||(VR||zR)&&n.shiftKey&&n.key&&n.key.length==1,t=!e&&n.key||(n.shiftKey?cc:Bn)[n.keyCode]||n.key||"Unidentified";return t=="Esc"&&(t="Escape"),t=="Del"&&(t="Delete"),t=="Left"&&(t="ArrowLeft"),t=="Up"&&(t="ArrowUp"),t=="Right"&&(t="ArrowRight"),t=="Down"&&(t="ArrowDown"),t}function fc(n){let e;return n.nodeType==11?e=n.getSelection?n:n.ownerDocument:e=n,e.getSelection()}function Io(n,e){return e?n==e||n.contains(e.nodeType!=1?e.parentNode:e):!1}function $R(){let n=document.activeElement;for(;n&&n.shadowRoot;)n=n.shadowRoot.activeElement;return n}function mp(n,e){if(!e.anchorNode)return!1;try{return Io(n,e.anchorNode)}catch{return!1}}function ea(n){return n.nodeType==3?ta(n,0,n.nodeValue.length).getClientRects():n.nodeType==1?n.getClientRects():[]}function dc(n,e,t,i){return t?ab(n,e,t,i,-1)||ab(n,e,t,i,1):!1}function gp(n){for(var e=0;;e++)if(n=n.previousSibling,!n)return e}function ab(n,e,t,i,r){for(;;){if(n==t&&e==i)return!0;if(e==(r<0?0:pc(n))){if(n.nodeName=="DIV")return!1;let s=n.parentNode;if(!s||s.nodeType!=1)return!1;e=gp(n)+(r<0?0:1),n=s}else if(n.nodeType==1){if(n=n.childNodes[e+(r<0?-1:0)],n.nodeType==1&&n.contentEditable=="false")return!1;e=r<0?pc(n):0}else return!1}}function pc(n){return n.nodeType==3?n.nodeValue.length:n.childNodes.length}const hb={left:0,right:0,top:0,bottom:0};function mc(n,e){let t=e?n.left:n.right;return{left:t,right:t,top:n.top,bottom:n.bottom}}function UR(n){return{left:0,right:n.innerWidth,top:0,bottom:n.innerHeight}}function qR(n,e,t,i,r,s,o,l){let a=n.ownerDocument,h=a.defaultView;for(let c=n;c;)if(c.nodeType==1){let u,f=c==a.body;if(f)u=UR(h);else{if(c.scrollHeight<=c.clientHeight&&c.scrollWidth<=c.clientWidth){c=c.parentNode;continue}let g=c.getBoundingClientRect();u={left:g.left,right:g.left+c.clientWidth,top:g.top,bottom:g.top+c.clientHeight}}let d=0,p=0;if(r=="nearest")e.top<u.top?(p=-(u.top-e.top+o),t>0&&e.bottom>u.bottom+p&&(p=e.bottom-u.bottom+p+o)):e.bottom>u.bottom&&(p=e.bottom-u.bottom+o,t<0&&e.top-p<u.top&&(p=-(u.top+p-e.top+o)));else{let g=e.bottom-e.top,y=u.bottom-u.top;p=(r=="center"&&g<=y?e.top+g/2-y/2:r=="start"||r=="center"&&t<0?e.top-o:e.bottom-y+o)-u.top}if(i=="nearest"?e.left<u.left?(d=-(u.left-e.left+s),t>0&&e.right>u.right+d&&(d=e.right-u.right+d+s)):e.right>u.right&&(d=e.right-u.right+s,t<0&&e.left<u.left+d&&(d=-(u.left+d-e.left+s))):d=(i=="center"?e.left+(e.right-e.left)/2-(u.right-u.left)/2:i=="start"==l?e.left-s:e.right-(u.right-u.left)+s)-u.left,d||p)if(f)h.scrollBy(d,p);else{if(p){let g=c.scrollTop;c.scrollTop+=p,p=c.scrollTop-g}if(d){let g=c.scrollLeft;c.scrollLeft+=d,d=c.scrollLeft-g}e={left:e.left-d,top:e.top-p,right:e.right-d,bottom:e.bottom-p}}if(f)break;c=c.assignedSlot||c.parentNode,i=r="nearest"}else if(c.nodeType==11)c=c.host;else break}class KR{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}eq(e){return this.anchorNode==e.anchorNode&&this.anchorOffset==e.anchorOffset&&this.focusNode==e.focusNode&&this.focusOffset==e.focusOffset}setRange(e){this.set(e.anchorNode,e.anchorOffset,e.focusNode,e.focusOffset)}set(e,t,i,r){this.anchorNode=e,this.anchorOffset=t,this.focusNode=i,this.focusOffset=r}}let Wo=null;function cb(n){if(n.setActive)return n.setActive();if(Wo)return n.focus(Wo);let e=[];for(let t=n;t&&(e.push(t,t.scrollTop,t.scrollLeft),t!=t.ownerDocument);t=t.parentNode);if(n.focus(Wo==null?{get preventScroll(){return Wo={preventScroll:!0},!0}}:void 0),!Wo){Wo=!1;for(let t=0;t<e.length;){let i=e[t++],r=e[t++],s=e[t++];i.scrollTop!=r&&(i.scrollTop=r),i.scrollLeft!=s&&(i.scrollLeft=s)}}}let ub;function ta(n,e,t=e){let i=ub||(ub=document.createRange());return i.setEnd(n,t),i.setStart(n,e),i}function ia(n,e,t){let i={key:e,code:e,keyCode:t,which:t,cancelable:!0},r=new KeyboardEvent("keydown",i);r.synthetic=!0,n.dispatchEvent(r);let s=new KeyboardEvent("keyup",i);return s.synthetic=!0,n.dispatchEvent(s),r.defaultPrevented||s.defaultPrevented}function GR(n){for(;n;){if(n&&(n.nodeType==9||n.nodeType==11&&n.host))return n;n=n.assignedSlot||n.parentNode}return null}function fb(n){for(;n.attributes.length;)n.removeAttributeNode(n.attributes[0])}class li{constructor(e,t,i=!0){this.node=e,this.offset=t,this.precise=i}static before(e,t){return new li(e.parentNode,gp(e),t)}static after(e,t){return new li(e.parentNode,gp(e)+1,t)}}const yp=[];class _t{constructor(){this.parent=null,this.dom=null,this.dirty=2}get editorView(){if(!this.parent)throw new Error("Accessing view in orphan content view");return this.parent.editorView}get overrideDOMText(){return null}get posAtStart(){return this.parent?this.parent.posBefore(this):0}get posAtEnd(){return this.posAtStart+this.length}posBefore(e){let t=this.posAtStart;for(let i of this.children){if(i==e)return t;t+=i.length+i.breakAfter}throw new RangeError("Invalid child in posBefore")}posAfter(e){return this.posBefore(e)+e.length}coordsAt(e,t){return null}sync(e){if(this.dirty&2){let t=this.dom,i=null,r;for(let s of this.children){if(s.dirty){if(!s.dom&&(r=i?i.nextSibling:t.firstChild)){let o=_t.get(r);(!o||!o.parent&&o.constructor==s.constructor)&&s.reuseDOM(r)}s.sync(e),s.dirty=0}if(r=i?i.nextSibling:t.firstChild,e&&!e.written&&e.node==t&&r!=s.dom&&(e.written=!0),s.dom.parentNode==t)for(;r&&r!=s.dom;)r=db(r);else t.insertBefore(s.dom,r);i=s.dom}for(r=i?i.nextSibling:t.firstChild,r&&e&&e.node==t&&(e.written=!0);r;)r=db(r)}else if(this.dirty&1)for(let t of this.children)t.dirty&&(t.sync(e),t.dirty=0)}reuseDOM(e){}localPosFromDOM(e,t){let i;if(e==this.dom)i=this.dom.childNodes[t];else{let r=pc(e)==0?0:t==0?-1:1;for(;;){let s=e.parentNode;if(s==this.dom)break;r==0&&s.firstChild!=s.lastChild&&(e==s.firstChild?r=-1:r=1),e=s}r<0?i=e:i=e.nextSibling}if(i==this.dom.firstChild)return 0;for(;i&&!_t.get(i);)i=i.nextSibling;if(!i)return this.length;for(let r=0,s=0;;r++){let o=this.children[r];if(o.dom==i)return s;s+=o.length+o.breakAfter}}domBoundsAround(e,t,i=0){let r=-1,s=-1,o=-1,l=-1;for(let a=0,h=i,c=i;a<this.children.length;a++){let u=this.children[a],f=h+u.length;if(h<e&&f>t)return u.domBoundsAround(e,t,h);if(f>=e&&r==-1&&(r=a,s=h),h>t&&u.dom.parentNode==this.dom){o=a,l=c;break}c=f,h=f+u.breakAfter}return{from:s,to:l<0?i+this.length:l,startDOM:(r?this.children[r-1].dom.nextSibling:null)||this.dom.firstChild,endDOM:o<this.children.length&&o>=0?this.children[o].dom:null}}markDirty(e=!1){this.dirty|=2,this.markParentsDirty(e)}markParentsDirty(e){for(let t=this.parent;t;t=t.parent){if(e&&(t.dirty|=2),t.dirty&1)return;t.dirty|=1,e=!1}}setParent(e){this.parent!=e&&(this.parent=e,this.dirty&&this.markParentsDirty(!0))}setDOM(e){this.dom&&(this.dom.cmView=null),this.dom=e,e.cmView=this}get rootView(){for(let e=this;;){let t=e.parent;if(!t)return e;e=t}}replaceChildren(e,t,i=yp){this.markDirty();for(let r=e;r<t;r++){let s=this.children[r];s.parent==this&&s.destroy()}this.children.splice(e,t-e,...i);for(let r=0;r<i.length;r++)i[r].setParent(this)}ignoreMutation(e){return!1}ignoreEvent(e){return!1}childCursor(e=this.length){return new pb(this.children,e,this.children.length)}childPos(e,t=1){return this.childCursor().findPos(e,t)}toString(){let e=this.constructor.name.replace("View","");return e+(this.children.length?"("+this.children.join()+")":this.length?"["+(e=="Text"?this.text:this.length)+"]":"")+(this.breakAfter?"#":"")}static get(e){return e.cmView}get isEditable(){return!0}merge(e,t,i,r,s,o){return!1}become(e){return!1}getSide(){return 0}destroy(){this.parent=null}}_t.prototype.breakAfter=0;function db(n){let e=n.nextSibling;return n.parentNode.removeChild(n),e}class pb{constructor(e,t,i){this.children=e,this.pos=t,this.i=i,this.off=0}findPos(e,t=1){for(;;){if(e>this.pos||e==this.pos&&(t>0||this.i==0||this.children[this.i-1].breakAfter))return this.off=e-this.pos,this;let i=this.children[--this.i];this.pos-=i.length+i.breakAfter}}}function mb(n,e,t,i,r,s,o,l,a){let{children:h}=n,c=h.length?h[e]:null,u=s.length?s[s.length-1]:null,f=u?u.breakAfter:o;if(!(e==i&&c&&!o&&!f&&s.length<2&&c.merge(t,r,s.length?u:null,t==0,l,a))){if(i<h.length){let d=h[i];d&&r<d.length?(e==i&&(d=d.split(r),r=0),!f&&u&&d.merge(0,r,u,!0,0,a)?s[s.length-1]=d:(r&&d.merge(0,r,null,!1,0,a),s.push(d))):d!=null&&d.breakAfter&&(u?u.breakAfter=1:o=1),i++}for(c&&(c.breakAfter=o,t>0&&(!o&&s.length&&c.merge(t,c.length,s[0],!1,l,0)?c.breakAfter=s.shift().breakAfter:(t<c.length||c.children.length&&c.children[c.children.length-1].length==0)&&c.merge(t,c.length,null,!1,l,0),e++));e<i&&s.length;)if(h[i-1].become(s[s.length-1]))i--,s.pop(),a=s.length?0:l;else if(h[e].become(s[0]))e++,s.shift(),l=s.length?0:a;else break;!s.length&&e&&i<h.length&&!h[e-1].breakAfter&&h[i].merge(0,0,h[e-1],!1,l,a)&&e--,(e<i||s.length)&&n.replaceChildren(e,i,s)}}function gb(n,e,t,i,r,s){let o=n.childCursor(),{i:l,off:a}=o.findPos(t,1),{i:h,off:c}=o.findPos(e,-1),u=e-t;for(let f of i)u+=f.length;n.length+=u,mb(n,h,c,l,a,i,0,r,s)}let tn=typeof navigator!="undefined"?navigator:{userAgent:"",vendor:"",platform:""},vp=typeof document!="undefined"?document:{documentElement:{style:{}}};const wp=/Edge\/(\d+)/.exec(tn.userAgent),yb=/MSIE \d/.test(tn.userAgent),bp=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(tn.userAgent),gc=!!(yb||bp||wp),vb=!gc&&/gecko\/(\d+)/i.test(tn.userAgent),xp=!gc&&/Chrome\/(\d+)/.exec(tn.userAgent),wb="webkitFontSmoothing"in vp.documentElement.style,bb=!gc&&/Apple Computer/.test(tn.vendor),xb=bb&&(/Mobile\/\w+/.test(tn.userAgent)||tn.maxTouchPoints>2);var pe={mac:xb||/Mac/.test(tn.platform),windows:/Win/.test(tn.platform),linux:/Linux|X11/.test(tn.platform),ie:gc,ie_version:yb?vp.documentMode||6:bp?+bp[1]:wp?+wp[1]:0,gecko:vb,gecko_version:vb?+(/Firefox\/(\d+)/.exec(tn.userAgent)||[0,0])[1]:0,chrome:!!xp,chrome_version:xp?+xp[1]:0,ios:xb,android:/Android\b/.test(tn.userAgent),webkit:wb,safari:bb,webkit_version:wb?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0,tabSize:vp.documentElement.style.tabSize!=null?"tab-size":"-moz-tab-size"};const JR=256;class es extends _t{constructor(e){super(),this.text=e}get length(){return this.text.length}createDOM(e){this.setDOM(e||document.createTextNode(this.text))}sync(e){this.dom||this.createDOM(),this.dom.nodeValue!=this.text&&(e&&e.node==this.dom&&(e.written=!0),this.dom.nodeValue=this.text)}reuseDOM(e){e.nodeType==3&&this.createDOM(e)}merge(e,t,i){return i&&(!(i instanceof es)||this.length-(t-e)+i.length>JR)?!1:(this.text=this.text.slice(0,e)+(i?i.text:"")+this.text.slice(t),this.markDirty(),!0)}split(e){let t=new es(this.text.slice(e));return this.text=this.text.slice(0,e),this.markDirty(),t}localPosFromDOM(e,t){return e==this.dom?t:t?this.text.length:0}domAtPos(e){return new li(this.dom,e)}domBoundsAround(e,t,i){return{from:i,to:i+this.length,startDOM:this.dom,endDOM:this.dom.nextSibling}}coordsAt(e,t){return Sp(this.dom,e,t)}}class Vn extends _t{constructor(e,t=[],i=0){super(),this.mark=e,this.children=t,this.length=i;for(let r of t)r.setParent(this)}setAttrs(e){if(fb(e),this.mark.class&&(e.className=this.mark.class),this.mark.attrs)for(let t in this.mark.attrs)e.setAttribute(t,this.mark.attrs[t]);return e}reuseDOM(e){e.nodeName==this.mark.tagName.toUpperCase()&&(this.setDOM(e),this.dirty|=6)}sync(e){this.dom?this.dirty&4&&this.setAttrs(this.dom):this.setDOM(this.setAttrs(document.createElement(this.mark.tagName))),super.sync(e)}merge(e,t,i,r,s,o){return i&&(!(i instanceof Vn&&i.mark.eq(this.mark))||e&&s<=0||t<this.length&&o<=0)?!1:(gb(this,e,t,i?i.children:[],s-1,o-1),this.markDirty(),!0)}split(e){let t=[],i=0,r=-1,s=0;for(let l of this.children){let a=i+l.length;a>e&&t.push(i<e?l.split(e-i):l),r<0&&i>=e&&(r=s),i=a,s++}let o=this.length-e;return this.length=e,r>-1&&(this.children.length=r,this.markDirty()),new Vn(this.mark,t,o)}domAtPos(e){return Cb(this.dom,this.children,e)}coordsAt(e,t){return Ob(this,e,t)}}function Sp(n,e,t){let i=n.nodeValue.length;e>i&&(e=i);let r=e,s=e,o=0;e==0&&t<0||e==i&&t>=0?pe.chrome||pe.gecko||(e?(r--,o=1):(s++,o=-1)):t<0?r--:s++;let l=ta(n,r,s).getClientRects();if(!l.length)return hb;let a=l[(o?o<0:t>=0)?0:l.length-1];return pe.safari&&!o&&a.width==0&&(a=Array.prototype.find.call(l,h=>h.width)||a),o?mc(a,o<0):a||null}class ts extends _t{constructor(e,t,i){super(),this.widget=e,this.length=t,this.side=i,this.prevWidget=null}static create(e,t,i){return new(e.customView||ts)(e,t,i)}split(e){let t=ts.create(this.widget,this.length-e,this.side);return this.length-=e,t}sync(){(!this.dom||!this.widget.updateDOM(this.dom))&&(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(this.editorView)),this.dom.contentEditable="false")}getSide(){return this.side}merge(e,t,i,r,s,o){return i&&(!(i instanceof ts)||!this.widget.compare(i.widget)||e>0&&s<=0||t<this.length&&o<=0)?!1:(this.length=e+(i?i.length:0)+(this.length-t),!0)}become(e){return e.length==this.length&&e instanceof ts&&e.side==this.side&&this.widget.constructor==e.widget.constructor?(this.widget.eq(e.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=e.widget,!0):!1}ignoreMutation(){return!0}ignoreEvent(e){return this.widget.ignoreEvent(e)}get overrideDOMText(){if(this.length==0)return j.empty;let e=this;for(;e.parent;)e=e.parent;let t=e.editorView,i=t&&t.state.doc,r=this.posAtStart;return i?i.slice(r,r+this.length):j.empty}domAtPos(e){return e==0?li.before(this.dom):li.after(this.dom,e==this.length)}domBoundsAround(){return null}coordsAt(e,t){let i=this.dom.getClientRects(),r=null;if(!i.length)return hb;for(let s=e>0?i.length-1:0;r=i[s],!(e>0?s==0:s==i.length-1||r.top<r.bottom);s+=e>0?-1:1);return e==0&&t>0||e==this.length&&t<=0?r:mc(r,e==0)}get isEditable(){return!1}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class Sb extends ts{domAtPos(e){let{topView:t,text:i}=this.widget;return t?kp(e,0,t,i,(r,s)=>r.domAtPos(s),r=>new li(i,Math.min(r,i.nodeValue.length))):new li(i,Math.min(e,i.nodeValue.length))}sync(){this.setDOM(this.widget.toDOM())}localPosFromDOM(e,t){let{topView:i,text:r}=this.widget;return i?kb(e,t,i,r):Math.min(t,this.length)}ignoreMutation(){return!1}get overrideDOMText(){return null}coordsAt(e,t){let{topView:i,text:r}=this.widget;return i?kp(e,t,i,r,(s,o,l)=>s.coordsAt(o,l),(s,o)=>Sp(r,s,o)):Sp(r,e,t)}destroy(){var e;super.destroy(),(e=this.widget.topView)===null||e===void 0||e.destroy()}get isEditable(){return!0}}function kp(n,e,t,i,r,s){if(t instanceof Vn){for(let o of t.children){let l=Io(o.dom,i),a=l?i.nodeValue.length:o.length;if(n<a||n==a&&o.getSide()<=0)return l?kp(n,e,o,i,r,s):r(o,n,e);n-=a}return r(t,t.length,-1)}else return t.dom==i?s(n,e):r(t,n,e)}function kb(n,e,t,i){if(t instanceof Vn)for(let r of t.children){let s=0,o=Io(r.dom,i);if(Io(r.dom,n))return s+(o?kb(n,e,r,i):r.localPosFromDOM(n,e));s+=o?i.nodeValue.length:r.length}else if(t.dom==i)return Math.min(e,i.nodeValue.length);return t.localPosFromDOM(n,e)}class Vo extends _t{constructor(e){super(),this.side=e}get length(){return 0}merge(){return!1}become(e){return e instanceof Vo&&e.side==this.side}split(){return new Vo(this.side)}sync(){if(!this.dom){let e=document.createElement("img");e.className="cm-widgetBuffer",e.setAttribute("aria-hidden","true"),this.setDOM(e)}}getSide(){return this.side}domAtPos(e){return li.before(this.dom)}localPosFromDOM(){return 0}domBoundsAround(){return null}coordsAt(e){let t=this.dom.getBoundingClientRect(),i=ZR(this,this.side>0?-1:1);return i&&i.top<t.bottom&&i.bottom>t.top?{left:t.left,right:t.right,top:i.top,bottom:i.bottom}:t}get overrideDOMText(){return j.empty}}es.prototype.children=ts.prototype.children=Vo.prototype.children=yp;function ZR(n,e){let t=n.parent,i=t?t.children.indexOf(n):-1;for(;t&&i>=0;)if(e<0?i>0:i<t.children.length){let r=t.children[i+e];if(r instanceof es){let s=r.coordsAt(e<0?r.length:0,e);if(s)return s}i+=e}else if(t instanceof Vn&&t.parent)i=t.parent.children.indexOf(t)+(e<0?0:1),t=t.parent;else{let r=t.dom.lastChild;if(r&&r.nodeName=="BR")return r.getClientRects()[0];break}}function Cb(n,e,t){let i=0;for(let r=0;i<e.length;i++){let s=e[i],o=r+s.length;if(!(o==r&&s.getSide()<=0)){if(t>r&&t<o&&s.dom.parentNode==n)return s.domAtPos(t-r);if(t<=r)break;r=o}}for(;i>0;i--){let r=e[i-1].dom;if(r.parentNode==n)return li.after(r)}return new li(n,0)}function Ab(n,e,t){let i,{children:r}=n;t>0&&e instanceof Vn&&r.length&&(i=r[r.length-1])instanceof Vn&&i.mark.eq(e.mark)?Ab(i,e.children[0],t-1):(r.push(e),e.setParent(n)),n.length+=e.length}function Ob(n,e,t){for(let s=0,o=0;o<n.children.length;o++){let l=n.children[o],a=s+l.length,h;if((t<=0||a==n.length||l.getSide()>0?a>=e:a>e)&&(e<a||o+1==n.children.length||(h=n.children[o+1]).length||h.getSide()>0)){let c=0;if(a==s){if(l.getSide()<=0)continue;c=t=-l.getSide()}let u=l.coordsAt(Math.max(0,e-s),t);return c&&u?mc(u,t<0):u}s=a}let i=n.dom.lastChild;if(!i)return n.dom.getBoundingClientRect();let r=ea(i);return r[r.length-1]||null}function Cp(n,e){for(let t in n)t=="class"&&e.class?e.class+=" "+n.class:t=="style"&&e.style?e.style+=";"+n.style:e[t]=n[t];return e}function Ap(n,e){if(n==e)return!0;if(!n||!e)return!1;let t=Object.keys(n),i=Object.keys(e);if(t.length!=i.length)return!1;for(let r of t)if(i.indexOf(r)==-1||n[r]!==e[r])return!1;return!0}function Op(n,e,t){if(e)for(let i in e)t&&i in t||n.removeAttribute(i);if(t)for(let i in t)e&&e[i]==t[i]||n.setAttribute(i,t[i])}class yc{eq(e){return!1}updateDOM(e){return!1}compare(e){return this==e||this.constructor==e.constructor&&this.eq(e)}get estimatedHeight(){return-1}ignoreEvent(e){return!0}get customView(){return null}destroy(e){}}var ft=function(n){return n[n.Text=0]="Text",n[n.WidgetBefore=1]="WidgetBefore",n[n.WidgetAfter=2]="WidgetAfter",n[n.WidgetRange=3]="WidgetRange",n}(ft||(ft={}));class ht extends qs{constructor(e,t,i,r){super(),this.startSide=e,this.endSide=t,this.widget=i,this.spec=r}get heightRelevant(){return!1}static mark(e){return new vc(e)}static widget(e){let t=e.side||0,i=!!e.block;return t+=i?t>0?3e8:-4e8:t>0?1e8:-1e8,new Ks(e,t,t,i,e.widget||null,!1)}static replace(e){let t=!!e.block,i,r;if(e.isBlockGap)i=-5e8,r=4e8;else{let{start:s,end:o}=_b(e,t);i=(s?t?-3e8:-1:5e8)-1,r=(o?t?2e8:1:-6e8)+1}return new Ks(e,i,r,t,e.widget||null,!0)}static line(e){return new na(e)}static set(e,t=!1){return Te.of(e,t)}hasHeight(){return this.widget?this.widget.estimatedHeight>-1:!1}}ht.none=Te.empty;class vc extends ht{constructor(e){let{start:t,end:i}=_b(e);super(t?-1:5e8,i?1:-6e8,null,e),this.tagName=e.tagName||"span",this.class=e.class||"",this.attrs=e.attributes||null}eq(e){return this==e||e instanceof vc&&this.tagName==e.tagName&&this.class==e.class&&Ap(this.attrs,e.attrs)}range(e,t=e){if(e>=t)throw new RangeError("Mark decorations may not be empty");return super.range(e,t)}}vc.prototype.point=!1;class na extends ht{constructor(e){super(-2e8,-2e8,null,e)}eq(e){return e instanceof na&&Ap(this.spec.attributes,e.spec.attributes)}range(e,t=e){if(t!=e)throw new RangeError("Line decoration ranges must be zero-length");return super.range(e,t)}}na.prototype.mapMode=Pn.TrackBefore,na.prototype.point=!0;class Ks extends ht{constructor(e,t,i,r,s,o){super(t,i,s,e),this.block=r,this.isReplace=o,this.mapMode=r?t<=0?Pn.TrackBefore:Pn.TrackAfter:Pn.TrackDel}get type(){return this.startSide<this.endSide?ft.WidgetRange:this.startSide<=0?ft.WidgetBefore:ft.WidgetAfter}get heightRelevant(){return this.block||!!this.widget&&this.widget.estimatedHeight>=5}eq(e){return e instanceof Ks&&YR(this.widget,e.widget)&&this.block==e.block&&this.startSide==e.startSide&&this.endSide==e.endSide}range(e,t=e){if(this.isReplace&&(e>t||e==t&&this.startSide>0&&this.endSide<=0))throw new RangeError("Invalid range for replacement decoration");if(!this.isReplace&&t!=e)throw new RangeError("Widget decorations can only have zero-length ranges");return super.range(e,t)}}Ks.prototype.point=!0;function _b(n,e=!1){let{inclusiveStart:t,inclusiveEnd:i}=n;return t==null&&(t=n.inclusive),i==null&&(i=n.inclusive),{start:t!=null?t:e,end:i!=null?i:e}}function YR(n,e){return n==e||!!(n&&e&&n.compare(e))}function _p(n,e,t,i=0){let r=t.length-1;r>=0&&t[r]+i>=n?t[r]=Math.max(t[r],e):t.push(n,e)}class Di extends _t{constructor(){super(...arguments),this.children=[],this.length=0,this.prevAttrs=void 0,this.attrs=null,this.breakAfter=0}merge(e,t,i,r,s,o){if(i){if(!(i instanceof Di))return!1;this.dom||i.transferDOM(this)}return r&&this.setDeco(i?i.attrs:null),gb(this,e,t,i?i.children:[],s,o),!0}split(e){let t=new Di;if(t.breakAfter=this.breakAfter,this.length==0)return t;let{i,off:r}=this.childPos(e);r&&(t.append(this.children[i].split(r),0),this.children[i].merge(r,this.children[i].length,null,!1,0,0),i++);for(let s=i;s<this.children.length;s++)t.append(this.children[s],0);for(;i>0&&this.children[i-1].length==0;)this.children[--i].destroy();return this.children.length=i,this.markDirty(),this.length=e,t}transferDOM(e){!this.dom||(e.setDOM(this.dom),e.prevAttrs=this.prevAttrs===void 0?this.attrs:this.prevAttrs,this.prevAttrs=void 0,this.dom=null)}setDeco(e){Ap(this.attrs,e)||(this.dom&&(this.prevAttrs=this.attrs,this.markDirty()),this.attrs=e)}append(e,t){Ab(this,e,t)}addLineDeco(e){let t=e.spec.attributes,i=e.spec.class;t&&(this.attrs=Cp(t,this.attrs||{})),i&&(this.attrs=Cp({class:i},this.attrs||{}))}domAtPos(e){return Cb(this.dom,this.children,e)}reuseDOM(e){e.nodeName=="DIV"&&(this.setDOM(e),this.dirty|=6)}sync(e){var t;this.dom?this.dirty&4&&(fb(this.dom),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0):(this.setDOM(document.createElement("div")),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0),this.prevAttrs!==void 0&&(Op(this.dom,this.prevAttrs,this.attrs),this.dom.classList.add("cm-line"),this.prevAttrs=void 0),super.sync(e);let i=this.dom.lastChild;for(;i&&_t.get(i)instanceof Vn;)i=i.lastChild;if(!i||!this.length||i.nodeName!="BR"&&((t=_t.get(i))===null||t===void 0?void 0:t.isEditable)==!1&&(!pe.ios||!this.children.some(r=>r instanceof es))){let r=document.createElement("BR");r.cmIgnore=!0,this.dom.appendChild(r)}}measureTextSize(){if(this.children.length==0||this.length>20)return null;let e=0;for(let t of this.children){if(!(t instanceof es))return null;let i=ea(t.dom);if(i.length!=1)return null;e+=i[0].width}return{lineHeight:this.dom.getBoundingClientRect().height,charWidth:e/this.length}}coordsAt(e,t){return Ob(this,e,t)}become(e){return!1}get type(){return ft.Text}static find(e,t){for(let i=0,r=0;i<e.children.length;i++){let s=e.children[i],o=r+s.length;if(o>=t){if(s instanceof Di)return s;if(o>t)break}r=o+s.breakAfter}return null}}class Gs extends _t{constructor(e,t,i){super(),this.widget=e,this.length=t,this.type=i,this.breakAfter=0,this.prevWidget=null}merge(e,t,i,r,s,o){return i&&(!(i instanceof Gs)||!this.widget.compare(i.widget)||e>0&&s<=0||t<this.length&&o<=0)?!1:(this.length=e+(i?i.length:0)+(this.length-t),!0)}domAtPos(e){return e==0?li.before(this.dom):li.after(this.dom,e==this.length)}split(e){let t=this.length-e;this.length=e;let i=new Gs(this.widget,t,this.type);return i.breakAfter=this.breakAfter,i}get children(){return yp}sync(){(!this.dom||!this.widget.updateDOM(this.dom))&&(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(this.editorView)),this.dom.contentEditable="false")}get overrideDOMText(){return this.parent?this.parent.view.state.doc.slice(this.posAtStart,this.posAtEnd):j.empty}domBoundsAround(){return null}become(e){return e instanceof Gs&&e.type==this.type&&e.widget.constructor==this.widget.constructor?(e.widget.eq(this.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=e.widget,this.length=e.length,this.breakAfter=e.breakAfter,!0):!1}ignoreMutation(){return!0}ignoreEvent(e){return this.widget.ignoreEvent(e)}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class Dp{constructor(e,t,i,r){this.doc=e,this.pos=t,this.end=i,this.disallowBlockEffectsBelow=r,this.content=[],this.curLine=null,this.breakAtStart=0,this.pendingBuffer=0,this.atCursorPos=!0,this.openStart=-1,this.openEnd=-1,this.text="",this.textOff=0,this.cursor=e.iter(),this.skip=t}posCovered(){if(this.content.length==0)return!this.breakAtStart&&this.doc.lineAt(this.pos).from!=this.pos;let e=this.content[this.content.length-1];return!e.breakAfter&&!(e instanceof Gs&&e.type==ft.WidgetBefore)}getLine(){return this.curLine||(this.content.push(this.curLine=new Di),this.atCursorPos=!0),this.curLine}flushBuffer(e){this.pendingBuffer&&(this.curLine.append(wc(new Vo(-1),e),e.length),this.pendingBuffer=0)}addBlockWidget(e){this.flushBuffer([]),this.curLine=null,this.content.push(e)}finish(e){e?this.pendingBuffer=0:this.flushBuffer([]),this.posCovered()||this.getLine()}buildText(e,t,i){for(;e>0;){if(this.textOff==this.text.length){let{value:s,lineBreak:o,done:l}=this.cursor.next(this.skip);if(this.skip=0,l)throw new Error("Ran out of text content when drawing inline views");if(o){this.posCovered()||this.getLine(),this.content.length?this.content[this.content.length-1].breakAfter=1:this.breakAtStart=1,this.flushBuffer([]),this.curLine=null,e--;continue}else this.text=s,this.textOff=0}let r=Math.min(this.text.length-this.textOff,e,512);this.flushBuffer(t.slice(0,i)),this.getLine().append(wc(new es(this.text.slice(this.textOff,this.textOff+r)),t),i),this.atCursorPos=!0,this.textOff+=r,e-=r,i=0}}span(e,t,i,r){this.buildText(t-e,i,r),this.pos=t,this.openStart<0&&(this.openStart=r)}point(e,t,i,r,s){let o=t-e;if(i instanceof Ks)if(i.block){let{type:l}=i;l==ft.WidgetAfter&&!this.posCovered()&&this.getLine(),this.addBlockWidget(new Gs(i.widget||new Db("div"),o,l))}else{let l=ts.create(i.widget||new Db("span"),o,i.startSide),a=this.atCursorPos&&!l.isEditable&&s<=r.length&&(e<t||i.startSide>0),h=!l.isEditable&&(e<t||i.startSide<=0),c=this.getLine();this.pendingBuffer==2&&!a&&(this.pendingBuffer=0),this.flushBuffer(r),a&&(c.append(wc(new Vo(1),r),s),s=r.length+Math.max(0,s-r.length)),c.append(wc(l,r),s),this.atCursorPos=h,this.pendingBuffer=h?e<t?1:2:0}else this.doc.lineAt(this.pos).from==this.pos&&this.getLine().addLineDeco(i);o&&(this.textOff+o<=this.text.length?this.textOff+=o:(this.skip+=o-(this.text.length-this.textOff),this.text="",this.textOff=0),this.pos=t),this.openStart<0&&(this.openStart=s)}filterPoint(e,t,i,r){if(r<this.disallowBlockEffectsBelow&&i instanceof Ks){if(i.block)throw new RangeError("Block decorations may not be specified via plugins");if(t>this.doc.lineAt(this.pos).to)throw new RangeError("Decorations that replace line breaks may not be specified via plugins")}return!0}static build(e,t,i,r,s){let o=new Dp(e,t,i,s);return o.openEnd=Te.spans(r,t,i,o),o.openStart<0&&(o.openStart=o.openEnd),o.finish(o.openEnd),o}}function wc(n,e){for(let t of e)n=new Vn(t,[n],n.length);return n}class Db extends yc{constructor(e){super(),this.tag=e}eq(e){return e.tag==this.tag}toDOM(){return document.createElement(this.tag)}updateDOM(e){return e.nodeName.toLowerCase()==this.tag}}const XR=[],Mb=Ie.define(),Eb=Ie.define(),Tb=Ie.define(),Pb=Ie.define(),Mp=Ie.define(),Bb=Ie.define(),Ep=Wt.define({map:(n,e)=>n.map(e)}),Rb=Wt.define({map:(n,e)=>n.map(e)});class Ho{constructor(e,t="nearest",i="nearest",r=5,s=5){this.range=e,this.y=t,this.x=i,this.yMargin=r,this.xMargin=s}map(e){return e.empty?this:new Ho(this.range.map(e),this.y,this.x,this.yMargin,this.xMargin)}}const Lb=Wt.define({map:(n,e)=>n.map(e)});function Js(n,e,t){let i=n.facet(Pb);i.length?i[0](e):window.onerror?window.onerror(String(e),t,void 0,void 0,e):t?console.error(t+":",e):console.error(e)}const ra=Ie.define({combine:n=>n.length?n[0]:!0});class QR{constructor(e,t){this.field=e,this.get=t}}class Gi{from(e){return new QR(this,e)}static define(){return new Gi}}Gi.decorations=Gi.define(),Gi.atomicRanges=Gi.define(),Gi.scrollMargins=Gi.define();let eL=0;const sa=Ie.define();class Cr{constructor(e,t,i){this.id=e,this.create=t,this.fields=i,this.extension=sa.of(this)}static define(e,t){let{eventHandlers:i,provide:r,decorations:s}=t||{},o=[];if(r)for(let l of Array.isArray(r)?r:[r])o.push(l);return i&&o.push(Fb.from(l=>({plugin:l,handlers:i}))),s&&o.push(Gi.decorations.from(s)),new Cr(eL++,e,o)}static fromClass(e,t){return Cr.define(i=>new e(i),t)}}const Fb=Gi.define();class Tp{constructor(e){this.spec=e,this.mustUpdate=null,this.value=null}takeField(e,t){if(this.spec)for(let{field:i,get:r}of this.spec.fields)i==e&&t.push(r(this.value))}update(e){if(this.value){if(this.mustUpdate){let t=this.mustUpdate;if(this.mustUpdate=null,this.value.update)try{this.value.update(t)}catch(i){if(Js(t.state,i,"CodeMirror plugin crashed"),this.value.destroy)try{this.value.destroy()}catch{}this.deactivate()}}}else if(this.spec)try{this.value=this.spec.create(e)}catch(t){Js(e.state,t,"CodeMirror plugin crashed"),this.deactivate()}return this}destroy(e){var t;if(!((t=this.value)===null||t===void 0)&&t.destroy)try{this.value.destroy()}catch(i){Js(e.state,i,"CodeMirror plugin crashed")}}deactivate(){this.spec=this.value=null}}const Nb=Ie.define(),Pp=Ie.define(),Zs=Ie.define(),oa=Ie.define();class Hn{constructor(e,t,i,r){this.fromA=e,this.toA=t,this.fromB=i,this.toB=r}join(e){return new Hn(Math.min(this.fromA,e.fromA),Math.max(this.toA,e.toA),Math.min(this.fromB,e.fromB),Math.max(this.toB,e.toB))}addToSet(e){let t=e.length,i=this;for(;t>0;t--){let r=e[t-1];if(!(r.fromA>i.toA)){if(r.toA<i.fromA)break;i=i.join(r),e.splice(t-1,1)}}return e.splice(t,0,i),e}static extendWithRanges(e,t){if(t.length==0)return e;let i=[];for(let r=0,s=0,o=0,l=0;;r++){let a=r==e.length?null:e[r],h=o-l,c=a?a.fromB:1e9;for(;s<t.length&&t[s]<c;){let u=t[s],f=t[s+1],d=Math.max(l,u),p=Math.min(c,f);if(d<=p&&new Hn(d+h,p+h,d,p).addToSet(i),f>c)break;s+=2}if(!a)return i;new Hn(a.fromA,a.toA,a.fromB,a.toB).addToSet(i),o=a.toA,l=a.toB}}}class Ib{constructor(e,t,i=XR){this.view=e,this.state=t,this.transactions=i,this.flags=0,this.startState=e.state,this.changes=si.empty(this.startState.doc.length);for(let o of i)this.changes=this.changes.compose(o.changes);let r=[];this.changes.iterChangedRanges((o,l,a,h)=>r.push(new Hn(o,l,a,h))),this.changedRanges=r;let s=e.hasFocus;s!=e.inputState.notifiedFocused&&(e.inputState.notifiedFocused=s,this.flags|=1)}get viewportChanged(){return(this.flags&4)>0}get heightChanged(){return(this.flags&2)>0}get geometryChanged(){return this.docChanged||(this.flags&10)>0}get focusChanged(){return(this.flags&1)>0}get docChanged(){return!this.changes.empty}get selectionSet(){return this.transactions.some(e=>e.selection)}get empty(){return this.flags==0&&this.transactions.length==0}}var vi=function(n){return n[n.LTR=0]="LTR",n[n.RTL=1]="RTL",n}(vi||(vi={}));const Bp=vi.LTR,tL=vi.RTL;function Wb(n){let e=[];for(let t=0;t<n.length;t++)e.push(1<<+n[t]);return e}const iL=Wb("88888888888888888888888888888888888666888888787833333333337888888000000000000000000000000008888880000000000000000000000000088888888888888888888888888888888888887866668888088888663380888308888800000000000000000000000800000000000000000000000000000008"),nL=Wb("4444448826627288999999999992222222222222222222222222222222222222222222222229999999999999999999994444444444644222822222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222999999949999999229989999223333333333"),Rp=Object.create(null),zn=[];for(let n of["()","[]","{}"]){let e=n.charCodeAt(0),t=n.charCodeAt(1);Rp[e]=t,Rp[t]=-e}function rL(n){return n<=247?iL[n]:1424<=n&&n<=1524?2:1536<=n&&n<=1785?nL[n-1536]:1774<=n&&n<=2220?4:8192<=n&&n<=8203||n==8204?256:1}const sL=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;class zo{constructor(e,t,i){this.from=e,this.to=t,this.level=i}get dir(){return this.level%2?tL:Bp}side(e,t){return this.dir==t==e?this.to:this.from}static find(e,t,i,r){let s=-1;for(let o=0;o<e.length;o++){let l=e[o];if(l.from<=t&&l.to>=t){if(l.level==i)return o;(s<0||(r!=0?r<0?l.from<t:l.to>t:e[s].level>l.level))&&(s=o)}}if(s<0)throw new RangeError("Index out of range");return s}}const wt=[];function Vb(n,e){let t=n.length,i=e==Bp?1:2,r=e==Bp?2:1;if(!n||i==1&&!sL.test(n))return Hb(t);for(let o=0,l=i,a=i;o<t;o++){let h=rL(n.charCodeAt(o));h==512?h=l:h==8&&a==4&&(h=16),wt[o]=h==4?2:h,h&7&&(a=h),l=h}for(let o=0,l=i,a=i;o<t;o++){let h=wt[o];if(h==128)o<t-1&&l==wt[o+1]&&l&24?h=wt[o]=l:wt[o]=256;else if(h==64){let c=o+1;for(;c<t&&wt[c]==64;)c++;let u=o&&l==8||c<t&&wt[c]==8?a==1?1:8:256;for(let f=o;f<c;f++)wt[f]=u;o=c-1}else h==8&&a==1&&(wt[o]=1);l=h,h&7&&(a=h)}for(let o=0,l=0,a=0,h,c,u;o<t;o++)if(c=Rp[h=n.charCodeAt(o)])if(c<0){for(let f=l-3;f>=0;f-=3)if(zn[f+1]==-c){let d=zn[f+2],p=d&2?i:d&4?d&1?r:i:0;p&&(wt[o]=wt[zn[f]]=p),l=f;break}}else{if(zn.length==189)break;zn[l++]=o,zn[l++]=h,zn[l++]=a}else if((u=wt[o])==2||u==1){let f=u==i;a=f?0:1;for(let d=l-3;d>=0;d-=3){let p=zn[d+2];if(p&2)break;if(f)zn[d+2]|=2;else{if(p&4)break;zn[d+2]|=4}}}for(let o=0;o<t;o++)if(wt[o]==256){let l=o+1;for(;l<t&&wt[l]==256;)l++;let a=(o?wt[o-1]:i)==1,h=(l<t?wt[l]:i)==1,c=a==h?a?1:2:i;for(let u=o;u<l;u++)wt[u]=c;o=l-1}let s=[];if(i==1)for(let o=0;o<t;){let l=o,a=wt[o++]!=1;for(;o<t&&a==(wt[o]!=1);)o++;if(a)for(let h=o;h>l;){let c=h,u=wt[--h]!=2;for(;h>l&&u==(wt[h-1]!=2);)h--;s.push(new zo(h,c,u?2:1))}else s.push(new zo(l,o,0))}else for(let o=0;o<t;){let l=o,a=wt[o++]==2;for(;o<t&&a==(wt[o]==2);)o++;s.push(new zo(l,o,a?1:2))}return s}function Hb(n){return[new zo(0,n,0)]}let zb="";function jb(n,e,t,i,r){var s;let o=i.head-n.from,l=-1;if(o==0){if(!r||!n.length)return null;e[0].level!=t&&(o=e[0].side(!1,t),l=0)}else if(o==n.length){if(r)return null;let f=e[e.length-1];f.level!=t&&(o=f.side(!0,t),l=e.length-1)}l<0&&(l=zo.find(e,o,(s=i.bidiLevel)!==null&&s!==void 0?s:-1,i.assoc));let a=e[l];o==a.side(r,t)&&(a=e[l+=r?1:-1],o=a.side(!r,t));let h=r==(a.dir==t),c=lt(n.text,o,h);if(zb=n.text.slice(Math.min(o,c),Math.max(o,c)),c!=a.side(r,t))return we.cursor(c+n.from,h?-1:1,a.level);let u=l==(r?e.length-1:0)?null:e[l+(r?1:-1)];return!u&&a.level!=t?we.cursor(r?n.to:n.from,r?-1:1,t):u&&u.level<a.level?we.cursor(u.side(!r,t)+n.from,r?1:-1,u.level):we.cursor(c+n.from,r?-1:1,a.level)}const is="\uFFFF";class $b{constructor(e,t){this.points=e,this.text="",this.lineSeparator=t.facet(at.lineSeparator)}append(e){this.text+=e}lineBreak(){this.text+=is}readRange(e,t){if(!e)return this;let i=e.parentNode;for(let r=e;;){this.findPointBefore(i,r),this.readNode(r);let s=r.nextSibling;if(s==t)break;let o=_t.get(r),l=_t.get(s);(o&&l?o.breakAfter:(o?o.breakAfter:Ub(r))||Ub(s)&&(r.nodeName!="BR"||r.cmIgnore))&&this.lineBreak(),r=s}return this.findPointBefore(i,t),this}readTextNode(e){let t=e.nodeValue;for(let i of this.points)i.node==e&&(i.pos=this.text.length+Math.min(i.offset,t.length));for(let i=0,r=this.lineSeparator?null:/\r\n?|\n/g;;){let s=-1,o=1,l;if(this.lineSeparator?(s=t.indexOf(this.lineSeparator,i),o=this.lineSeparator.length):(l=r.exec(t))&&(s=l.index,o=l[0].length),this.append(t.slice(i,s<0?t.length:s)),s<0)break;if(this.lineBreak(),o>1)for(let a of this.points)a.node==e&&a.pos>this.text.length&&(a.pos-=o-1);i=s+o}}readNode(e){if(e.cmIgnore)return;let t=_t.get(e),i=t&&t.overrideDOMText;if(i!=null){this.findPointInside(e,i.length);for(let r=i.iter();!r.next().done;)r.lineBreak?this.lineBreak():this.append(r.value)}else e.nodeType==3?this.readTextNode(e):e.nodeName=="BR"?e.nextSibling&&this.lineBreak():e.nodeType==1&&this.readRange(e.firstChild,null)}findPointBefore(e,t){for(let i of this.points)i.node==e&&e.childNodes[i.offset]==t&&(i.pos=this.text.length)}findPointInside(e,t){for(let i of this.points)(e.nodeType==3?i.node==e:e.contains(i.node))&&(i.pos=this.text.length+Math.min(t,i.offset))}}function Ub(n){return n.nodeType==1&&/^(DIV|P|LI|UL|OL|BLOCKQUOTE|DD|DT|H\d|SECTION|PRE)$/.test(n.nodeName)}class qb{constructor(e,t){this.node=e,this.offset=t,this.pos=-1}}class Kb extends _t{constructor(e){super(),this.view=e,this.compositionDeco=ht.none,this.decorations=[],this.pluginDecorationLength=0,this.minWidth=0,this.minWidthFrom=0,this.minWidthTo=0,this.impreciseAnchor=null,this.impreciseHead=null,this.forceSelection=!1,this.lastUpdate=Date.now(),this.setDOM(e.contentDOM),this.children=[new Di],this.children[0].setParent(this),this.updateDeco(),this.updateInner([new Hn(0,0,0,e.state.doc.length)],0)}get root(){return this.view.root}get editorView(){return this.view}get length(){return this.view.state.doc.length}update(e){let t=e.changedRanges;this.minWidth>0&&t.length&&(t.every(({fromA:o,toA:l})=>l<this.minWidthFrom||o>this.minWidthTo)?(this.minWidthFrom=e.changes.mapPos(this.minWidthFrom,1),this.minWidthTo=e.changes.mapPos(this.minWidthTo,1)):this.minWidth=this.minWidthFrom=this.minWidthTo=0),this.view.inputState.composing<0?this.compositionDeco=ht.none:(e.transactions.length||this.dirty)&&(this.compositionDeco=lL(this.view,e.changes)),(pe.ie||pe.chrome)&&!this.compositionDeco.size&&e&&e.state.doc.lines!=e.startState.doc.lines&&(this.forceSelection=!0);let i=this.decorations,r=this.updateDeco(),s=uL(i,r,e.changes);return t=Hn.extendWithRanges(t,s),this.dirty==0&&t.length==0?!1:(this.updateInner(t,e.startState.doc.length),e.transactions.length&&(this.lastUpdate=Date.now()),!0)}updateInner(e,t){this.view.viewState.mustMeasureContent=!0,this.updateChildren(e,t);let{observer:i}=this.view;i.ignore(()=>{this.dom.style.height=this.view.viewState.contentHeight+"px",this.dom.style.minWidth=this.minWidth?this.minWidth+"px":"";let s=pe.chrome||pe.ios?{node:i.selectionRange.focusNode,written:!1}:void 0;this.sync(s),this.dirty=0,s&&(s.written||i.selectionRange.focusNode!=s.node)&&(this.forceSelection=!0),this.dom.style.height=""});let r=[];if(this.view.viewport.from||this.view.viewport.to<this.view.state.doc.length)for(let s of this.children)s instanceof Gs&&s.widget instanceof Gb&&r.push(s.dom);i.updateGaps(r)}updateChildren(e,t){let i=this.childCursor(t);for(let r=e.length-1;;r--){let s=r>=0?e[r]:null;if(!s)break;let{fromA:o,toA:l,fromB:a,toB:h}=s,{content:c,breakAtStart:u,openStart:f,openEnd:d}=Dp.build(this.view.state.doc,a,h,this.decorations,this.pluginDecorationLength),{i:p,off:g}=i.findPos(l,1),{i:y,off:v}=i.findPos(o,-1);mb(this,y,v,p,g,c,u,f,d)}}updateSelection(e=!1,t=!1){if(e&&this.view.observer.readSelectionRange(),!(t||this.mayControlSelection())||pe.ios&&this.view.inputState.rapidCompositionStart)return;let i=this.forceSelection;this.forceSelection=!1;let r=this.view.state.selection.main,s=this.domAtPos(r.anchor),o=r.empty?s:this.domAtPos(r.head);if(pe.gecko&&r.empty&&oL(s)){let a=document.createTextNode("");this.view.observer.ignore(()=>s.node.insertBefore(a,s.node.childNodes[s.offset]||null)),s=o=new li(a,0),i=!0}let l=this.view.observer.selectionRange;(i||!l.focusNode||!dc(s.node,s.offset,l.anchorNode,l.anchorOffset)||!dc(o.node,o.offset,l.focusNode,l.focusOffset))&&(this.view.observer.ignore(()=>{pe.android&&pe.chrome&&this.dom.contains(l.focusNode)&&fL(l.focusNode,this.dom)&&(this.dom.blur(),this.dom.focus({preventScroll:!0}));let a=fc(this.root);if(r.empty){if(pe.gecko){let h=hL(s.node,s.offset);if(h&&h!=3){let c=Zb(s.node,s.offset,h==1?1:-1);c&&(s=new li(c,h==1?0:c.nodeValue.length))}}a.collapse(s.node,s.offset),r.bidiLevel!=null&&l.cursorBidiLevel!=null&&(l.cursorBidiLevel=r.bidiLevel)}else if(a.extend)a.collapse(s.node,s.offset),a.extend(o.node,o.offset);else{let h=document.createRange();r.anchor>r.head&&([s,o]=[o,s]),h.setEnd(o.node,o.offset),h.setStart(s.node,s.offset),a.removeAllRanges(),a.addRange(h)}}),this.view.observer.setSelectionRange(s,o)),this.impreciseAnchor=s.precise?null:new li(l.anchorNode,l.anchorOffset),this.impreciseHead=o.precise?null:new li(l.focusNode,l.focusOffset)}enforceCursorAssoc(){if(this.compositionDeco.size)return;let e=this.view.state.selection.main,t=fc(this.root);if(!e.empty||!e.assoc||!t.modify)return;let i=Di.find(this,e.head);if(!i)return;let r=i.posAtStart;if(e.head==r||e.head==r+i.length)return;let s=this.coordsAt(e.head,-1),o=this.coordsAt(e.head,1);if(!s||!o||s.bottom>o.top)return;let l=this.domAtPos(e.head+e.assoc);t.collapse(l.node,l.offset),t.modify("move",e.assoc<0?"forward":"backward","lineboundary")}mayControlSelection(){return this.view.state.facet(ra)?this.root.activeElement==this.dom:mp(this.dom,this.view.observer.selectionRange)}nearest(e){for(let t=e;t;){let i=_t.get(t);if(i&&i.rootView==this)return i;t=t.parentNode}return null}posFromDOM(e,t){let i=this.nearest(e);if(!i)throw new RangeError("Trying to find position for a DOM position outside of the document");return i.localPosFromDOM(e,t)+i.posAtStart}domAtPos(e){let{i:t,off:i}=this.childCursor().findPos(e,-1);for(;t<this.children.length-1;){let r=this.children[t];if(i<r.length||r instanceof Di)break;t++,i=0}return this.children[t].domAtPos(i)}coordsAt(e,t){for(let i=this.length,r=this.children.length-1;;r--){let s=this.children[r],o=i-s.breakAfter-s.length;if(e>o||e==o&&s.type!=ft.WidgetBefore&&s.type!=ft.WidgetAfter&&(!r||t==2||this.children[r-1].breakAfter||this.children[r-1].type==ft.WidgetBefore&&t>-2))return s.coordsAt(e-o,t);i=o}}measureVisibleLineHeights(){let e=[],{from:t,to:i}=this.view.viewState.viewport,r=this.view.contentDOM.clientWidth,s=r>Math.max(this.view.scrollDOM.clientWidth,this.minWidth)+1,o=-1;for(let l=0,a=0;a<this.children.length;a++){let h=this.children[a],c=l+h.length;if(c>i)break;if(l>=t){let u=h.dom.getBoundingClientRect();if(e.push(u.height),s){let f=h.dom.lastChild,d=f?ea(f):[];if(d.length){let p=d[d.length-1],g=this.view.textDirection==vi.LTR?p.right-u.left:u.right-p.left;g>o&&(o=g,this.minWidth=r,this.minWidthFrom=l,this.minWidthTo=c)}}}l=c+h.breakAfter}return e}measureTextSize(){for(let r of this.children)if(r instanceof Di){let s=r.measureTextSize();if(s)return s}let e=document.createElement("div"),t,i;return e.className="cm-line",e.textContent="abc def ghi jkl mno pqr stu",this.view.observer.ignore(()=>{this.dom.appendChild(e);let r=ea(e.firstChild)[0];t=e.getBoundingClientRect().height,i=r?r.width/27:7,e.remove()}),{lineHeight:t,charWidth:i}}childCursor(e=this.length){let t=this.children.length;return t&&(e-=this.children[--t].length),new pb(this.children,e,t)}computeBlockGapDeco(){let e=[],t=this.view.viewState;for(let i=0,r=0;;r++){let s=r==t.viewports.length?null:t.viewports[r],o=s?s.from-1:this.length;if(o>i){let l=t.lineBlockAt(o).bottom-t.lineBlockAt(i).top;e.push(ht.replace({widget:new Gb(l),block:!0,inclusive:!0,isBlockGap:!0}).range(i,o))}if(!s)break;i=s.to+1}return ht.set(e)}updateDeco(){let e=this.view.pluginField(Gi.decorations);return this.pluginDecorationLength=e.length,this.decorations=[...e,...this.view.state.facet(Zs),this.compositionDeco,this.computeBlockGapDeco(),this.view.viewState.lineGapDeco]}scrollIntoView(e){let{range:t}=e,i=this.coordsAt(t.head,t.empty?t.assoc:t.head>t.anchor?-1:1),r;if(!i)return;!t.empty&&(r=this.coordsAt(t.anchor,t.anchor>t.head?-1:1))&&(i={left:Math.min(i.left,r.left),top:Math.min(i.top,r.top),right:Math.max(i.right,r.right),bottom:Math.max(i.bottom,r.bottom)});let s=0,o=0,l=0,a=0;for(let c of this.view.pluginField(Gi.scrollMargins))if(c){let{left:u,right:f,top:d,bottom:p}=c;u!=null&&(s=Math.max(s,u)),f!=null&&(o=Math.max(o,f)),d!=null&&(l=Math.max(l,d)),p!=null&&(a=Math.max(a,p))}let h={left:i.left-s,top:i.top-l,right:i.right+o,bottom:i.bottom+a};qR(this.view.scrollDOM,h,t.head<t.anchor?-1:1,e.x,e.y,e.xMargin,e.yMargin,this.view.textDirection==vi.LTR)}}function oL(n){return n.node.nodeType==1&&n.node.firstChild&&(n.offset==0||n.node.childNodes[n.offset-1].contentEditable=="false")&&(n.offset==n.node.childNodes.length||n.node.childNodes[n.offset].contentEditable=="false")}class Gb extends yc{constructor(e){super(),this.height=e}toDOM(){let e=document.createElement("div");return this.updateDOM(e),e}eq(e){return e.height==this.height}updateDOM(e){return e.style.height=this.height+"px",!0}get estimatedHeight(){return this.height}}function Jb(n){let e=n.observer.selectionRange,t=e.focusNode&&Zb(e.focusNode,e.focusOffset,0);if(!t)return null;let i=n.docView.nearest(t);if(!i)return null;if(i instanceof Di){let r=t;for(;r.parentNode!=i.dom;)r=r.parentNode;let s=r.previousSibling;for(;s&&!_t.get(s);)s=s.previousSibling;let o=s?_t.get(s).posAtEnd:i.posAtStart;return{from:o,to:o,node:r,text:t}}else{for(;;){let{parent:s}=i;if(!s)return null;if(s instanceof Di)break;i=s}let r=i.posAtStart;return{from:r,to:r+i.length,node:i.dom,text:t}}}function lL(n,e){let t=Jb(n);if(!t)return ht.none;let{from:i,to:r,node:s,text:o}=t,l=e.mapPos(i,1),a=Math.max(l,e.mapPos(r,-1)),{state:h}=n,c=s.nodeType==3?s.nodeValue:new $b([],h).readRange(s.firstChild,null).text;if(a-l<c.length)if(h.doc.sliceString(l,Math.min(h.doc.length,l+c.length),is)==c)a=l+c.length;else if(h.doc.sliceString(Math.max(0,a-c.length),a,is)==c)l=a-c.length;else return ht.none;else if(h.doc.sliceString(l,a,is)!=c)return ht.none;let u=_t.get(s);return u instanceof Sb?u=u.widget.topView:u&&(u.parent=null),ht.set(ht.replace({widget:new aL(s,o,u)}).range(l,a))}class aL extends yc{constructor(e,t,i){super(),this.top=e,this.text=t,this.topView=i}eq(e){return this.top==e.top&&this.text==e.text}toDOM(){return this.top}ignoreEvent(){return!1}get customView(){return Sb}}function Zb(n,e,t){for(;;){if(n.nodeType==3)return n;if(n.nodeType==1&&e>0&&t<=0)n=n.childNodes[e-1],e=pc(n);else if(n.nodeType==1&&e<n.childNodes.length&&t>=0)n=n.childNodes[e],e=0;else return null}}function hL(n,e){return n.nodeType!=1?0:(e&&n.childNodes[e-1].contentEditable=="false"?1:0)|(e<n.childNodes.length&&n.childNodes[e].contentEditable=="false"?2:0)}class cL{constructor(){this.changes=[]}compareRange(e,t){_p(e,t,this.changes)}comparePoint(e,t){_p(e,t,this.changes)}}function uL(n,e,t){let i=new cL;return Te.compare(n,e,t,i),i.changes}function fL(n,e){for(let t=n;t&&t!=e;t=t.assignedSlot||t.parentNode)if(t.nodeType==1&&t.contentEditable=="false")return!0;return!1}function dL(n,e,t=1){let i=n.charCategorizer(e),r=n.doc.lineAt(e),s=e-r.from;if(r.length==0)return we.cursor(e);s==0?t=1:s==r.length&&(t=-1);let o=s,l=s;t<0?o=lt(r.text,s,!1):l=lt(r.text,s);let a=i(r.text.slice(o,l));for(;o>0;){let h=lt(r.text,o,!1);if(i(r.text.slice(h,o))!=a)break;o=h}for(;l<r.length;){let h=lt(r.text,l);if(i(r.text.slice(l,h))!=a)break;l=h}return we.range(o+r.from,l+r.from)}function pL(n,e){return e.left>n?e.left-n:Math.max(0,n-e.right)}function mL(n,e){return e.top>n?e.top-n:Math.max(0,n-e.bottom)}function Lp(n,e){return n.top<e.bottom-1&&n.bottom>e.top+1}function Yb(n,e){return e<n.top?{top:e,left:n.left,right:n.right,bottom:n.bottom}:n}function Xb(n,e){return e>n.bottom?{top:n.top,left:n.left,right:n.right,bottom:e}:n}function Fp(n,e,t){let i,r,s,o,l,a,h,c;for(let d=n.firstChild;d;d=d.nextSibling){let p=ea(d);for(let g=0;g<p.length;g++){let y=p[g];r&&Lp(r,y)&&(y=Yb(Xb(y,r.bottom),r.top));let v=pL(e,y),C=mL(t,y);if(v==0&&C==0)return d.nodeType==3?Qb(d,e,t):Fp(d,e,t);(!i||o>C||o==C&&s>v)&&(i=d,r=y,s=v,o=C),v==0?t>y.bottom&&(!h||h.bottom<y.bottom)?(l=d,h=y):t<y.top&&(!c||c.top>y.top)&&(a=d,c=y):h&&Lp(h,y)?h=Xb(h,y.bottom):c&&Lp(c,y)&&(c=Yb(c,y.top))}}if(h&&h.bottom>=t?(i=l,r=h):c&&c.top<=t&&(i=a,r=c),!i)return{node:n,offset:0};let u=Math.max(r.left,Math.min(r.right,e));if(i.nodeType==3)return Qb(i,u,t);if(!s&&i.contentEditable=="true")return Fp(i,u,t);let f=Array.prototype.indexOf.call(n.childNodes,i)+(e>=(r.left+r.right)/2?1:0);return{node:n,offset:f}}function Qb(n,e,t){let i=n.nodeValue.length,r=-1,s=1e9,o=0;for(let l=0;l<i;l++){let a=ta(n,l,l+1).getClientRects();for(let h=0;h<a.length;h++){let c=a[h];if(c.top==c.bottom)continue;o||(o=e-c.left);let u=(c.top>t?c.top-t:t-c.bottom)-1;if(c.left-1<=e&&c.right+1>=e&&u<s){let f=e>=(c.left+c.right)/2,d=f;if((pe.chrome||pe.gecko)&&ta(n,l).getBoundingClientRect().left==c.right&&(d=!f),u<=0)return{node:n,offset:l+(d?1:0)};r=l+(d?1:0),s=u}}}return{node:n,offset:r>-1?r:o>0?n.nodeValue.length:0}}function e1(n,{x:e,y:t},i,r=-1){var s;let o=n.contentDOM.getBoundingClientRect(),l=o.top+n.viewState.paddingTop,a,{docHeight:h}=n.viewState,c=t-l;if(c<0)return 0;if(c>h)return n.state.doc.length;for(let v=n.defaultLineHeight/2,C=!1;a=n.elementAtHeight(c),a.type!=ft.Text;)for(;c=r>0?a.bottom+v:a.top-v,!(c>=0&&c<=h);){if(C)return i?null:0;C=!0,r=-r}t=l+c;let u=a.from;if(u<n.viewport.from)return n.viewport.from==0?0:i?null:t1(n,o,a,e,t);if(u>n.viewport.to)return n.viewport.to==n.state.doc.length?n.state.doc.length:i?null:t1(n,o,a,e,t);let f=n.dom.ownerDocument,d=n.root.elementFromPoint?n.root:f,p=d.elementFromPoint(e,t);p&&!n.contentDOM.contains(p)&&(p=null),p||(e=Math.max(o.left+1,Math.min(o.right-1,e)),p=d.elementFromPoint(e,t),p&&!n.contentDOM.contains(p)&&(p=null));let g,y=-1;if(p&&((s=n.docView.nearest(p))===null||s===void 0?void 0:s.isEditable)!=!1){if(f.caretPositionFromPoint){let v=f.caretPositionFromPoint(e,t);v&&({offsetNode:g,offset:y}=v)}else if(f.caretRangeFromPoint){let v=f.caretRangeFromPoint(e,t);v&&({startContainer:g,startOffset:y}=v,pe.safari&&gL(g,y,e)&&(g=void 0))}}if(!g||!n.docView.dom.contains(g)){let v=Di.find(n.docView,u);if(!v)return c>a.top+a.height/2?a.to:a.from;({node:g,offset:y}=Fp(v.dom,e,t))}return n.docView.posFromDOM(g,y)}function t1(n,e,t,i,r){let s=Math.round((i-e.left)*n.defaultCharacterWidth);n.lineWrapping&&t.height>n.defaultLineHeight*1.5&&(s+=Math.floor((r-t.top)/n.defaultLineHeight)*n.viewState.heightOracle.lineLength);let o=n.state.sliceDoc(t.from,t.to);return t.from+$d(o,s,n.state.tabSize)}function gL(n,e,t){let i;if(n.nodeType!=3||e!=(i=n.nodeValue.length))return!1;for(let r=n.nextSibling;r;r=r.nextSibling)if(r.nodeType!=1||r.nodeName!="BR")return!1;return ta(n,i-1,i).getBoundingClientRect().left>t}function yL(n,e,t,i){let r=n.state.doc.lineAt(e.head),s=!i||!n.lineWrapping?null:n.coordsAtPos(e.assoc<0&&e.head>r.from?e.head-1:e.head);if(s){let a=n.dom.getBoundingClientRect(),h=n.posAtCoords({x:t==(n.textDirection==vi.LTR)?a.right-1:a.left+1,y:(s.top+s.bottom)/2});if(h!=null)return we.cursor(h,t?-1:1)}let o=Di.find(n.docView,e.head),l=o?t?o.posAtEnd:o.posAtStart:t?r.to:r.from;return we.cursor(l,t?-1:1)}function i1(n,e,t,i){let r=n.state.doc.lineAt(e.head),s=n.bidiSpans(r);for(let o=e,l=null;;){let a=jb(r,s,n.textDirection,o,t),h=zb;if(!a){if(r.number==(t?n.state.doc.lines:1))return o;h=`
`,r=n.state.doc.line(r.number+(t?1:-1)),s=n.bidiSpans(r),a=we.cursor(t?r.from:r.to)}if(l){if(!l(h))return o}else{if(!i)return a;l=i(h)}o=a}}function vL(n,e,t){let i=n.state.charCategorizer(e),r=i(t);return s=>{let o=i(s);return r==Sr.Space&&(r=o),r==o}}function wL(n,e,t,i){let r=e.head,s=t?1:-1;if(r==(t?n.state.doc.length:0))return we.cursor(r,e.assoc);let o=e.goalColumn,l,a=n.contentDOM.getBoundingClientRect(),h=n.coordsAtPos(r),c=n.documentTop;if(h)o==null&&(o=h.left-a.left),l=s<0?h.top:h.bottom;else{let d=n.viewState.lineBlockAt(r-c);o==null&&(o=Math.min(a.right-a.left,n.defaultCharacterWidth*(r-d.from))),l=(s<0?d.top:d.bottom)+c}let u=a.left+o,f=i!=null?i:n.defaultLineHeight>>1;for(let d=0;;d+=10){let p=l+(f+d)*s,g=e1(n,{x:u,y:p},!1,s);if(p<a.top||p>a.bottom||(s<0?g<r:g>r))return we.cursor(g,e.assoc,void 0,o)}}function Np(n,e,t){let i=n.pluginField(Gi.atomicRanges);for(;;){let r=!1;for(let s of i)s.between(t.from-1,t.from+1,(o,l,a)=>{t.from>o&&t.from<l&&(t=e.from>t.from?we.cursor(o,1):we.cursor(l,-1),r=!0)});if(!r)return t}}class bL{constructor(e){this.lastKeyCode=0,this.lastKeyTime=0,this.pendingIOSKey=void 0,this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastEscPress=0,this.lastContextMenu=0,this.scrollHandlers=[],this.registeredEvents=[],this.customHandlers=[],this.composing=-1,this.compositionFirstChange=null,this.compositionEndedAt=0,this.rapidCompositionStart=!1,this.mouseSelection=null;for(let t in Gt){let i=Gt[t];e.contentDOM.addEventListener(t,r=>{!s1(e,r)||this.ignoreDuringComposition(r)||t=="keydown"&&this.keydown(e,r)||(this.mustFlushObserver(r)&&e.observer.forceFlush(),this.runCustomHandlers(t,e,r)?r.preventDefault():i(e,r))}),this.registeredEvents.push(t)}this.notifiedFocused=e.hasFocus,this.ensureHandlers(e),pe.safari&&e.contentDOM.addEventListener("input",()=>null)}setSelectionOrigin(e){this.lastSelectionOrigin=e,this.lastSelectionTime=Date.now()}ensureHandlers(e){let t=this.customHandlers=e.pluginField(Fb);for(let i of t)for(let r in i.handlers)this.registeredEvents.indexOf(r)<0&&r!="scroll"&&(this.registeredEvents.push(r),e.contentDOM.addEventListener(r,s=>{!s1(e,s)||this.runCustomHandlers(r,e,s)&&s.preventDefault()}))}runCustomHandlers(e,t,i){for(let r of this.customHandlers){let s=r.handlers[e];if(s)try{if(s.call(r.plugin,i,t)||i.defaultPrevented)return!0}catch(o){Js(t.state,o)}}return!1}runScrollHandlers(e,t){for(let i of this.customHandlers){let r=i.handlers.scroll;if(r)try{r.call(i.plugin,t,e)}catch(s){Js(e.state,s)}}}keydown(e,t){if(this.lastKeyCode=t.keyCode,this.lastKeyTime=Date.now(),t.keyCode==9&&Date.now()<this.lastEscPress+2e3)return!0;if(pe.android&&pe.chrome&&!t.synthetic&&(t.keyCode==13||t.keyCode==8))return e.observer.delayAndroidKey(t.key,t.keyCode),!0;let i;return pe.ios&&(i=n1.find(r=>r.keyCode==t.keyCode))&&!(t.ctrlKey||t.altKey||t.metaKey)&&!t.synthetic?(this.pendingIOSKey=i,setTimeout(()=>this.flushIOSKey(e),250),!0):!1}flushIOSKey(e){let t=this.pendingIOSKey;return t?(this.pendingIOSKey=void 0,ia(e.contentDOM,t.key,t.keyCode)):!1}ignoreDuringComposition(e){return/^key/.test(e.type)?this.composing>0?!0:pe.safari&&Date.now()-this.compositionEndedAt<500?(this.compositionEndedAt=0,!0):!1:!1}mustFlushObserver(e){return e.type=="keydown"&&e.keyCode!=229||e.type=="compositionend"&&!pe.ios}startMouseSelection(e){this.mouseSelection&&this.mouseSelection.destroy(),this.mouseSelection=e}update(e){this.mouseSelection&&this.mouseSelection.update(e),e.transactions.length&&(this.lastKeyCode=this.lastSelectionTime=0)}destroy(){this.mouseSelection&&this.mouseSelection.destroy()}}const n1=[{key:"Backspace",keyCode:8,inputType:"deleteContentBackward"},{key:"Enter",keyCode:13,inputType:"insertParagraph"},{key:"Delete",keyCode:46,inputType:"deleteContentForward"}],r1=[16,17,18,20,91,92,224,225];class xL{constructor(e,t,i,r){this.view=e,this.style=i,this.mustSelect=r,this.lastEvent=t;let s=e.contentDOM.ownerDocument;s.addEventListener("mousemove",this.move=this.move.bind(this)),s.addEventListener("mouseup",this.up=this.up.bind(this)),this.extend=t.shiftKey,this.multiple=e.state.facet(at.allowMultipleSelections)&&SL(e,t),this.dragMove=kL(e,t),this.dragging=CL(e,t)&&Ip(t)==1?null:!1,this.dragging===!1&&(t.preventDefault(),this.select(t))}move(e){if(e.buttons==0)return this.destroy();this.dragging===!1&&this.select(this.lastEvent=e)}up(e){this.dragging==null&&this.select(this.lastEvent),this.dragging||e.preventDefault(),this.destroy()}destroy(){let e=this.view.contentDOM.ownerDocument;e.removeEventListener("mousemove",this.move),e.removeEventListener("mouseup",this.up),this.view.inputState.mouseSelection=null}select(e){let t=this.style.get(e,this.extend,this.multiple);(this.mustSelect||!t.eq(this.view.state.selection)||t.main.assoc!=this.view.state.selection.main.assoc)&&this.view.dispatch({selection:t,userEvent:"select.pointer",scrollIntoView:!0}),this.mustSelect=!1}update(e){e.docChanged&&this.dragging&&(this.dragging=this.dragging.map(e.changes)),this.style.update(e)&&setTimeout(()=>this.select(this.lastEvent),20)}}function SL(n,e){let t=n.state.facet(Mb);return t.length?t[0](e):pe.mac?e.metaKey:e.ctrlKey}function kL(n,e){let t=n.state.facet(Eb);return t.length?t[0](e):pe.mac?!e.altKey:!e.ctrlKey}function CL(n,e){let{main:t}=n.state.selection;if(t.empty)return!1;let i=fc(n.root);if(i.rangeCount==0)return!0;let r=i.getRangeAt(0).getClientRects();for(let s=0;s<r.length;s++){let o=r[s];if(o.left<=e.clientX&&o.right>=e.clientX&&o.top<=e.clientY&&o.bottom>=e.clientY)return!0}return!1}function s1(n,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let t=e.target,i;t!=n.contentDOM;t=t.parentNode)if(!t||t.nodeType==11||(i=_t.get(t))&&i.ignoreEvent(e))return!1;return!0}const Gt=Object.create(null),o1=pe.ie&&pe.ie_version<15||pe.ios&&pe.webkit_version<604;function AL(n){let e=n.dom.parentNode;if(!e)return;let t=e.appendChild(document.createElement("textarea"));t.style.cssText="position: fixed; left: -10000px; top: 10px",t.focus(),setTimeout(()=>{n.focus(),t.remove(),l1(n,t.value)},50)}function l1(n,e){let{state:t}=n,i,r=1,s=t.toText(e),o=s.lines==t.selection.ranges.length;if(Wp!=null&&t.selection.ranges.every(a=>a.empty)&&Wp==s.toString()){let a=-1;i=t.changeByRange(h=>{let c=t.doc.lineAt(h.from);if(c.from==a)return{range:h};a=c.from;let u=t.toText((o?s.line(r++).text:e)+t.lineBreak);return{changes:{from:c.from,insert:u},range:we.cursor(h.from+u.length)}})}else o?i=t.changeByRange(a=>{let h=s.line(r++);return{changes:{from:a.from,to:a.to,insert:h.text},range:we.cursor(a.from+h.length)}}):i=t.replaceSelection(s);n.dispatch(i,{userEvent:"input.paste",scrollIntoView:!0})}Gt.keydown=(n,e)=>{n.inputState.setSelectionOrigin("select"),e.keyCode==27?n.inputState.lastEscPress=Date.now():r1.indexOf(e.keyCode)<0&&(n.inputState.lastEscPress=0)};let a1=0;Gt.touchstart=(n,e)=>{a1=Date.now(),n.inputState.setSelectionOrigin("select.pointer")},Gt.touchmove=n=>{n.inputState.setSelectionOrigin("select.pointer")},Gt.mousedown=(n,e)=>{if(n.observer.flush(),a1>Date.now()-2e3&&Ip(e)==1)return;let t=null;for(let i of n.state.facet(Tb))if(t=i(n,e),t)break;if(!t&&e.button==0&&(t=DL(n,e)),t){let i=n.root.activeElement!=n.contentDOM;i&&n.observer.ignore(()=>cb(n.contentDOM)),n.inputState.startMouseSelection(new xL(n,e,t,i))}};function h1(n,e,t,i){if(i==1)return we.cursor(e,t);if(i==2)return dL(n.state,e,t);{let r=Di.find(n.docView,e),s=n.state.doc.lineAt(r?r.posAtEnd:e),o=r?r.posAtStart:s.from,l=r?r.posAtEnd:s.to;return l<n.state.doc.length&&l==s.to&&l++,we.range(o,l)}}let c1=(n,e)=>n>=e.top&&n<=e.bottom,u1=(n,e,t)=>c1(e,t)&&n>=t.left&&n<=t.right;function OL(n,e,t,i){let r=Di.find(n.docView,e);if(!r)return 1;let s=e-r.posAtStart;if(s==0)return 1;if(s==r.length)return-1;let o=r.coordsAt(s,-1);if(o&&u1(t,i,o))return-1;let l=r.coordsAt(s,1);return l&&u1(t,i,l)?1:o&&c1(i,o)?-1:1}function f1(n,e){let t=n.posAtCoords({x:e.clientX,y:e.clientY},!1);return{pos:t,bias:OL(n,t,e.clientX,e.clientY)}}const _L=pe.ie&&pe.ie_version<=11;let d1=null,p1=0,m1=0;function Ip(n){if(!_L)return n.detail;let e=d1,t=m1;return d1=n,m1=Date.now(),p1=!e||t>Date.now()-400&&Math.abs(e.clientX-n.clientX)<2&&Math.abs(e.clientY-n.clientY)<2?(p1+1)%3:1}function DL(n,e){let t=f1(n,e),i=Ip(e),r=n.state.selection,s=t,o=e;return{update(l){l.docChanged&&(t&&(t.pos=l.changes.mapPos(t.pos)),r=r.map(l.changes),o=null)},get(l,a,h){let c;if(o&&l.clientX==o.clientX&&l.clientY==o.clientY?c=s:(c=s=f1(n,l),o=l),!c||!t)return r;let u=h1(n,c.pos,c.bias,i);if(t.pos!=c.pos&&!a){let f=h1(n,t.pos,t.bias,i),d=Math.min(f.from,u.from),p=Math.max(f.to,u.to);u=d<u.from?we.range(d,p):we.range(p,d)}return a?r.replaceRange(r.main.extend(u.from,u.to)):h?r.addRange(u):we.create([u])}}}Gt.dragstart=(n,e)=>{let{selection:{main:t}}=n.state,{mouseSelection:i}=n.inputState;i&&(i.dragging=t),e.dataTransfer&&(e.dataTransfer.setData("Text",n.state.sliceDoc(t.from,t.to)),e.dataTransfer.effectAllowed="copyMove")};function g1(n,e,t,i){if(!t)return;let r=n.posAtCoords({x:e.clientX,y:e.clientY},!1);e.preventDefault();let{mouseSelection:s}=n.inputState,o=i&&s&&s.dragging&&s.dragMove?{from:s.dragging.from,to:s.dragging.to}:null,l={from:r,insert:t},a=n.state.changes(o?[o,l]:l);n.focus(),n.dispatch({changes:a,selection:{anchor:a.mapPos(r,-1),head:a.mapPos(r,1)},userEvent:o?"move.drop":"input.drop"})}Gt.drop=(n,e)=>{if(!e.dataTransfer)return;if(n.state.readOnly)return e.preventDefault();let t=e.dataTransfer.files;if(t&&t.length){e.preventDefault();let i=Array(t.length),r=0,s=()=>{++r==t.length&&g1(n,e,i.filter(o=>o!=null).join(n.state.lineBreak),!1)};for(let o=0;o<t.length;o++){let l=new FileReader;l.onerror=s,l.onload=()=>{/[\x00-\x08\x0e-\x1f]{2}/.test(l.result)||(i[o]=l.result),s()},l.readAsText(t[o])}}else g1(n,e,e.dataTransfer.getData("Text"),!0)},Gt.paste=(n,e)=>{if(n.state.readOnly)return e.preventDefault();n.observer.flush();let t=o1?null:e.clipboardData;t?(l1(n,t.getData("text/plain")),e.preventDefault()):AL(n)};function ML(n,e){let t=n.dom.parentNode;if(!t)return;let i=t.appendChild(document.createElement("textarea"));i.style.cssText="position: fixed; left: -10000px; top: 10px",i.value=e,i.focus(),i.selectionEnd=e.length,i.selectionStart=0,setTimeout(()=>{i.remove(),n.focus()},50)}function EL(n){let e=[],t=[],i=!1;for(let r of n.selection.ranges)r.empty||(e.push(n.sliceDoc(r.from,r.to)),t.push(r));if(!e.length){let r=-1;for(let{from:s}of n.selection.ranges){let o=n.doc.lineAt(s);o.number>r&&(e.push(o.text),t.push({from:o.from,to:Math.min(n.doc.length,o.to+1)})),r=o.number}i=!0}return{text:e.join(n.lineBreak),ranges:t,linewise:i}}let Wp=null;Gt.copy=Gt.cut=(n,e)=>{let{text:t,ranges:i,linewise:r}=EL(n.state);if(!t&&!r)return;Wp=r?t:null;let s=o1?null:e.clipboardData;s?(e.preventDefault(),s.clearData(),s.setData("text/plain",t)):ML(n,t),e.type=="cut"&&!n.state.readOnly&&n.dispatch({changes:i,scrollIntoView:!0,userEvent:"delete.cut"})},Gt.focus=Gt.blur=n=>{setTimeout(()=>{n.hasFocus!=n.inputState.notifiedFocused&&n.update([])},10)};function y1(n,e){if(n.docView.compositionDeco.size){n.inputState.rapidCompositionStart=e;try{n.update([])}finally{n.inputState.rapidCompositionStart=!1}}}Gt.compositionstart=Gt.compositionupdate=n=>{n.inputState.compositionFirstChange==null&&(n.inputState.compositionFirstChange=!0),n.inputState.composing<0&&(n.inputState.composing=0,n.docView.compositionDeco.size&&(n.observer.flush(),y1(n,!0)))},Gt.compositionend=n=>{n.inputState.composing=-1,n.inputState.compositionEndedAt=Date.now(),n.inputState.compositionFirstChange=null,setTimeout(()=>{n.inputState.composing<0&&y1(n,!1)},50)},Gt.contextmenu=n=>{n.inputState.lastContextMenu=Date.now()},Gt.beforeinput=(n,e)=>{var t;let i;if(pe.chrome&&pe.android&&(i=n1.find(r=>r.inputType==e.inputType))&&(n.observer.delayAndroidKey(i.key,i.keyCode),i.key=="Backspace"||i.key=="Delete")){let r=((t=window.visualViewport)===null||t===void 0?void 0:t.height)||0;setTimeout(()=>{var s;(((s=window.visualViewport)===null||s===void 0?void 0:s.height)||0)>r+10&&n.hasFocus&&(n.contentDOM.blur(),n.focus())},100)}};const v1=["pre-wrap","normal","pre-line","break-spaces"];class w1{constructor(){this.doc=j.empty,this.lineWrapping=!1,this.direction=vi.LTR,this.heightSamples={},this.lineHeight=14,this.charWidth=7,this.lineLength=30,this.heightChanged=!1}heightForGap(e,t){let i=this.doc.lineAt(t).number-this.doc.lineAt(e).number+1;return this.lineWrapping&&(i+=Math.ceil((t-e-i*this.lineLength*.5)/this.lineLength)),this.lineHeight*i}heightForLine(e){return this.lineWrapping?(1+Math.max(0,Math.ceil((e-this.lineLength)/(this.lineLength-5))))*this.lineHeight:this.lineHeight}setDoc(e){return this.doc=e,this}mustRefreshForStyle(e,t){return v1.indexOf(e)>-1!=this.lineWrapping||this.direction!=t}mustRefreshForHeights(e){let t=!1;for(let i=0;i<e.length;i++){let r=e[i];r<0?i++:this.heightSamples[Math.floor(r*10)]||(t=!0,this.heightSamples[Math.floor(r*10)]=!0)}return t}refresh(e,t,i,r,s,o){let l=v1.indexOf(e)>-1,a=Math.round(i)!=Math.round(this.lineHeight)||this.lineWrapping!=l||this.direction!=t;if(this.lineWrapping=l,this.direction=t,this.lineHeight=i,this.charWidth=r,this.lineLength=s,a){this.heightSamples={};for(let h=0;h<o.length;h++){let c=o[h];c<0?h++:this.heightSamples[Math.floor(c*10)]=!0}}return a}}class b1{constructor(e,t){this.from=e,this.heights=t,this.index=0}get more(){return this.index<this.heights.length}}class Ar{constructor(e,t,i,r,s){this.from=e,this.length=t,this.top=i,this.height=r,this.type=s}get to(){return this.from+this.length}get bottom(){return this.top+this.height}join(e){let t=(Array.isArray(this.type)?this.type:[this]).concat(Array.isArray(e.type)?e.type:[e]);return new Ar(this.from,this.length+e.length,this.top,this.height+e.height,t)}moveY(e){return e?new Ar(this.from,this.length,this.top+e,this.height,Array.isArray(this.type)?this.type.map(t=>t.moveY(e)):this.type):this}}var Qe=function(n){return n[n.ByPos=0]="ByPos",n[n.ByHeight=1]="ByHeight",n[n.ByPosNoHeight=2]="ByPosNoHeight",n}(Qe||(Qe={}));const bc=.001;class Mi{constructor(e,t,i=2){this.length=e,this.height=t,this.flags=i}get outdated(){return(this.flags&2)>0}set outdated(e){this.flags=(e?2:0)|this.flags&-3}setHeight(e,t){this.height!=t&&(Math.abs(this.height-t)>bc&&(e.heightChanged=!0),this.height=t)}replace(e,t,i){return Mi.of(i)}decomposeLeft(e,t){t.push(this)}decomposeRight(e,t){t.push(this)}applyChanges(e,t,i,r){let s=this;for(let o=r.length-1;o>=0;o--){let{fromA:l,toA:a,fromB:h,toB:c}=r[o],u=s.lineAt(l,Qe.ByPosNoHeight,t,0,0),f=u.to>=a?u:s.lineAt(a,Qe.ByPosNoHeight,t,0,0);for(c+=f.to-a,a=f.to;o>0&&u.from<=r[o-1].toA;)l=r[o-1].fromA,h=r[o-1].fromB,o--,l<u.from&&(u=s.lineAt(l,Qe.ByPosNoHeight,t,0,0));h+=u.from-l,l=u.from;let d=Vp.build(i,e,h,c);s=s.replace(l,a,d)}return s.updateHeight(i,0)}static empty(){return new nn(0,0)}static of(e){if(e.length==1)return e[0];let t=0,i=e.length,r=0,s=0;for(;;)if(t==i)if(r>s*2){let l=e[t-1];l.break?e.splice(--t,1,l.left,null,l.right):e.splice(--t,1,l.left,l.right),i+=1+l.break,r-=l.size}else if(s>r*2){let l=e[i];l.break?e.splice(i,1,l.left,null,l.right):e.splice(i,1,l.left,l.right),i+=2+l.break,s-=l.size}else break;else if(r<s){let l=e[t++];l&&(r+=l.size)}else{let l=e[--i];l&&(s+=l.size)}let o=0;return e[t-1]==null?(o=1,t--):e[t]==null&&(o=1,i++),new TL(Mi.of(e.slice(0,t)),o,Mi.of(e.slice(i)))}}Mi.prototype.size=1;class x1 extends Mi{constructor(e,t,i){super(e,t),this.type=i}blockAt(e,t,i,r){return new Ar(r,this.length,i,this.height,this.type)}lineAt(e,t,i,r,s){return this.blockAt(0,i,r,s)}forEachLine(e,t,i,r,s,o){o(this.blockAt(0,i,r,s))}updateHeight(e,t=0,i=!1,r){return r&&r.from<=t&&r.more&&this.setHeight(e,r.heights[r.index++]),this.outdated=!1,this}toString(){return`block(${this.length})`}}class nn extends x1{constructor(e,t){super(e,t,ft.Text),this.collapsed=0,this.widgetHeight=0}replace(e,t,i){let r=i[0];return i.length==1&&(r instanceof nn||r instanceof ai&&r.flags&4)&&Math.abs(this.length-r.length)<10?(r instanceof ai?r=new nn(r.length,this.height):r.height=this.height,this.outdated||(r.outdated=!1),r):Mi.of(i)}updateHeight(e,t=0,i=!1,r){return r&&r.from<=t&&r.more?this.setHeight(e,r.heights[r.index++]):(i||this.outdated)&&this.setHeight(e,Math.max(this.widgetHeight,e.heightForLine(this.length-this.collapsed))),this.outdated=!1,this}toString(){return`line(${this.length}${this.collapsed?-this.collapsed:""}${this.widgetHeight?":"+this.widgetHeight:""})`}}class ai extends Mi{constructor(e){super(e,0)}lines(e,t){let i=e.lineAt(t).number,r=e.lineAt(t+this.length).number;return{firstLine:i,lastLine:r,lineHeight:this.height/(r-i+1)}}blockAt(e,t,i,r){let{firstLine:s,lastLine:o,lineHeight:l}=this.lines(t,r),a=Math.max(0,Math.min(o-s,Math.floor((e-i)/l))),{from:h,length:c}=t.line(s+a);return new Ar(h,c,i+l*a,l,ft.Text)}lineAt(e,t,i,r,s){if(t==Qe.ByHeight)return this.blockAt(e,i,r,s);if(t==Qe.ByPosNoHeight){let{from:u,to:f}=i.lineAt(e);return new Ar(u,f-u,0,0,ft.Text)}let{firstLine:o,lineHeight:l}=this.lines(i,s),{from:a,length:h,number:c}=i.lineAt(e);return new Ar(a,h,r+l*(c-o),l,ft.Text)}forEachLine(e,t,i,r,s,o){let{firstLine:l,lineHeight:a}=this.lines(i,s);for(let h=Math.max(e,s),c=Math.min(s+this.length,t);h<=c;){let u=i.lineAt(h);h==e&&(r+=a*(u.number-l)),o(new Ar(u.from,u.length,r,a,ft.Text)),r+=a,h=u.to+1}}replace(e,t,i){let r=this.length-t;if(r>0){let s=i[i.length-1];s instanceof ai?i[i.length-1]=new ai(s.length+r):i.push(null,new ai(r-1))}if(e>0){let s=i[0];s instanceof ai?i[0]=new ai(e+s.length):i.unshift(new ai(e-1),null)}return Mi.of(i)}decomposeLeft(e,t){t.push(new ai(e-1),null)}decomposeRight(e,t){t.push(null,new ai(this.length-e-1))}updateHeight(e,t=0,i=!1,r){let s=t+this.length;if(r&&r.from<=t+this.length&&r.more){let o=[],l=Math.max(t,r.from),a=-1,h=e.heightChanged;for(r.from>t&&o.push(new ai(r.from-t-1).updateHeight(e,t));l<=s&&r.more;){let u=e.doc.lineAt(l).length;o.length&&o.push(null);let f=r.heights[r.index++];a==-1?a=f:Math.abs(f-a)>=bc&&(a=-2);let d=new nn(u,f);d.outdated=!1,o.push(d),l+=u+1}l<=s&&o.push(null,new ai(s-l).updateHeight(e,l));let c=Mi.of(o);return e.heightChanged=h||a<0||Math.abs(c.height-this.height)>=bc||Math.abs(a-this.lines(e.doc,t).lineHeight)>=bc,c}else(i||this.outdated)&&(this.setHeight(e,e.heightForGap(t,t+this.length)),this.outdated=!1);return this}toString(){return`gap(${this.length})`}}class TL extends Mi{constructor(e,t,i){super(e.length+t+i.length,e.height+i.height,t|(e.outdated||i.outdated?2:0)),this.left=e,this.right=i,this.size=e.size+i.size}get break(){return this.flags&1}blockAt(e,t,i,r){let s=i+this.left.height;return e<s?this.left.blockAt(e,t,i,r):this.right.blockAt(e,t,s,r+this.left.length+this.break)}lineAt(e,t,i,r,s){let o=r+this.left.height,l=s+this.left.length+this.break,a=t==Qe.ByHeight?e<o:e<l,h=a?this.left.lineAt(e,t,i,r,s):this.right.lineAt(e,t,i,o,l);if(this.break||(a?h.to<l:h.from>l))return h;let c=t==Qe.ByPosNoHeight?Qe.ByPosNoHeight:Qe.ByPos;return a?h.join(this.right.lineAt(l,c,i,o,l)):this.left.lineAt(l,c,i,r,s).join(h)}forEachLine(e,t,i,r,s,o){let l=r+this.left.height,a=s+this.left.length+this.break;if(this.break)e<a&&this.left.forEachLine(e,t,i,r,s,o),t>=a&&this.right.forEachLine(e,t,i,l,a,o);else{let h=this.lineAt(a,Qe.ByPos,i,r,s);e<h.from&&this.left.forEachLine(e,h.from-1,i,r,s,o),h.to>=e&&h.from<=t&&o(h),t>h.to&&this.right.forEachLine(h.to+1,t,i,l,a,o)}}replace(e,t,i){let r=this.left.length+this.break;if(t<r)return this.balanced(this.left.replace(e,t,i),this.right);if(e>this.left.length)return this.balanced(this.left,this.right.replace(e-r,t-r,i));let s=[];e>0&&this.decomposeLeft(e,s);let o=s.length;for(let l of i)s.push(l);if(e>0&&S1(s,o-1),t<this.length){let l=s.length;this.decomposeRight(t,s),S1(s,l)}return Mi.of(s)}decomposeLeft(e,t){let i=this.left.length;if(e<=i)return this.left.decomposeLeft(e,t);t.push(this.left),this.break&&(i++,e>=i&&t.push(null)),e>i&&this.right.decomposeLeft(e-i,t)}decomposeRight(e,t){let i=this.left.length,r=i+this.break;if(e>=r)return this.right.decomposeRight(e-r,t);e<i&&this.left.decomposeRight(e,t),this.break&&e<r&&t.push(null),t.push(this.right)}balanced(e,t){return e.size>2*t.size||t.size>2*e.size?Mi.of(this.break?[e,null,t]:[e,t]):(this.left=e,this.right=t,this.height=e.height+t.height,this.outdated=e.outdated||t.outdated,this.size=e.size+t.size,this.length=e.length+this.break+t.length,this)}updateHeight(e,t=0,i=!1,r){let{left:s,right:o}=this,l=t+s.length+this.break,a=null;return r&&r.from<=t+s.length&&r.more?a=s=s.updateHeight(e,t,i,r):s.updateHeight(e,t,i),r&&r.from<=l+o.length&&r.more?a=o=o.updateHeight(e,l,i,r):o.updateHeight(e,l,i),a?this.balanced(s,o):(this.height=this.left.height+this.right.height,this.outdated=!1,this)}toString(){return this.left+(this.break?" ":"-")+this.right}}function S1(n,e){let t,i;n[e]==null&&(t=n[e-1])instanceof ai&&(i=n[e+1])instanceof ai&&n.splice(e-1,3,new ai(t.length+1+i.length))}const PL=5;class Vp{constructor(e,t){this.pos=e,this.oracle=t,this.nodes=[],this.lineStart=-1,this.lineEnd=-1,this.covering=null,this.writtenTo=e}get isCovered(){return this.covering&&this.nodes[this.nodes.length-1]==this.covering}span(e,t){if(this.lineStart>-1){let i=Math.min(t,this.lineEnd),r=this.nodes[this.nodes.length-1];r instanceof nn?r.length+=i-this.pos:(i>this.pos||!this.isCovered)&&this.nodes.push(new nn(i-this.pos,-1)),this.writtenTo=i,t>i&&(this.nodes.push(null),this.writtenTo++,this.lineStart=-1)}this.pos=t}point(e,t,i){if(e<t||i.heightRelevant){let r=i.widget?i.widget.estimatedHeight:0;r<0&&(r=this.oracle.lineHeight);let s=t-e;i.block?this.addBlock(new x1(s,r,i.type)):(s||r>=PL)&&this.addLineDeco(r,s)}else t>e&&this.span(e,t);this.lineEnd>-1&&this.lineEnd<this.pos&&(this.lineEnd=this.oracle.doc.lineAt(this.pos).to)}enterLine(){if(this.lineStart>-1)return;let{from:e,to:t}=this.oracle.doc.lineAt(this.pos);this.lineStart=e,this.lineEnd=t,this.writtenTo<e&&((this.writtenTo<e-1||this.nodes[this.nodes.length-1]==null)&&this.nodes.push(this.blankContent(this.writtenTo,e-1)),this.nodes.push(null)),this.pos>e&&this.nodes.push(new nn(this.pos-e,-1)),this.writtenTo=this.pos}blankContent(e,t){let i=new ai(t-e);return this.oracle.doc.lineAt(e).to==t&&(i.flags|=4),i}ensureLine(){this.enterLine();let e=this.nodes.length?this.nodes[this.nodes.length-1]:null;if(e instanceof nn)return e;let t=new nn(0,-1);return this.nodes.push(t),t}addBlock(e){this.enterLine(),e.type==ft.WidgetAfter&&!this.isCovered&&this.ensureLine(),this.nodes.push(e),this.writtenTo=this.pos=this.pos+e.length,e.type!=ft.WidgetBefore&&(this.covering=e)}addLineDeco(e,t){let i=this.ensureLine();i.length+=t,i.collapsed+=t,i.widgetHeight=Math.max(i.widgetHeight,e),this.writtenTo=this.pos=this.pos+t}finish(e){let t=this.nodes.length==0?null:this.nodes[this.nodes.length-1];this.lineStart>-1&&!(t instanceof nn)&&!this.isCovered?this.nodes.push(new nn(0,-1)):(this.writtenTo<this.pos||t==null)&&this.nodes.push(this.blankContent(this.writtenTo,this.pos));let i=e;for(let r of this.nodes)r instanceof nn&&r.updateHeight(this.oracle,i),i+=r?r.length:1;return this.nodes}static build(e,t,i,r){let s=new Vp(i,e);return Te.spans(t,i,r,s,0),s.finish(i)}}function BL(n,e,t){let i=new RL;return Te.compare(n,e,t,i,0),i.changes}class RL{constructor(){this.changes=[]}compareRange(){}comparePoint(e,t,i,r){(e<t||i&&i.heightRelevant||r&&r.heightRelevant)&&_p(e,t,this.changes,5)}}function LL(n,e){let t=n.getBoundingClientRect(),i=Math.max(0,t.left),r=Math.min(innerWidth,t.right),s=Math.max(0,t.top),o=Math.min(innerHeight,t.bottom),l=n.ownerDocument.body;for(let a=n.parentNode;a&&a!=l;)if(a.nodeType==1){let h=a,c=window.getComputedStyle(h);if((h.scrollHeight>h.clientHeight||h.scrollWidth>h.clientWidth)&&c.overflow!="visible"){let u=h.getBoundingClientRect();i=Math.max(i,u.left),r=Math.min(r,u.right),s=Math.max(s,u.top),o=Math.min(o,u.bottom)}a=c.position=="absolute"||c.position=="fixed"?h.offsetParent:h.parentNode}else if(a.nodeType==11)a=a.host;else break;return{left:i-t.left,right:Math.max(i,r)-t.left,top:s-(t.top+e),bottom:Math.max(s,o)-(t.top+e)}}function FL(n,e){let t=n.getBoundingClientRect();return{left:0,right:t.right-t.left,top:e,bottom:t.bottom-(t.top+e)}}class Hp{constructor(e,t,i){this.from=e,this.to=t,this.size=i}static same(e,t){if(e.length!=t.length)return!1;for(let i=0;i<e.length;i++){let r=e[i],s=t[i];if(r.from!=s.from||r.to!=s.to||r.size!=s.size)return!1}return!0}draw(e){return ht.replace({widget:new NL(this.size,e)}).range(this.from,this.to)}}class NL extends yc{constructor(e,t){super(),this.size=e,this.vertical=t}eq(e){return e.size==this.size&&e.vertical==this.vertical}toDOM(){let e=document.createElement("div");return this.vertical?e.style.height=this.size+"px":(e.style.width=this.size+"px",e.style.height="2px",e.style.display="inline-block"),e}get estimatedHeight(){return this.vertical?this.size:-1}}class k1{constructor(e){this.state=e,this.pixelViewport={left:0,right:window.innerWidth,top:0,bottom:0},this.inView=!0,this.paddingTop=0,this.paddingBottom=0,this.contentDOMWidth=0,this.contentDOMHeight=0,this.editorHeight=0,this.editorWidth=0,this.heightOracle=new w1,this.scaler=O1,this.scrollTarget=null,this.printing=!1,this.mustMeasureContent=!0,this.visibleRanges=[],this.mustEnforceCursorAssoc=!1,this.heightMap=Mi.empty().applyChanges(e.facet(Zs),j.empty,this.heightOracle.setDoc(e.doc),[new Hn(0,0,0,e.doc.length)]),this.viewport=this.getViewport(0,null),this.updateViewportLines(),this.updateForViewport(),this.lineGaps=this.ensureLineGaps([]),this.lineGapDeco=ht.set(this.lineGaps.map(t=>t.draw(!1))),this.computeVisibleRanges()}updateForViewport(){let e=[this.viewport],{main:t}=this.state.selection;for(let i=0;i<=1;i++){let r=i?t.head:t.anchor;if(!e.some(({from:s,to:o})=>r>=s&&r<=o)){let{from:s,to:o}=this.lineBlockAt(r);e.push(new xc(s,o))}}this.viewports=e.sort((i,r)=>i.from-r.from),this.scaler=this.heightMap.height<=7e6?O1:new VL(this.heightOracle.doc,this.heightMap,this.viewports)}updateViewportLines(){this.viewportLines=[],this.heightMap.forEachLine(this.viewport.from,this.viewport.to,this.state.doc,0,0,e=>{this.viewportLines.push(this.scaler.scale==1?e:la(e,this.scaler))})}update(e,t=null){let i=this.state;this.state=e.state;let r=this.state.facet(Zs),s=e.changedRanges,o=Hn.extendWithRanges(s,BL(e.startState.facet(Zs),r,e?e.changes:si.empty(this.state.doc.length))),l=this.heightMap.height;this.heightMap=this.heightMap.applyChanges(r,i.doc,this.heightOracle.setDoc(this.state.doc),o),this.heightMap.height!=l&&(e.flags|=2);let a=o.length?this.mapViewport(this.viewport,e.changes):this.viewport;(t&&(t.range.head<a.from||t.range.head>a.to)||!this.viewportIsAppropriate(a))&&(a=this.getViewport(0,t));let h=!e.changes.empty||e.flags&2||a.from!=this.viewport.from||a.to!=this.viewport.to;this.viewport=a,this.updateForViewport(),h&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(this.mapLineGaps(this.lineGaps,e.changes))),e.flags|=this.computeVisibleRanges(),t&&(this.scrollTarget=t),!this.mustEnforceCursorAssoc&&e.selectionSet&&e.view.lineWrapping&&e.state.selection.main.empty&&e.state.selection.main.assoc&&(this.mustEnforceCursorAssoc=!0)}measure(e){let t=e.contentDOM,i=window.getComputedStyle(t),r=this.heightOracle,s=i.whiteSpace,o=i.direction=="rtl"?vi.RTL:vi.LTR,l=this.heightOracle.mustRefreshForStyle(s,o),a=l||this.mustMeasureContent||this.contentDOMHeight!=t.clientHeight,h=0,c=0;if(this.editorWidth!=e.scrollDOM.clientWidth&&(r.lineWrapping&&(a=!0),this.editorWidth=e.scrollDOM.clientWidth,h|=8),a){this.mustMeasureContent=!1,this.contentDOMHeight=t.clientHeight;let v=parseInt(i.paddingTop)||0,C=parseInt(i.paddingBottom)||0;(this.paddingTop!=v||this.paddingBottom!=C)&&(h|=8,this.paddingTop=v,this.paddingBottom=C)}let u=(this.printing?FL:LL)(t,this.paddingTop),f=u.top-this.pixelViewport.top,d=u.bottom-this.pixelViewport.bottom;this.pixelViewport=u;let p=this.pixelViewport.bottom>this.pixelViewport.top&&this.pixelViewport.right>this.pixelViewport.left;if(p!=this.inView&&(this.inView=p,p&&(a=!0)),!this.inView)return 0;let g=t.clientWidth;if((this.contentDOMWidth!=g||this.editorHeight!=e.scrollDOM.clientHeight)&&(this.contentDOMWidth=g,this.editorHeight=e.scrollDOM.clientHeight,h|=8),a){let v=e.docView.measureVisibleLineHeights();if(r.mustRefreshForHeights(v)&&(l=!0),l||r.lineWrapping&&Math.abs(g-this.contentDOMWidth)>r.charWidth){let{lineHeight:C,charWidth:x}=e.docView.measureTextSize();l=r.refresh(s,o,C,x,g/x,v),l&&(e.docView.minWidth=0,h|=8)}f>0&&d>0?c=Math.max(f,d):f<0&&d<0&&(c=Math.min(f,d)),r.heightChanged=!1,this.heightMap=this.heightMap.updateHeight(r,0,l,new b1(this.viewport.from,v)),r.heightChanged&&(h|=2)}let y=!this.viewportIsAppropriate(this.viewport,c)||this.scrollTarget&&(this.scrollTarget.range.head<this.viewport.from||this.scrollTarget.range.head>this.viewport.to);return y&&(this.viewport=this.getViewport(c,this.scrollTarget)),this.updateForViewport(),(h&2||y)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(l?[]:this.lineGaps)),h|=this.computeVisibleRanges(),this.mustEnforceCursorAssoc&&(this.mustEnforceCursorAssoc=!1,e.docView.enforceCursorAssoc()),h}get visibleTop(){return this.scaler.fromDOM(this.pixelViewport.top)}get visibleBottom(){return this.scaler.fromDOM(this.pixelViewport.bottom)}getViewport(e,t){let i=.5-Math.max(-.5,Math.min(.5,e/1e3/2)),r=this.heightMap,s=this.state.doc,{visibleTop:o,visibleBottom:l}=this,a=new xc(r.lineAt(o-i*1e3,Qe.ByHeight,s,0,0).from,r.lineAt(l+(1-i)*1e3,Qe.ByHeight,s,0,0).to);if(t){let{head:h}=t.range;if(h<a.from||h>a.to){let c=Math.min(this.editorHeight,this.pixelViewport.bottom-this.pixelViewport.top),u=r.lineAt(h,Qe.ByPos,s,0,0),f;t.y=="center"?f=(u.top+u.bottom)/2-c/2:t.y=="start"||t.y=="nearest"&&h<a.from?f=u.top:f=u.bottom-c,a=new xc(r.lineAt(f-1e3/2,Qe.ByHeight,s,0,0).from,r.lineAt(f+c+1e3/2,Qe.ByHeight,s,0,0).to)}}return a}mapViewport(e,t){let i=t.mapPos(e.from,-1),r=t.mapPos(e.to,1);return new xc(this.heightMap.lineAt(i,Qe.ByPos,this.state.doc,0,0).from,this.heightMap.lineAt(r,Qe.ByPos,this.state.doc,0,0).to)}viewportIsAppropriate({from:e,to:t},i=0){if(!this.inView)return!0;let{top:r}=this.heightMap.lineAt(e,Qe.ByPos,this.state.doc,0,0),{bottom:s}=this.heightMap.lineAt(t,Qe.ByPos,this.state.doc,0,0),{visibleTop:o,visibleBottom:l}=this;return(e==0||r<=o-Math.max(10,Math.min(-i,250)))&&(t==this.state.doc.length||s>=l+Math.max(10,Math.min(i,250)))&&r>o-2*1e3&&s<l+2*1e3}mapLineGaps(e,t){if(!e.length||t.empty)return e;let i=[];for(let r of e)t.touchesRange(r.from,r.to)||i.push(new Hp(t.mapPos(r.from),t.mapPos(r.to),r.size));return i}ensureLineGaps(e){let t=[];if(this.heightOracle.direction!=vi.LTR)return t;for(let i of this.viewportLines){if(i.length<4e3)continue;let r=IL(i.from,i.to,this.state);if(r.total<4e3)continue;let s,o;if(this.heightOracle.lineWrapping){let h=2e3/this.heightOracle.lineLength*this.heightOracle.lineHeight;s=Sc(r,(this.visibleTop-i.top-h)/i.height),o=Sc(r,(this.visibleBottom-i.top+h)/i.height)}else{let h=r.total*this.heightOracle.charWidth,c=2e3*this.heightOracle.charWidth;s=Sc(r,(this.pixelViewport.left-c)/h),o=Sc(r,(this.pixelViewport.right+c)/h)}let l=[];s>i.from&&l.push({from:i.from,to:s}),o<i.to&&l.push({from:o,to:i.to});let a=this.state.selection.main;a.from>=i.from&&a.from<=i.to&&A1(l,a.from-10,a.from+10),!a.empty&&a.to>=i.from&&a.to<=i.to&&A1(l,a.to-10,a.to+10);for(let{from:h,to:c}of l)c-h>1e3&&t.push(WL(e,u=>u.from>=i.from&&u.to<=i.to&&Math.abs(u.from-h)<1e3&&Math.abs(u.to-c)<1e3)||new Hp(h,c,this.gapSize(i,h,c,r)))}return t}gapSize(e,t,i,r){let s=C1(r,i)-C1(r,t);return this.heightOracle.lineWrapping?e.height*s:r.total*this.heightOracle.charWidth*s}updateLineGaps(e){Hp.same(e,this.lineGaps)||(this.lineGaps=e,this.lineGapDeco=ht.set(e.map(t=>t.draw(this.heightOracle.lineWrapping))))}computeVisibleRanges(){let e=this.state.facet(Zs);this.lineGaps.length&&(e=e.concat(this.lineGapDeco));let t=[];Te.spans(e,this.viewport.from,this.viewport.to,{span(r,s){t.push({from:r,to:s})},point(){}},20);let i=t.length!=this.visibleRanges.length||this.visibleRanges.some((r,s)=>r.from!=t[s].from||r.to!=t[s].to);return this.visibleRanges=t,i?4:0}lineBlockAt(e){return e>=this.viewport.from&&e<=this.viewport.to&&this.viewportLines.find(t=>t.from<=e&&t.to>=e)||la(this.heightMap.lineAt(e,Qe.ByPos,this.state.doc,0,0),this.scaler)}lineBlockAtHeight(e){return la(this.heightMap.lineAt(this.scaler.fromDOM(e),Qe.ByHeight,this.state.doc,0,0),this.scaler)}elementAtHeight(e){return la(this.heightMap.blockAt(this.scaler.fromDOM(e),this.state.doc,0,0),this.scaler)}get docHeight(){return this.scaler.toDOM(this.heightMap.height)}get contentHeight(){return this.docHeight+this.paddingTop+this.paddingBottom}}class xc{constructor(e,t){this.from=e,this.to=t}}function IL(n,e,t){let i=[],r=n,s=0;return Te.spans(t.facet(Zs),n,e,{span(){},point(o,l){o>r&&(i.push({from:r,to:o}),s+=o-r),r=l}},20),r<e&&(i.push({from:r,to:e}),s+=e-r),{total:s,ranges:i}}function Sc({total:n,ranges:e},t){if(t<=0)return e[0].from;if(t>=1)return e[e.length-1].to;let i=Math.floor(n*t);for(let r=0;;r++){let{from:s,to:o}=e[r],l=o-s;if(i<=l)return s+i;i-=l}}function C1(n,e){let t=0;for(let{from:i,to:r}of n.ranges){if(e<=r){t+=e-i;break}t+=r-i}return t/n.total}function A1(n,e,t){for(let i=0;i<n.length;i++){let r=n[i];if(r.from<t&&r.to>e){let s=[];r.from<e&&s.push({from:r.from,to:e}),r.to>t&&s.push({from:t,to:r.to}),n.splice(i,1,...s),i+=s.length-1}}}function WL(n,e){for(let t of n)if(e(t))return t}const O1={toDOM(n){return n},fromDOM(n){return n},scale:1};class VL{constructor(e,t,i){let r=0,s=0,o=0;this.viewports=i.map(({from:l,to:a})=>{let h=t.lineAt(l,Qe.ByPos,e,0,0).top,c=t.lineAt(a,Qe.ByPos,e,0,0).bottom;return r+=c-h,{from:l,to:a,top:h,bottom:c,domTop:0,domBottom:0}}),this.scale=(7e6-r)/(t.height-r);for(let l of this.viewports)l.domTop=o+(l.top-s)*this.scale,o=l.domBottom=l.domTop+(l.bottom-l.top),s=l.bottom}toDOM(e){for(let t=0,i=0,r=0;;t++){let s=t<this.viewports.length?this.viewports[t]:null;if(!s||e<s.top)return r+(e-i)*this.scale;if(e<=s.bottom)return s.domTop+(e-s.top);i=s.bottom,r=s.domBottom}}fromDOM(e){for(let t=0,i=0,r=0;;t++){let s=t<this.viewports.length?this.viewports[t]:null;if(!s||e<s.domTop)return i+(e-r)/this.scale;if(e<=s.domBottom)return s.top+(e-s.domTop);i=s.bottom,r=s.domBottom}}}function la(n,e){if(e.scale==1)return n;let t=e.toDOM(n.top),i=e.toDOM(n.bottom);return new Ar(n.from,n.length,t,i-t,Array.isArray(n.type)?n.type.map(r=>la(r,e)):n.type)}const kc=Ie.define({combine:n=>n.join(" ")}),zp=Ie.define({combine:n=>n.indexOf(!0)>-1}),jp=Ue.newName(),_1=Ue.newName(),D1=Ue.newName(),M1={"&light":"."+_1,"&dark":"."+D1};function $p(n,e,t){return new Ue(e,{finish(i){return/&/.test(i)?i.replace(/&\w*/,r=>{if(r=="&")return n;if(!t||!t[r])throw new RangeError(`Unsupported selector: ${r}`);return t[r]}):n+" "+i}})}const HL=$p("."+jp,{"&.cm-editor":{position:"relative !important",boxSizing:"border-box","&.cm-focused":{outline:"1px dotted #212121"},display:"flex !important",flexDirection:"column"},".cm-scroller":{display:"flex !important",alignItems:"flex-start !important",fontFamily:"monospace",lineHeight:1.4,height:"100%",overflowX:"auto",position:"relative",zIndex:0},".cm-content":{margin:0,flexGrow:2,minHeight:"100%",display:"block",whiteSpace:"pre",wordWrap:"normal",boxSizing:"border-box",padding:"4px 0",outline:"none","&[contenteditable=true]":{WebkitUserModify:"read-write-plaintext-only"}},".cm-lineWrapping":{whiteSpace_fallback:"pre-wrap",whiteSpace:"break-spaces",wordBreak:"break-word",overflowWrap:"anywhere"},"&light .cm-content":{caretColor:"black"},"&dark .cm-content":{caretColor:"white"},".cm-line":{display:"block",padding:"0 2px 0 4px"},".cm-selectionLayer":{zIndex:-1,contain:"size style"},".cm-selectionBackground":{position:"absolute"},"&light .cm-selectionBackground":{background:"#d9d9d9"},"&dark .cm-selectionBackground":{background:"#222"},"&light.cm-focused .cm-selectionBackground":{background:"#d7d4f0"},"&dark.cm-focused .cm-selectionBackground":{background:"#233"},".cm-cursorLayer":{zIndex:100,contain:"size style",pointerEvents:"none"},"&.cm-focused .cm-cursorLayer":{animation:"steps(1) cm-blink 1.2s infinite"},"@keyframes cm-blink":{"0%":{},"50%":{visibility:"hidden"},"100%":{}},"@keyframes cm-blink2":{"0%":{},"50%":{visibility:"hidden"},"100%":{}},".cm-cursor, .cm-dropCursor":{position:"absolute",borderLeft:"1.2px solid black",marginLeft:"-0.6px",pointerEvents:"none"},".cm-cursor":{display:"none"},"&dark .cm-cursor":{borderLeftColor:"#444"},"&.cm-focused .cm-cursor":{display:"block"},"&light .cm-activeLine":{backgroundColor:"#f3f9ff"},"&dark .cm-activeLine":{backgroundColor:"#223039"},"&light .cm-specialChar":{color:"red"},"&dark .cm-specialChar":{color:"#f78"},".cm-tab":{display:"inline-block",overflow:"hidden",verticalAlign:"bottom"},".cm-widgetBuffer":{verticalAlign:"text-top",height:"1em",display:"inline"},".cm-placeholder":{color:"#888",display:"inline-block",verticalAlign:"top"},".cm-button":{verticalAlign:"middle",color:"inherit",fontSize:"70%",padding:".2em 1em",borderRadius:"1px"},"&light .cm-button":{backgroundImage:"linear-gradient(#eff1f5, #d9d9df)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#b4b4b4, #d0d3d6)"}},"&dark .cm-button":{backgroundImage:"linear-gradient(#393939, #111)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#111, #333)"}},".cm-textfield":{verticalAlign:"middle",color:"inherit",fontSize:"70%",border:"1px solid silver",padding:".2em .5em"},"&light .cm-textfield":{backgroundColor:"white"},"&dark .cm-textfield":{border:"1px solid #555",backgroundColor:"inherit"}},M1),zL={childList:!0,characterData:!0,subtree:!0,attributes:!0,characterDataOldValue:!0},Up=pe.ie&&pe.ie_version<=11;class jL{constructor(e,t,i){this.view=e,this.onChange=t,this.onScrollChanged=i,this.active=!1,this.selectionRange=new KR,this.selectionChanged=!1,this.delayedFlush=-1,this.resizeTimeout=-1,this.queue=[],this.delayedAndroidKey=null,this.scrollTargets=[],this.intersection=null,this.resize=null,this.intersecting=!1,this.gapIntersection=null,this.gaps=[],this.parentCheck=-1,this.dom=e.contentDOM,this.observer=new MutationObserver(r=>{for(let s of r)this.queue.push(s);(pe.ie&&pe.ie_version<=11||pe.ios&&e.composing)&&r.some(s=>s.type=="childList"&&s.removedNodes.length||s.type=="characterData"&&s.oldValue.length>s.target.nodeValue.length)?this.flushSoon():this.flush()}),Up&&(this.onCharData=r=>{this.queue.push({target:r.target,type:"characterData",oldValue:r.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this),window.addEventListener("resize",this.onResize=this.onResize.bind(this)),typeof ResizeObserver=="function"&&(this.resize=new ResizeObserver(()=>{this.view.docView.lastUpdate<Date.now()-75&&this.onResize()}),this.resize.observe(e.scrollDOM)),window.addEventListener("beforeprint",this.onPrint=this.onPrint.bind(this)),this.start(),window.addEventListener("scroll",this.onScroll=this.onScroll.bind(this)),typeof IntersectionObserver=="function"&&(this.intersection=new IntersectionObserver(r=>{this.parentCheck<0&&(this.parentCheck=setTimeout(this.listenForScroll.bind(this),1e3)),r.length>0&&r[r.length-1].intersectionRatio>0!=this.intersecting&&(this.intersecting=!this.intersecting,this.intersecting!=this.view.inView&&this.onScrollChanged(document.createEvent("Event")))},{}),this.intersection.observe(this.dom),this.gapIntersection=new IntersectionObserver(r=>{r.length>0&&r[r.length-1].intersectionRatio>0&&this.onScrollChanged(document.createEvent("Event"))},{})),this.listenForScroll(),this.readSelectionRange(),this.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}onScroll(e){this.intersecting&&this.flush(!1),this.onScrollChanged(e)}onResize(){this.resizeTimeout<0&&(this.resizeTimeout=setTimeout(()=>{this.resizeTimeout=-1,this.view.requestMeasure()},50))}onPrint(){this.view.viewState.printing=!0,this.view.measure(),setTimeout(()=>{this.view.viewState.printing=!1,this.view.requestMeasure()},500)}updateGaps(e){if(this.gapIntersection&&(e.length!=this.gaps.length||this.gaps.some((t,i)=>t!=e[i]))){this.gapIntersection.disconnect();for(let t of e)this.gapIntersection.observe(t);this.gaps=e}}onSelectionChange(e){if(!this.readSelectionRange()||this.delayedAndroidKey)return;let{view:t}=this,i=this.selectionRange;if(t.state.facet(ra)?t.root.activeElement!=this.dom:!mp(t.dom,i))return;let r=i.anchorNode&&t.docView.nearest(i.anchorNode);r&&r.ignoreEvent(e)||((pe.ie&&pe.ie_version<=11||pe.android&&pe.chrome)&&!t.state.selection.main.empty&&i.focusNode&&dc(i.focusNode,i.focusOffset,i.anchorNode,i.anchorOffset)?this.flushSoon():this.flush(!1))}readSelectionRange(){let{root:e}=this.view,t=fc(e),i=pe.safari&&e.nodeType==11&&$R()==this.view.contentDOM&&$L(this.view)||t;return this.selectionRange.eq(i)?!1:(this.selectionRange.setRange(i),this.selectionChanged=!0)}setSelectionRange(e,t){this.selectionRange.set(e.node,e.offset,t.node,t.offset),this.selectionChanged=!1}listenForScroll(){this.parentCheck=-1;let e=0,t=null;for(let i=this.dom;i;)if(i.nodeType==1)!t&&e<this.scrollTargets.length&&this.scrollTargets[e]==i?e++:t||(t=this.scrollTargets.slice(0,e)),t&&t.push(i),i=i.assignedSlot||i.parentNode;else if(i.nodeType==11)i=i.host;else break;if(e<this.scrollTargets.length&&!t&&(t=this.scrollTargets.slice(0,e)),t){for(let i of this.scrollTargets)i.removeEventListener("scroll",this.onScroll);for(let i of this.scrollTargets=t)i.addEventListener("scroll",this.onScroll)}}ignore(e){if(!this.active)return e();try{return this.stop(),e()}finally{this.start(),this.clear()}}start(){this.active||(this.observer.observe(this.dom,zL),Up&&this.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.active=!0)}stop(){!this.active||(this.active=!1,this.observer.disconnect(),Up&&this.dom.removeEventListener("DOMCharacterDataModified",this.onCharData))}clear(){this.processRecords(),this.queue.length=0,this.selectionChanged=!1}delayAndroidKey(e,t){this.delayedAndroidKey||requestAnimationFrame(()=>{let i=this.delayedAndroidKey;this.delayedAndroidKey=null;let r=this.view.state;ia(this.view.contentDOM,i.key,i.keyCode)?this.processRecords():this.flush(),this.view.state==r&&this.view.update([])}),(!this.delayedAndroidKey||e=="Enter")&&(this.delayedAndroidKey={key:e,keyCode:t})}flushSoon(){this.delayedFlush<0&&(this.delayedFlush=window.setTimeout(()=>{this.delayedFlush=-1,this.flush()},20))}forceFlush(){this.delayedFlush>=0&&(window.clearTimeout(this.delayedFlush),this.delayedFlush=-1,this.flush())}processRecords(){let e=this.queue;for(let s of this.observer.takeRecords())e.push(s);e.length&&(this.queue=[]);let t=-1,i=-1,r=!1;for(let s of e){let o=this.readMutation(s);!o||(o.typeOver&&(r=!0),t==-1?{from:t,to:i}=o:(t=Math.min(o.from,t),i=Math.max(o.to,i)))}return{from:t,to:i,typeOver:r}}flush(e=!0){if(this.delayedFlush>=0||this.delayedAndroidKey)return;e&&this.readSelectionRange();let{from:t,to:i,typeOver:r}=this.processRecords(),s=this.selectionChanged&&mp(this.dom,this.selectionRange);if(t<0&&!s)return;this.selectionChanged=!1;let o=this.view.state;this.onChange(t,i,r),this.view.state==o&&this.view.update([])}readMutation(e){let t=this.view.docView.nearest(e.target);if(!t||t.ignoreMutation(e))return null;if(t.markDirty(e.type=="attributes"),e.type=="attributes"&&(t.dirty|=4),e.type=="childList"){let i=E1(t,e.previousSibling||e.target.previousSibling,-1),r=E1(t,e.nextSibling||e.target.nextSibling,1);return{from:i?t.posAfter(i):t.posAtStart,to:r?t.posBefore(r):t.posAtEnd,typeOver:!1}}else return e.type=="characterData"?{from:t.posAtStart,to:t.posAtEnd,typeOver:e.target.nodeValue==e.oldValue}:null}destroy(){var e,t,i;this.stop(),(e=this.intersection)===null||e===void 0||e.disconnect(),(t=this.gapIntersection)===null||t===void 0||t.disconnect(),(i=this.resize)===null||i===void 0||i.disconnect();for(let r of this.scrollTargets)r.removeEventListener("scroll",this.onScroll);window.removeEventListener("scroll",this.onScroll),window.removeEventListener("resize",this.onResize),window.removeEventListener("beforeprint",this.onPrint),this.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange),clearTimeout(this.parentCheck),clearTimeout(this.resizeTimeout)}}function E1(n,e,t){for(;e;){let i=_t.get(e);if(i&&i.parent==n)return i;let r=e.parentNode;e=r!=n.dom?r:t>0?e.nextSibling:e.previousSibling}return null}function $L(n){let e=null;function t(a){a.preventDefault(),a.stopImmediatePropagation(),e=a.getTargetRanges()[0]}if(n.contentDOM.addEventListener("beforeinput",t,!0),document.execCommand("indent"),n.contentDOM.removeEventListener("beforeinput",t,!0),!e)return null;let i=e.startContainer,r=e.startOffset,s=e.endContainer,o=e.endOffset,l=n.docView.domAtPos(n.state.selection.main.anchor);return dc(l.node,l.offset,s,o)&&([i,r,s,o]=[s,o,i,r]),{anchorNode:i,anchorOffset:r,focusNode:s,focusOffset:o}}function UL(n,e,t,i){let r,s,o=n.state.selection.main;if(e>-1){let l=n.docView.domBoundsAround(e,t,0);if(!l||n.state.readOnly)return;let{from:a,to:h}=l,c=n.docView.impreciseHead||n.docView.impreciseAnchor?[]:KL(n),u=new $b(c,n.state);u.readRange(l.startDOM,l.endDOM);let f=o.from,d=null;(n.inputState.lastKeyCode===8&&n.inputState.lastKeyTime>Date.now()-100||pe.android&&u.text.length<h-a)&&(f=o.to,d="end");let p=qL(n.state.doc.sliceString(a,h,is),u.text,f-a,d);p&&(pe.chrome&&n.inputState.lastKeyCode==13&&p.toB==p.from+2&&u.text.slice(p.from,p.toB)==is+is&&p.toB--,r={from:a+p.from,to:a+p.toA,insert:j.of(u.text.slice(p.from,p.toB).split(is))}),s=GL(c,a)}else if(n.hasFocus||!n.state.facet(ra)){let l=n.observer.selectionRange,{impreciseHead:a,impreciseAnchor:h}=n.docView,c=a&&a.node==l.focusNode&&a.offset==l.focusOffset||!Io(n.contentDOM,l.focusNode)?n.state.selection.main.head:n.docView.posFromDOM(l.focusNode,l.focusOffset),u=h&&h.node==l.anchorNode&&h.offset==l.anchorOffset||!Io(n.contentDOM,l.anchorNode)?n.state.selection.main.anchor:n.docView.posFromDOM(l.anchorNode,l.anchorOffset);(c!=o.head||u!=o.anchor)&&(s=we.single(u,c))}if(!(!r&&!s)){if(!r&&i&&!o.empty&&s&&s.main.empty?r={from:o.from,to:o.to,insert:n.state.doc.slice(o.from,o.to)}:r&&r.from>=o.from&&r.to<=o.to&&(r.from!=o.from||r.to!=o.to)&&o.to-o.from-(r.to-r.from)<=4&&(r={from:o.from,to:o.to,insert:n.state.doc.slice(o.from,r.from).append(r.insert).append(n.state.doc.slice(r.to,o.to))}),r){let l=n.state;if(pe.ios&&n.inputState.flushIOSKey(n)||pe.android&&(r.from==o.from&&r.to==o.to&&r.insert.length==1&&r.insert.lines==2&&ia(n.contentDOM,"Enter",13)||r.from==o.from-1&&r.to==o.to&&r.insert.length==0&&ia(n.contentDOM,"Backspace",8)||r.from==o.from&&r.to==o.to+1&&r.insert.length==0&&ia(n.contentDOM,"Delete",46)))return;let a=r.insert.toString();if(n.state.facet(Bb).some(u=>u(n,r.from,r.to,a)))return;n.inputState.composing>=0&&n.inputState.composing++;let h;if(r.from>=o.from&&r.to<=o.to&&r.to-r.from>=(o.to-o.from)/3&&(!s||s.main.empty&&s.main.from==r.from+r.insert.length)&&n.inputState.composing<0){let u=o.from<r.from?l.sliceDoc(o.from,r.from):"",f=o.to>r.to?l.sliceDoc(r.to,o.to):"";h=l.replaceSelection(n.state.toText(u+r.insert.sliceString(0,void 0,n.state.lineBreak)+f))}else{let u=l.changes(r),f=s&&!l.selection.main.eq(s.main)&&s.main.to<=u.newLength?s.main:void 0;if(l.selection.ranges.length>1&&n.inputState.composing>=0&&r.to<=o.to&&r.to>=o.to-10){let d=n.state.sliceDoc(r.from,r.to),p=Jb(n)||n.state.doc.lineAt(o.head),g=o.to-r.to,y=o.to-o.from;h=l.changeByRange(v=>{if(v.from==o.from&&v.to==o.to)return{changes:u,range:f||v.map(u)};let C=v.to-g,x=C-d.length;if(v.to-v.from!=y||n.state.sliceDoc(x,C)!=d||p&&v.to>=p.from&&v.from<=p.to)return{range:v};let b=l.changes({from:x,to:C,insert:r.insert}),S=v.to-o.to;return{changes:b,range:f?we.range(Math.max(0,f.anchor+S),Math.max(0,f.head+S)):v.map(b)}})}else h={changes:u,selection:f&&l.selection.replaceRange(f)}}let c="input.type";n.composing&&(c+=".compose",n.inputState.compositionFirstChange&&(c+=".start",n.inputState.compositionFirstChange=!1)),n.dispatch(h,{scrollIntoView:!0,userEvent:c})}else if(s&&!s.main.eq(o)){let l=!1,a="select";n.inputState.lastSelectionTime>Date.now()-50&&(n.inputState.lastSelectionOrigin=="select"&&(l=!0),a=n.inputState.lastSelectionOrigin),n.dispatch({selection:s,scrollIntoView:l,userEvent:a})}}}function qL(n,e,t,i){let r=Math.min(n.length,e.length),s=0;for(;s<r&&n.charCodeAt(s)==e.charCodeAt(s);)s++;if(s==r&&n.length==e.length)return null;let o=n.length,l=e.length;for(;o>0&&l>0&&n.charCodeAt(o-1)==e.charCodeAt(l-1);)o--,l--;if(i=="end"){let a=Math.max(0,s-Math.min(o,l));t-=o+a-s}return o<s&&n.length<e.length?(s-=t<=s&&t>=o?s-t:0,l=s+(l-o),o=s):l<s&&(s-=t<=s&&t>=l?s-t:0,o=s+(o-l),l=s),{from:s,toA:o,toB:l}}function KL(n){let e=[];if(n.root.activeElement!=n.contentDOM)return e;let{anchorNode:t,anchorOffset:i,focusNode:r,focusOffset:s}=n.observer.selectionRange;return t&&(e.push(new qb(t,i)),(r!=t||s!=i)&&e.push(new qb(r,s))),e}function GL(n,e){if(n.length==0)return null;let t=n[0].pos,i=n.length==2?n[1].pos:t;return t>-1&&i>-1?we.single(t+e,i+e):null}class Bt{constructor(e={}){this.plugins=[],this.pluginMap=new Map,this.editorAttrs={},this.contentAttrs={},this.bidiCache=[],this.destroyed=!1,this.updateState=2,this.measureScheduled=-1,this.measureRequests=[],this.contentDOM=document.createElement("div"),this.scrollDOM=document.createElement("div"),this.scrollDOM.tabIndex=-1,this.scrollDOM.className="cm-scroller",this.scrollDOM.appendChild(this.contentDOM),this.announceDOM=document.createElement("div"),this.announceDOM.style.cssText="position: absolute; top: -10000px",this.announceDOM.setAttribute("aria-live","polite"),this.dom=document.createElement("div"),this.dom.appendChild(this.announceDOM),this.dom.appendChild(this.scrollDOM),this._dispatch=e.dispatch||(t=>this.update([t])),this.dispatch=this.dispatch.bind(this),this.root=e.root||GR(e.parent)||document,this.viewState=new k1(e.state||at.create()),this.plugins=this.state.facet(sa).map(t=>new Tp(t));for(let t of this.plugins)t.update(this);this.observer=new jL(this,(t,i,r)=>{UL(this,t,i,r)},t=>{this.inputState.runScrollHandlers(this,t),this.observer.intersecting&&this.measure()}),this.inputState=new bL(this),this.docView=new Kb(this),this.mountStyles(),this.updateAttrs(),this.updateState=0,this.requestMeasure(),e.parent&&e.parent.appendChild(this.dom)}get state(){return this.viewState.state}get viewport(){return this.viewState.viewport}get visibleRanges(){return this.viewState.visibleRanges}get inView(){return this.viewState.inView}get composing(){return this.inputState.composing>0}get compositionStarted(){return this.inputState.composing>=0}dispatch(...e){this._dispatch(e.length==1&&e[0]instanceof Ci?e[0]:this.state.update(...e))}update(e){if(this.updateState!=0)throw new Error("Calls to EditorView.update are not allowed while an update is in progress");let t=!1,i,r=this.state;for(let o of e){if(o.startState!=r)throw new RangeError("Trying to update state with a transaction that doesn't start from the previous state.");r=o.state}if(this.destroyed){this.viewState.state=r;return}if(r.facet(at.phrases)!=this.state.facet(at.phrases))return this.setState(r);i=new Ib(this,r,e);let s=this.viewState.scrollTarget;try{this.updateState=2;for(let o of e){if(s&&(s=s.map(o.changes)),o.scrollIntoView){let{main:l}=o.state.selection;s=new Ho(l.empty?l:we.cursor(l.head,l.head>l.anchor?-1:1))}for(let l of o.effects)l.is(Ep)?s=new Ho(l.value):l.is(Rb)?s=new Ho(l.value,"center"):l.is(Lb)&&(s=l.value)}this.viewState.update(i,s),this.bidiCache=Cc.update(this.bidiCache,i.changes),i.empty||(this.updatePlugins(i),this.inputState.update(i)),t=this.docView.update(i),this.state.facet(oa)!=this.styleModules&&this.mountStyles(),this.updateAttrs(),this.showAnnouncements(e),this.docView.updateSelection(t,e.some(o=>o.isUserEvent("select.pointer")))}finally{this.updateState=0}if(i.startState.facet(kc)!=i.state.facet(kc)&&(this.viewState.mustMeasureContent=!0),(t||s||this.viewState.mustEnforceCursorAssoc||this.viewState.mustMeasureContent)&&this.requestMeasure(),!i.empty)for(let o of this.state.facet(Mp))o(i)}setState(e){if(this.updateState!=0)throw new Error("Calls to EditorView.setState are not allowed while an update is in progress");if(this.destroyed){this.viewState.state=e;return}this.updateState=2;let t=this.hasFocus;try{for(let i of this.plugins)i.destroy(this);this.viewState=new k1(e),this.plugins=e.facet(sa).map(i=>new Tp(i)),this.pluginMap.clear();for(let i of this.plugins)i.update(this);this.docView=new Kb(this),this.inputState.ensureHandlers(this),this.mountStyles(),this.updateAttrs(),this.bidiCache=[]}finally{this.updateState=0}t&&this.focus(),this.requestMeasure()}updatePlugins(e){let t=e.startState.facet(sa),i=e.state.facet(sa);if(t!=i){let r=[];for(let s of i){let o=t.indexOf(s);if(o<0)r.push(new Tp(s));else{let l=this.plugins[o];l.mustUpdate=e,r.push(l)}}for(let s of this.plugins)s.mustUpdate!=e&&s.destroy(this);this.plugins=r,this.pluginMap.clear(),this.inputState.ensureHandlers(this)}else for(let r of this.plugins)r.mustUpdate=e;for(let r=0;r<this.plugins.length;r++)this.plugins[r].update(this)}measure(e=!0){if(this.destroyed)return;this.measureScheduled>-1&&cancelAnimationFrame(this.measureScheduled),this.measureScheduled=0,e&&this.observer.flush();let t=null;try{for(let i=0;;i++){this.updateState=1;let r=this.viewport,s=this.viewState.measure(this);if(!s&&!this.measureRequests.length&&this.viewState.scrollTarget==null)break;if(i>5){console.warn(this.measureRequests.length?"Measure loop restarted more than 5 times":"Viewport failed to stabilize");break}let o=[];s&4||([this.measureRequests,o]=[o,this.measureRequests]);let l=o.map(u=>{try{return u.read(this)}catch(f){return Js(this.state,f),T1}}),a=new Ib(this,this.state),h=!1,c=!1;a.flags|=s,t?t.flags|=s:t=a,this.updateState=2,a.empty||(this.updatePlugins(a),this.inputState.update(a),this.updateAttrs(),h=this.docView.update(a));for(let u=0;u<o.length;u++)if(l[u]!=T1)try{let f=o[u];f.write&&f.write(l[u],this)}catch(f){Js(this.state,f)}if(this.viewState.scrollTarget&&(this.docView.scrollIntoView(this.viewState.scrollTarget),this.viewState.scrollTarget=null,c=!0),h&&this.docView.updateSelection(!0),this.viewport.from==r.from&&this.viewport.to==r.to&&!c&&this.measureRequests.length==0)break}}finally{this.updateState=0,this.measureScheduled=-1}if(t&&!t.empty)for(let i of this.state.facet(Mp))i(t)}get themeClasses(){return jp+" "+(this.state.facet(zp)?D1:_1)+" "+this.state.facet(kc)}updateAttrs(){let e=P1(this,Nb,{class:"cm-editor"+(this.hasFocus?" cm-focused ":" ")+this.themeClasses}),t={spellcheck:"false",autocorrect:"off",autocapitalize:"off",translate:"no",contenteditable:this.state.facet(ra)?"true":"false",class:"cm-content",style:`${pe.tabSize}: ${this.state.tabSize}`,role:"textbox","aria-multiline":"true"};this.state.readOnly&&(t["aria-readonly"]="true"),P1(this,Pp,t),this.observer.ignore(()=>{Op(this.contentDOM,this.contentAttrs,t),Op(this.dom,this.editorAttrs,e)}),this.editorAttrs=e,this.contentAttrs=t}showAnnouncements(e){let t=!0;for(let i of e)for(let r of i.effects)if(r.is(Bt.announce)){t&&(this.announceDOM.textContent=""),t=!1;let s=this.announceDOM.appendChild(document.createElement("div"));s.textContent=r.value}}mountStyles(){this.styleModules=this.state.facet(oa),Ue.mount(this.root,this.styleModules.concat(HL).reverse())}readMeasured(){if(this.updateState==2)throw new Error("Reading the editor layout isn't allowed during an update");this.updateState==0&&this.measureScheduled>-1&&this.measure(!1)}requestMeasure(e){if(this.measureScheduled<0&&(this.measureScheduled=requestAnimationFrame(()=>this.measure())),e){if(e.key!=null){for(let t=0;t<this.measureRequests.length;t++)if(this.measureRequests[t].key===e.key){this.measureRequests[t]=e;return}}this.measureRequests.push(e)}}pluginField(e){let t=[];for(let i of this.plugins)i.update(this).takeField(e,t);return t}plugin(e){let t=this.pluginMap.get(e);return(t===void 0||t&&t.spec!=e)&&this.pluginMap.set(e,t=this.plugins.find(i=>i.spec==e)||null),t&&t.update(this).value}get documentTop(){return this.contentDOM.getBoundingClientRect().top+this.viewState.paddingTop}get documentPadding(){return{top:this.viewState.paddingTop,bottom:this.viewState.paddingBottom}}blockAtHeight(e,t){let i=qp(t,this);return this.elementAtHeight(e-i).moveY(i)}elementAtHeight(e){return this.readMeasured(),this.viewState.elementAtHeight(e)}visualLineAtHeight(e,t){let i=qp(t,this);return this.lineBlockAtHeight(e-i).moveY(i)}lineBlockAtHeight(e){return this.readMeasured(),this.viewState.lineBlockAtHeight(e)}viewportLines(e,t){let i=qp(t,this);for(let r of this.viewportLineBlocks)e(r.moveY(i))}get viewportLineBlocks(){return this.viewState.viewportLines}visualLineAt(e,t=0){return this.lineBlockAt(e).moveY(t+this.viewState.paddingTop)}lineBlockAt(e){return this.viewState.lineBlockAt(e)}get contentHeight(){return this.viewState.contentHeight}moveByChar(e,t,i){return Np(this,e,i1(this,e,t,i))}moveByGroup(e,t){return Np(this,e,i1(this,e,t,i=>vL(this,e.head,i)))}moveToLineBoundary(e,t,i=!0){return yL(this,e,t,i)}moveVertically(e,t,i){return Np(this,e,wL(this,e,t,i))}scrollPosIntoView(e){this.dispatch({effects:Ep.of(we.cursor(e))})}domAtPos(e){return this.docView.domAtPos(e)}posAtDOM(e,t=0){return this.docView.posFromDOM(e,t)}posAtCoords(e,t=!0){return this.readMeasured(),e1(this,e,t)}coordsAtPos(e,t=1){this.readMeasured();let i=this.docView.coordsAt(e,t);if(!i||i.left==i.right)return i;let r=this.state.doc.lineAt(e),s=this.bidiSpans(r),o=s[zo.find(s,e-r.from,-1,t)];return mc(i,o.dir==vi.LTR==t>0)}get defaultCharacterWidth(){return this.viewState.heightOracle.charWidth}get defaultLineHeight(){return this.viewState.heightOracle.lineHeight}get textDirection(){return this.viewState.heightOracle.direction}get lineWrapping(){return this.viewState.heightOracle.lineWrapping}bidiSpans(e){if(e.length>JL)return Hb(e.length);let t=this.textDirection;for(let r of this.bidiCache)if(r.from==e.from&&r.dir==t)return r.order;let i=Vb(e.text,this.textDirection);return this.bidiCache.push(new Cc(e.from,e.to,t,i)),i}get hasFocus(){var e;return(document.hasFocus()||pe.safari&&((e=this.inputState)===null||e===void 0?void 0:e.lastContextMenu)>Date.now()-3e4)&&this.root.activeElement==this.contentDOM}focus(){this.observer.ignore(()=>{cb(this.contentDOM),this.docView.updateSelection()})}destroy(){for(let e of this.plugins)e.destroy(this);this.plugins=[],this.inputState.destroy(),this.dom.remove(),this.observer.destroy(),this.measureScheduled>-1&&cancelAnimationFrame(this.measureScheduled),this.destroyed=!0}static scrollIntoView(e,t={}){return Lb.of(new Ho(typeof e=="number"?we.cursor(e):e,t.y,t.x,t.yMargin,t.xMargin))}static domEventHandlers(e){return Cr.define(()=>({}),{eventHandlers:e})}static theme(e,t){let i=Ue.newName(),r=[kc.of(i),oa.of($p(`.${i}`,e))];return t&&t.dark&&r.push(zp.of(!0)),r}static baseTheme(e){return mR.lowest(oa.of($p("."+jp,e,M1)))}}Bt.scrollTo=Ep,Bt.centerOn=Rb,Bt.styleModule=oa,Bt.inputHandler=Bb,Bt.exceptionSink=Pb,Bt.updateListener=Mp,Bt.editable=ra,Bt.mouseSelectionStyle=Tb,Bt.dragMovesSelection=Eb,Bt.clickAddsSelectionRange=Mb,Bt.decorations=Zs,Bt.darkTheme=zp,Bt.contentAttributes=Pp,Bt.editorAttributes=Nb,Bt.lineWrapping=Bt.contentAttributes.of({class:"cm-lineWrapping"}),Bt.announce=Wt.define();const JL=4096;function qp(n,e){return(n==null?e.contentDOM.getBoundingClientRect().top:n)+e.viewState.paddingTop}const T1={};class Cc{constructor(e,t,i,r){this.from=e,this.to=t,this.dir=i,this.order=r}static update(e,t){if(t.empty)return e;let i=[],r=e.length?e[e.length-1].dir:vi.LTR;for(let s=Math.max(0,e.length-10);s<e.length;s++){let o=e[s];o.dir==r&&!t.touchesRange(o.from,o.to)&&i.push(new Cc(t.mapPos(o.from,1),t.mapPos(o.to,-1),o.dir,o.order))}return i}}function P1(n,e,t){for(let i=n.state.facet(e),r=i.length-1;r>=0;r--){let s=i[r],o=typeof s=="function"?s(n):s;o&&Cp(o,t)}return t}const ZL=pe.mac?"mac":pe.windows?"win":pe.linux?"linux":"key";function YL(n,e){const t=n.split(/-(?!$)/);let i=t[t.length-1];i=="Space"&&(i=" ");let r,s,o,l;for(let a=0;a<t.length-1;++a){const h=t[a];if(/^(cmd|meta|m)$/i.test(h))l=!0;else if(/^a(lt)?$/i.test(h))r=!0;else if(/^(c|ctrl|control)$/i.test(h))s=!0;else if(/^s(hift)?$/i.test(h))o=!0;else if(/^mod$/i.test(h))e=="mac"?l=!0:s=!0;else throw new Error("Unrecognized modifier name: "+h)}return r&&(i="Alt-"+i),s&&(i="Ctrl-"+i),l&&(i="Meta-"+i),o&&(i="Shift-"+i),i}function Kp(n,e,t){return e.altKey&&(n="Alt-"+n),e.ctrlKey&&(n="Ctrl-"+n),e.metaKey&&(n="Meta-"+n),t!==!1&&e.shiftKey&&(n="Shift-"+n),n}const XL=Bt.domEventHandlers({keydown(n,e){return L1(R1(e.state),n,e,"editor")}}),QL=Ie.define({enables:XL}),B1=new WeakMap;function R1(n){let e=n.facet(QL),t=B1.get(e);return t||B1.set(e,t=tF(e.reduce((i,r)=>i.concat(r),[]))),t}function Rj(n,e,t){return L1(R1(n.state),e,n,t)}let ns=null;const eF=4e3;function tF(n,e=ZL){let t=Object.create(null),i=Object.create(null),r=(o,l)=>{let a=i[o];if(a==null)i[o]=l;else if(a!=l)throw new Error("Key binding "+o+" is used both as a regular binding and as a multi-stroke prefix")},s=(o,l,a,h)=>{let c=t[o]||(t[o]=Object.create(null)),u=l.split(/ (?!$)/).map(p=>YL(p,e));for(let p=1;p<u.length;p++){let g=u.slice(0,p).join(" ");r(g,!0),c[g]||(c[g]={preventDefault:!0,commands:[y=>{let v=ns={view:y,prefix:g,scope:o};return setTimeout(()=>{ns==v&&(ns=null)},eF),!0}]})}let f=u.join(" ");r(f,!1);let d=c[f]||(c[f]={preventDefault:!1,commands:[]});d.commands.push(a),h&&(d.preventDefault=!0)};for(let o of n){let l=o[e]||o.key;if(!!l)for(let a of o.scope?o.scope.split(" "):["editor"])s(a,l,o.run,o.preventDefault),o.shift&&s(a,"Shift-"+l,o.shift,o.preventDefault)}return t}function L1(n,e,t,i){let r=uc(e),s=r.length==1&&r!=" ",o="",l=!1;ns&&ns.view==t&&ns.scope==i&&(o=ns.prefix+" ",(l=r1.indexOf(e.keyCode)<0)&&(ns=null));let a=u=>{if(u){for(let f of u.commands)if(f(t))return!0;u.preventDefault&&(l=!0)}return!1},h=n[i],c;if(h){if(a(h[o+Kp(r,e,!s)]))return!0;if(s&&(e.shiftKey||e.altKey||e.metaKey)&&(c=Bn[e.keyCode])&&c!=r){if(a(h[o+Kp(c,e,!0)]))return!0}else if(s&&e.shiftKey&&a(h[o+Kp(r,e,!0)]))return!0}return l}const iF=!pe.ios,nF=Ie.define({combine(n){return Ww(n,{cursorBlinkRate:1200,drawRangeCursor:!0},{cursorBlinkRate:(e,t)=>Math.min(e,t),drawRangeCursor:(e,t)=>e||t})}});function Lj(n={}){return[nF.of(n),rF,oF]}class F1{constructor(e,t,i,r,s){this.left=e,this.top=t,this.width=i,this.height=r,this.className=s}draw(){let e=document.createElement("div");return e.className=this.className,this.adjust(e),e}adjust(e){e.style.left=this.left+"px",e.style.top=this.top+"px",this.width>=0&&(e.style.width=this.width+"px"),e.style.height=this.height+"px"}eq(e){return this.left==e.left&&this.top==e.top&&this.width==e.width&&this.height==e.height&&this.className==e.className}}const rF=null,sF={".cm-line":{"& ::selection":{backgroundColor:"transparent !important"},"&::selection":{backgroundColor:"transparent !important"}}};iF&&(sF[".cm-line"].caretColor="transparent !important");const oF=null;function N1(n){let e=n.scrollDOM.getBoundingClientRect();return{left:(n.textDirection==vi.LTR?e.left:e.right-n.scrollDOM.clientWidth)-n.scrollDOM.scrollLeft,top:e.top-n.scrollDOM.scrollTop}}function I1(n,e,t){let i=EditorSelection.cursor(e);return{from:Math.max(t.from,n.moveToLineBoundary(i,!1,!0).from),to:Math.min(t.to,n.moveToLineBoundary(i,!0,!0).from),type:ft.Text}}function W1(n,e){let t=n.lineBlockAt(e);if(Array.isArray(t.type)){for(let i of t.type)if(i.to>e||i.to==e&&(i.to==t.to||i.type==ft.Text))return i}return t}function Fj(n,e){if(e.to<=n.viewport.from||e.from>=n.viewport.to)return[];let t=Math.max(e.from,n.viewport.from),i=Math.min(e.to,n.viewport.to),r=n.textDirection==vi.LTR,s=n.contentDOM,o=s.getBoundingClientRect(),l=N1(n),a=window.getComputedStyle(s.firstChild),h=o.left+parseInt(a.paddingLeft)+Math.min(0,parseInt(a.textIndent)),c=o.right-parseInt(a.paddingRight),u=W1(n,t),f=W1(n,i),d=u.type==ft.Text?u:null,p=f.type==ft.Text?f:null;if(n.lineWrapping&&(d&&(d=I1(n,t,d)),p&&(p=I1(n,i,p))),d&&p&&d.from==p.from)return y(v(e.from,e.to,d));{let x=d?v(e.from,null,d):C(u,!1),b=p?v(null,e.to,p):C(f,!0),S=[];return(d||u).to<(p||f).from-1?S.push(g(h,x.bottom,c,b.top)):x.bottom<b.top&&n.elementAtHeight((x.bottom+b.top)/2).type==ft.Text&&(x.bottom=b.top=(x.bottom+b.top)/2),y(x).concat(S).concat(y(b))}function g(x,b,S,k){return new F1(x-l.left,b-l.top-.01,S-x,k-b+.01,"cm-selectionBackground")}function y({top:x,bottom:b,horizontal:S}){let k=[];for(let A=0;A<S.length;A+=2)k.push(g(S[A],x,S[A+1],b));return k}function v(x,b,S){let k=1e9,A=-1e9,_=[];function O(B,N,ne,W,J){let re=n.coordsAtPos(B,B==S.to?-2:2),ie=n.coordsAtPos(ne,ne==S.from?2:-2);k=Math.min(re.top,ie.top,k),A=Math.max(re.bottom,ie.bottom,A),J==vi.LTR?_.push(r&&N?h:re.left,r&&W?c:ie.right):_.push(!r&&W?h:ie.left,!r&&N?c:re.right)}let D=x!=null?x:S.from,T=b!=null?b:S.to;for(let B of n.visibleRanges)if(B.to>D&&B.from<T)for(let N=Math.max(B.from,D),ne=Math.min(B.to,T);;){let W=n.state.doc.lineAt(N);for(let J of n.bidiSpans(W)){let re=J.from+W.from,ie=J.to+W.from;if(re>=ne)break;ie>N&&O(Math.max(re,N),x==null&&re<=D,Math.min(ie,ne),b==null&&ie>=T,J.dir)}if(N=W.to+1,N>=ne)break}return _.length==0&&O(D,x==null,T,b==null,n.textDirection),{top:k,bottom:A,horizontal:_}}function C(x,b){let S=o.top+(b?x.top:x.bottom);return{top:S,bottom:S,horizontal:[]}}}function Nj(n,e,t){let i=n.coordsAtPos(e.head,e.assoc||1);if(!i)return null;let r=N1(n);return new F1(i.left-r.left,i.top-r.top,-1,i.bottom-i.top,t?"cm-cursor cm-cursor-primary":"cm-cursor cm-cursor-secondary")}const V1=Wt.define({map(n,e){return n==null?null:e.mapPos(n)}}),aa=Ro.define({create(){return null},update(n,e){return n!=null&&(n=e.changes.mapPos(n)),e.effects.reduce((t,i)=>i.is(V1)?i.value:t,n)}}),lF=Cr.fromClass(class{constructor(n){this.view=n,this.cursor=null,this.measureReq={read:this.readPos.bind(this),write:this.drawCursor.bind(this)}}update(n){var e;let t=n.state.field(aa);t==null?this.cursor!=null&&((e=this.cursor)===null||e===void 0||e.remove(),this.cursor=null):(this.cursor||(this.cursor=this.view.scrollDOM.appendChild(document.createElement("div")),this.cursor.className="cm-dropCursor"),(n.startState.field(aa)!=t||n.docChanged||n.geometryChanged)&&this.view.requestMeasure(this.measureReq))}readPos(){let n=this.view.state.field(aa),e=n!=null&&this.view.coordsAtPos(n);if(!e)return null;let t=this.view.scrollDOM.getBoundingClientRect();return{left:e.left-t.left+this.view.scrollDOM.scrollLeft,top:e.top-t.top+this.view.scrollDOM.scrollTop,height:e.bottom-e.top}}drawCursor(n){this.cursor&&(n?(this.cursor.style.left=n.left+"px",this.cursor.style.top=n.top+"px",this.cursor.style.height=n.height+"px"):this.cursor.style.left="-100000px")}destroy(){this.cursor&&this.cursor.remove()}setDropPos(n){this.view.state.field(aa)!=n&&this.view.dispatch({effects:V1.of(n)})}},{eventHandlers:{dragover(n){this.setDropPos(this.view.posAtCoords({x:n.clientX,y:n.clientY}))},dragleave(n){(n.target==this.view.contentDOM||!this.view.contentDOM.contains(n.relatedTarget))&&this.setDropPos(null)},dragend(){this.setDropPos(null)},drop(){this.setDropPos(null)}}});function Ij(){return[aa,lF]}function H1(n,e,t,i,r){e.lastIndex=0;for(let s=n.iterRange(t,i),o=t,l;!s.next().done;o+=s.value.length)if(!s.lineBreak)for(;l=e.exec(s.value);)r(o+l.index,o+l.index+l[0].length,l)}function aF(n,e){let t=n.visibleRanges;if(t.length==1&&t[0].from==n.viewport.from&&t[0].to==n.viewport.to)return t;let i=[];for(let{from:r,to:s}of t)r=Math.max(n.state.doc.lineAt(r).from,r-e),s=Math.min(n.state.doc.lineAt(s).to,s+e),i.length&&i[i.length-1].to>=r?i[i.length-1].to=s:i.push({from:r,to:s});return i}class hF{constructor(e){let{regexp:t,decoration:i,boundary:r,maxLength:s=1e3}=e;if(!t.global)throw new RangeError("The regular expression given to MatchDecorator should have its 'g' flag set");this.regexp=t,this.getDeco=typeof i=="function"?i:()=>i,this.boundary=r,this.maxLength=s}createDeco(e){let t=new RangeSetBuilder;for(let{from:i,to:r}of aF(e,this.maxLength))H1(e.state.doc,this.regexp,i,r,(s,o,l)=>t.add(s,o,this.getDeco(l,e,s)));return t.finish()}updateDeco(e,t){let i=1e9,r=-1;return e.docChanged&&e.changes.iterChanges((s,o,l,a)=>{a>e.view.viewport.from&&l<e.view.viewport.to&&(i=Math.min(l,i),r=Math.max(a,r))}),e.viewportChanged||r-i>1e3?this.createDeco(e.view):r>-1?this.updateRange(e.view,t.map(e.changes),i,r):t}updateRange(e,t,i,r){for(let s of e.visibleRanges){let o=Math.max(s.from,i),l=Math.min(s.to,r);if(l>o){let a=e.state.doc.lineAt(o),h=a.to<l?e.state.doc.lineAt(l):a,c=Math.max(s.from,a.from),u=Math.min(s.to,h.to);if(this.boundary){for(;o>a.from;o--)if(this.boundary.test(a.text[o-1-a.from])){c=o;break}for(;l<h.to;l++)if(this.boundary.test(h.text[l-h.from])){u=l;break}}let f=[],d;if(a==h)for(this.regexp.lastIndex=c-a.from;(d=this.regexp.exec(a.text))&&d.index<u-a.from;){let p=d.index+a.from;f.push(this.getDeco(d,e,p).range(p,p+d[0].length))}else H1(e.state.doc,this.regexp,c,u,(p,g,y)=>f.push(this.getDeco(y,e,p).range(p,g)));t=t.update({filterFrom:c,filterTo:u,filter:(p,g)=>p<c||g>u,add:f})}}return t}}const Gp=/x/.unicode!=null?"gu":"g",cF=new RegExp(`[\0-\b
-\x7F-\x9F\xAD\u061C\u200B\u200E\u200F\u2028\u2029\u202D\u202E\uFEFF\uFFF9-\uFFFC]`,Gp),uF={0:"null",7:"bell",8:"backspace",10:"newline",11:"vertical tab",13:"carriage return",27:"escape",8203:"zero width space",8204:"zero width non-joiner",8205:"zero width joiner",8206:"left-to-right mark",8207:"right-to-left mark",8232:"line separator",8237:"left-to-right override",8238:"right-to-left override",8233:"paragraph separator",65279:"zero width no-break space",65532:"object replacement"};let Jp=null;function fF(){var n;if(Jp==null&&typeof document!="undefined"&&document.body){let e=document.body.style;Jp=((n=e.tabSize)!==null&&n!==void 0?n:e.MozTabSize)!=null}return Jp||!1}const Ac=Ie.define({combine(n){let e=Ww(n,{render:null,specialChars:cF,addSpecialChars:null});return(e.replaceTabs=!fF())&&(e.specialChars=new RegExp("	|"+e.specialChars.source,Gp)),e.addSpecialChars&&(e.specialChars=new RegExp(e.specialChars.source+"|"+e.addSpecialChars.source,Gp)),e}});function Wj(n={}){return[Ac.of(n),dF()]}let z1=null;function dF(){return z1||(z1=Cr.fromClass(class{constructor(n){this.view=n,this.decorations=ht.none,this.decorationCache=Object.create(null),this.decorator=this.makeDecorator(n.state.facet(Ac)),this.decorations=this.decorator.createDeco(n)}makeDecorator(n){return new hF({regexp:n.specialChars,decoration:(e,t,i)=>{let{doc:r}=t.state,s=codePointAt(e[0],0);if(s==9){let o=r.lineAt(i),l=t.state.tabSize,a=countColumn(o.text,l,i-o.from);return ht.replace({widget:new yF((l-a%l)*this.view.defaultCharacterWidth)})}return this.decorationCache[s]||(this.decorationCache[s]=ht.replace({widget:new gF(n,s)}))},boundary:n.replaceTabs?void 0:/[^]/})}update(n){let e=n.state.facet(Ac);n.startState.facet(Ac)!=e?(this.decorator=this.makeDecorator(e),this.decorations=this.decorator.createDeco(n.view)):this.decorations=this.decorator.updateDeco(n,this.decorations)}},{decorations:n=>n.decorations}))}const pF="\u2022";function mF(n){return n>=32?pF:n==10?"\u2424":String.fromCharCode(9216+n)}class gF extends null{constructor(e,t){super(),this.options=e,this.code=t}eq(e){return e.code==this.code}toDOM(e){let t=mF(this.code),i=e.state.phrase("Control character")+" "+(uF[this.code]||"0x"+this.code.toString(16)),r=this.options.render&&this.options.render(this.code,i,t);if(r)return r;let s=document.createElement("span");return s.textContent=t,s.title=i,s.setAttribute("aria-label",i),s.className="cm-specialChar",s}ignoreEvent(){return!1}}class yF extends null{constructor(e){super(),this.width=e}eq(e){return e.width==this.width}toDOM(){let e=document.createElement("span");return e.textContent="	",e.className="cm-tab",e.style.width=this.width+"px",e}ignoreEvent(){return!1}}const j1=null;function Vj(){return[j1,Pp.of(n=>{var e;return((e=n.plugin(j1))===null||e===void 0?void 0:e.attrs)||null})]}function Hj(){return wF}const vF=ht.line({class:"cm-activeLine"}),wF=Cr.fromClass(class{constructor(n){this.decorations=this.getDeco(n)}update(n){(n.docChanged||n.selectionSet)&&(this.decorations=this.getDeco(n.view))}getDeco(n){let e=-1,t=[];for(let i of n.state.selection.ranges){if(!i.empty)return ht.none;let r=n.lineBlockAt(i.head);r.from>e&&(t.push(vF.range(r.from)),e=r.from)}return ht.set(t)}},{decorations:n=>n.decorations});class bF extends null{constructor(e){super(),this.content=e}toDOM(){let e=document.createElement("span");return e.className="cm-placeholder",e.style.pointerEvents="none",e.appendChild(typeof this.content=="string"?document.createTextNode(this.content):this.content),typeof this.content=="string"?e.setAttribute("aria-label","placeholder "+this.content):e.setAttribute("aria-hidden","true"),e}ignoreEvent(){return!1}}function zj(n){return Cr.fromClass(class{constructor(e){this.view=e,this.placeholder=ht.set([ht.widget({widget:new bF(n),side:1}).range(0)])}get decorations(){return this.view.state.doc.length?ht.none:this.placeholder}},{decorations:e=>e.decorations})}const jj={HeightMap:Mi,HeightOracle:w1,MeasuredHeights:b1,QueryType:Qe,ChangedRange:Hn,computeOrder:Vb,moveVisually:jb},Zp=Ie.define({combine(n){let e,t;for(let i of n)e=e||i.topContainer,t=t||i.bottomContainer;return{topContainer:e,bottomContainer:t}}});function $j(n){return n?[Zp.of(n)]:[]}function Uj(n,e){let t=n.plugin($1),i=t?t.specs.indexOf(e):-1;return i>-1?t.panels[i]:null}const $1=Cr.fromClass(class{constructor(n){this.input=n.state.facet(Yp),this.specs=this.input.filter(t=>t),this.panels=this.specs.map(t=>t(n));let e=n.state.facet(Zp);this.top=new Oc(n,!0,e.topContainer),this.bottom=new Oc(n,!1,e.bottomContainer),this.top.sync(this.panels.filter(t=>t.top)),this.bottom.sync(this.panels.filter(t=>!t.top));for(let t of this.panels)t.dom.classList.add("cm-panel"),t.mount&&t.mount()}update(n){let e=n.state.facet(Zp);this.top.container!=e.topContainer&&(this.top.sync([]),this.top=new Oc(n.view,!0,e.topContainer)),this.bottom.container!=e.bottomContainer&&(this.bottom.sync([]),this.bottom=new Oc(n.view,!1,e.bottomContainer)),this.top.syncClasses(),this.bottom.syncClasses();let t=n.state.facet(Yp);if(t!=this.input){let i=t.filter(a=>a),r=[],s=[],o=[],l=[];for(let a of i){let h=this.specs.indexOf(a),c;h<0?(c=a(n.view),l.push(c)):(c=this.panels[h],c.update&&c.update(n)),r.push(c),(c.top?s:o).push(c)}this.specs=i,this.panels=r,this.top.sync(s),this.bottom.sync(o);for(let a of l)a.dom.classList.add("cm-panel"),a.mount&&a.mount()}else for(let i of this.panels)i.update&&i.update(n)}destroy(){this.top.sync([]),this.bottom.sync([])}},{provide:Gi.scrollMargins.from(n=>({top:n.top.scrollMargin(),bottom:n.bottom.scrollMargin()}))});class Oc{constructor(e,t,i){this.view=e,this.top=t,this.container=i,this.dom=void 0,this.classes="",this.panels=[],this.syncClasses()}sync(e){for(let t of this.panels)t.destroy&&e.indexOf(t)<0&&t.destroy();this.panels=e,this.syncDOM()}syncDOM(){if(this.panels.length==0){this.dom&&(this.dom.remove(),this.dom=void 0);return}if(!this.dom){this.dom=document.createElement("div"),this.dom.className=this.top?"cm-panels cm-panels-top":"cm-panels cm-panels-bottom",this.dom.style[this.top?"top":"bottom"]="0";let t=this.container||this.view.dom;t.insertBefore(this.dom,this.top?t.firstChild:null)}let e=this.dom.firstChild;for(let t of this.panels)if(t.dom.parentNode==this.dom){for(;e!=t.dom;)e=U1(e);e=e.nextSibling}else this.dom.insertBefore(t.dom,e);for(;e;)e=U1(e)}scrollMargin(){return!this.dom||this.container?0:Math.max(0,this.top?this.dom.getBoundingClientRect().bottom-Math.max(0,this.view.scrollDOM.getBoundingClientRect().top):Math.min(innerHeight,this.view.scrollDOM.getBoundingClientRect().bottom)-this.dom.getBoundingClientRect().top)}syncClasses(){if(!(!this.container||this.classes==this.view.themeClasses)){for(let e of this.classes.split(" "))e&&this.container.classList.remove(e);for(let e of(this.classes=this.view.themeClasses).split(" "))e&&this.container.classList.add(e)}}}function U1(n){let e=n.nextSibling;return n.remove(),e}const xF=Bt.baseTheme({".cm-panels":{boxSizing:"border-box",position:"sticky",left:0,right:0},"&light .cm-panels":{backgroundColor:"#f5f5f5",color:"black"},"&light .cm-panels-top":{borderBottom:"1px solid #ddd"},"&light .cm-panels-bottom":{borderTop:"1px solid #ddd"},"&dark .cm-panels":{backgroundColor:"#333338",color:"white"}}),Yp=Ie.define({enables:[$1,xF]}),SF=1024;let kF=0;class bn{constructor(e,t){this.from=e,this.to=t}}class qe{constructor(e={}){this.id=kF++,this.perNode=!!e.perNode,this.deserialize=e.deserialize||(()=>{throw new Error("This node type doesn't define a deserialize function")})}add(e){if(this.perNode)throw new RangeError("Can't add per-node props to node types");return typeof e!="function"&&(e=Ei.match(e)),t=>{let i=e(t);return i===void 0?null:[this,i]}}}qe.closedBy=new qe({deserialize:n=>n.split(" ")}),qe.openedBy=new qe({deserialize:n=>n.split(" ")}),qe.group=new qe({deserialize:n=>n.split(" ")}),qe.contextHash=new qe({perNode:!0}),qe.lookAhead=new qe({perNode:!0}),qe.mounted=new qe({perNode:!0});class CF{constructor(e,t,i){this.tree=e,this.overlay=t,this.parser=i}}const AF=Object.create(null);class Ei{constructor(e,t,i,r=0){this.name=e,this.props=t,this.id=i,this.flags=r}static define(e){let t=e.props&&e.props.length?Object.create(null):AF,i=(e.top?1:0)|(e.skipped?2:0)|(e.error?4:0)|(e.name==null?8:0),r=new Ei(e.name||"",t,e.id,i);if(e.props){for(let s of e.props)if(Array.isArray(s)||(s=s(r)),s){if(s[0].perNode)throw new RangeError("Can't store a per-node prop on a node type");t[s[0].id]=s[1]}}return r}prop(e){return this.props[e.id]}get isTop(){return(this.flags&1)>0}get isSkipped(){return(this.flags&2)>0}get isError(){return(this.flags&4)>0}get isAnonymous(){return(this.flags&8)>0}is(e){if(typeof e=="string"){if(this.name==e)return!0;let t=this.prop(qe.group);return t?t.indexOf(e)>-1:!1}return this.id==e}static match(e){let t=Object.create(null);for(let i in e)for(let r of i.split(" "))t[r]=e[i];return i=>{for(let r=i.prop(qe.group),s=-1;s<(r?r.length:0);s++){let o=t[s<0?i.name:r[s]];if(o)return o}}}}Ei.none=new Ei("",Object.create(null),0,8);class Xp{constructor(e){this.types=e;for(let t=0;t<e.length;t++)if(e[t].id!=t)throw new RangeError("Node type ids should correspond to array positions when creating a node set")}extend(...e){let t=[];for(let i of this.types){let r=null;for(let s of e){let o=s(i);o&&(r||(r=Object.assign({},i.props)),r[o[0].id]=o[1])}t.push(r?new Ei(i.name,r,i.id,i.flags):i)}return new Xp(t)}}const _c=new WeakMap,q1=new WeakMap;class et{constructor(e,t,i,r,s){if(this.type=e,this.children=t,this.positions=i,this.length=r,this.props=null,s&&s.length){this.props=Object.create(null);for(let[o,l]of s)this.props[typeof o=="number"?o:o.id]=l}}toString(){let e=this.prop(qe.mounted);if(e&&!e.overlay)return e.tree.toString();let t="";for(let i of this.children){let r=i.toString();r&&(t&&(t+=","),t+=r)}return this.type.name?(/\W/.test(this.type.name)&&!this.type.isError?JSON.stringify(this.type.name):this.type.name)+(t.length?"("+t+")":""):t}cursor(e,t=0){let i=e!=null&&_c.get(this)||this.topNode,r=new ha(i);return e!=null&&(r.moveTo(e,t),_c.set(this,r._tree)),r}fullCursor(){return new ha(this.topNode,1)}get topNode(){return new jn(this,0,0,null)}resolve(e,t=0){let i=jo(_c.get(this)||this.topNode,e,t,!1);return _c.set(this,i),i}resolveInner(e,t=0){let i=jo(q1.get(this)||this.topNode,e,t,!0);return q1.set(this,i),i}iterate(e){let{enter:t,leave:i,from:r=0,to:s=this.length}=e;for(let o=this.cursor(),l=()=>o.node;;){let a=!1;if(o.from<=s&&o.to>=r&&(o.type.isAnonymous||t(o.type,o.from,o.to,l)!==!1)){if(o.firstChild())continue;o.type.isAnonymous||(a=!0)}for(;a&&i&&i(o.type,o.from,o.to,l),a=o.type.isAnonymous,!o.nextSibling();){if(!o.parent())return;a=!0}}}prop(e){return e.perNode?this.props?this.props[e.id]:void 0:this.type.prop(e)}get propValues(){let e=[];if(this.props)for(let t in this.props)e.push([+t,this.props[t]]);return e}balance(e={}){return this.children.length<=8?this:tm(Ei.none,this.children,this.positions,0,this.children.length,0,this.length,(t,i,r)=>new et(this.type,t,i,r,this.propValues),e.makeTree||((t,i,r)=>new et(Ei.none,t,i,r)))}static build(e){return _F(e)}}et.empty=new et(Ei.none,[],[],0);class Qp{constructor(e,t){this.buffer=e,this.index=t}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}get pos(){return this.index}next(){this.index-=4}fork(){return new Qp(this.buffer,this.index)}}class Ys{constructor(e,t,i){this.buffer=e,this.length=t,this.set=i}get type(){return Ei.none}toString(){let e=[];for(let t=0;t<this.buffer.length;)e.push(this.childString(t)),t=this.buffer[t+3];return e.join(",")}childString(e){let t=this.buffer[e],i=this.buffer[e+3],r=this.set.types[t],s=r.name;if(/\W/.test(s)&&!r.isError&&(s=JSON.stringify(s)),e+=4,i==e)return s;let o=[];for(;e<i;)o.push(this.childString(e)),e=this.buffer[e+3];return s+"("+o.join(",")+")"}findChild(e,t,i,r,s){let{buffer:o}=this,l=-1;for(let a=e;a!=t&&!(K1(s,r,o[a+1],o[a+2])&&(l=a,i>0));a=o[a+3]);return l}slice(e,t,i,r){let s=this.buffer,o=new Uint16Array(t-e);for(let l=e,a=0;l<t;)o[a++]=s[l++],o[a++]=s[l++]-i,o[a++]=s[l++]-i,o[a++]=s[l++]-e;return new Ys(o,r-i,this.set)}}function K1(n,e,t,i){switch(n){case-2:return t<e;case-1:return i>=e&&t<e;case 0:return t<e&&i>e;case 1:return t<=e&&i>e;case 2:return i>e;case 4:return!0}}function G1(n,e){let t=n.childBefore(e);for(;t;){let i=t.lastChild;if(!i||i.to!=t.to)break;i.type.isError&&i.from==i.to?(n=t,t=i.prevSibling):t=i}return n}function jo(n,e,t,i){for(var r;n.from==n.to||(t<1?n.from>=e:n.from>e)||(t>-1?n.to<=e:n.to<e);){let s=!i&&n instanceof jn&&n.index<0?null:n.parent;if(!s)return n;n=s}if(i)for(let s=n,o=s.parent;o;s=o,o=s.parent)s instanceof jn&&s.index<0&&((r=o.enter(e,t,!0))===null||r===void 0?void 0:r.from)!=s.from&&(n=o);for(;;){let s=n.enter(e,t,i);if(!s)return n;n=s}}class jn{constructor(e,t,i,r){this.node=e,this._from=t,this.index=i,this._parent=r}get type(){return this.node.type}get name(){return this.node.type.name}get from(){return this._from}get to(){return this._from+this.node.length}nextChild(e,t,i,r,s=0){for(let o=this;;){for(let{children:l,positions:a}=o.node,h=t>0?l.length:-1;e!=h;e+=t){let c=l[e],u=a[e]+o._from;if(!!K1(r,i,u,u+c.length)){if(c instanceof Ys){if(s&2)continue;let f=c.findChild(0,c.buffer.length,t,i-u,r);if(f>-1)return new rs(new OF(o,c,e,u),null,f)}else if(s&1||!c.type.isAnonymous||em(c)){let f;if(!(s&1)&&c.props&&(f=c.prop(qe.mounted))&&!f.overlay)return new jn(f.tree,u,e,o);let d=new jn(c,u,e,o);return s&1||!d.type.isAnonymous?d:d.nextChild(t<0?c.children.length-1:0,t,i,r)}}}if(s&1||!o.type.isAnonymous||(o.index>=0?e=o.index+t:e=t<0?-1:o._parent.node.children.length,o=o._parent,!o))return null}}get firstChild(){return this.nextChild(0,1,0,4)}get lastChild(){return this.nextChild(this.node.children.length-1,-1,0,4)}childAfter(e){return this.nextChild(0,1,e,2)}childBefore(e){return this.nextChild(this.node.children.length-1,-1,e,-2)}enter(e,t,i=!0,r=!0){let s;if(i&&(s=this.node.prop(qe.mounted))&&s.overlay){let o=e-this.from;for(let{from:l,to:a}of s.overlay)if((t>0?l<=o:l<o)&&(t<0?a>=o:a>o))return new jn(s.tree,s.overlay[0].from+this.from,-1,this)}return this.nextChild(0,1,e,t,r?0:2)}nextSignificantParent(){let e=this;for(;e.type.isAnonymous&&e._parent;)e=e._parent;return e}get parent(){return this._parent?this._parent.nextSignificantParent():null}get nextSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index+1,1,0,4):null}get prevSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index-1,-1,0,4):null}get cursor(){return new ha(this)}get tree(){return this.node}toTree(){return this.node}resolve(e,t=0){return jo(this,e,t,!1)}resolveInner(e,t=0){return jo(this,e,t,!0)}enterUnfinishedNodesBefore(e){return G1(this,e)}getChild(e,t=null,i=null){let r=Dc(this,e,t,i);return r.length?r[0]:null}getChildren(e,t=null,i=null){return Dc(this,e,t,i)}toString(){return this.node.toString()}}function Dc(n,e,t,i){let r=n.cursor,s=[];if(!r.firstChild())return s;if(t!=null){for(;!r.type.is(t);)if(!r.nextSibling())return s}for(;;){if(i!=null&&r.type.is(i))return s;if(r.type.is(e)&&s.push(r.node),!r.nextSibling())return i==null?s:[]}}class OF{constructor(e,t,i,r){this.parent=e,this.buffer=t,this.index=i,this.start=r}}class rs{constructor(e,t,i){this.context=e,this._parent=t,this.index=i,this.type=e.buffer.set.types[e.buffer.buffer[i]]}get name(){return this.type.name}get from(){return this.context.start+this.context.buffer.buffer[this.index+1]}get to(){return this.context.start+this.context.buffer.buffer[this.index+2]}child(e,t,i){let{buffer:r}=this.context,s=r.findChild(this.index+4,r.buffer[this.index+3],e,t-this.context.start,i);return s<0?null:new rs(this.context,this,s)}get firstChild(){return this.child(1,0,4)}get lastChild(){return this.child(-1,0,4)}childAfter(e){return this.child(1,e,2)}childBefore(e){return this.child(-1,e,-2)}enter(e,t,i,r=!0){if(!r)return null;let{buffer:s}=this.context,o=s.findChild(this.index+4,s.buffer[this.index+3],t>0?1:-1,e-this.context.start,t);return o<0?null:new rs(this.context,this,o)}get parent(){return this._parent||this.context.parent.nextSignificantParent()}externalSibling(e){return this._parent?null:this.context.parent.nextChild(this.context.index+e,e,0,4)}get nextSibling(){let{buffer:e}=this.context,t=e.buffer[this.index+3];return t<(this._parent?e.buffer[this._parent.index+3]:e.buffer.length)?new rs(this.context,this._parent,t):this.externalSibling(1)}get prevSibling(){let{buffer:e}=this.context,t=this._parent?this._parent.index+4:0;return this.index==t?this.externalSibling(-1):new rs(this.context,this._parent,e.findChild(t,this.index,-1,0,4))}get cursor(){return new ha(this)}get tree(){return null}toTree(){let e=[],t=[],{buffer:i}=this.context,r=this.index+4,s=i.buffer[this.index+3];if(s>r){let o=i.buffer[this.index+1],l=i.buffer[this.index+2];e.push(i.slice(r,s,o,l)),t.push(0)}return new et(this.type,e,t,this.to-this.from)}resolve(e,t=0){return jo(this,e,t,!1)}resolveInner(e,t=0){return jo(this,e,t,!0)}enterUnfinishedNodesBefore(e){return G1(this,e)}toString(){return this.context.buffer.childString(this.index)}getChild(e,t=null,i=null){let r=Dc(this,e,t,i);return r.length?r[0]:null}getChildren(e,t=null,i=null){return Dc(this,e,t,i)}}class ha{constructor(e,t=0){if(this.mode=t,this.buffer=null,this.stack=[],this.index=0,this.bufferNode=null,e instanceof jn)this.yieldNode(e);else{this._tree=e.context.parent,this.buffer=e.context;for(let i=e._parent;i;i=i._parent)this.stack.unshift(i.index);this.bufferNode=e,this.yieldBuf(e.index)}}get name(){return this.type.name}yieldNode(e){return e?(this._tree=e,this.type=e.type,this.from=e.from,this.to=e.to,!0):!1}yieldBuf(e,t){this.index=e;let{start:i,buffer:r}=this.buffer;return this.type=t||r.set.types[r.buffer[e]],this.from=i+r.buffer[e+1],this.to=i+r.buffer[e+2],!0}yield(e){return e?e instanceof jn?(this.buffer=null,this.yieldNode(e)):(this.buffer=e.context,this.yieldBuf(e.index,e.type)):!1}toString(){return this.buffer?this.buffer.buffer.childString(this.index):this._tree.toString()}enterChild(e,t,i){if(!this.buffer)return this.yield(this._tree.nextChild(e<0?this._tree.node.children.length-1:0,e,t,i,this.mode));let{buffer:r}=this.buffer,s=r.findChild(this.index+4,r.buffer[this.index+3],e,t-this.buffer.start,i);return s<0?!1:(this.stack.push(this.index),this.yieldBuf(s))}firstChild(){return this.enterChild(1,0,4)}lastChild(){return this.enterChild(-1,0,4)}childAfter(e){return this.enterChild(1,e,2)}childBefore(e){return this.enterChild(-1,e,-2)}enter(e,t,i=!0,r=!0){return this.buffer?r?this.enterChild(1,e,t):!1:this.yield(this._tree.enter(e,t,i&&!(this.mode&1),r))}parent(){if(!this.buffer)return this.yieldNode(this.mode&1?this._tree._parent:this._tree.parent);if(this.stack.length)return this.yieldBuf(this.stack.pop());let e=this.mode&1?this.buffer.parent:this.buffer.parent.nextSignificantParent();return this.buffer=null,this.yieldNode(e)}sibling(e){if(!this.buffer)return this._tree._parent?this.yield(this._tree.index<0?null:this._tree._parent.nextChild(this._tree.index+e,e,0,4,this.mode)):!1;let{buffer:t}=this.buffer,i=this.stack.length-1;if(e<0){let r=i<0?0:this.stack[i]+4;if(this.index!=r)return this.yieldBuf(t.findChild(r,this.index,-1,0,4))}else{let r=t.buffer[this.index+3];if(r<(i<0?t.buffer.length:t.buffer[this.stack[i]+3]))return this.yieldBuf(r)}return i<0?this.yield(this.buffer.parent.nextChild(this.buffer.index+e,e,0,4,this.mode)):!1}nextSibling(){return this.sibling(1)}prevSibling(){return this.sibling(-1)}atLastNode(e){let t,i,{buffer:r}=this;if(r){if(e>0){if(this.index<r.buffer.buffer.length)return!1}else for(let s=0;s<this.index;s++)if(r.buffer.buffer[s+3]<this.index)return!1;({index:t,parent:i}=r)}else({index:t,_parent:i}=this._tree);for(;i;{index:t,_parent:i}=i)if(t>-1)for(let s=t+e,o=e<0?-1:i.node.children.length;s!=o;s+=e){let l=i.node.children[s];if(this.mode&1||l instanceof Ys||!l.type.isAnonymous||em(l))return!1}return!0}move(e,t){if(t&&this.enterChild(e,0,4))return!0;for(;;){if(this.sibling(e))return!0;if(this.atLastNode(e)||!this.parent())return!1}}next(e=!0){return this.move(1,e)}prev(e=!0){return this.move(-1,e)}moveTo(e,t=0){for(;(this.from==this.to||(t<1?this.from>=e:this.from>e)||(t>-1?this.to<=e:this.to<e))&&this.parent(););for(;this.enterChild(1,e,t););return this}get node(){if(!this.buffer)return this._tree;let e=this.bufferNode,t=null,i=0;if(e&&e.context==this.buffer){e:for(let r=this.index,s=this.stack.length;s>=0;){for(let o=e;o;o=o._parent)if(o.index==r){if(r==this.index)return o;t=o,i=s+1;break e}r=this.stack[--s]}}for(let r=i;r<this.stack.length;r++)t=new rs(this.buffer,t,this.stack[r]);return this.bufferNode=new rs(this.buffer,t,this.index)}get tree(){return this.buffer?null:this._tree.node}}function em(n){return n.children.some(e=>e instanceof Ys||!e.type.isAnonymous||em(e))}function _F(n){var e;let{buffer:t,nodeSet:i,maxBufferLength:r=SF,reused:s=[],minRepeatType:o=i.types.length}=n,l=Array.isArray(t)?new Qp(t,t.length):t,a=i.types,h=0,c=0;function u(b,S,k,A,_){let{id:O,start:D,end:T,size:B}=l,N=c;for(;B<0;)if(l.next(),B==-1){let ie=s[O];k.push(ie),A.push(D-b);return}else if(B==-3){h=O;return}else if(B==-4){c=O;return}else throw new RangeError(`Unrecognized record size: ${B}`);let ne=a[O],W,J,re=D-b;if(T-D<=r&&(J=g(l.pos-S,_))){let ie=new Uint16Array(J.size-J.skip),Ce=l.pos-J.size,Oe=ie.length;for(;l.pos>Ce;)Oe=y(J.start,ie,Oe);W=new Ys(ie,T-J.start,i),re=J.start-b}else{let ie=l.pos-B;l.next();let Ce=[],Oe=[],Ve=O>=o?O:-1,st=0,jt=T;for(;l.pos>ie;)Ve>=0&&l.id==Ve&&l.size>=0?(l.end<=jt-r&&(d(Ce,Oe,D,st,l.end,jt,Ve,N),st=Ce.length,jt=l.end),l.next()):u(D,ie,Ce,Oe,Ve);if(Ve>=0&&st>0&&st<Ce.length&&d(Ce,Oe,D,st,D,jt,Ve,N),Ce.reverse(),Oe.reverse(),Ve>-1&&st>0){let vr=f(ne);W=tm(ne,Ce,Oe,0,Ce.length,0,T-D,vr,vr)}else W=p(ne,Ce,Oe,T-D,N-T)}k.push(W),A.push(re)}function f(b){return(S,k,A)=>{let _=0,O=S.length-1,D,T;if(O>=0&&(D=S[O])instanceof et){if(!O&&D.type==b&&D.length==A)return D;(T=D.prop(qe.lookAhead))&&(_=k[O]+D.length+T)}return p(b,S,k,A,_)}}function d(b,S,k,A,_,O,D,T){let B=[],N=[];for(;b.length>A;)B.push(b.pop()),N.push(S.pop()+k-_);b.push(p(i.types[D],B,N,O-_,T-O)),S.push(_-k)}function p(b,S,k,A,_=0,O){if(h){let D=[qe.contextHash,h];O=O?[D].concat(O):[D]}if(_>25){let D=[qe.lookAhead,_];O=O?[D].concat(O):[D]}return new et(b,S,k,A,O)}function g(b,S){let k=l.fork(),A=0,_=0,O=0,D=k.end-r,T={size:0,start:0,skip:0};e:for(let B=k.pos-b;k.pos>B;){let N=k.size;if(k.id==S&&N>=0){T.size=A,T.start=_,T.skip=O,O+=4,A+=4,k.next();continue}let ne=k.pos-N;if(N<0||ne<B||k.start<D)break;let W=k.id>=o?4:0,J=k.start;for(k.next();k.pos>ne;){if(k.size<0)if(k.size==-3)W+=4;else break e;else k.id>=o&&(W+=4);k.next()}_=J,A+=N,O+=W}return(S<0||A==b)&&(T.size=A,T.start=_,T.skip=O),T.size>4?T:void 0}function y(b,S,k){let{id:A,start:_,end:O,size:D}=l;if(l.next(),D>=0&&A<o){let T=k;if(D>4){let B=l.pos-(D-4);for(;l.pos>B;)k=y(b,S,k)}S[--k]=T,S[--k]=O-b,S[--k]=_-b,S[--k]=A}else D==-3?h=A:D==-4&&(c=A);return k}let v=[],C=[];for(;l.pos>0;)u(n.start||0,n.bufferStart||0,v,C,-1);let x=(e=n.length)!==null&&e!==void 0?e:v.length?C[0]+v[0].length:0;return new et(a[n.topID],v.reverse(),C.reverse(),x)}const J1=new WeakMap;function Mc(n,e){if(!n.isAnonymous||e instanceof Ys||e.type!=n)return 1;let t=J1.get(e);if(t==null){t=1;for(let i of e.children){if(i.type!=n||!(i instanceof et)){t=1;break}t+=Mc(n,i)}J1.set(e,t)}return t}function tm(n,e,t,i,r,s,o,l,a){let h=0;for(let p=i;p<r;p++)h+=Mc(n,e[p]);let c=Math.ceil(h*1.5/8),u=[],f=[];function d(p,g,y,v,C){for(let x=y;x<v;){let b=x,S=g[x],k=Mc(n,p[x]);for(x++;x<v;x++){let A=Mc(n,p[x]);if(k+A>=c)break;k+=A}if(x==b+1){if(k>c){let A=p[b];d(A.children,A.positions,0,A.children.length,g[b]+C);continue}u.push(p[b])}else{let A=g[x-1]+p[x-1].length-S;u.push(tm(n,p,g,b,x,S,A,null,a))}f.push(S+C-s)}}return d(e,t,i,r,0),(l||a)(u,f,o)}class Or{constructor(e,t,i,r,s=!1,o=!1){this.from=e,this.to=t,this.tree=i,this.offset=r,this.open=(s?1:0)|(o?2:0)}get openStart(){return(this.open&1)>0}get openEnd(){return(this.open&2)>0}static addTree(e,t=[],i=!1){let r=[new Or(0,e.length,e,0,!1,i)];for(let s of t)s.to>e.length&&r.push(s);return r}static applyChanges(e,t,i=128){if(!t.length)return e;let r=[],s=1,o=e.length?e[0]:null;for(let l=0,a=0,h=0;;l++){let c=l<t.length?t[l]:null,u=c?c.fromA:1e9;if(u-a>=i)for(;o&&o.from<u;){let f=o;if(a>=f.from||u<=f.to||h){let d=Math.max(f.from,a)-h,p=Math.min(f.to,u)-h;f=d>=p?null:new Or(d,p,f.tree,f.offset+h,l>0,!!c)}if(f&&r.push(f),o.to>u)break;o=s<e.length?e[s++]:null}if(!c)break;a=c.toA,h=c.toA-c.toB}return r}}class Z1{startParse(e,t,i){return typeof e=="string"&&(e=new DF(e)),i=i?i.length?i.map(r=>new bn(r.from,r.to)):[new bn(0,0)]:[new bn(0,e.length)],this.createParse(e,t||[],i)}parse(e,t,i){let r=this.startParse(e,t,i);for(;;){let s=r.advance();if(s)return s}}}class DF{constructor(e){this.string=e}get length(){return this.string.length}chunk(e){return this.string.slice(e)}get lineChunks(){return!1}read(e,t){return this.string.slice(e,t)}}function qj(n){return(e,t,i,r)=>new EF(e,n,t,i,r)}class Y1{constructor(e,t,i,r,s){this.parser=e,this.parse=t,this.overlay=i,this.target=r,this.ranges=s}}class MF{constructor(e,t,i,r,s,o,l){this.parser=e,this.predicate=t,this.mounts=i,this.index=r,this.start=s,this.target=o,this.prev=l,this.depth=0,this.ranges=[]}}const im=new qe({perNode:!0});class EF{constructor(e,t,i,r,s){this.nest=t,this.input=i,this.fragments=r,this.ranges=s,this.inner=[],this.innerDone=0,this.baseTree=null,this.stoppedAt=null,this.baseParse=e}advance(){if(this.baseParse){let i=this.baseParse.advance();if(!i)return null;if(this.baseParse=null,this.baseTree=i,this.startInner(),this.stoppedAt!=null)for(let r of this.inner)r.parse.stopAt(this.stoppedAt)}if(this.innerDone==this.inner.length){let i=this.baseTree;return this.stoppedAt!=null&&(i=new et(i.type,i.children,i.positions,i.length,i.propValues.concat([[im,this.stoppedAt]]))),i}let e=this.inner[this.innerDone],t=e.parse.advance();if(t){this.innerDone++;let i=Object.assign(Object.create(null),e.target.props);i[qe.mounted.id]=new CF(t,e.overlay,e.parser),e.target.props=i}return null}get parsedPos(){if(this.baseParse)return 0;let e=this.input.length;for(let t=this.innerDone;t<this.inner.length;t++)this.inner[t].ranges[0].from<e&&(e=Math.min(e,this.inner[t].parse.parsedPos));return e}stopAt(e){if(this.stoppedAt=e,this.baseParse)this.baseParse.stopAt(e);else for(let t=this.innerDone;t<this.inner.length;t++)this.inner[t].parse.stopAt(e)}startInner(){let e=new BF(this.fragments),t=null,i=null,r=new ha(new jn(this.baseTree,this.ranges[0].from,0,null),1);e:for(let s,o;this.stoppedAt==null||r.from<this.stoppedAt;){let l=!0,a;if(e.hasNode(r)){if(t){let h=t.mounts.find(c=>c.frag.from<=r.from&&c.frag.to>=r.to&&c.mount.overlay);if(h)for(let c of h.mount.overlay){let u=c.from+h.pos,f=c.to+h.pos;u>=r.from&&f<=r.to&&!t.ranges.some(d=>d.from<f&&d.to>u)&&t.ranges.push({from:u,to:f})}}l=!1}else if(i&&(o=TF(i.ranges,r.from,r.to)))l=o!=2;else if(!r.type.isAnonymous&&r.from<r.to&&(s=this.nest(r,this.input))){r.tree||PF(r);let h=e.findMounts(r.from,s.parser);if(typeof s.overlay=="function")t=new MF(s.parser,s.overlay,h,this.inner.length,r.from,r.tree,t);else{let c=ex(this.ranges,s.overlay||[new bn(r.from,r.to)]);c.length&&this.inner.push(new Y1(s.parser,s.parser.startParse(this.input,tx(h,c),c),s.overlay?s.overlay.map(u=>new bn(u.from-r.from,u.to-r.from)):null,r.tree,c)),s.overlay?c.length&&(i={ranges:c,depth:0,prev:i}):l=!1}}else t&&(a=t.predicate(r))&&(a===!0&&(a=new bn(r.from,r.to)),a.from<a.to&&t.ranges.push(a));if(l&&r.firstChild())t&&t.depth++,i&&i.depth++;else for(;!r.nextSibling();){if(!r.parent())break e;if(t&&!--t.depth){let h=ex(this.ranges,t.ranges);h.length&&this.inner.splice(t.index,0,new Y1(t.parser,t.parser.startParse(this.input,tx(t.mounts,h),h),t.ranges.map(c=>new bn(c.from-t.start,c.to-t.start)),t.target,h)),t=t.prev}i&&!--i.depth&&(i=i.prev)}}}}function TF(n,e,t){for(let i of n){if(i.from>=t)break;if(i.to>e)return i.from<=e&&i.to>=t?2:1}return 0}function X1(n,e,t,i,r,s){if(e<t){let o=n.buffer[e+1],l=n.buffer[t-2];i.push(n.slice(e,t,o,l)),r.push(o-s)}}function PF(n){let{node:e}=n,t=0;do n.parent(),t++;while(!n.tree);let i=0,r=n.tree,s=0;for(;s=r.positions[i]+n.from,!(s<=e.from&&s+r.children[i].length>=e.to);i++);let o=r.children[i],l=o.buffer;function a(h,c,u,f,d){let p=h;for(;l[p+2]+s<=e.from;)p=l[p+3];let g=[],y=[];X1(o,h,p,g,y,f);let v=l[p+1],C=l[p+2],x=v+s==e.from&&C+s==e.to&&l[p]==e.type.id;return g.push(x?e.toTree():a(p+4,l[p+3],o.set.types[l[p]],v,C-v)),y.push(v-f),X1(o,l[p+3],c,g,y,f),new et(u,g,y,d)}r.children[i]=a(0,l.length,Ei.none,0,o.length);for(let h=0;h<=t;h++)n.childAfter(e.from)}class Q1{constructor(e,t){this.offset=t,this.done=!1,this.cursor=e.fullCursor()}moveTo(e){let{cursor:t}=this,i=e-this.offset;for(;!this.done&&t.from<i;)t.to>=e&&t.enter(i,1,!1,!1)||t.next(!1)||(this.done=!0)}hasNode(e){if(this.moveTo(e.from),!this.done&&this.cursor.from+this.offset==e.from&&this.cursor.tree)for(let t=this.cursor.tree;;){if(t==e.tree)return!0;if(t.children.length&&t.positions[0]==0&&t.children[0]instanceof et)t=t.children[0];else break}return!1}}class BF{constructor(e){var t;if(this.fragments=e,this.curTo=0,this.fragI=0,e.length){let i=this.curFrag=e[0];this.curTo=(t=i.tree.prop(im))!==null&&t!==void 0?t:i.to,this.inner=new Q1(i.tree,-i.offset)}else this.curFrag=this.inner=null}hasNode(e){for(;this.curFrag&&e.from>=this.curTo;)this.nextFrag();return this.curFrag&&this.curFrag.from<=e.from&&this.curTo>=e.to&&this.inner.hasNode(e)}nextFrag(){var e;if(this.fragI++,this.fragI==this.fragments.length)this.curFrag=this.inner=null;else{let t=this.curFrag=this.fragments[this.fragI];this.curTo=(e=t.tree.prop(im))!==null&&e!==void 0?e:t.to,this.inner=new Q1(t.tree,-t.offset)}}findMounts(e,t){var i;let r=[];if(this.inner){this.inner.cursor.moveTo(e,1);for(let s=this.inner.cursor.node;s;s=s.parent){let o=(i=s.tree)===null||i===void 0?void 0:i.prop(qe.mounted);if(o&&o.parser==t)for(let l=this.fragI;l<this.fragments.length;l++){let a=this.fragments[l];if(a.from>=s.to)break;a.tree==this.curFrag.tree&&r.push({frag:a,pos:s.from-a.offset,mount:o})}}}return r}}function ex(n,e){let t=null,i=e;for(let r=1,s=0;r<n.length;r++){let o=n[r-1].to,l=n[r].from;for(;s<i.length;s++){let a=i[s];if(a.from>=l)break;a.to<=o||(t||(i=t=e.slice()),a.from<o?(t[s]=new bn(a.from,o),a.to>l&&t.splice(s+1,0,new bn(l,a.to))):a.to>l?t[s--]=new bn(l,a.to):t.splice(s--,1))}}return i}function RF(n,e,t,i){let r=0,s=0,o=!1,l=!1,a=-1e9,h=[];for(;;){let c=r==n.length?1e9:o?n[r].to:n[r].from,u=s==e.length?1e9:l?e[s].to:e[s].from;if(o!=l){let f=Math.max(a,t),d=Math.min(c,u,i);f<d&&h.push(new bn(f,d))}if(a=Math.min(c,u),a==1e9)break;c==a&&(o?(o=!1,r++):o=!0),u==a&&(l?(l=!1,s++):l=!0)}return h}function tx(n,e){let t=[];for(let{pos:i,mount:r,frag:s}of n){let o=i+(r.overlay?r.overlay[0].from:0),l=o+r.tree.length,a=Math.max(s.from,o),h=Math.min(s.to,l);if(r.overlay){let c=r.overlay.map(f=>new bn(f.from+i,f.to+i)),u=RF(e,c,a,h);for(let f=0,d=a;;f++){let p=f==u.length,g=p?h:u[f].from;if(g>d&&t.push(new Or(d,g,r.tree,-o,s.from>=d,s.to<=g)),p)break;d=u[f].to}}else t.push(new Or(a,h,r.tree,-o,s.from>=o,s.to<=l))}return t}const LF=1024;let FF=0;class xn{constructor(e,t){this.from=e,this.to=t}}class je{constructor(e={}){this.id=FF++,this.perNode=!!e.perNode,this.deserialize=e.deserialize||(()=>{throw new Error("This node type doesn't define a deserialize function")})}add(e){if(this.perNode)throw new RangeError("Can't add per-node props to node types");return typeof e!="function"&&(e=rn.match(e)),t=>{let i=e(t);return i===void 0?null:[this,i]}}}je.closedBy=new je({deserialize:n=>n.split(" ")}),je.openedBy=new je({deserialize:n=>n.split(" ")}),je.group=new je({deserialize:n=>n.split(" ")}),je.contextHash=new je({perNode:!0}),je.lookAhead=new je({perNode:!0}),je.mounted=new je({perNode:!0});class NF{constructor(e,t,i){this.tree=e,this.overlay=t,this.parser=i}}const IF=Object.create(null);class rn{constructor(e,t,i,r=0){this.name=e,this.props=t,this.id=i,this.flags=r}static define(e){let t=e.props&&e.props.length?Object.create(null):IF,i=(e.top?1:0)|(e.skipped?2:0)|(e.error?4:0)|(e.name==null?8:0),r=new rn(e.name||"",t,e.id,i);if(e.props){for(let s of e.props)if(Array.isArray(s)||(s=s(r)),s){if(s[0].perNode)throw new RangeError("Can't store a per-node prop on a node type");t[s[0].id]=s[1]}}return r}prop(e){return this.props[e.id]}get isTop(){return(this.flags&1)>0}get isSkipped(){return(this.flags&2)>0}get isError(){return(this.flags&4)>0}get isAnonymous(){return(this.flags&8)>0}is(e){if(typeof e=="string"){if(this.name==e)return!0;let t=this.prop(je.group);return t?t.indexOf(e)>-1:!1}return this.id==e}static match(e){let t=Object.create(null);for(let i in e)for(let r of i.split(" "))t[r]=e[i];return i=>{for(let r=i.prop(je.group),s=-1;s<(r?r.length:0);s++){let o=t[s<0?i.name:r[s]];if(o)return o}}}}rn.none=new rn("",Object.create(null),0,8);class ix{constructor(e){this.types=e;for(let t=0;t<e.length;t++)if(e[t].id!=t)throw new RangeError("Node type ids should correspond to array positions when creating a node set")}extend(...e){let t=[];for(let i of this.types){let r=null;for(let s of e){let o=s(i);o&&(r||(r=Object.assign({},i.props)),r[o[0].id]=o[1])}t.push(r?new rn(i.name,r,i.id,i.flags):i)}return new ix(t)}}const Ec=new WeakMap,nx=new WeakMap;class $t{constructor(e,t,i,r,s){if(this.type=e,this.children=t,this.positions=i,this.length=r,this.props=null,s&&s.length){this.props=Object.create(null);for(let[o,l]of s)this.props[typeof o=="number"?o:o.id]=l}}toString(){let e=this.prop(je.mounted);if(e&&!e.overlay)return e.tree.toString();let t="";for(let i of this.children){let r=i.toString();r&&(t&&(t+=","),t+=r)}return this.type.name?(/\W/.test(this.type.name)&&!this.type.isError?JSON.stringify(this.type.name):this.type.name)+(t.length?"("+t+")":""):t}cursor(e,t=0){let i=e!=null&&Ec.get(this)||this.topNode,r=new ca(i);return e!=null&&(r.moveTo(e,t),Ec.set(this,r._tree)),r}fullCursor(){return new ca(this.topNode,1)}get topNode(){return new $n(this,0,0,null)}resolve(e,t=0){let i=$o(Ec.get(this)||this.topNode,e,t,!1);return Ec.set(this,i),i}resolveInner(e,t=0){let i=$o(nx.get(this)||this.topNode,e,t,!0);return nx.set(this,i),i}iterate(e){let{enter:t,leave:i,from:r=0,to:s=this.length}=e;for(let o=this.cursor(),l=()=>o.node;;){let a=!1;if(o.from<=s&&o.to>=r&&(o.type.isAnonymous||t(o.type,o.from,o.to,l)!==!1)){if(o.firstChild())continue;o.type.isAnonymous||(a=!0)}for(;a&&i&&i(o.type,o.from,o.to,l),a=o.type.isAnonymous,!o.nextSibling();){if(!o.parent())return;a=!0}}}prop(e){return e.perNode?this.props?this.props[e.id]:void 0:this.type.prop(e)}get propValues(){let e=[];if(this.props)for(let t in this.props)e.push([+t,this.props[t]]);return e}balance(e={}){return this.children.length<=8?this:sm(rn.none,this.children,this.positions,0,this.children.length,0,this.length,(t,i,r)=>new $t(this.type,t,i,r,this.propValues),e.makeTree||((t,i,r)=>new $t(rn.none,t,i,r)))}static build(e){return VF(e)}}$t.empty=new $t(rn.none,[],[],0);class nm{constructor(e,t){this.buffer=e,this.index=t}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}get pos(){return this.index}next(){this.index-=4}fork(){return new nm(this.buffer,this.index)}}class Xs{constructor(e,t,i){this.buffer=e,this.length=t,this.set=i}get type(){return rn.none}toString(){let e=[];for(let t=0;t<this.buffer.length;)e.push(this.childString(t)),t=this.buffer[t+3];return e.join(",")}childString(e){let t=this.buffer[e],i=this.buffer[e+3],r=this.set.types[t],s=r.name;if(/\W/.test(s)&&!r.isError&&(s=JSON.stringify(s)),e+=4,i==e)return s;let o=[];for(;e<i;)o.push(this.childString(e)),e=this.buffer[e+3];return s+"("+o.join(",")+")"}findChild(e,t,i,r,s){let{buffer:o}=this,l=-1;for(let a=e;a!=t&&!(rx(s,r,o[a+1],o[a+2])&&(l=a,i>0));a=o[a+3]);return l}slice(e,t,i,r){let s=this.buffer,o=new Uint16Array(t-e);for(let l=e,a=0;l<t;)o[a++]=s[l++],o[a++]=s[l++]-i,o[a++]=s[l++]-i,o[a++]=s[l++]-e;return new Xs(o,r-i,this.set)}}function rx(n,e,t,i){switch(n){case-2:return t<e;case-1:return i>=e&&t<e;case 0:return t<e&&i>e;case 1:return t<=e&&i>e;case 2:return i>e;case 4:return!0}}function sx(n,e){let t=n.childBefore(e);for(;t;){let i=t.lastChild;if(!i||i.to!=t.to)break;i.type.isError&&i.from==i.to?(n=t,t=i.prevSibling):t=i}return n}function $o(n,e,t,i){for(var r;n.from==n.to||(t<1?n.from>=e:n.from>e)||(t>-1?n.to<=e:n.to<e);){let s=!i&&n instanceof $n&&n.index<0?null:n.parent;if(!s)return n;n=s}if(i)for(let s=n,o=s.parent;o;s=o,o=s.parent)s instanceof $n&&s.index<0&&((r=o.enter(e,t,!0))===null||r===void 0?void 0:r.from)!=s.from&&(n=o);for(;;){let s=n.enter(e,t,i);if(!s)return n;n=s}}class $n{constructor(e,t,i,r){this.node=e,this._from=t,this.index=i,this._parent=r}get type(){return this.node.type}get name(){return this.node.type.name}get from(){return this._from}get to(){return this._from+this.node.length}nextChild(e,t,i,r,s=0){for(let o=this;;){for(let{children:l,positions:a}=o.node,h=t>0?l.length:-1;e!=h;e+=t){let c=l[e],u=a[e]+o._from;if(!!rx(r,i,u,u+c.length)){if(c instanceof Xs){if(s&2)continue;let f=c.findChild(0,c.buffer.length,t,i-u,r);if(f>-1)return new ss(new WF(o,c,e,u),null,f)}else if(s&1||!c.type.isAnonymous||rm(c)){let f;if(!(s&1)&&c.props&&(f=c.prop(je.mounted))&&!f.overlay)return new $n(f.tree,u,e,o);let d=new $n(c,u,e,o);return s&1||!d.type.isAnonymous?d:d.nextChild(t<0?c.children.length-1:0,t,i,r)}}}if(s&1||!o.type.isAnonymous||(o.index>=0?e=o.index+t:e=t<0?-1:o._parent.node.children.length,o=o._parent,!o))return null}}get firstChild(){return this.nextChild(0,1,0,4)}get lastChild(){return this.nextChild(this.node.children.length-1,-1,0,4)}childAfter(e){return this.nextChild(0,1,e,2)}childBefore(e){return this.nextChild(this.node.children.length-1,-1,e,-2)}enter(e,t,i=!0,r=!0){let s;if(i&&(s=this.node.prop(je.mounted))&&s.overlay){let o=e-this.from;for(let{from:l,to:a}of s.overlay)if((t>0?l<=o:l<o)&&(t<0?a>=o:a>o))return new $n(s.tree,s.overlay[0].from+this.from,-1,this)}return this.nextChild(0,1,e,t,r?0:2)}nextSignificantParent(){let e=this;for(;e.type.isAnonymous&&e._parent;)e=e._parent;return e}get parent(){return this._parent?this._parent.nextSignificantParent():null}get nextSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index+1,1,0,4):null}get prevSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index-1,-1,0,4):null}get cursor(){return new ca(this)}get tree(){return this.node}toTree(){return this.node}resolve(e,t=0){return $o(this,e,t,!1)}resolveInner(e,t=0){return $o(this,e,t,!0)}enterUnfinishedNodesBefore(e){return sx(this,e)}getChild(e,t=null,i=null){let r=Tc(this,e,t,i);return r.length?r[0]:null}getChildren(e,t=null,i=null){return Tc(this,e,t,i)}toString(){return this.node.toString()}}function Tc(n,e,t,i){let r=n.cursor,s=[];if(!r.firstChild())return s;if(t!=null){for(;!r.type.is(t);)if(!r.nextSibling())return s}for(;;){if(i!=null&&r.type.is(i))return s;if(r.type.is(e)&&s.push(r.node),!r.nextSibling())return i==null?s:[]}}class WF{constructor(e,t,i,r){this.parent=e,this.buffer=t,this.index=i,this.start=r}}class ss{constructor(e,t,i){this.context=e,this._parent=t,this.index=i,this.type=e.buffer.set.types[e.buffer.buffer[i]]}get name(){return this.type.name}get from(){return this.context.start+this.context.buffer.buffer[this.index+1]}get to(){return this.context.start+this.context.buffer.buffer[this.index+2]}child(e,t,i){let{buffer:r}=this.context,s=r.findChild(this.index+4,r.buffer[this.index+3],e,t-this.context.start,i);return s<0?null:new ss(this.context,this,s)}get firstChild(){return this.child(1,0,4)}get lastChild(){return this.child(-1,0,4)}childAfter(e){return this.child(1,e,2)}childBefore(e){return this.child(-1,e,-2)}enter(e,t,i,r=!0){if(!r)return null;let{buffer:s}=this.context,o=s.findChild(this.index+4,s.buffer[this.index+3],t>0?1:-1,e-this.context.start,t);return o<0?null:new ss(this.context,this,o)}get parent(){return this._parent||this.context.parent.nextSignificantParent()}externalSibling(e){return this._parent?null:this.context.parent.nextChild(this.context.index+e,e,0,4)}get nextSibling(){let{buffer:e}=this.context,t=e.buffer[this.index+3];return t<(this._parent?e.buffer[this._parent.index+3]:e.buffer.length)?new ss(this.context,this._parent,t):this.externalSibling(1)}get prevSibling(){let{buffer:e}=this.context,t=this._parent?this._parent.index+4:0;return this.index==t?this.externalSibling(-1):new ss(this.context,this._parent,e.findChild(t,this.index,-1,0,4))}get cursor(){return new ca(this)}get tree(){return null}toTree(){let e=[],t=[],{buffer:i}=this.context,r=this.index+4,s=i.buffer[this.index+3];if(s>r){let o=i.buffer[this.index+1],l=i.buffer[this.index+2];e.push(i.slice(r,s,o,l)),t.push(0)}return new $t(this.type,e,t,this.to-this.from)}resolve(e,t=0){return $o(this,e,t,!1)}resolveInner(e,t=0){return $o(this,e,t,!0)}enterUnfinishedNodesBefore(e){return sx(this,e)}toString(){return this.context.buffer.childString(this.index)}getChild(e,t=null,i=null){let r=Tc(this,e,t,i);return r.length?r[0]:null}getChildren(e,t=null,i=null){return Tc(this,e,t,i)}}class ca{constructor(e,t=0){if(this.mode=t,this.buffer=null,this.stack=[],this.index=0,this.bufferNode=null,e instanceof $n)this.yieldNode(e);else{this._tree=e.context.parent,this.buffer=e.context;for(let i=e._parent;i;i=i._parent)this.stack.unshift(i.index);this.bufferNode=e,this.yieldBuf(e.index)}}get name(){return this.type.name}yieldNode(e){return e?(this._tree=e,this.type=e.type,this.from=e.from,this.to=e.to,!0):!1}yieldBuf(e,t){this.index=e;let{start:i,buffer:r}=this.buffer;return this.type=t||r.set.types[r.buffer[e]],this.from=i+r.buffer[e+1],this.to=i+r.buffer[e+2],!0}yield(e){return e?e instanceof $n?(this.buffer=null,this.yieldNode(e)):(this.buffer=e.context,this.yieldBuf(e.index,e.type)):!1}toString(){return this.buffer?this.buffer.buffer.childString(this.index):this._tree.toString()}enterChild(e,t,i){if(!this.buffer)return this.yield(this._tree.nextChild(e<0?this._tree.node.children.length-1:0,e,t,i,this.mode));let{buffer:r}=this.buffer,s=r.findChild(this.index+4,r.buffer[this.index+3],e,t-this.buffer.start,i);return s<0?!1:(this.stack.push(this.index),this.yieldBuf(s))}firstChild(){return this.enterChild(1,0,4)}lastChild(){return this.enterChild(-1,0,4)}childAfter(e){return this.enterChild(1,e,2)}childBefore(e){return this.enterChild(-1,e,-2)}enter(e,t,i=!0,r=!0){return this.buffer?r?this.enterChild(1,e,t):!1:this.yield(this._tree.enter(e,t,i&&!(this.mode&1),r))}parent(){if(!this.buffer)return this.yieldNode(this.mode&1?this._tree._parent:this._tree.parent);if(this.stack.length)return this.yieldBuf(this.stack.pop());let e=this.mode&1?this.buffer.parent:this.buffer.parent.nextSignificantParent();return this.buffer=null,this.yieldNode(e)}sibling(e){if(!this.buffer)return this._tree._parent?this.yield(this._tree.index<0?null:this._tree._parent.nextChild(this._tree.index+e,e,0,4,this.mode)):!1;let{buffer:t}=this.buffer,i=this.stack.length-1;if(e<0){let r=i<0?0:this.stack[i]+4;if(this.index!=r)return this.yieldBuf(t.findChild(r,this.index,-1,0,4))}else{let r=t.buffer[this.index+3];if(r<(i<0?t.buffer.length:t.buffer[this.stack[i]+3]))return this.yieldBuf(r)}return i<0?this.yield(this.buffer.parent.nextChild(this.buffer.index+e,e,0,4,this.mode)):!1}nextSibling(){return this.sibling(1)}prevSibling(){return this.sibling(-1)}atLastNode(e){let t,i,{buffer:r}=this;if(r){if(e>0){if(this.index<r.buffer.buffer.length)return!1}else for(let s=0;s<this.index;s++)if(r.buffer.buffer[s+3]<this.index)return!1;({index:t,parent:i}=r)}else({index:t,_parent:i}=this._tree);for(;i;{index:t,_parent:i}=i)if(t>-1)for(let s=t+e,o=e<0?-1:i.node.children.length;s!=o;s+=e){let l=i.node.children[s];if(this.mode&1||l instanceof Xs||!l.type.isAnonymous||rm(l))return!1}return!0}move(e,t){if(t&&this.enterChild(e,0,4))return!0;for(;;){if(this.sibling(e))return!0;if(this.atLastNode(e)||!this.parent())return!1}}next(e=!0){return this.move(1,e)}prev(e=!0){return this.move(-1,e)}moveTo(e,t=0){for(;(this.from==this.to||(t<1?this.from>=e:this.from>e)||(t>-1?this.to<=e:this.to<e))&&this.parent(););for(;this.enterChild(1,e,t););return this}get node(){if(!this.buffer)return this._tree;let e=this.bufferNode,t=null,i=0;if(e&&e.context==this.buffer){e:for(let r=this.index,s=this.stack.length;s>=0;){for(let o=e;o;o=o._parent)if(o.index==r){if(r==this.index)return o;t=o,i=s+1;break e}r=this.stack[--s]}}for(let r=i;r<this.stack.length;r++)t=new ss(this.buffer,t,this.stack[r]);return this.bufferNode=new ss(this.buffer,t,this.index)}get tree(){return this.buffer?null:this._tree.node}}function rm(n){return n.children.some(e=>e instanceof Xs||!e.type.isAnonymous||rm(e))}function VF(n){var e;let{buffer:t,nodeSet:i,maxBufferLength:r=LF,reused:s=[],minRepeatType:o=i.types.length}=n,l=Array.isArray(t)?new nm(t,t.length):t,a=i.types,h=0,c=0;function u(b,S,k,A,_){let{id:O,start:D,end:T,size:B}=l,N=c;for(;B<0;)if(l.next(),B==-1){let ie=s[O];k.push(ie),A.push(D-b);return}else if(B==-3){h=O;return}else if(B==-4){c=O;return}else throw new RangeError(`Unrecognized record size: ${B}`);let ne=a[O],W,J,re=D-b;if(T-D<=r&&(J=g(l.pos-S,_))){let ie=new Uint16Array(J.size-J.skip),Ce=l.pos-J.size,Oe=ie.length;for(;l.pos>Ce;)Oe=y(J.start,ie,Oe);W=new Xs(ie,T-J.start,i),re=J.start-b}else{let ie=l.pos-B;l.next();let Ce=[],Oe=[],Ve=O>=o?O:-1,st=0,jt=T;for(;l.pos>ie;)Ve>=0&&l.id==Ve&&l.size>=0?(l.end<=jt-r&&(d(Ce,Oe,D,st,l.end,jt,Ve,N),st=Ce.length,jt=l.end),l.next()):u(D,ie,Ce,Oe,Ve);if(Ve>=0&&st>0&&st<Ce.length&&d(Ce,Oe,D,st,D,jt,Ve,N),Ce.reverse(),Oe.reverse(),Ve>-1&&st>0){let vr=f(ne);W=sm(ne,Ce,Oe,0,Ce.length,0,T-D,vr,vr)}else W=p(ne,Ce,Oe,T-D,N-T)}k.push(W),A.push(re)}function f(b){return(S,k,A)=>{let _=0,O=S.length-1,D,T;if(O>=0&&(D=S[O])instanceof $t){if(!O&&D.type==b&&D.length==A)return D;(T=D.prop(je.lookAhead))&&(_=k[O]+D.length+T)}return p(b,S,k,A,_)}}function d(b,S,k,A,_,O,D,T){let B=[],N=[];for(;b.length>A;)B.push(b.pop()),N.push(S.pop()+k-_);b.push(p(i.types[D],B,N,O-_,T-O)),S.push(_-k)}function p(b,S,k,A,_=0,O){if(h){let D=[je.contextHash,h];O=O?[D].concat(O):[D]}if(_>25){let D=[je.lookAhead,_];O=O?[D].concat(O):[D]}return new $t(b,S,k,A,O)}function g(b,S){let k=l.fork(),A=0,_=0,O=0,D=k.end-r,T={size:0,start:0,skip:0};e:for(let B=k.pos-b;k.pos>B;){let N=k.size;if(k.id==S&&N>=0){T.size=A,T.start=_,T.skip=O,O+=4,A+=4,k.next();continue}let ne=k.pos-N;if(N<0||ne<B||k.start<D)break;let W=k.id>=o?4:0,J=k.start;for(k.next();k.pos>ne;){if(k.size<0)if(k.size==-3)W+=4;else break e;else k.id>=o&&(W+=4);k.next()}_=J,A+=N,O+=W}return(S<0||A==b)&&(T.size=A,T.start=_,T.skip=O),T.size>4?T:void 0}function y(b,S,k){let{id:A,start:_,end:O,size:D}=l;if(l.next(),D>=0&&A<o){let T=k;if(D>4){let B=l.pos-(D-4);for(;l.pos>B;)k=y(b,S,k)}S[--k]=T,S[--k]=O-b,S[--k]=_-b,S[--k]=A}else D==-3?h=A:D==-4&&(c=A);return k}let v=[],C=[];for(;l.pos>0;)u(n.start||0,n.bufferStart||0,v,C,-1);let x=(e=n.length)!==null&&e!==void 0?e:v.length?C[0]+v[0].length:0;return new $t(a[n.topID],v.reverse(),C.reverse(),x)}const ox=new WeakMap;function Pc(n,e){if(!n.isAnonymous||e instanceof Xs||e.type!=n)return 1;let t=ox.get(e);if(t==null){t=1;for(let i of e.children){if(i.type!=n||!(i instanceof $t)){t=1;break}t+=Pc(n,i)}ox.set(e,t)}return t}function sm(n,e,t,i,r,s,o,l,a){let h=0;for(let p=i;p<r;p++)h+=Pc(n,e[p]);let c=Math.ceil(h*1.5/8),u=[],f=[];function d(p,g,y,v,C){for(let x=y;x<v;){let b=x,S=g[x],k=Pc(n,p[x]);for(x++;x<v;x++){let A=Pc(n,p[x]);if(k+A>=c)break;k+=A}if(x==b+1){if(k>c){let A=p[b];d(A.children,A.positions,0,A.children.length,g[b]+C);continue}u.push(p[b])}else{let A=g[x-1]+p[x-1].length-S;u.push(sm(n,p,g,b,x,S,A,null,a))}f.push(S+C-s)}}return d(e,t,i,r,0),(l||a)(u,f,o)}class _r{constructor(e,t,i,r,s=!1,o=!1){this.from=e,this.to=t,this.tree=i,this.offset=r,this.open=(s?1:0)|(o?2:0)}get openStart(){return(this.open&1)>0}get openEnd(){return(this.open&2)>0}static addTree(e,t=[],i=!1){let r=[new _r(0,e.length,e,0,!1,i)];for(let s of t)s.to>e.length&&r.push(s);return r}static applyChanges(e,t,i=128){if(!t.length)return e;let r=[],s=1,o=e.length?e[0]:null;for(let l=0,a=0,h=0;;l++){let c=l<t.length?t[l]:null,u=c?c.fromA:1e9;if(u-a>=i)for(;o&&o.from<u;){let f=o;if(a>=f.from||u<=f.to||h){let d=Math.max(f.from,a)-h,p=Math.min(f.to,u)-h;f=d>=p?null:new _r(d,p,f.tree,f.offset+h,l>0,!!c)}if(f&&r.push(f),o.to>u)break;o=s<e.length?e[s++]:null}if(!c)break;a=c.toA,h=c.toA-c.toB}return r}}class HF{startParse(e,t,i){return typeof e=="string"&&(e=new zF(e)),i=i?i.length?i.map(r=>new xn(r.from,r.to)):[new xn(0,0)]:[new xn(0,e.length)],this.createParse(e,t||[],i)}parse(e,t,i){let r=this.startParse(e,t,i);for(;;){let s=r.advance();if(s)return s}}}class zF{constructor(e){this.string=e}get length(){return this.string.length}chunk(e){return this.string.slice(e)}get lineChunks(){return!1}read(e,t){return this.string.slice(e,t)}}function Kj(n){return(e,t,i,r)=>new $F(e,n,t,i,r)}class lx{constructor(e,t,i,r,s){this.parser=e,this.parse=t,this.overlay=i,this.target=r,this.ranges=s}}class jF{constructor(e,t,i,r,s,o,l){this.parser=e,this.predicate=t,this.mounts=i,this.index=r,this.start=s,this.target=o,this.prev=l,this.depth=0,this.ranges=[]}}const om=new je({perNode:!0});class $F{constructor(e,t,i,r,s){this.nest=t,this.input=i,this.fragments=r,this.ranges=s,this.inner=[],this.innerDone=0,this.baseTree=null,this.stoppedAt=null,this.baseParse=e}advance(){if(this.baseParse){let i=this.baseParse.advance();if(!i)return null;if(this.baseParse=null,this.baseTree=i,this.startInner(),this.stoppedAt!=null)for(let r of this.inner)r.parse.stopAt(this.stoppedAt)}if(this.innerDone==this.inner.length){let i=this.baseTree;return this.stoppedAt!=null&&(i=new $t(i.type,i.children,i.positions,i.length,i.propValues.concat([[om,this.stoppedAt]]))),i}let e=this.inner[this.innerDone],t=e.parse.advance();if(t){this.innerDone++;let i=Object.assign(Object.create(null),e.target.props);i[je.mounted.id]=new NF(t,e.overlay,e.parser),e.target.props=i}return null}get parsedPos(){if(this.baseParse)return 0;let e=this.input.length;for(let t=this.innerDone;t<this.inner.length;t++)this.inner[t].ranges[0].from<e&&(e=Math.min(e,this.inner[t].parse.parsedPos));return e}stopAt(e){if(this.stoppedAt=e,this.baseParse)this.baseParse.stopAt(e);else for(let t=this.innerDone;t<this.inner.length;t++)this.inner[t].parse.stopAt(e)}startInner(){let e=new KF(this.fragments),t=null,i=null,r=new ca(new $n(this.baseTree,this.ranges[0].from,0,null),1);e:for(let s,o;this.stoppedAt==null||r.from<this.stoppedAt;){let l=!0,a;if(e.hasNode(r)){if(t){let h=t.mounts.find(c=>c.frag.from<=r.from&&c.frag.to>=r.to&&c.mount.overlay);if(h)for(let c of h.mount.overlay){let u=c.from+h.pos,f=c.to+h.pos;u>=r.from&&f<=r.to&&!t.ranges.some(d=>d.from<f&&d.to>u)&&t.ranges.push({from:u,to:f})}}l=!1}else if(i&&(o=UF(i.ranges,r.from,r.to)))l=o!=2;else if(!r.type.isAnonymous&&r.from<r.to&&(s=this.nest(r,this.input))){r.tree||qF(r);let h=e.findMounts(r.from,s.parser);if(typeof s.overlay=="function")t=new jF(s.parser,s.overlay,h,this.inner.length,r.from,r.tree,t);else{let c=cx(this.ranges,s.overlay||[new xn(r.from,r.to)]);c.length&&this.inner.push(new lx(s.parser,s.parser.startParse(this.input,ux(h,c),c),s.overlay?s.overlay.map(u=>new xn(u.from-r.from,u.to-r.from)):null,r.tree,c)),s.overlay?c.length&&(i={ranges:c,depth:0,prev:i}):l=!1}}else t&&(a=t.predicate(r))&&(a===!0&&(a=new xn(r.from,r.to)),a.from<a.to&&t.ranges.push(a));if(l&&r.firstChild())t&&t.depth++,i&&i.depth++;else for(;!r.nextSibling();){if(!r.parent())break e;if(t&&!--t.depth){let h=cx(this.ranges,t.ranges);h.length&&this.inner.splice(t.index,0,new lx(t.parser,t.parser.startParse(this.input,ux(t.mounts,h),h),t.ranges.map(c=>new xn(c.from-t.start,c.to-t.start)),t.target,h)),t=t.prev}i&&!--i.depth&&(i=i.prev)}}}}function UF(n,e,t){for(let i of n){if(i.from>=t)break;if(i.to>e)return i.from<=e&&i.to>=t?2:1}return 0}function ax(n,e,t,i,r,s){if(e<t){let o=n.buffer[e+1],l=n.buffer[t-2];i.push(n.slice(e,t,o,l)),r.push(o-s)}}function qF(n){let{node:e}=n,t=0;do n.parent(),t++;while(!n.tree);let i=0,r=n.tree,s=0;for(;s=r.positions[i]+n.from,!(s<=e.from&&s+r.children[i].length>=e.to);i++);let o=r.children[i],l=o.buffer;function a(h,c,u,f,d){let p=h;for(;l[p+2]+s<=e.from;)p=l[p+3];let g=[],y=[];ax(o,h,p,g,y,f);let v=l[p+1],C=l[p+2],x=v+s==e.from&&C+s==e.to&&l[p]==e.type.id;return g.push(x?e.toTree():a(p+4,l[p+3],o.set.types[l[p]],v,C-v)),y.push(v-f),ax(o,l[p+3],c,g,y,f),new $t(u,g,y,d)}r.children[i]=a(0,l.length,rn.none,0,o.length);for(let h=0;h<=t;h++)n.childAfter(e.from)}class hx{constructor(e,t){this.offset=t,this.done=!1,this.cursor=e.fullCursor()}moveTo(e){let{cursor:t}=this,i=e-this.offset;for(;!this.done&&t.from<i;)t.to>=e&&t.enter(i,1,!1,!1)||t.next(!1)||(this.done=!0)}hasNode(e){if(this.moveTo(e.from),!this.done&&this.cursor.from+this.offset==e.from&&this.cursor.tree)for(let t=this.cursor.tree;;){if(t==e.tree)return!0;if(t.children.length&&t.positions[0]==0&&t.children[0]instanceof $t)t=t.children[0];else break}return!1}}class KF{constructor(e){var t;if(this.fragments=e,this.curTo=0,this.fragI=0,e.length){let i=this.curFrag=e[0];this.curTo=(t=i.tree.prop(om))!==null&&t!==void 0?t:i.to,this.inner=new hx(i.tree,-i.offset)}else this.curFrag=this.inner=null}hasNode(e){for(;this.curFrag&&e.from>=this.curTo;)this.nextFrag();return this.curFrag&&this.curFrag.from<=e.from&&this.curTo>=e.to&&this.inner.hasNode(e)}nextFrag(){var e;if(this.fragI++,this.fragI==this.fragments.length)this.curFrag=this.inner=null;else{let t=this.curFrag=this.fragments[this.fragI];this.curTo=(e=t.tree.prop(om))!==null&&e!==void 0?e:t.to,this.inner=new hx(t.tree,-t.offset)}}findMounts(e,t){var i;let r=[];if(this.inner){this.inner.cursor.moveTo(e,1);for(let s=this.inner.cursor.node;s;s=s.parent){let o=(i=s.tree)===null||i===void 0?void 0:i.prop(je.mounted);if(o&&o.parser==t)for(let l=this.fragI;l<this.fragments.length;l++){let a=this.fragments[l];if(a.from>=s.to)break;a.tree==this.curFrag.tree&&r.push({frag:a,pos:s.from-a.offset,mount:o})}}}return r}}function cx(n,e){let t=null,i=e;for(let r=1,s=0;r<n.length;r++){let o=n[r-1].to,l=n[r].from;for(;s<i.length;s++){let a=i[s];if(a.from>=l)break;a.to<=o||(t||(i=t=e.slice()),a.from<o?(t[s]=new xn(a.from,o),a.to>l&&t.splice(s+1,0,new xn(l,a.to))):a.to>l?t[s--]=new xn(l,a.to):t.splice(s--,1))}}return i}function GF(n,e,t,i){let r=0,s=0,o=!1,l=!1,a=-1e9,h=[];for(;;){let c=r==n.length?1e9:o?n[r].to:n[r].from,u=s==e.length?1e9:l?e[s].to:e[s].from;if(o!=l){let f=Math.max(a,t),d=Math.min(c,u,i);f<d&&h.push(new xn(f,d))}if(a=Math.min(c,u),a==1e9)break;c==a&&(o?(o=!1,r++):o=!0),u==a&&(l?(l=!1,s++):l=!0)}return h}function ux(n,e){let t=[];for(let{pos:i,mount:r,frag:s}of n){let o=i+(r.overlay?r.overlay[0].from:0),l=o+r.tree.length,a=Math.max(s.from,o),h=Math.min(s.to,l);if(r.overlay){let c=r.overlay.map(f=>new xn(f.from+i,f.to+i)),u=GF(e,c,a,h);for(let f=0,d=a;;f++){let p=f==u.length,g=p?h:u[f].from;if(g>d&&t.push(new _r(d,g,r.tree,-o,s.from>=d,s.to<=g)),p)break;d=u[f].to}}else t.push(new _r(a,h,r.tree,-o,s.from>=o,s.to<=l))}return t}const lm=/\r\n?|\n/;var Rn=function(n){return n[n.Simple=0]="Simple",n[n.TrackDel=1]="TrackDel",n[n.TrackBefore=2]="TrackBefore",n[n.TrackAfter=3]="TrackAfter",n}(Rn||(Rn={}));class os{constructor(e){this.sections=e}get length(){let e=0;for(let t=0;t<this.sections.length;t+=2)e+=this.sections[t];return e}get newLength(){let e=0;for(let t=0;t<this.sections.length;t+=2){let i=this.sections[t+1];e+=i<0?this.sections[t]:i}return e}get empty(){return this.sections.length==0||this.sections.length==2&&this.sections[1]<0}iterGaps(e){for(let t=0,i=0,r=0;t<this.sections.length;){let s=this.sections[t++],o=this.sections[t++];o<0?(e(i,r,s),r+=s):r+=o,i+=s}}iterChangedRanges(e,t=!1){am(this,e,t)}get invertedDesc(){let e=[];for(let t=0;t<this.sections.length;){let i=this.sections[t++],r=this.sections[t++];r<0?e.push(i,r):e.push(r,i)}return new os(e)}composeDesc(e){return this.empty?e:e.empty?this:fx(this,e)}mapDesc(e,t=!1){return e.empty?this:hm(this,e,t)}mapPos(e,t=-1,i=Rn.Simple){let r=0,s=0;for(let o=0;o<this.sections.length;){let l=this.sections[o++],a=this.sections[o++],h=r+l;if(a<0){if(h>e)return s+(e-r);s+=l}else{if(i!=Rn.Simple&&h>=e&&(i==Rn.TrackDel&&r<e&&h>e||i==Rn.TrackBefore&&r<e||i==Rn.TrackAfter&&h>e))return null;if(h>e||h==e&&t<0&&!l)return e==r||t<0?s:s+a;s+=a}r=h}if(e>r)throw new RangeError(`Position ${e} is out of range for changeset of length ${r}`);return s}touchesRange(e,t=e){for(let i=0,r=0;i<this.sections.length&&r<=t;){let s=this.sections[i++],o=this.sections[i++],l=r+s;if(o>=0&&r<=t&&l>=e)return r<e&&l>t?"cover":!0;r=l}return!1}toString(){let e="";for(let t=0;t<this.sections.length;){let i=this.sections[t++],r=this.sections[t++];e+=(e?" ":"")+i+(r>=0?":"+r:"")}return e}toJSON(){return this.sections}static fromJSON(e){if(!Array.isArray(e)||e.length%2||e.some(t=>typeof t!="number"))throw new RangeError("Invalid JSON representation of ChangeDesc");return new os(e)}}class hi extends os{constructor(e,t){super(e),this.inserted=t}apply(e){if(this.length!=e.length)throw new RangeError("Applying change set to a document with the wrong length");return am(this,(t,i,r,s,o)=>e=e.replace(r,r+(i-t),o),!1),e}mapDesc(e,t=!1){return hm(this,e,t,!0)}invert(e){let t=this.sections.slice(),i=[];for(let r=0,s=0;r<t.length;r+=2){let o=t[r],l=t[r+1];if(l>=0){t[r]=l,t[r+1]=o;let a=r>>1;for(;i.length<a;)i.push(j.empty);i.push(o?e.slice(s,s+o):j.empty)}s+=o}return new hi(t,i)}compose(e){return this.empty?e:e.empty?this:fx(this,e,!0)}map(e,t=!1){return e.empty?this:hm(this,e,t,!0)}iterChanges(e,t=!1){am(this,e,t)}get desc(){return new os(this.sections)}filter(e){let t=[],i=[],r=[],s=new ua(this);e:for(let o=0,l=0;;){let a=o==e.length?1e9:e[o++];for(;l<a||l==a&&s.len==0;){if(s.done)break e;let c=Math.min(s.len,a-l);Ti(r,c,-1);let u=s.ins==-1?-1:s.off==0?s.ins:0;Ti(t,c,u),u>0&&Qs(i,t,s.text),s.forward(c),l+=c}let h=e[o++];for(;l<h;){if(s.done)break e;let c=Math.min(s.len,h-l);Ti(t,c,-1),Ti(r,c,s.ins==-1?-1:s.off==0?s.ins:0),s.forward(c),l+=c}}return{changes:new hi(t,i),filtered:new os(r)}}toJSON(){let e=[];for(let t=0;t<this.sections.length;t+=2){let i=this.sections[t],r=this.sections[t+1];r<0?e.push(i):r==0?e.push([i]):e.push([i].concat(this.inserted[t>>1].toJSON()))}return e}static of(e,t,i){let r=[],s=[],o=0,l=null;function a(c=!1){if(!c&&!r.length)return;o<t&&Ti(r,t-o,-1);let u=new hi(r,s);l=l?l.compose(u.map(l)):u,r=[],s=[],o=0}function h(c){if(Array.isArray(c))for(let u of c)h(u);else if(c instanceof hi){if(c.length!=t)throw new RangeError(`Mismatched change set length (got ${c.length}, expected ${t})`);a(),l=l?l.compose(c.map(l)):c}else{let{from:u,to:f=u,insert:d}=c;if(u>f||u<0||f>t)throw new RangeError(`Invalid change range ${u} to ${f} (in doc of length ${t})`);let p=d?typeof d=="string"?j.of(d.split(i||lm)):d:j.empty,g=p.length;if(u==f&&g==0)return;u<o&&a(),u>o&&Ti(r,u-o,-1),Ti(r,f-u,g),Qs(s,r,p),o=f}}return h(e),a(!l),l}static empty(e){return new hi(e?[e,-1]:[],[])}static fromJSON(e){if(!Array.isArray(e))throw new RangeError("Invalid JSON representation of ChangeSet");let t=[],i=[];for(let r=0;r<e.length;r++){let s=e[r];if(typeof s=="number")t.push(s,-1);else{if(!Array.isArray(s)||typeof s[0]!="number"||s.some((o,l)=>l&&typeof o!="string"))throw new RangeError("Invalid JSON representation of ChangeSet");if(s.length==1)t.push(s[0],0);else{for(;i.length<r;)i.push(j.empty);i[r]=j.of(s.slice(1)),t.push(s[0],i[r].length)}}}return new hi(t,i)}}function Ti(n,e,t,i=!1){if(e==0&&t<=0)return;let r=n.length-2;r>=0&&t<=0&&t==n[r+1]?n[r]+=e:e==0&&n[r]==0?n[r+1]+=t:i?(n[r]+=e,n[r+1]+=t):n.push(e,t)}function Qs(n,e,t){if(t.length==0)return;let i=e.length-2>>1;if(i<n.length)n[n.length-1]=n[n.length-1].append(t);else{for(;n.length<i;)n.push(j.empty);n.push(t)}}function am(n,e,t){let i=n.inserted;for(let r=0,s=0,o=0;o<n.sections.length;){let l=n.sections[o++],a=n.sections[o++];if(a<0)r+=l,s+=l;else{let h=r,c=s,u=j.empty;for(;h+=l,c+=a,a&&i&&(u=u.append(i[o-2>>1])),!(t||o==n.sections.length||n.sections[o+1]<0);)l=n.sections[o++],a=n.sections[o++];e(r,h,s,c,u),r=h,s=c}}}function hm(n,e,t,i=!1){let r=[],s=i?[]:null,o=new ua(n),l=new ua(e);for(let a=0,h=0;;)if(o.ins==-1)a+=o.len,o.next();else if(l.ins==-1&&h<a){let c=Math.min(l.len,a-h);l.forward(c),Ti(r,c,-1),h+=c}else if(l.ins>=0&&(o.done||h<a||h==a&&(l.len<o.len||l.len==o.len&&!t))){for(Ti(r,l.ins,-1);a>h&&!o.done&&a+o.len<h+l.len;)a+=o.len,o.next();h+=l.len,l.next()}else if(o.ins>=0){let c=0,u=a+o.len;for(;;)if(l.ins>=0&&h>a&&h+l.len<u)c+=l.ins,h+=l.len,l.next();else if(l.ins==-1&&h<u){let f=Math.min(l.len,u-h);c+=f,l.forward(f),h+=f}else break;Ti(r,c,o.ins),s&&Qs(s,r,o.text),a=u,o.next()}else{if(o.done&&l.done)return s?new hi(r,s):new os(r);throw new Error("Mismatched change set lengths")}}function fx(n,e,t=!1){let i=[],r=t?[]:null,s=new ua(n),o=new ua(e);for(let l=!1;;){if(s.done&&o.done)return r?new hi(i,r):new os(i);if(s.ins==0)Ti(i,s.len,0,l),s.next();else if(o.len==0&&!o.done)Ti(i,0,o.ins,l),r&&Qs(r,i,o.text),o.next();else{if(s.done||o.done)throw new Error("Mismatched change set lengths");{let a=Math.min(s.len2,o.len),h=i.length;if(s.ins==-1){let c=o.ins==-1?-1:o.off?0:o.ins;Ti(i,a,c,l),r&&c&&Qs(r,i,o.text)}else o.ins==-1?(Ti(i,s.off?0:s.len,a,l),r&&Qs(r,i,s.textBit(a))):(Ti(i,s.off?0:s.len,o.off?0:o.ins,l),r&&!o.off&&Qs(r,i,o.text));l=(s.ins>a||o.ins>=0&&o.len>a)&&(l||i.length>h),s.forward2(a),o.forward(a)}}}}class ua{constructor(e){this.set=e,this.i=0,this.next()}next(){let{sections:e}=this.set;this.i<e.length?(this.len=e[this.i++],this.ins=e[this.i++]):(this.len=0,this.ins=-2),this.off=0}get done(){return this.ins==-2}get len2(){return this.ins<0?this.len:this.ins}get text(){let{inserted:e}=this.set,t=this.i-2>>1;return t>=e.length?j.empty:e[t]}textBit(e){let{inserted:t}=this.set,i=this.i-2>>1;return i>=t.length&&!e?j.empty:t[i].slice(this.off,e==null?void 0:this.off+e)}forward(e){e==this.len?this.next():(this.len-=e,this.off+=e)}forward2(e){this.ins==-1?this.forward(e):e==this.ins?this.next():(this.ins-=e,this.off+=e)}}class Uo{constructor(e,t,i){this.from=e,this.to=t,this.flags=i}get anchor(){return this.flags&16?this.to:this.from}get head(){return this.flags&16?this.from:this.to}get empty(){return this.from==this.to}get assoc(){return this.flags&4?-1:this.flags&8?1:0}get bidiLevel(){let e=this.flags&3;return e==3?null:e}get goalColumn(){let e=this.flags>>5;return e==33554431?void 0:e}map(e,t=-1){let i,r;return this.empty?i=r=e.mapPos(this.from,t):(i=e.mapPos(this.from,1),r=e.mapPos(this.to,-1)),i==this.from&&r==this.to?this:new Uo(i,r,this.flags)}extend(e,t=e){if(e<=this.anchor&&t>=this.anchor)return be.range(e,t);let i=Math.abs(e-this.anchor)>Math.abs(t-this.anchor)?e:t;return be.range(this.anchor,i)}eq(e){return this.anchor==e.anchor&&this.head==e.head}toJSON(){return{anchor:this.anchor,head:this.head}}static fromJSON(e){if(!e||typeof e.anchor!="number"||typeof e.head!="number")throw new RangeError("Invalid JSON representation for SelectionRange");return be.range(e.anchor,e.head)}}class be{constructor(e,t=0){this.ranges=e,this.mainIndex=t}map(e,t=-1){return e.empty?this:be.create(this.ranges.map(i=>i.map(e,t)),this.mainIndex)}eq(e){if(this.ranges.length!=e.ranges.length||this.mainIndex!=e.mainIndex)return!1;for(let t=0;t<this.ranges.length;t++)if(!this.ranges[t].eq(e.ranges[t]))return!1;return!0}get main(){return this.ranges[this.mainIndex]}asSingle(){return this.ranges.length==1?this:new be([this.main])}addRange(e,t=!0){return be.create([e].concat(this.ranges),t?0:this.mainIndex+1)}replaceRange(e,t=this.mainIndex){let i=this.ranges.slice();return i[t]=e,be.create(i,this.mainIndex)}toJSON(){return{ranges:this.ranges.map(e=>e.toJSON()),main:this.mainIndex}}static fromJSON(e){if(!e||!Array.isArray(e.ranges)||typeof e.main!="number"||e.main>=e.ranges.length)throw new RangeError("Invalid JSON representation for EditorSelection");return new be(e.ranges.map(t=>Uo.fromJSON(t)),e.main)}static single(e,t=e){return new be([be.range(e,t)],0)}static create(e,t=0){if(e.length==0)throw new RangeError("A selection needs at least one range");for(let i=0,r=0;r<e.length;r++){let s=e[r];if(s.empty?s.from<=i:s.from<i)return JF(e.slice(),t);i=s.to}return new be(e,t)}static cursor(e,t=0,i,r){return new Uo(e,e,(t==0?0:t<0?4:8)|(i==null?3:Math.min(2,i))|(r!=null?r:33554431)<<5)}static range(e,t,i){let r=(i!=null?i:33554431)<<5;return t<e?new Uo(t,e,16|r|8):new Uo(e,t,r|(t>e?4:0))}}function JF(n,e=0){let t=n[e];n.sort((i,r)=>i.from-r.from),e=n.indexOf(t);for(let i=1;i<n.length;i++){let r=n[i],s=n[i-1];if(r.empty?r.from<=s.to:r.from<s.to){let o=s.from,l=Math.max(r.to,s.to);i<=e&&e--,n.splice(--i,2,r.anchor>r.head?be.range(l,o):be.range(o,l))}}return new be(n,e)}function dx(n,e){for(let t of n.ranges)if(t.to>e)throw new RangeError("Selection points outside of document")}let cm=0;class Re{constructor(e,t,i,r,s){this.combine=e,this.compareInput=t,this.compare=i,this.isStatic=r,this.extensions=s,this.id=cm++,this.default=e([])}static define(e={}){return new Re(e.combine||(t=>t),e.compareInput||((t,i)=>t===i),e.compare||(e.combine?(t,i)=>t===i:um),!!e.static,e.enables)}of(e){return new Bc([],this,0,e)}compute(e,t){if(this.isStatic)throw new Error("Can't compute a static facet");return new Bc(e,this,1,t)}computeN(e,t){if(this.isStatic)throw new Error("Can't compute a static facet");return new Bc(e,this,2,t)}from(e,t){return t||(t=i=>i),this.compute([e],i=>t(i.field(e)))}}function um(n,e){return n==e||n.length==e.length&&n.every((t,i)=>t===e[i])}class Bc{constructor(e,t,i,r){this.dependencies=e,this.facet=t,this.type=i,this.value=r,this.id=cm++}dynamicSlot(e){var t;let i=this.value,r=this.facet.compareInput,s=this.id,o=e[s]>>1,l=this.type==2,a=!1,h=!1,c=[];for(let u of this.dependencies)u=="doc"?a=!0:u=="selection"?h=!0:(((t=e[u.id])!==null&&t!==void 0?t:1)&1)==0&&c.push(e[u.id]);return{create(u){return u.values[o]=i(u),1},update(u,f){if(a&&f.docChanged||h&&(f.docChanged||f.selection)||c.some(d=>(to(u,d)&1)>0)){let d=i(u);if(l?!px(d,u.values[o],r):!r(d,u.values[o]))return u.values[o]=d,1}return 0},reconfigure(u,f){let d=i(u),p=f.config.address[s];if(p!=null){let g=Fc(f,p);if(l?px(d,g,r):r(d,g))return u.values[o]=g,0}return u.values[o]=d,1}}}}function px(n,e,t){if(n.length!=e.length)return!1;for(let i=0;i<n.length;i++)if(!t(n[i],e[i]))return!1;return!0}function ZF(n,e,t){let i=t.map(a=>n[a.id]),r=t.map(a=>a.type),s=i.filter(a=>!(a&1)),o=n[e.id]>>1;function l(a){let h=[];for(let c=0;c<i.length;c++){let u=Fc(a,i[c]);if(r[c]==2)for(let f of u)h.push(f);else h.push(u)}return e.combine(h)}return{create(a){for(let h of i)to(a,h);return a.values[o]=l(a),1},update(a,h){if(!s.some(u=>to(a,u)&1))return 0;let c=l(a);return e.compare(c,a.values[o])?0:(a.values[o]=c,1)},reconfigure(a,h){let c=i.some(p=>to(a,p)&1),u=h.config.facets[e.id],f=h.facet(e);if(u&&!c&&um(t,u))return a.values[o]=f,0;let d=l(a);return e.compare(d,f)?(a.values[o]=f,0):(a.values[o]=d,1)}}}const mx=Re.define({static:!0});class eo{constructor(e,t,i,r,s){this.id=e,this.createF=t,this.updateF=i,this.compareF=r,this.spec=s,this.provides=void 0}static define(e){let t=new eo(cm++,e.create,e.update,e.compare||((i,r)=>i===r),e);return e.provide&&(t.provides=e.provide(t)),t}create(e){let t=e.facet(mx).find(i=>i.field==this);return((t==null?void 0:t.create)||this.createF)(e)}slot(e){let t=e[this.id]>>1;return{create:i=>(i.values[t]=this.create(i),1),update:(i,r)=>{let s=i.values[t],o=this.updateF(s,r);return this.compareF(s,o)?0:(i.values[t]=o,1)},reconfigure:(i,r)=>r.config.address[this.id]!=null?(i.values[t]=r.field(this),0):(i.values[t]=this.create(i),1)}}init(e){return[this,mx.of({field:this,create:e})]}get extension(){return this}}const Dr={lowest:4,low:3,default:2,high:1,highest:0};function ls(n){return e=>new yx(e,n)}const gx={lowest:ls(Dr.lowest),low:ls(Dr.low),default:ls(Dr.default),high:ls(Dr.high),highest:ls(Dr.highest),fallback:ls(Dr.lowest),extend:ls(Dr.high),override:ls(Dr.highest)};class yx{constructor(e,t){this.inner=e,this.prec=t}}class Rc{of(e){return new fm(this,e)}reconfigure(e){return Rc.reconfigure.of({compartment:this,extension:e})}get(e){return e.config.compartments.get(this)}}class fm{constructor(e,t){this.compartment=e,this.inner=t}}class Lc{constructor(e,t,i,r,s,o){for(this.base=e,this.compartments=t,this.dynamicSlots=i,this.address=r,this.staticValues=s,this.facets=o,this.statusTemplate=[];this.statusTemplate.length<i.length;)this.statusTemplate.push(0)}staticFacet(e){let t=this.address[e.id];return t==null?e.default:this.staticValues[t>>1]}static resolve(e,t,i){let r=[],s=Object.create(null),o=new Map;for(let f of YF(e,t,o))f instanceof eo?r.push(f):(s[f.facet.id]||(s[f.facet.id]=[])).push(f);let l=Object.create(null),a=[],h=[];for(let f of r)l[f.id]=h.length<<1,h.push(d=>f.slot(d));let c=i==null?void 0:i.config.facets;for(let f in s){let d=s[f],p=d[0].facet,g=c&&c[f]||[];if(d.every(y=>y.type==0))if(l[p.id]=a.length<<1|1,um(g,d))a.push(i.facet(p));else{let y=p.combine(d.map(v=>v.value));a.push(i&&p.compare(y,i.facet(p))?i.facet(p):y)}else{for(let y of d)y.type==0?(l[y.id]=a.length<<1|1,a.push(y.value)):(l[y.id]=h.length<<1,h.push(v=>y.dynamicSlot(v)));l[p.id]=h.length<<1,h.push(y=>ZF(y,p,d))}}let u=h.map(f=>f(l));return new Lc(e,o,u,l,a,s)}}function YF(n,e,t){let i=[[],[],[],[],[]],r=new Map;function s(o,l){let a=r.get(o);if(a!=null){if(a>=l)return;let h=i[a].indexOf(o);h>-1&&i[a].splice(h,1),o instanceof fm&&t.delete(o.compartment)}if(r.set(o,l),Array.isArray(o))for(let h of o)s(h,l);else if(o instanceof fm){if(t.has(o.compartment))throw new RangeError("Duplicate use of compartment in extensions");let h=e.get(o.compartment)||o.inner;t.set(o.compartment,h),s(h,l)}else if(o instanceof yx)s(o.inner,o.prec);else if(o instanceof eo)i[l].push(o),o.provides&&s(o.provides,l);else if(o instanceof Bc)i[l].push(o),o.facet.extensions&&s(o.facet.extensions,l);else{let h=o.extension;if(!h)throw new Error(`Unrecognized extension value in extension set (${o}). This sometimes happens because multiple instances of @codemirror/state are loaded, breaking instanceof checks.`);s(h,l)}}return s(n,Dr.default),i.reduce((o,l)=>o.concat(l))}function to(n,e){if(e&1)return 2;let t=e>>1,i=n.status[t];if(i==4)throw new Error("Cyclic dependency between fields and/or facets");if(i&2)return i;n.status[t]=4;let r=n.computeSlot(n,n.config.dynamicSlots[t]);return n.status[t]=2|r}function Fc(n,e){return e&1?n.config.staticValues[e>>1]:n.values[e>>1]}const vx=Re.define(),wx=Re.define({combine:n=>n.some(e=>e),static:!0}),bx=Re.define({combine:n=>n.length?n[0]:void 0,static:!0}),xx=Re.define(),Sx=Re.define(),kx=Re.define(),Cx=Re.define({combine:n=>n.length?n[0]:!1});class fa{constructor(e,t){this.type=e,this.value=t}static define(){return new XF}}class XF{of(e){return new fa(this,e)}}class QF{constructor(e){this.map=e}of(e){return new Rt(this,e)}}class Rt{constructor(e,t){this.type=e,this.value=t}map(e){let t=this.type.map(this.value,e);return t===void 0?void 0:t==this.value?this:new Rt(this.type,t)}is(e){return this.type==e}static define(e={}){return new QF(e.map||(t=>t))}static mapEffects(e,t){if(!e.length)return e;let i=[];for(let r of e){let s=r.map(t);s&&i.push(s)}return i}}Rt.reconfigure=Rt.define(),Rt.appendConfig=Rt.define();class Pi{constructor(e,t,i,r,s,o){this.startState=e,this.changes=t,this.selection=i,this.effects=r,this.annotations=s,this.scrollIntoView=o,this._doc=null,this._state=null,i&&dx(i,t.newLength),s.some(l=>l.type==Pi.time)||(this.annotations=s.concat(Pi.time.of(Date.now())))}get newDoc(){return this._doc||(this._doc=this.changes.apply(this.startState.doc))}get newSelection(){return this.selection||this.startState.selection.map(this.changes)}get state(){return this._state||this.startState.applyTransaction(this),this._state}annotation(e){for(let t of this.annotations)if(t.type==e)return t.value}get docChanged(){return!this.changes.empty}get reconfigured(){return this.startState.config!=this.state.config}isUserEvent(e){let t=this.annotation(Pi.userEvent);return!!(t&&(t==e||t.length>e.length&&t.slice(0,e.length)==e&&t[e.length]=="."))}}Pi.time=fa.define(),Pi.userEvent=fa.define(),Pi.addToHistory=fa.define(),Pi.remote=fa.define();function eN(n,e){let t=[];for(let i=0,r=0;;){let s,o;if(i<n.length&&(r==e.length||e[r]>=n[i]))s=n[i++],o=n[i++];else if(r<e.length)s=e[r++],o=e[r++];else return t;!t.length||t[t.length-1]<s?t.push(s,o):t[t.length-1]<o&&(t[t.length-1]=o)}}function Ax(n,e,t){var i;let r,s,o;return t?(r=e.changes,s=hi.empty(e.changes.length),o=n.changes.compose(e.changes)):(r=e.changes.map(n.changes),s=n.changes.mapDesc(e.changes,!0),o=n.changes.compose(r)),{changes:o,selection:e.selection?e.selection.map(s):(i=n.selection)===null||i===void 0?void 0:i.map(r),effects:Rt.mapEffects(n.effects,r).concat(Rt.mapEffects(e.effects,s)),annotations:n.annotations.length?n.annotations.concat(e.annotations):e.annotations,scrollIntoView:n.scrollIntoView||e.scrollIntoView}}function dm(n,e,t){let i=e.selection,r=qo(e.annotations);return e.userEvent&&(r=r.concat(Pi.userEvent.of(e.userEvent))),{changes:e.changes instanceof hi?e.changes:hi.of(e.changes||[],t,n.facet(bx)),selection:i&&(i instanceof be?i:be.single(i.anchor,i.head)),effects:qo(e.effects),annotations:r,scrollIntoView:!!e.scrollIntoView}}function Ox(n,e,t){let i=dm(n,e.length?e[0]:{},n.doc.length);e.length&&e[0].filter===!1&&(t=!1);for(let s=1;s<e.length;s++){e[s].filter===!1&&(t=!1);let o=!!e[s].sequential;i=Ax(i,dm(n,e[s],o?i.changes.newLength:n.doc.length),o)}let r=new Pi(n,i.changes,i.selection,i.effects,i.annotations,i.scrollIntoView);return iN(t?tN(r):r)}function tN(n){let e=n.startState,t=!0;for(let r of e.facet(xx)){let s=r(n);if(s===!1){t=!1;break}Array.isArray(s)&&(t=t===!0?s:eN(t,s))}if(t!==!0){let r,s;if(t===!1)s=n.changes.invertedDesc,r=hi.empty(e.doc.length);else{let o=n.changes.filter(t);r=o.changes,s=o.filtered.invertedDesc}n=new Pi(e,r,n.selection&&n.selection.map(s),Rt.mapEffects(n.effects,s),n.annotations,n.scrollIntoView)}let i=e.facet(Sx);for(let r=i.length-1;r>=0;r--){let s=i[r](n);s instanceof Pi?n=s:Array.isArray(s)&&s.length==1&&s[0]instanceof Pi?n=s[0]:n=Ox(e,qo(s),!1)}return n}function iN(n){let e=n.startState,t=e.facet(kx),i=n;for(let r=t.length-1;r>=0;r--){let s=t[r](n);s&&Object.keys(s).length&&(i=Ax(n,dm(e,s,n.changes.newLength),!0))}return i==n?n:new Pi(e,n.changes,n.selection,i.effects,i.annotations,i.scrollIntoView)}const nN=[];function qo(n){return n==null?nN:Array.isArray(n)?n:[n]}var Mr=function(n){return n[n.Word=0]="Word",n[n.Space=1]="Space",n[n.Other=2]="Other",n}(Mr||(Mr={}));const rN=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;let pm;try{pm=new RegExp("[\\p{Alphabetic}\\p{Number}_]","u")}catch{}function sN(n){if(pm)return pm.test(n);for(let e=0;e<n.length;e++){let t=n[e];if(/\w/.test(t)||t>"\x80"&&(t.toUpperCase()!=t.toLowerCase()||rN.test(t)))return!0}return!1}function oN(n){return e=>{if(!/\S/.test(e))return Mr.Space;if(sN(e))return Mr.Word;for(let t=0;t<n.length;t++)if(e.indexOf(n[t])>-1)return Mr.Word;return Mr.Other}}class Ke{constructor(e,t,i,r,s,o){this.config=e,this.doc=t,this.selection=i,this.values=r,this.status=e.statusTemplate.slice(),this.computeSlot=s,o&&(o._state=this);for(let l=0;l<this.config.dynamicSlots.length;l++)to(this,l<<1);this.computeSlot=null}field(e,t=!0){let i=this.config.address[e.id];if(i==null){if(t)throw new RangeError("Field is not present in this state");return}return to(this,i),Fc(this,i)}update(...e){return Ox(this,e,!0)}applyTransaction(e){let t=this.config,{base:i,compartments:r}=t;for(let o of e.effects)o.is(Rc.reconfigure)?(t&&(r=new Map,t.compartments.forEach((l,a)=>r.set(a,l)),t=null),r.set(o.value.compartment,o.value.extension)):o.is(Rt.reconfigure)?(t=null,i=o.value):o.is(Rt.appendConfig)&&(t=null,i=qo(i).concat(o.value));let s;t?s=e.startState.values.slice():(t=Lc.resolve(i,r,this),s=new Ke(t,this.doc,this.selection,t.dynamicSlots.map(()=>null),(l,a)=>a.reconfigure(l,this),null).values),new Ke(t,e.newDoc,e.newSelection,s,(o,l)=>l.update(o,e),e)}replaceSelection(e){return typeof e=="string"&&(e=this.toText(e)),this.changeByRange(t=>({changes:{from:t.from,to:t.to,insert:e},range:be.cursor(t.from+e.length)}))}changeByRange(e){let t=this.selection,i=e(t.ranges[0]),r=this.changes(i.changes),s=[i.range],o=qo(i.effects);for(let l=1;l<t.ranges.length;l++){let a=e(t.ranges[l]),h=this.changes(a.changes),c=h.map(r);for(let f=0;f<l;f++)s[f]=s[f].map(c);let u=r.mapDesc(h,!0);s.push(a.range.map(u)),r=r.compose(c),o=Rt.mapEffects(o,c).concat(Rt.mapEffects(qo(a.effects),u))}return{changes:r,selection:be.create(s,t.mainIndex),effects:o}}changes(e=[]){return e instanceof hi?e:hi.of(e,this.doc.length,this.facet(Ke.lineSeparator))}toText(e){return j.of(e.split(this.facet(Ke.lineSeparator)||lm))}sliceDoc(e=0,t=this.doc.length){return this.doc.sliceString(e,t,this.lineBreak)}facet(e){let t=this.config.address[e.id];return t==null?e.default:(to(this,t),Fc(this,t))}toJSON(e){let t={doc:this.sliceDoc(),selection:this.selection.toJSON()};if(e)for(let i in e){let r=e[i];r instanceof eo&&(t[i]=r.spec.toJSON(this.field(e[i]),this))}return t}static fromJSON(e,t={},i){if(!e||typeof e.doc!="string")throw new RangeError("Invalid JSON representation for EditorState");let r=[];if(i)for(let s in i){let o=i[s],l=e[s];r.push(o.init(a=>o.spec.fromJSON(l,a)))}return Ke.create({doc:e.doc,selection:be.fromJSON(e.selection),extensions:t.extensions?r.concat([t.extensions]):r})}static create(e={}){let t=Lc.resolve(e.extensions||[],new Map),i=e.doc instanceof j?e.doc:j.of((e.doc||"").split(t.staticFacet(Ke.lineSeparator)||lm)),r=e.selection?e.selection instanceof be?e.selection:be.single(e.selection.anchor,e.selection.head):be.single(0);return dx(r,i.length),t.staticFacet(wx)||(r=r.asSingle()),new Ke(t,i,r,t.dynamicSlots.map(()=>null),(s,o)=>o.create(s),null)}get tabSize(){return this.facet(Ke.tabSize)}get lineBreak(){return this.facet(Ke.lineSeparator)||`
`}get readOnly(){return this.facet(Cx)}phrase(e){for(let t of this.facet(Ke.phrases))if(Object.prototype.hasOwnProperty.call(t,e))return t[e];return e}languageDataAt(e,t,i=-1){let r=[];for(let s of this.facet(vx))for(let o of s(this,t,i))Object.prototype.hasOwnProperty.call(o,e)&&r.push(o[e]);return r}charCategorizer(e){return oN(this.languageDataAt("wordChars",e).join(""))}wordAt(e){let{text:t,from:i,length:r}=this.doc.lineAt(e),s=this.charCategorizer(e),o=e-i,l=e-i;for(;o>0;){let a=lt(t,o,!1);if(s(t.slice(a,o))!=Mr.Word)break;o=a}for(;l<r;){let a=lt(t,l);if(s(t.slice(l,a))!=Mr.Word)break;l=a}return o==l?null:be.range(o+i,l+i)}}Ke.allowMultipleSelections=wx,Ke.tabSize=Re.define({combine:n=>n.length?n[0]:4}),Ke.lineSeparator=bx,Ke.readOnly=Cx,Ke.phrases=Re.define(),Ke.languageData=vx,Ke.changeFilter=xx,Ke.transactionFilter=Sx,Ke.transactionExtender=kx,Rc.reconfigure=Rt.define();function _x(n,e,t={}){let i={};for(let r of n)for(let s of Object.keys(r)){let o=r[s],l=i[s];if(l===void 0)i[s]=o;else if(!(l===o||o===void 0))if(Object.hasOwnProperty.call(t,s))i[s]=t[s](l,o);else throw new Error("Config merge conflict for field "+s)}for(let r in e)i[r]===void 0&&(i[r]=e[r]);return i}function Nc(n){let e;return n.nodeType==11?e=n.getSelection?n:n.ownerDocument:e=n,e.getSelection()}function Ko(n,e){return e?n==e||n.contains(e.nodeType!=1?e.parentNode:e):!1}function lN(){let n=document.activeElement;for(;n&&n.shadowRoot;)n=n.shadowRoot.activeElement;return n}function mm(n,e){if(!e.anchorNode)return!1;try{return Ko(n,e.anchorNode)}catch{return!1}}function da(n){return n.nodeType==3?pa(n,0,n.nodeValue.length).getClientRects():n.nodeType==1?n.getClientRects():[]}function Ic(n,e,t,i){return t?Dx(n,e,t,i,-1)||Dx(n,e,t,i,1):!1}function gm(n){for(var e=0;;e++)if(n=n.previousSibling,!n)return e}function Dx(n,e,t,i,r){for(;;){if(n==t&&e==i)return!0;if(e==(r<0?0:Wc(n))){if(n.nodeName=="DIV")return!1;let s=n.parentNode;if(!s||s.nodeType!=1)return!1;e=gm(n)+(r<0?0:1),n=s}else if(n.nodeType==1){if(n=n.childNodes[e+(r<0?-1:0)],n.nodeType==1&&n.contentEditable=="false")return!1;e=r<0?Wc(n):0}else return!1}}function Wc(n){return n.nodeType==3?n.nodeValue.length:n.childNodes.length}const Mx={left:0,right:0,top:0,bottom:0};function Vc(n,e){let t=e?n.left:n.right;return{left:t,right:t,top:n.top,bottom:n.bottom}}function aN(n){return{left:0,right:n.innerWidth,top:0,bottom:n.innerHeight}}function hN(n,e,t,i,r,s,o,l){let a=n.ownerDocument,h=a.defaultView;for(let c=n;c;)if(c.nodeType==1){let u,f=c==a.body;if(f)u=aN(h);else{if(c.scrollHeight<=c.clientHeight&&c.scrollWidth<=c.clientWidth){c=c.parentNode;continue}let g=c.getBoundingClientRect();u={left:g.left,right:g.left+c.clientWidth,top:g.top,bottom:g.top+c.clientHeight}}let d=0,p=0;if(r=="nearest")e.top<u.top?(p=-(u.top-e.top+o),t>0&&e.bottom>u.bottom+p&&(p=e.bottom-u.bottom+p+o)):e.bottom>u.bottom&&(p=e.bottom-u.bottom+o,t<0&&e.top-p<u.top&&(p=-(u.top+p-e.top+o)));else{let g=e.bottom-e.top,y=u.bottom-u.top;p=(r=="center"&&g<=y?e.top+g/2-y/2:r=="start"||r=="center"&&t<0?e.top-o:e.bottom-y+o)-u.top}if(i=="nearest"?e.left<u.left?(d=-(u.left-e.left+s),t>0&&e.right>u.right+d&&(d=e.right-u.right+d+s)):e.right>u.right&&(d=e.right-u.right+s,t<0&&e.left<u.left+d&&(d=-(u.left+d-e.left+s))):d=(i=="center"?e.left+(e.right-e.left)/2-(u.right-u.left)/2:i=="start"==l?e.left-s:e.right-(u.right-u.left)+s)-u.left,d||p)if(f)h.scrollBy(d,p);else{if(p){let g=c.scrollTop;c.scrollTop+=p,p=c.scrollTop-g}if(d){let g=c.scrollLeft;c.scrollLeft+=d,d=c.scrollLeft-g}e={left:e.left-d,top:e.top-p,right:e.right-d,bottom:e.bottom-p}}if(f)break;c=c.assignedSlot||c.parentNode,i=r="nearest"}else if(c.nodeType==11)c=c.host;else break}class cN{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}eq(e){return this.anchorNode==e.anchorNode&&this.anchorOffset==e.anchorOffset&&this.focusNode==e.focusNode&&this.focusOffset==e.focusOffset}setRange(e){this.set(e.anchorNode,e.anchorOffset,e.focusNode,e.focusOffset)}set(e,t,i,r){this.anchorNode=e,this.anchorOffset=t,this.focusNode=i,this.focusOffset=r}}let Go=null;function Ex(n){if(n.setActive)return n.setActive();if(Go)return n.focus(Go);let e=[];for(let t=n;t&&(e.push(t,t.scrollTop,t.scrollLeft),t!=t.ownerDocument);t=t.parentNode);if(n.focus(Go==null?{get preventScroll(){return Go={preventScroll:!0},!0}}:void 0),!Go){Go=!1;for(let t=0;t<e.length;){let i=e[t++],r=e[t++],s=e[t++];i.scrollTop!=r&&(i.scrollTop=r),i.scrollLeft!=s&&(i.scrollLeft=s)}}}let Tx;function pa(n,e,t=e){let i=Tx||(Tx=document.createRange());return i.setEnd(n,t),i.setStart(n,e),i}function ma(n,e,t){let i={key:e,code:e,keyCode:t,which:t,cancelable:!0},r=new KeyboardEvent("keydown",i);r.synthetic=!0,n.dispatchEvent(r);let s=new KeyboardEvent("keyup",i);return s.synthetic=!0,n.dispatchEvent(s),r.defaultPrevented||s.defaultPrevented}function uN(n){for(;n;){if(n&&(n.nodeType==9||n.nodeType==11&&n.host))return n;n=n.assignedSlot||n.parentNode}return null}function Px(n){for(;n.attributes.length;)n.removeAttributeNode(n.attributes[0])}class ci{constructor(e,t,i=!0){this.node=e,this.offset=t,this.precise=i}static before(e,t){return new ci(e.parentNode,gm(e),t)}static after(e,t){return new ci(e.parentNode,gm(e)+1,t)}}const ym=[];class Dt{constructor(){this.parent=null,this.dom=null,this.dirty=2}get editorView(){if(!this.parent)throw new Error("Accessing view in orphan content view");return this.parent.editorView}get overrideDOMText(){return null}get posAtStart(){return this.parent?this.parent.posBefore(this):0}get posAtEnd(){return this.posAtStart+this.length}posBefore(e){let t=this.posAtStart;for(let i of this.children){if(i==e)return t;t+=i.length+i.breakAfter}throw new RangeError("Invalid child in posBefore")}posAfter(e){return this.posBefore(e)+e.length}coordsAt(e,t){return null}sync(e){if(this.dirty&2){let t=this.dom,i=null,r;for(let s of this.children){if(s.dirty){if(!s.dom&&(r=i?i.nextSibling:t.firstChild)){let o=Dt.get(r);(!o||!o.parent&&o.constructor==s.constructor)&&s.reuseDOM(r)}s.sync(e),s.dirty=0}if(r=i?i.nextSibling:t.firstChild,e&&!e.written&&e.node==t&&r!=s.dom&&(e.written=!0),s.dom.parentNode==t)for(;r&&r!=s.dom;)r=Bx(r);else t.insertBefore(s.dom,r);i=s.dom}for(r=i?i.nextSibling:t.firstChild,r&&e&&e.node==t&&(e.written=!0);r;)r=Bx(r)}else if(this.dirty&1)for(let t of this.children)t.dirty&&(t.sync(e),t.dirty=0)}reuseDOM(e){}localPosFromDOM(e,t){let i;if(e==this.dom)i=this.dom.childNodes[t];else{let r=Wc(e)==0?0:t==0?-1:1;for(;;){let s=e.parentNode;if(s==this.dom)break;r==0&&s.firstChild!=s.lastChild&&(e==s.firstChild?r=-1:r=1),e=s}r<0?i=e:i=e.nextSibling}if(i==this.dom.firstChild)return 0;for(;i&&!Dt.get(i);)i=i.nextSibling;if(!i)return this.length;for(let r=0,s=0;;r++){let o=this.children[r];if(o.dom==i)return s;s+=o.length+o.breakAfter}}domBoundsAround(e,t,i=0){let r=-1,s=-1,o=-1,l=-1;for(let a=0,h=i,c=i;a<this.children.length;a++){let u=this.children[a],f=h+u.length;if(h<e&&f>t)return u.domBoundsAround(e,t,h);if(f>=e&&r==-1&&(r=a,s=h),h>t&&u.dom.parentNode==this.dom){o=a,l=c;break}c=f,h=f+u.breakAfter}return{from:s,to:l<0?i+this.length:l,startDOM:(r?this.children[r-1].dom.nextSibling:null)||this.dom.firstChild,endDOM:o<this.children.length&&o>=0?this.children[o].dom:null}}markDirty(e=!1){this.dirty|=2,this.markParentsDirty(e)}markParentsDirty(e){for(let t=this.parent;t;t=t.parent){if(e&&(t.dirty|=2),t.dirty&1)return;t.dirty|=1,e=!1}}setParent(e){this.parent!=e&&(this.parent=e,this.dirty&&this.markParentsDirty(!0))}setDOM(e){this.dom&&(this.dom.cmView=null),this.dom=e,e.cmView=this}get rootView(){for(let e=this;;){let t=e.parent;if(!t)return e;e=t}}replaceChildren(e,t,i=ym){this.markDirty();for(let r=e;r<t;r++){let s=this.children[r];s.parent==this&&s.destroy()}this.children.splice(e,t-e,...i);for(let r=0;r<i.length;r++)i[r].setParent(this)}ignoreMutation(e){return!1}ignoreEvent(e){return!1}childCursor(e=this.length){return new Rx(this.children,e,this.children.length)}childPos(e,t=1){return this.childCursor().findPos(e,t)}toString(){let e=this.constructor.name.replace("View","");return e+(this.children.length?"("+this.children.join()+")":this.length?"["+(e=="Text"?this.text:this.length)+"]":"")+(this.breakAfter?"#":"")}static get(e){return e.cmView}get isEditable(){return!0}merge(e,t,i,r,s,o){return!1}become(e){return!1}getSide(){return 0}destroy(){this.parent=null}}Dt.prototype.breakAfter=0;function Bx(n){let e=n.nextSibling;return n.parentNode.removeChild(n),e}class Rx{constructor(e,t,i){this.children=e,this.pos=t,this.i=i,this.off=0}findPos(e,t=1){for(;;){if(e>this.pos||e==this.pos&&(t>0||this.i==0||this.children[this.i-1].breakAfter))return this.off=e-this.pos,this;let i=this.children[--this.i];this.pos-=i.length+i.breakAfter}}}function Lx(n,e,t,i,r,s,o,l,a){let{children:h}=n,c=h.length?h[e]:null,u=s.length?s[s.length-1]:null,f=u?u.breakAfter:o;if(!(e==i&&c&&!o&&!f&&s.length<2&&c.merge(t,r,s.length?u:null,t==0,l,a))){if(i<h.length){let d=h[i];d&&r<d.length?(e==i&&(d=d.split(r),r=0),!f&&u&&d.merge(0,r,u,!0,0,a)?s[s.length-1]=d:(r&&d.merge(0,r,null,!1,0,a),s.push(d))):d!=null&&d.breakAfter&&(u?u.breakAfter=1:o=1),i++}for(c&&(c.breakAfter=o,t>0&&(!o&&s.length&&c.merge(t,c.length,s[0],!1,l,0)?c.breakAfter=s.shift().breakAfter:(t<c.length||c.children.length&&c.children[c.children.length-1].length==0)&&c.merge(t,c.length,null,!1,l,0),e++));e<i&&s.length;)if(h[i-1].become(s[s.length-1]))i--,s.pop(),a=s.length?0:l;else if(h[e].become(s[0]))e++,s.shift(),l=s.length?0:a;else break;!s.length&&e&&i<h.length&&!h[e-1].breakAfter&&h[i].merge(0,0,h[e-1],!1,l,a)&&e--,(e<i||s.length)&&n.replaceChildren(e,i,s)}}function Fx(n,e,t,i,r,s){let o=n.childCursor(),{i:l,off:a}=o.findPos(t,1),{i:h,off:c}=o.findPos(e,-1),u=e-t;for(let f of i)u+=f.length;n.length+=u,Lx(n,h,c,l,a,i,0,r,s)}let sn=typeof navigator!="undefined"?navigator:{userAgent:"",vendor:"",platform:""},vm=typeof document!="undefined"?document:{documentElement:{style:{}}};const wm=/Edge\/(\d+)/.exec(sn.userAgent),Nx=/MSIE \d/.test(sn.userAgent),bm=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(sn.userAgent),Hc=!!(Nx||bm||wm),Ix=!Hc&&/gecko\/(\d+)/i.test(sn.userAgent),xm=!Hc&&/Chrome\/(\d+)/.exec(sn.userAgent),Wx="webkitFontSmoothing"in vm.documentElement.style,Vx=!Hc&&/Apple Computer/.test(sn.vendor),Hx=Vx&&(/Mobile\/\w+/.test(sn.userAgent)||sn.maxTouchPoints>2);var me={mac:Hx||/Mac/.test(sn.platform),windows:/Win/.test(sn.platform),linux:/Linux|X11/.test(sn.platform),ie:Hc,ie_version:Nx?vm.documentMode||6:bm?+bm[1]:wm?+wm[1]:0,gecko:Ix,gecko_version:Ix?+(/Firefox\/(\d+)/.exec(sn.userAgent)||[0,0])[1]:0,chrome:!!xm,chrome_version:xm?+xm[1]:0,ios:Hx,android:/Android\b/.test(sn.userAgent),webkit:Wx,safari:Vx,webkit_version:Wx?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0,tabSize:vm.documentElement.style.tabSize!=null?"tab-size":"-moz-tab-size"};const fN=256;class as extends Dt{constructor(e){super(),this.text=e}get length(){return this.text.length}createDOM(e){this.setDOM(e||document.createTextNode(this.text))}sync(e){this.dom||this.createDOM(),this.dom.nodeValue!=this.text&&(e&&e.node==this.dom&&(e.written=!0),this.dom.nodeValue=this.text)}reuseDOM(e){e.nodeType==3&&this.createDOM(e)}merge(e,t,i){return i&&(!(i instanceof as)||this.length-(t-e)+i.length>fN)?!1:(this.text=this.text.slice(0,e)+(i?i.text:"")+this.text.slice(t),this.markDirty(),!0)}split(e){let t=new as(this.text.slice(e));return this.text=this.text.slice(0,e),this.markDirty(),t}localPosFromDOM(e,t){return e==this.dom?t:t?this.text.length:0}domAtPos(e){return new ci(this.dom,e)}domBoundsAround(e,t,i){return{from:i,to:i+this.length,startDOM:this.dom,endDOM:this.dom.nextSibling}}coordsAt(e,t){return Sm(this.dom,e,t)}}class Un extends Dt{constructor(e,t=[],i=0){super(),this.mark=e,this.children=t,this.length=i;for(let r of t)r.setParent(this)}setAttrs(e){if(Px(e),this.mark.class&&(e.className=this.mark.class),this.mark.attrs)for(let t in this.mark.attrs)e.setAttribute(t,this.mark.attrs[t]);return e}reuseDOM(e){e.nodeName==this.mark.tagName.toUpperCase()&&(this.setDOM(e),this.dirty|=6)}sync(e){this.dom?this.dirty&4&&this.setAttrs(this.dom):this.setDOM(this.setAttrs(document.createElement(this.mark.tagName))),super.sync(e)}merge(e,t,i,r,s,o){return i&&(!(i instanceof Un&&i.mark.eq(this.mark))||e&&s<=0||t<this.length&&o<=0)?!1:(Fx(this,e,t,i?i.children:[],s-1,o-1),this.markDirty(),!0)}split(e){let t=[],i=0,r=-1,s=0;for(let l of this.children){let a=i+l.length;a>e&&t.push(i<e?l.split(e-i):l),r<0&&i>=e&&(r=s),i=a,s++}let o=this.length-e;return this.length=e,r>-1&&(this.children.length=r,this.markDirty()),new Un(this.mark,t,o)}domAtPos(e){return $x(this.dom,this.children,e)}coordsAt(e,t){return qx(this,e,t)}}function Sm(n,e,t){let i=n.nodeValue.length;e>i&&(e=i);let r=e,s=e,o=0;e==0&&t<0||e==i&&t>=0?me.chrome||me.gecko||(e?(r--,o=1):(s++,o=-1)):t<0?r--:s++;let l=pa(n,r,s).getClientRects();if(!l.length)return Mx;let a=l[(o?o<0:t>=0)?0:l.length-1];return me.safari&&!o&&a.width==0&&(a=Array.prototype.find.call(l,h=>h.width)||a),o?Vc(a,o<0):a||null}class hs extends Dt{constructor(e,t,i){super(),this.widget=e,this.length=t,this.side=i,this.prevWidget=null}static create(e,t,i){return new(e.customView||hs)(e,t,i)}split(e){let t=hs.create(this.widget,this.length-e,this.side);return this.length-=e,t}sync(){(!this.dom||!this.widget.updateDOM(this.dom))&&(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(this.editorView)),this.dom.contentEditable="false")}getSide(){return this.side}merge(e,t,i,r,s,o){return i&&(!(i instanceof hs)||!this.widget.compare(i.widget)||e>0&&s<=0||t<this.length&&o<=0)?!1:(this.length=e+(i?i.length:0)+(this.length-t),!0)}become(e){return e.length==this.length&&e instanceof hs&&e.side==this.side&&this.widget.constructor==e.widget.constructor?(this.widget.eq(e.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=e.widget,!0):!1}ignoreMutation(){return!0}ignoreEvent(e){return this.widget.ignoreEvent(e)}get overrideDOMText(){if(this.length==0)return j.empty;let e=this;for(;e.parent;)e=e.parent;let t=e.editorView,i=t&&t.state.doc,r=this.posAtStart;return i?i.slice(r,r+this.length):j.empty}domAtPos(e){return e==0?ci.before(this.dom):ci.after(this.dom,e==this.length)}domBoundsAround(){return null}coordsAt(e,t){let i=this.dom.getClientRects(),r=null;if(!i.length)return Mx;for(let s=e>0?i.length-1:0;r=i[s],!(e>0?s==0:s==i.length-1||r.top<r.bottom);s+=e>0?-1:1);return e==0&&t>0||e==this.length&&t<=0?r:Vc(r,e==0)}get isEditable(){return!1}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class zx extends hs{domAtPos(e){let{topView:t,text:i}=this.widget;return t?km(e,0,t,i,(r,s)=>r.domAtPos(s),r=>new ci(i,Math.min(r,i.nodeValue.length))):new ci(i,Math.min(e,i.nodeValue.length))}sync(){this.setDOM(this.widget.toDOM())}localPosFromDOM(e,t){let{topView:i,text:r}=this.widget;return i?jx(e,t,i,r):Math.min(t,this.length)}ignoreMutation(){return!1}get overrideDOMText(){return null}coordsAt(e,t){let{topView:i,text:r}=this.widget;return i?km(e,t,i,r,(s,o,l)=>s.coordsAt(o,l),(s,o)=>Sm(r,s,o)):Sm(r,e,t)}destroy(){var e;super.destroy(),(e=this.widget.topView)===null||e===void 0||e.destroy()}get isEditable(){return!0}}function km(n,e,t,i,r,s){if(t instanceof Un){for(let o of t.children){let l=Ko(o.dom,i),a=l?i.nodeValue.length:o.length;if(n<a||n==a&&o.getSide()<=0)return l?km(n,e,o,i,r,s):r(o,n,e);n-=a}return r(t,t.length,-1)}else return t.dom==i?s(n,e):r(t,n,e)}function jx(n,e,t,i){if(t instanceof Un)for(let r of t.children){let s=0,o=Ko(r.dom,i);if(Ko(r.dom,n))return s+(o?jx(n,e,r,i):r.localPosFromDOM(n,e));s+=o?i.nodeValue.length:r.length}else if(t.dom==i)return Math.min(e,i.nodeValue.length);return t.localPosFromDOM(n,e)}class Jo extends Dt{constructor(e){super(),this.side=e}get length(){return 0}merge(){return!1}become(e){return e instanceof Jo&&e.side==this.side}split(){return new Jo(this.side)}sync(){if(!this.dom){let e=document.createElement("img");e.className="cm-widgetBuffer",e.setAttribute("aria-hidden","true"),this.setDOM(e)}}getSide(){return this.side}domAtPos(e){return ci.before(this.dom)}localPosFromDOM(){return 0}domBoundsAround(){return null}coordsAt(e){let t=this.dom.getBoundingClientRect(),i=dN(this,this.side>0?-1:1);return i&&i.top<t.bottom&&i.bottom>t.top?{left:t.left,right:t.right,top:i.top,bottom:i.bottom}:t}get overrideDOMText(){return j.empty}}as.prototype.children=hs.prototype.children=Jo.prototype.children=ym;function dN(n,e){let t=n.parent,i=t?t.children.indexOf(n):-1;for(;t&&i>=0;)if(e<0?i>0:i<t.children.length){let r=t.children[i+e];if(r instanceof as){let s=r.coordsAt(e<0?r.length:0,e);if(s)return s}i+=e}else if(t instanceof Un&&t.parent)i=t.parent.children.indexOf(t)+(e<0?0:1),t=t.parent;else{let r=t.dom.lastChild;if(r&&r.nodeName=="BR")return r.getClientRects()[0];break}}function $x(n,e,t){let i=0;for(let r=0;i<e.length;i++){let s=e[i],o=r+s.length;if(!(o==r&&s.getSide()<=0)){if(t>r&&t<o&&s.dom.parentNode==n)return s.domAtPos(t-r);if(t<=r)break;r=o}}for(;i>0;i--){let r=e[i-1].dom;if(r.parentNode==n)return ci.after(r)}return new ci(n,0)}function Ux(n,e,t){let i,{children:r}=n;t>0&&e instanceof Un&&r.length&&(i=r[r.length-1])instanceof Un&&i.mark.eq(e.mark)?Ux(i,e.children[0],t-1):(r.push(e),e.setParent(n)),n.length+=e.length}function qx(n,e,t){for(let s=0,o=0;o<n.children.length;o++){let l=n.children[o],a=s+l.length,h;if((t<=0||a==n.length||l.getSide()>0?a>=e:a>e)&&(e<a||o+1==n.children.length||(h=n.children[o+1]).length||h.getSide()>0)){let c=0;if(a==s){if(l.getSide()<=0)continue;c=t=-l.getSide()}let u=l.coordsAt(Math.max(0,e-s),t);return c&&u?Vc(u,t<0):u}s=a}let i=n.dom.lastChild;if(!i)return n.dom.getBoundingClientRect();let r=da(i);return r[r.length-1]||null}function Cm(n,e){for(let t in n)t=="class"&&e.class?e.class+=" "+n.class:t=="style"&&e.style?e.style+=";"+n.style:e[t]=n[t];return e}function Am(n,e){if(n==e)return!0;if(!n||!e)return!1;let t=Object.keys(n),i=Object.keys(e);if(t.length!=i.length)return!1;for(let r of t)if(i.indexOf(r)==-1||n[r]!==e[r])return!1;return!0}function Om(n,e,t){if(e)for(let i in e)t&&i in t||n.removeAttribute(i);if(t)for(let i in t)e&&e[i]==t[i]||n.setAttribute(i,t[i])}class zc{eq(e){return!1}updateDOM(e){return!1}compare(e){return this==e||this.constructor==e.constructor&&this.eq(e)}get estimatedHeight(){return-1}ignoreEvent(e){return!0}get customView(){return null}destroy(e){}}var dt=function(n){return n[n.Text=0]="Text",n[n.WidgetBefore=1]="WidgetBefore",n[n.WidgetAfter=2]="WidgetAfter",n[n.WidgetRange=3]="WidgetRange",n}(dt||(dt={}));class Xe extends qs{constructor(e,t,i,r){super(),this.startSide=e,this.endSide=t,this.widget=i,this.spec=r}get heightRelevant(){return!1}static mark(e){return new jc(e)}static widget(e){let t=e.side||0,i=!!e.block;return t+=i?t>0?3e8:-4e8:t>0?1e8:-1e8,new io(e,t,t,i,e.widget||null,!1)}static replace(e){let t=!!e.block,i,r;if(e.isBlockGap)i=-5e8,r=4e8;else{let{start:s,end:o}=Kx(e,t);i=(s?t?-3e8:-1:5e8)-1,r=(o?t?2e8:1:-6e8)+1}return new io(e,i,r,t,e.widget||null,!0)}static line(e){return new ga(e)}static set(e,t=!1){return Te.of(e,t)}hasHeight(){return this.widget?this.widget.estimatedHeight>-1:!1}}Xe.none=Te.empty;class jc extends Xe{constructor(e){let{start:t,end:i}=Kx(e);super(t?-1:5e8,i?1:-6e8,null,e),this.tagName=e.tagName||"span",this.class=e.class||"",this.attrs=e.attributes||null}eq(e){return this==e||e instanceof jc&&this.tagName==e.tagName&&this.class==e.class&&Am(this.attrs,e.attrs)}range(e,t=e){if(e>=t)throw new RangeError("Mark decorations may not be empty");return super.range(e,t)}}jc.prototype.point=!1;class ga extends Xe{constructor(e){super(-2e8,-2e8,null,e)}eq(e){return e instanceof ga&&Am(this.spec.attributes,e.spec.attributes)}range(e,t=e){if(t!=e)throw new RangeError("Line decoration ranges must be zero-length");return super.range(e,t)}}ga.prototype.mapMode=Rn.TrackBefore,ga.prototype.point=!0;class io extends Xe{constructor(e,t,i,r,s,o){super(t,i,s,e),this.block=r,this.isReplace=o,this.mapMode=r?t<=0?Rn.TrackBefore:Rn.TrackAfter:Rn.TrackDel}get type(){return this.startSide<this.endSide?dt.WidgetRange:this.startSide<=0?dt.WidgetBefore:dt.WidgetAfter}get heightRelevant(){return this.block||!!this.widget&&this.widget.estimatedHeight>=5}eq(e){return e instanceof io&&pN(this.widget,e.widget)&&this.block==e.block&&this.startSide==e.startSide&&this.endSide==e.endSide}range(e,t=e){if(this.isReplace&&(e>t||e==t&&this.startSide>0&&this.endSide<=0))throw new RangeError("Invalid range for replacement decoration");if(!this.isReplace&&t!=e)throw new RangeError("Widget decorations can only have zero-length ranges");return super.range(e,t)}}io.prototype.point=!0;function Kx(n,e=!1){let{inclusiveStart:t,inclusiveEnd:i}=n;return t==null&&(t=n.inclusive),i==null&&(i=n.inclusive),{start:t!=null?t:e,end:i!=null?i:e}}function pN(n,e){return n==e||!!(n&&e&&n.compare(e))}function _m(n,e,t,i=0){let r=t.length-1;r>=0&&t[r]+i>=n?t[r]=Math.max(t[r],e):t.push(n,e)}class Bi extends Dt{constructor(){super(...arguments),this.children=[],this.length=0,this.prevAttrs=void 0,this.attrs=null,this.breakAfter=0}merge(e,t,i,r,s,o){if(i){if(!(i instanceof Bi))return!1;this.dom||i.transferDOM(this)}return r&&this.setDeco(i?i.attrs:null),Fx(this,e,t,i?i.children:[],s,o),!0}split(e){let t=new Bi;if(t.breakAfter=this.breakAfter,this.length==0)return t;let{i,off:r}=this.childPos(e);r&&(t.append(this.children[i].split(r),0),this.children[i].merge(r,this.children[i].length,null,!1,0,0),i++);for(let s=i;s<this.children.length;s++)t.append(this.children[s],0);for(;i>0&&this.children[i-1].length==0;)this.children[--i].destroy();return this.children.length=i,this.markDirty(),this.length=e,t}transferDOM(e){!this.dom||(e.setDOM(this.dom),e.prevAttrs=this.prevAttrs===void 0?this.attrs:this.prevAttrs,this.prevAttrs=void 0,this.dom=null)}setDeco(e){Am(this.attrs,e)||(this.dom&&(this.prevAttrs=this.attrs,this.markDirty()),this.attrs=e)}append(e,t){Ux(this,e,t)}addLineDeco(e){let t=e.spec.attributes,i=e.spec.class;t&&(this.attrs=Cm(t,this.attrs||{})),i&&(this.attrs=Cm({class:i},this.attrs||{}))}domAtPos(e){return $x(this.dom,this.children,e)}reuseDOM(e){e.nodeName=="DIV"&&(this.setDOM(e),this.dirty|=6)}sync(e){var t;this.dom?this.dirty&4&&(Px(this.dom),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0):(this.setDOM(document.createElement("div")),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0),this.prevAttrs!==void 0&&(Om(this.dom,this.prevAttrs,this.attrs),this.dom.classList.add("cm-line"),this.prevAttrs=void 0),super.sync(e);let i=this.dom.lastChild;for(;i&&Dt.get(i)instanceof Un;)i=i.lastChild;if(!i||!this.length||i.nodeName!="BR"&&((t=Dt.get(i))===null||t===void 0?void 0:t.isEditable)==!1&&(!me.ios||!this.children.some(r=>r instanceof as))){let r=document.createElement("BR");r.cmIgnore=!0,this.dom.appendChild(r)}}measureTextSize(){if(this.children.length==0||this.length>20)return null;let e=0;for(let t of this.children){if(!(t instanceof as))return null;let i=da(t.dom);if(i.length!=1)return null;e+=i[0].width}return{lineHeight:this.dom.getBoundingClientRect().height,charWidth:e/this.length}}coordsAt(e,t){return qx(this,e,t)}become(e){return!1}get type(){return dt.Text}static find(e,t){for(let i=0,r=0;i<e.children.length;i++){let s=e.children[i],o=r+s.length;if(o>=t){if(s instanceof Bi)return s;if(o>t)break}r=o+s.breakAfter}return null}}class no extends Dt{constructor(e,t,i){super(),this.widget=e,this.length=t,this.type=i,this.breakAfter=0,this.prevWidget=null}merge(e,t,i,r,s,o){return i&&(!(i instanceof no)||!this.widget.compare(i.widget)||e>0&&s<=0||t<this.length&&o<=0)?!1:(this.length=e+(i?i.length:0)+(this.length-t),!0)}domAtPos(e){return e==0?ci.before(this.dom):ci.after(this.dom,e==this.length)}split(e){let t=this.length-e;this.length=e;let i=new no(this.widget,t,this.type);return i.breakAfter=this.breakAfter,i}get children(){return ym}sync(){(!this.dom||!this.widget.updateDOM(this.dom))&&(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(this.editorView)),this.dom.contentEditable="false")}get overrideDOMText(){return this.parent?this.parent.view.state.doc.slice(this.posAtStart,this.posAtEnd):j.empty}domBoundsAround(){return null}become(e){return e instanceof no&&e.type==this.type&&e.widget.constructor==this.widget.constructor?(e.widget.eq(this.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=e.widget,this.length=e.length,this.breakAfter=e.breakAfter,!0):!1}ignoreMutation(){return!0}ignoreEvent(e){return this.widget.ignoreEvent(e)}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class Dm{constructor(e,t,i,r){this.doc=e,this.pos=t,this.end=i,this.disallowBlockEffectsBelow=r,this.content=[],this.curLine=null,this.breakAtStart=0,this.pendingBuffer=0,this.atCursorPos=!0,this.openStart=-1,this.openEnd=-1,this.text="",this.textOff=0,this.cursor=e.iter(),this.skip=t}posCovered(){if(this.content.length==0)return!this.breakAtStart&&this.doc.lineAt(this.pos).from!=this.pos;let e=this.content[this.content.length-1];return!e.breakAfter&&!(e instanceof no&&e.type==dt.WidgetBefore)}getLine(){return this.curLine||(this.content.push(this.curLine=new Bi),this.atCursorPos=!0),this.curLine}flushBuffer(e){this.pendingBuffer&&(this.curLine.append($c(new Jo(-1),e),e.length),this.pendingBuffer=0)}addBlockWidget(e){this.flushBuffer([]),this.curLine=null,this.content.push(e)}finish(e){e?this.pendingBuffer=0:this.flushBuffer([]),this.posCovered()||this.getLine()}buildText(e,t,i){for(;e>0;){if(this.textOff==this.text.length){let{value:s,lineBreak:o,done:l}=this.cursor.next(this.skip);if(this.skip=0,l)throw new Error("Ran out of text content when drawing inline views");if(o){this.posCovered()||this.getLine(),this.content.length?this.content[this.content.length-1].breakAfter=1:this.breakAtStart=1,this.flushBuffer([]),this.curLine=null,e--;continue}else this.text=s,this.textOff=0}let r=Math.min(this.text.length-this.textOff,e,512);this.flushBuffer(t.slice(0,i)),this.getLine().append($c(new as(this.text.slice(this.textOff,this.textOff+r)),t),i),this.atCursorPos=!0,this.textOff+=r,e-=r,i=0}}span(e,t,i,r){this.buildText(t-e,i,r),this.pos=t,this.openStart<0&&(this.openStart=r)}point(e,t,i,r,s){let o=t-e;if(i instanceof io)if(i.block){let{type:l}=i;l==dt.WidgetAfter&&!this.posCovered()&&this.getLine(),this.addBlockWidget(new no(i.widget||new Gx("div"),o,l))}else{let l=hs.create(i.widget||new Gx("span"),o,i.startSide),a=this.atCursorPos&&!l.isEditable&&s<=r.length&&(e<t||i.startSide>0),h=!l.isEditable&&(e<t||i.startSide<=0),c=this.getLine();this.pendingBuffer==2&&!a&&(this.pendingBuffer=0),this.flushBuffer(r),a&&(c.append($c(new Jo(1),r),s),s=r.length+Math.max(0,s-r.length)),c.append($c(l,r),s),this.atCursorPos=h,this.pendingBuffer=h?e<t?1:2:0}else this.doc.lineAt(this.pos).from==this.pos&&this.getLine().addLineDeco(i);o&&(this.textOff+o<=this.text.length?this.textOff+=o:(this.skip+=o-(this.text.length-this.textOff),this.text="",this.textOff=0),this.pos=t),this.openStart<0&&(this.openStart=s)}filterPoint(e,t,i,r){if(r<this.disallowBlockEffectsBelow&&i instanceof io){if(i.block)throw new RangeError("Block decorations may not be specified via plugins");if(t>this.doc.lineAt(this.pos).to)throw new RangeError("Decorations that replace line breaks may not be specified via plugins")}return!0}static build(e,t,i,r,s){let o=new Dm(e,t,i,s);return o.openEnd=Te.spans(r,t,i,o),o.openStart<0&&(o.openStart=o.openEnd),o.finish(o.openEnd),o}}function $c(n,e){for(let t of e)n=new Un(t,[n],n.length);return n}class Gx extends zc{constructor(e){super(),this.tag=e}eq(e){return e.tag==this.tag}toDOM(){return document.createElement(this.tag)}updateDOM(e){return e.nodeName.toLowerCase()==this.tag}}const mN=[],Jx=Re.define(),Zx=Re.define(),Yx=Re.define(),Xx=Re.define(),Mm=Re.define(),Qx=Re.define(),Em=Rt.define({map:(n,e)=>n.map(e)}),eS=Rt.define({map:(n,e)=>n.map(e)});class Zo{constructor(e,t="nearest",i="nearest",r=5,s=5){this.range=e,this.y=t,this.x=i,this.yMargin=r,this.xMargin=s}map(e){return e.empty?this:new Zo(this.range.map(e),this.y,this.x,this.yMargin,this.xMargin)}}const tS=Rt.define({map:(n,e)=>n.map(e)});function cs(n,e,t){let i=n.facet(Xx);i.length?i[0](e):window.onerror?window.onerror(String(e),t,void 0,void 0,e):t?console.error(t+":",e):console.error(e)}const ya=Re.define({combine:n=>n.length?n[0]:!0});class gN{constructor(e,t){this.field=e,this.get=t}}class on{from(e){return new gN(this,e)}static define(){return new on}}on.decorations=on.define(),on.atomicRanges=on.define(),on.scrollMargins=on.define();let yN=0;const va=Re.define();class qn{constructor(e,t,i){this.id=e,this.create=t,this.fields=i,this.extension=va.of(this)}static define(e,t){let{eventHandlers:i,provide:r,decorations:s}=t||{},o=[];if(r)for(let l of Array.isArray(r)?r:[r])o.push(l);return i&&o.push(iS.from(l=>({plugin:l,handlers:i}))),s&&o.push(on.decorations.from(s)),new qn(yN++,e,o)}static fromClass(e,t){return qn.define(i=>new e(i),t)}}const iS=on.define();class Tm{constructor(e){this.spec=e,this.mustUpdate=null,this.value=null}takeField(e,t){if(this.spec)for(let{field:i,get:r}of this.spec.fields)i==e&&t.push(r(this.value))}update(e){if(this.value){if(this.mustUpdate){let t=this.mustUpdate;if(this.mustUpdate=null,this.value.update)try{this.value.update(t)}catch(i){if(cs(t.state,i,"CodeMirror plugin crashed"),this.value.destroy)try{this.value.destroy()}catch{}this.deactivate()}}}else if(this.spec)try{this.value=this.spec.create(e)}catch(t){cs(e.state,t,"CodeMirror plugin crashed"),this.deactivate()}return this}destroy(e){var t;if(!((t=this.value)===null||t===void 0)&&t.destroy)try{this.value.destroy()}catch(i){cs(e.state,i,"CodeMirror plugin crashed")}}deactivate(){this.spec=this.value=null}}const nS=Re.define(),Pm=Re.define(),ro=Re.define(),wa=Re.define();class Kn{constructor(e,t,i,r){this.fromA=e,this.toA=t,this.fromB=i,this.toB=r}join(e){return new Kn(Math.min(this.fromA,e.fromA),Math.max(this.toA,e.toA),Math.min(this.fromB,e.fromB),Math.max(this.toB,e.toB))}addToSet(e){let t=e.length,i=this;for(;t>0;t--){let r=e[t-1];if(!(r.fromA>i.toA)){if(r.toA<i.fromA)break;i=i.join(r),e.splice(t-1,1)}}return e.splice(t,0,i),e}static extendWithRanges(e,t){if(t.length==0)return e;let i=[];for(let r=0,s=0,o=0,l=0;;r++){let a=r==e.length?null:e[r],h=o-l,c=a?a.fromB:1e9;for(;s<t.length&&t[s]<c;){let u=t[s],f=t[s+1],d=Math.max(l,u),p=Math.min(c,f);if(d<=p&&new Kn(d+h,p+h,d,p).addToSet(i),f>c)break;s+=2}if(!a)return i;new Kn(a.fromA,a.toA,a.fromB,a.toB).addToSet(i),o=a.toA,l=a.toB}}}class rS{constructor(e,t,i=mN){this.view=e,this.state=t,this.transactions=i,this.flags=0,this.startState=e.state,this.changes=hi.empty(this.startState.doc.length);for(let o of i)this.changes=this.changes.compose(o.changes);let r=[];this.changes.iterChangedRanges((o,l,a,h)=>r.push(new Kn(o,l,a,h))),this.changedRanges=r;let s=e.hasFocus;s!=e.inputState.notifiedFocused&&(e.inputState.notifiedFocused=s,this.flags|=1)}get viewportChanged(){return(this.flags&4)>0}get heightChanged(){return(this.flags&2)>0}get geometryChanged(){return this.docChanged||(this.flags&10)>0}get focusChanged(){return(this.flags&1)>0}get docChanged(){return!this.changes.empty}get selectionSet(){return this.transactions.some(e=>e.selection)}get empty(){return this.flags==0&&this.transactions.length==0}}var wi=function(n){return n[n.LTR=0]="LTR",n[n.RTL=1]="RTL",n}(wi||(wi={}));const Bm=wi.LTR,vN=wi.RTL;function sS(n){let e=[];for(let t=0;t<n.length;t++)e.push(1<<+n[t]);return e}const wN=sS("88888888888888888888888888888888888666888888787833333333337888888000000000000000000000000008888880000000000000000000000000088888888888888888888888888888888888887866668888088888663380888308888800000000000000000000000800000000000000000000000000000008"),bN=sS("4444448826627288999999999992222222222222222222222222222222222222222222222229999999999999999999994444444444644222822222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222999999949999999229989999223333333333"),Rm=Object.create(null),Gn=[];for(let n of["()","[]","{}"]){let e=n.charCodeAt(0),t=n.charCodeAt(1);Rm[e]=t,Rm[t]=-e}function xN(n){return n<=247?wN[n]:1424<=n&&n<=1524?2:1536<=n&&n<=1785?bN[n-1536]:1774<=n&&n<=2220?4:8192<=n&&n<=8203||n==8204?256:1}const SN=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;class Yo{constructor(e,t,i){this.from=e,this.to=t,this.level=i}get dir(){return this.level%2?vN:Bm}side(e,t){return this.dir==t==e?this.to:this.from}static find(e,t,i,r){let s=-1;for(let o=0;o<e.length;o++){let l=e[o];if(l.from<=t&&l.to>=t){if(l.level==i)return o;(s<0||(r!=0?r<0?l.from<t:l.to>t:e[s].level>l.level))&&(s=o)}}if(s<0)throw new RangeError("Index out of range");return s}}const bt=[];function oS(n,e){let t=n.length,i=e==Bm?1:2,r=e==Bm?2:1;if(!n||i==1&&!SN.test(n))return lS(t);for(let o=0,l=i,a=i;o<t;o++){let h=xN(n.charCodeAt(o));h==512?h=l:h==8&&a==4&&(h=16),bt[o]=h==4?2:h,h&7&&(a=h),l=h}for(let o=0,l=i,a=i;o<t;o++){let h=bt[o];if(h==128)o<t-1&&l==bt[o+1]&&l&24?h=bt[o]=l:bt[o]=256;else if(h==64){let c=o+1;for(;c<t&&bt[c]==64;)c++;let u=o&&l==8||c<t&&bt[c]==8?a==1?1:8:256;for(let f=o;f<c;f++)bt[f]=u;o=c-1}else h==8&&a==1&&(bt[o]=1);l=h,h&7&&(a=h)}for(let o=0,l=0,a=0,h,c,u;o<t;o++)if(c=Rm[h=n.charCodeAt(o)])if(c<0){for(let f=l-3;f>=0;f-=3)if(Gn[f+1]==-c){let d=Gn[f+2],p=d&2?i:d&4?d&1?r:i:0;p&&(bt[o]=bt[Gn[f]]=p),l=f;break}}else{if(Gn.length==189)break;Gn[l++]=o,Gn[l++]=h,Gn[l++]=a}else if((u=bt[o])==2||u==1){let f=u==i;a=f?0:1;for(let d=l-3;d>=0;d-=3){let p=Gn[d+2];if(p&2)break;if(f)Gn[d+2]|=2;else{if(p&4)break;Gn[d+2]|=4}}}for(let o=0;o<t;o++)if(bt[o]==256){let l=o+1;for(;l<t&&bt[l]==256;)l++;let a=(o?bt[o-1]:i)==1,h=(l<t?bt[l]:i)==1,c=a==h?a?1:2:i;for(let u=o;u<l;u++)bt[u]=c;o=l-1}let s=[];if(i==1)for(let o=0;o<t;){let l=o,a=bt[o++]!=1;for(;o<t&&a==(bt[o]!=1);)o++;if(a)for(let h=o;h>l;){let c=h,u=bt[--h]!=2;for(;h>l&&u==(bt[h-1]!=2);)h--;s.push(new Yo(h,c,u?2:1))}else s.push(new Yo(l,o,0))}else for(let o=0;o<t;){let l=o,a=bt[o++]==2;for(;o<t&&a==(bt[o]==2);)o++;s.push(new Yo(l,o,a?1:2))}return s}function lS(n){return[new Yo(0,n,0)]}let aS="";function hS(n,e,t,i,r){var s;let o=i.head-n.from,l=-1;if(o==0){if(!r||!n.length)return null;e[0].level!=t&&(o=e[0].side(!1,t),l=0)}else if(o==n.length){if(r)return null;let f=e[e.length-1];f.level!=t&&(o=f.side(!0,t),l=e.length-1)}l<0&&(l=Yo.find(e,o,(s=i.bidiLevel)!==null&&s!==void 0?s:-1,i.assoc));let a=e[l];o==a.side(r,t)&&(a=e[l+=r?1:-1],o=a.side(!r,t));let h=r==(a.dir==t),c=lt(n.text,o,h);if(aS=n.text.slice(Math.min(o,c),Math.max(o,c)),c!=a.side(r,t))return be.cursor(c+n.from,h?-1:1,a.level);let u=l==(r?e.length-1:0)?null:e[l+(r?1:-1)];return!u&&a.level!=t?be.cursor(r?n.to:n.from,r?-1:1,t):u&&u.level<a.level?be.cursor(u.side(!r,t)+n.from,r?1:-1,u.level):be.cursor(c+n.from,r?-1:1,a.level)}const us="\uFFFF";class cS{constructor(e,t){this.points=e,this.text="",this.lineSeparator=t.facet(Ke.lineSeparator)}append(e){this.text+=e}lineBreak(){this.text+=us}readRange(e,t){if(!e)return this;let i=e.parentNode;for(let r=e;;){this.findPointBefore(i,r),this.readNode(r);let s=r.nextSibling;if(s==t)break;let o=Dt.get(r),l=Dt.get(s);(o&&l?o.breakAfter:(o?o.breakAfter:uS(r))||uS(s)&&(r.nodeName!="BR"||r.cmIgnore))&&this.lineBreak(),r=s}return this.findPointBefore(i,t),this}readTextNode(e){let t=e.nodeValue;for(let i of this.points)i.node==e&&(i.pos=this.text.length+Math.min(i.offset,t.length));for(let i=0,r=this.lineSeparator?null:/\r\n?|\n/g;;){let s=-1,o=1,l;if(this.lineSeparator?(s=t.indexOf(this.lineSeparator,i),o=this.lineSeparator.length):(l=r.exec(t))&&(s=l.index,o=l[0].length),this.append(t.slice(i,s<0?t.length:s)),s<0)break;if(this.lineBreak(),o>1)for(let a of this.points)a.node==e&&a.pos>this.text.length&&(a.pos-=o-1);i=s+o}}readNode(e){if(e.cmIgnore)return;let t=Dt.get(e),i=t&&t.overrideDOMText;if(i!=null){this.findPointInside(e,i.length);for(let r=i.iter();!r.next().done;)r.lineBreak?this.lineBreak():this.append(r.value)}else e.nodeType==3?this.readTextNode(e):e.nodeName=="BR"?e.nextSibling&&this.lineBreak():e.nodeType==1&&this.readRange(e.firstChild,null)}findPointBefore(e,t){for(let i of this.points)i.node==e&&e.childNodes[i.offset]==t&&(i.pos=this.text.length)}findPointInside(e,t){for(let i of this.points)(e.nodeType==3?i.node==e:e.contains(i.node))&&(i.pos=this.text.length+Math.min(t,i.offset))}}function uS(n){return n.nodeType==1&&/^(DIV|P|LI|UL|OL|BLOCKQUOTE|DD|DT|H\d|SECTION|PRE)$/.test(n.nodeName)}class fS{constructor(e,t){this.node=e,this.offset=t,this.pos=-1}}class dS extends Dt{constructor(e){super(),this.view=e,this.compositionDeco=Xe.none,this.decorations=[],this.pluginDecorationLength=0,this.minWidth=0,this.minWidthFrom=0,this.minWidthTo=0,this.impreciseAnchor=null,this.impreciseHead=null,this.forceSelection=!1,this.lastUpdate=Date.now(),this.setDOM(e.contentDOM),this.children=[new Bi],this.children[0].setParent(this),this.updateDeco(),this.updateInner([new Kn(0,0,0,e.state.doc.length)],0)}get root(){return this.view.root}get editorView(){return this.view}get length(){return this.view.state.doc.length}update(e){let t=e.changedRanges;this.minWidth>0&&t.length&&(t.every(({fromA:o,toA:l})=>l<this.minWidthFrom||o>this.minWidthTo)?(this.minWidthFrom=e.changes.mapPos(this.minWidthFrom,1),this.minWidthTo=e.changes.mapPos(this.minWidthTo,1)):this.minWidth=this.minWidthFrom=this.minWidthTo=0),this.view.inputState.composing<0?this.compositionDeco=Xe.none:(e.transactions.length||this.dirty)&&(this.compositionDeco=CN(this.view,e.changes)),(me.ie||me.chrome)&&!this.compositionDeco.size&&e&&e.state.doc.lines!=e.startState.doc.lines&&(this.forceSelection=!0);let i=this.decorations,r=this.updateDeco(),s=DN(i,r,e.changes);return t=Kn.extendWithRanges(t,s),this.dirty==0&&t.length==0?!1:(this.updateInner(t,e.startState.doc.length),e.transactions.length&&(this.lastUpdate=Date.now()),!0)}updateInner(e,t){this.view.viewState.mustMeasureContent=!0,this.updateChildren(e,t);let{observer:i}=this.view;i.ignore(()=>{this.dom.style.height=this.view.viewState.contentHeight+"px",this.dom.style.minWidth=this.minWidth?this.minWidth+"px":"";let s=me.chrome||me.ios?{node:i.selectionRange.focusNode,written:!1}:void 0;this.sync(s),this.dirty=0,s&&(s.written||i.selectionRange.focusNode!=s.node)&&(this.forceSelection=!0),this.dom.style.height=""});let r=[];if(this.view.viewport.from||this.view.viewport.to<this.view.state.doc.length)for(let s of this.children)s instanceof no&&s.widget instanceof pS&&r.push(s.dom);i.updateGaps(r)}updateChildren(e,t){let i=this.childCursor(t);for(let r=e.length-1;;r--){let s=r>=0?e[r]:null;if(!s)break;let{fromA:o,toA:l,fromB:a,toB:h}=s,{content:c,breakAtStart:u,openStart:f,openEnd:d}=Dm.build(this.view.state.doc,a,h,this.decorations,this.pluginDecorationLength),{i:p,off:g}=i.findPos(l,1),{i:y,off:v}=i.findPos(o,-1);Lx(this,y,v,p,g,c,u,f,d)}}updateSelection(e=!1,t=!1){if(e&&this.view.observer.readSelectionRange(),!(t||this.mayControlSelection())||me.ios&&this.view.inputState.rapidCompositionStart)return;let i=this.forceSelection;this.forceSelection=!1;let r=this.view.state.selection.main,s=this.domAtPos(r.anchor),o=r.empty?s:this.domAtPos(r.head);if(me.gecko&&r.empty&&kN(s)){let a=document.createTextNode("");this.view.observer.ignore(()=>s.node.insertBefore(a,s.node.childNodes[s.offset]||null)),s=o=new ci(a,0),i=!0}let l=this.view.observer.selectionRange;(i||!l.focusNode||!Ic(s.node,s.offset,l.anchorNode,l.anchorOffset)||!Ic(o.node,o.offset,l.focusNode,l.focusOffset))&&(this.view.observer.ignore(()=>{me.android&&me.chrome&&this.dom.contains(l.focusNode)&&MN(l.focusNode,this.dom)&&(this.dom.blur(),this.dom.focus({preventScroll:!0}));let a=Nc(this.root);if(r.empty){if(me.gecko){let h=ON(s.node,s.offset);if(h&&h!=3){let c=gS(s.node,s.offset,h==1?1:-1);c&&(s=new ci(c,h==1?0:c.nodeValue.length))}}a.collapse(s.node,s.offset),r.bidiLevel!=null&&l.cursorBidiLevel!=null&&(l.cursorBidiLevel=r.bidiLevel)}else if(a.extend)a.collapse(s.node,s.offset),a.extend(o.node,o.offset);else{let h=document.createRange();r.anchor>r.head&&([s,o]=[o,s]),h.setEnd(o.node,o.offset),h.setStart(s.node,s.offset),a.removeAllRanges(),a.addRange(h)}}),this.view.observer.setSelectionRange(s,o)),this.impreciseAnchor=s.precise?null:new ci(l.anchorNode,l.anchorOffset),this.impreciseHead=o.precise?null:new ci(l.focusNode,l.focusOffset)}enforceCursorAssoc(){if(this.compositionDeco.size)return;let e=this.view.state.selection.main,t=Nc(this.root);if(!e.empty||!e.assoc||!t.modify)return;let i=Bi.find(this,e.head);if(!i)return;let r=i.posAtStart;if(e.head==r||e.head==r+i.length)return;let s=this.coordsAt(e.head,-1),o=this.coordsAt(e.head,1);if(!s||!o||s.bottom>o.top)return;let l=this.domAtPos(e.head+e.assoc);t.collapse(l.node,l.offset),t.modify("move",e.assoc<0?"forward":"backward","lineboundary")}mayControlSelection(){return this.view.state.facet(ya)?this.root.activeElement==this.dom:mm(this.dom,this.view.observer.selectionRange)}nearest(e){for(let t=e;t;){let i=Dt.get(t);if(i&&i.rootView==this)return i;t=t.parentNode}return null}posFromDOM(e,t){let i=this.nearest(e);if(!i)throw new RangeError("Trying to find position for a DOM position outside of the document");return i.localPosFromDOM(e,t)+i.posAtStart}domAtPos(e){let{i:t,off:i}=this.childCursor().findPos(e,-1);for(;t<this.children.length-1;){let r=this.children[t];if(i<r.length||r instanceof Bi)break;t++,i=0}return this.children[t].domAtPos(i)}coordsAt(e,t){for(let i=this.length,r=this.children.length-1;;r--){let s=this.children[r],o=i-s.breakAfter-s.length;if(e>o||e==o&&s.type!=dt.WidgetBefore&&s.type!=dt.WidgetAfter&&(!r||t==2||this.children[r-1].breakAfter||this.children[r-1].type==dt.WidgetBefore&&t>-2))return s.coordsAt(e-o,t);i=o}}measureVisibleLineHeights(){let e=[],{from:t,to:i}=this.view.viewState.viewport,r=this.view.contentDOM.clientWidth,s=r>Math.max(this.view.scrollDOM.clientWidth,this.minWidth)+1,o=-1;for(let l=0,a=0;a<this.children.length;a++){let h=this.children[a],c=l+h.length;if(c>i)break;if(l>=t){let u=h.dom.getBoundingClientRect();if(e.push(u.height),s){let f=h.dom.lastChild,d=f?da(f):[];if(d.length){let p=d[d.length-1],g=this.view.textDirection==wi.LTR?p.right-u.left:u.right-p.left;g>o&&(o=g,this.minWidth=r,this.minWidthFrom=l,this.minWidthTo=c)}}}l=c+h.breakAfter}return e}measureTextSize(){for(let r of this.children)if(r instanceof Bi){let s=r.measureTextSize();if(s)return s}let e=document.createElement("div"),t,i;return e.className="cm-line",e.textContent="abc def ghi jkl mno pqr stu",this.view.observer.ignore(()=>{this.dom.appendChild(e);let r=da(e.firstChild)[0];t=e.getBoundingClientRect().height,i=r?r.width/27:7,e.remove()}),{lineHeight:t,charWidth:i}}childCursor(e=this.length){let t=this.children.length;return t&&(e-=this.children[--t].length),new Rx(this.children,e,t)}computeBlockGapDeco(){let e=[],t=this.view.viewState;for(let i=0,r=0;;r++){let s=r==t.viewports.length?null:t.viewports[r],o=s?s.from-1:this.length;if(o>i){let l=t.lineBlockAt(o).bottom-t.lineBlockAt(i).top;e.push(Xe.replace({widget:new pS(l),block:!0,inclusive:!0,isBlockGap:!0}).range(i,o))}if(!s)break;i=s.to+1}return Xe.set(e)}updateDeco(){let e=this.view.pluginField(on.decorations);return this.pluginDecorationLength=e.length,this.decorations=[...e,...this.view.state.facet(ro),this.compositionDeco,this.computeBlockGapDeco(),this.view.viewState.lineGapDeco]}scrollIntoView(e){let{range:t}=e,i=this.coordsAt(t.head,t.empty?t.assoc:t.head>t.anchor?-1:1),r;if(!i)return;!t.empty&&(r=this.coordsAt(t.anchor,t.anchor>t.head?-1:1))&&(i={left:Math.min(i.left,r.left),top:Math.min(i.top,r.top),right:Math.max(i.right,r.right),bottom:Math.max(i.bottom,r.bottom)});let s=0,o=0,l=0,a=0;for(let c of this.view.pluginField(on.scrollMargins))if(c){let{left:u,right:f,top:d,bottom:p}=c;u!=null&&(s=Math.max(s,u)),f!=null&&(o=Math.max(o,f)),d!=null&&(l=Math.max(l,d)),p!=null&&(a=Math.max(a,p))}let h={left:i.left-s,top:i.top-l,right:i.right+o,bottom:i.bottom+a};hN(this.view.scrollDOM,h,t.head<t.anchor?-1:1,e.x,e.y,e.xMargin,e.yMargin,this.view.textDirection==wi.LTR)}}function kN(n){return n.node.nodeType==1&&n.node.firstChild&&(n.offset==0||n.node.childNodes[n.offset-1].contentEditable=="false")&&(n.offset==n.node.childNodes.length||n.node.childNodes[n.offset].contentEditable=="false")}class pS extends zc{constructor(e){super(),this.height=e}toDOM(){let e=document.createElement("div");return this.updateDOM(e),e}eq(e){return e.height==this.height}updateDOM(e){return e.style.height=this.height+"px",!0}get estimatedHeight(){return this.height}}function mS(n){let e=n.observer.selectionRange,t=e.focusNode&&gS(e.focusNode,e.focusOffset,0);if(!t)return null;let i=n.docView.nearest(t);if(!i)return null;if(i instanceof Bi){let r=t;for(;r.parentNode!=i.dom;)r=r.parentNode;let s=r.previousSibling;for(;s&&!Dt.get(s);)s=s.previousSibling;let o=s?Dt.get(s).posAtEnd:i.posAtStart;return{from:o,to:o,node:r,text:t}}else{for(;;){let{parent:s}=i;if(!s)return null;if(s instanceof Bi)break;i=s}let r=i.posAtStart;return{from:r,to:r+i.length,node:i.dom,text:t}}}function CN(n,e){let t=mS(n);if(!t)return Xe.none;let{from:i,to:r,node:s,text:o}=t,l=e.mapPos(i,1),a=Math.max(l,e.mapPos(r,-1)),{state:h}=n,c=s.nodeType==3?s.nodeValue:new cS([],h).readRange(s.firstChild,null).text;if(a-l<c.length)if(h.doc.sliceString(l,Math.min(h.doc.length,l+c.length),us)==c)a=l+c.length;else if(h.doc.sliceString(Math.max(0,a-c.length),a,us)==c)l=a-c.length;else return Xe.none;else if(h.doc.sliceString(l,a,us)!=c)return Xe.none;let u=Dt.get(s);return u instanceof zx?u=u.widget.topView:u&&(u.parent=null),Xe.set(Xe.replace({widget:new AN(s,o,u)}).range(l,a))}class AN extends zc{constructor(e,t,i){super(),this.top=e,this.text=t,this.topView=i}eq(e){return this.top==e.top&&this.text==e.text}toDOM(){return this.top}ignoreEvent(){return!1}get customView(){return zx}}function gS(n,e,t){for(;;){if(n.nodeType==3)return n;if(n.nodeType==1&&e>0&&t<=0)n=n.childNodes[e-1],e=Wc(n);else if(n.nodeType==1&&e<n.childNodes.length&&t>=0)n=n.childNodes[e],e=0;else return null}}function ON(n,e){return n.nodeType!=1?0:(e&&n.childNodes[e-1].contentEditable=="false"?1:0)|(e<n.childNodes.length&&n.childNodes[e].contentEditable=="false"?2:0)}class _N{constructor(){this.changes=[]}compareRange(e,t){_m(e,t,this.changes)}comparePoint(e,t){_m(e,t,this.changes)}}function DN(n,e,t){let i=new _N;return Te.compare(n,e,t,i),i.changes}function MN(n,e){for(let t=n;t&&t!=e;t=t.assignedSlot||t.parentNode)if(t.nodeType==1&&t.contentEditable=="false")return!0;return!1}function EN(n,e,t=1){let i=n.charCategorizer(e),r=n.doc.lineAt(e),s=e-r.from;if(r.length==0)return be.cursor(e);s==0?t=1:s==r.length&&(t=-1);let o=s,l=s;t<0?o=lt(r.text,s,!1):l=lt(r.text,s);let a=i(r.text.slice(o,l));for(;o>0;){let h=lt(r.text,o,!1);if(i(r.text.slice(h,o))!=a)break;o=h}for(;l<r.length;){let h=lt(r.text,l);if(i(r.text.slice(l,h))!=a)break;l=h}return be.range(o+r.from,l+r.from)}function TN(n,e){return e.left>n?e.left-n:Math.max(0,n-e.right)}function PN(n,e){return e.top>n?e.top-n:Math.max(0,n-e.bottom)}function Lm(n,e){return n.top<e.bottom-1&&n.bottom>e.top+1}function yS(n,e){return e<n.top?{top:e,left:n.left,right:n.right,bottom:n.bottom}:n}function vS(n,e){return e>n.bottom?{top:n.top,left:n.left,right:n.right,bottom:e}:n}function Fm(n,e,t){let i,r,s,o,l,a,h,c;for(let d=n.firstChild;d;d=d.nextSibling){let p=da(d);for(let g=0;g<p.length;g++){let y=p[g];r&&Lm(r,y)&&(y=yS(vS(y,r.bottom),r.top));let v=TN(e,y),C=PN(t,y);if(v==0&&C==0)return d.nodeType==3?wS(d,e,t):Fm(d,e,t);(!i||o>C||o==C&&s>v)&&(i=d,r=y,s=v,o=C),v==0?t>y.bottom&&(!h||h.bottom<y.bottom)?(l=d,h=y):t<y.top&&(!c||c.top>y.top)&&(a=d,c=y):h&&Lm(h,y)?h=vS(h,y.bottom):c&&Lm(c,y)&&(c=yS(c,y.top))}}if(h&&h.bottom>=t?(i=l,r=h):c&&c.top<=t&&(i=a,r=c),!i)return{node:n,offset:0};let u=Math.max(r.left,Math.min(r.right,e));if(i.nodeType==3)return wS(i,u,t);if(!s&&i.contentEditable=="true")return Fm(i,u,t);let f=Array.prototype.indexOf.call(n.childNodes,i)+(e>=(r.left+r.right)/2?1:0);return{node:n,offset:f}}function wS(n,e,t){let i=n.nodeValue.length,r=-1,s=1e9,o=0;for(let l=0;l<i;l++){let a=pa(n,l,l+1).getClientRects();for(let h=0;h<a.length;h++){let c=a[h];if(c.top==c.bottom)continue;o||(o=e-c.left);let u=(c.top>t?c.top-t:t-c.bottom)-1;if(c.left-1<=e&&c.right+1>=e&&u<s){let f=e>=(c.left+c.right)/2,d=f;if((me.chrome||me.gecko)&&pa(n,l).getBoundingClientRect().left==c.right&&(d=!f),u<=0)return{node:n,offset:l+(d?1:0)};r=l+(d?1:0),s=u}}}return{node:n,offset:r>-1?r:o>0?n.nodeValue.length:0}}function bS(n,{x:e,y:t},i,r=-1){var s;let o=n.contentDOM.getBoundingClientRect(),l=o.top+n.viewState.paddingTop,a,{docHeight:h}=n.viewState,c=t-l;if(c<0)return 0;if(c>h)return n.state.doc.length;for(let v=n.defaultLineHeight/2,C=!1;a=n.elementAtHeight(c),a.type!=dt.Text;)for(;c=r>0?a.bottom+v:a.top-v,!(c>=0&&c<=h);){if(C)return i?null:0;C=!0,r=-r}t=l+c;let u=a.from;if(u<n.viewport.from)return n.viewport.from==0?0:i?null:xS(n,o,a,e,t);if(u>n.viewport.to)return n.viewport.to==n.state.doc.length?n.state.doc.length:i?null:xS(n,o,a,e,t);let f=n.dom.ownerDocument,d=n.root.elementFromPoint?n.root:f,p=d.elementFromPoint(e,t);p&&!n.contentDOM.contains(p)&&(p=null),p||(e=Math.max(o.left+1,Math.min(o.right-1,e)),p=d.elementFromPoint(e,t),p&&!n.contentDOM.contains(p)&&(p=null));let g,y=-1;if(p&&((s=n.docView.nearest(p))===null||s===void 0?void 0:s.isEditable)!=!1){if(f.caretPositionFromPoint){let v=f.caretPositionFromPoint(e,t);v&&({offsetNode:g,offset:y}=v)}else if(f.caretRangeFromPoint){let v=f.caretRangeFromPoint(e,t);v&&({startContainer:g,startOffset:y}=v,me.safari&&BN(g,y,e)&&(g=void 0))}}if(!g||!n.docView.dom.contains(g)){let v=Bi.find(n.docView,u);if(!v)return c>a.top+a.height/2?a.to:a.from;({node:g,offset:y}=Fm(v.dom,e,t))}return n.docView.posFromDOM(g,y)}function xS(n,e,t,i,r){let s=Math.round((i-e.left)*n.defaultCharacterWidth);n.lineWrapping&&t.height>n.defaultLineHeight*1.5&&(s+=Math.floor((r-t.top)/n.defaultLineHeight)*n.viewState.heightOracle.lineLength);let o=n.state.sliceDoc(t.from,t.to);return t.from+$d(o,s,n.state.tabSize)}function BN(n,e,t){let i;if(n.nodeType!=3||e!=(i=n.nodeValue.length))return!1;for(let r=n.nextSibling;r;r=r.nextSibling)if(r.nodeType!=1||r.nodeName!="BR")return!1;return pa(n,i-1,i).getBoundingClientRect().left>t}function RN(n,e,t,i){let r=n.state.doc.lineAt(e.head),s=!i||!n.lineWrapping?null:n.coordsAtPos(e.assoc<0&&e.head>r.from?e.head-1:e.head);if(s){let a=n.dom.getBoundingClientRect(),h=n.posAtCoords({x:t==(n.textDirection==wi.LTR)?a.right-1:a.left+1,y:(s.top+s.bottom)/2});if(h!=null)return be.cursor(h,t?-1:1)}let o=Bi.find(n.docView,e.head),l=o?t?o.posAtEnd:o.posAtStart:t?r.to:r.from;return be.cursor(l,t?-1:1)}function SS(n,e,t,i){let r=n.state.doc.lineAt(e.head),s=n.bidiSpans(r);for(let o=e,l=null;;){let a=hS(r,s,n.textDirection,o,t),h=aS;if(!a){if(r.number==(t?n.state.doc.lines:1))return o;h=`
`,r=n.state.doc.line(r.number+(t?1:-1)),s=n.bidiSpans(r),a=be.cursor(t?r.from:r.to)}if(l){if(!l(h))return o}else{if(!i)return a;l=i(h)}o=a}}function LN(n,e,t){let i=n.state.charCategorizer(e),r=i(t);return s=>{let o=i(s);return r==Mr.Space&&(r=o),r==o}}function FN(n,e,t,i){let r=e.head,s=t?1:-1;if(r==(t?n.state.doc.length:0))return be.cursor(r,e.assoc);let o=e.goalColumn,l,a=n.contentDOM.getBoundingClientRect(),h=n.coordsAtPos(r),c=n.documentTop;if(h)o==null&&(o=h.left-a.left),l=s<0?h.top:h.bottom;else{let d=n.viewState.lineBlockAt(r-c);o==null&&(o=Math.min(a.right-a.left,n.defaultCharacterWidth*(r-d.from))),l=(s<0?d.top:d.bottom)+c}let u=a.left+o,f=i!=null?i:n.defaultLineHeight>>1;for(let d=0;;d+=10){let p=l+(f+d)*s,g=bS(n,{x:u,y:p},!1,s);if(p<a.top||p>a.bottom||(s<0?g<r:g>r))return be.cursor(g,e.assoc,void 0,o)}}function Nm(n,e,t){let i=n.pluginField(on.atomicRanges);for(;;){let r=!1;for(let s of i)s.between(t.from-1,t.from+1,(o,l,a)=>{t.from>o&&t.from<l&&(t=e.from>t.from?be.cursor(o,1):be.cursor(l,-1),r=!0)});if(!r)return t}}class NN{constructor(e){this.lastKeyCode=0,this.lastKeyTime=0,this.pendingIOSKey=void 0,this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastEscPress=0,this.lastContextMenu=0,this.scrollHandlers=[],this.registeredEvents=[],this.customHandlers=[],this.composing=-1,this.compositionFirstChange=null,this.compositionEndedAt=0,this.rapidCompositionStart=!1,this.mouseSelection=null;for(let t in Jt){let i=Jt[t];e.contentDOM.addEventListener(t,r=>{!AS(e,r)||this.ignoreDuringComposition(r)||t=="keydown"&&this.keydown(e,r)||(this.mustFlushObserver(r)&&e.observer.forceFlush(),this.runCustomHandlers(t,e,r)?r.preventDefault():i(e,r))}),this.registeredEvents.push(t)}this.notifiedFocused=e.hasFocus,this.ensureHandlers(e),me.safari&&e.contentDOM.addEventListener("input",()=>null)}setSelectionOrigin(e){this.lastSelectionOrigin=e,this.lastSelectionTime=Date.now()}ensureHandlers(e){let t=this.customHandlers=e.pluginField(iS);for(let i of t)for(let r in i.handlers)this.registeredEvents.indexOf(r)<0&&r!="scroll"&&(this.registeredEvents.push(r),e.contentDOM.addEventListener(r,s=>{!AS(e,s)||this.runCustomHandlers(r,e,s)&&s.preventDefault()}))}runCustomHandlers(e,t,i){for(let r of this.customHandlers){let s=r.handlers[e];if(s)try{if(s.call(r.plugin,i,t)||i.defaultPrevented)return!0}catch(o){cs(t.state,o)}}return!1}runScrollHandlers(e,t){for(let i of this.customHandlers){let r=i.handlers.scroll;if(r)try{r.call(i.plugin,t,e)}catch(s){cs(e.state,s)}}}keydown(e,t){if(this.lastKeyCode=t.keyCode,this.lastKeyTime=Date.now(),t.keyCode==9&&Date.now()<this.lastEscPress+2e3)return!0;if(me.android&&me.chrome&&!t.synthetic&&(t.keyCode==13||t.keyCode==8))return e.observer.delayAndroidKey(t.key,t.keyCode),!0;let i;return me.ios&&(i=kS.find(r=>r.keyCode==t.keyCode))&&!(t.ctrlKey||t.altKey||t.metaKey)&&!t.synthetic?(this.pendingIOSKey=i,setTimeout(()=>this.flushIOSKey(e),250),!0):!1}flushIOSKey(e){let t=this.pendingIOSKey;return t?(this.pendingIOSKey=void 0,ma(e.contentDOM,t.key,t.keyCode)):!1}ignoreDuringComposition(e){return/^key/.test(e.type)?this.composing>0?!0:me.safari&&Date.now()-this.compositionEndedAt<500?(this.compositionEndedAt=0,!0):!1:!1}mustFlushObserver(e){return e.type=="keydown"&&e.keyCode!=229||e.type=="compositionend"&&!me.ios}startMouseSelection(e){this.mouseSelection&&this.mouseSelection.destroy(),this.mouseSelection=e}update(e){this.mouseSelection&&this.mouseSelection.update(e),e.transactions.length&&(this.lastKeyCode=this.lastSelectionTime=0)}destroy(){this.mouseSelection&&this.mouseSelection.destroy()}}const kS=[{key:"Backspace",keyCode:8,inputType:"deleteContentBackward"},{key:"Enter",keyCode:13,inputType:"insertParagraph"},{key:"Delete",keyCode:46,inputType:"deleteContentForward"}],CS=[16,17,18,20,91,92,224,225];class IN{constructor(e,t,i,r){this.view=e,this.style=i,this.mustSelect=r,this.lastEvent=t;let s=e.contentDOM.ownerDocument;s.addEventListener("mousemove",this.move=this.move.bind(this)),s.addEventListener("mouseup",this.up=this.up.bind(this)),this.extend=t.shiftKey,this.multiple=e.state.facet(Ke.allowMultipleSelections)&&WN(e,t),this.dragMove=VN(e,t),this.dragging=HN(e,t)&&Im(t)==1?null:!1,this.dragging===!1&&(t.preventDefault(),this.select(t))}move(e){if(e.buttons==0)return this.destroy();this.dragging===!1&&this.select(this.lastEvent=e)}up(e){this.dragging==null&&this.select(this.lastEvent),this.dragging||e.preventDefault(),this.destroy()}destroy(){let e=this.view.contentDOM.ownerDocument;e.removeEventListener("mousemove",this.move),e.removeEventListener("mouseup",this.up),this.view.inputState.mouseSelection=null}select(e){let t=this.style.get(e,this.extend,this.multiple);(this.mustSelect||!t.eq(this.view.state.selection)||t.main.assoc!=this.view.state.selection.main.assoc)&&this.view.dispatch({selection:t,userEvent:"select.pointer",scrollIntoView:!0}),this.mustSelect=!1}update(e){e.docChanged&&this.dragging&&(this.dragging=this.dragging.map(e.changes)),this.style.update(e)&&setTimeout(()=>this.select(this.lastEvent),20)}}function WN(n,e){let t=n.state.facet(Jx);return t.length?t[0](e):me.mac?e.metaKey:e.ctrlKey}function VN(n,e){let t=n.state.facet(Zx);return t.length?t[0](e):me.mac?!e.altKey:!e.ctrlKey}function HN(n,e){let{main:t}=n.state.selection;if(t.empty)return!1;let i=Nc(n.root);if(i.rangeCount==0)return!0;let r=i.getRangeAt(0).getClientRects();for(let s=0;s<r.length;s++){let o=r[s];if(o.left<=e.clientX&&o.right>=e.clientX&&o.top<=e.clientY&&o.bottom>=e.clientY)return!0}return!1}function AS(n,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let t=e.target,i;t!=n.contentDOM;t=t.parentNode)if(!t||t.nodeType==11||(i=Dt.get(t))&&i.ignoreEvent(e))return!1;return!0}const Jt=Object.create(null),OS=me.ie&&me.ie_version<15||me.ios&&me.webkit_version<604;function zN(n){let e=n.dom.parentNode;if(!e)return;let t=e.appendChild(document.createElement("textarea"));t.style.cssText="position: fixed; left: -10000px; top: 10px",t.focus(),setTimeout(()=>{n.focus(),t.remove(),_S(n,t.value)},50)}function _S(n,e){let{state:t}=n,i,r=1,s=t.toText(e),o=s.lines==t.selection.ranges.length;if(Wm!=null&&t.selection.ranges.every(a=>a.empty)&&Wm==s.toString()){let a=-1;i=t.changeByRange(h=>{let c=t.doc.lineAt(h.from);if(c.from==a)return{range:h};a=c.from;let u=t.toText((o?s.line(r++).text:e)+t.lineBreak);return{changes:{from:c.from,insert:u},range:be.cursor(h.from+u.length)}})}else o?i=t.changeByRange(a=>{let h=s.line(r++);return{changes:{from:a.from,to:a.to,insert:h.text},range:be.cursor(a.from+h.length)}}):i=t.replaceSelection(s);n.dispatch(i,{userEvent:"input.paste",scrollIntoView:!0})}Jt.keydown=(n,e)=>{n.inputState.setSelectionOrigin("select"),e.keyCode==27?n.inputState.lastEscPress=Date.now():CS.indexOf(e.keyCode)<0&&(n.inputState.lastEscPress=0)};let DS=0;Jt.touchstart=(n,e)=>{DS=Date.now(),n.inputState.setSelectionOrigin("select.pointer")},Jt.touchmove=n=>{n.inputState.setSelectionOrigin("select.pointer")},Jt.mousedown=(n,e)=>{if(n.observer.flush(),DS>Date.now()-2e3&&Im(e)==1)return;let t=null;for(let i of n.state.facet(Yx))if(t=i(n,e),t)break;if(!t&&e.button==0&&(t=UN(n,e)),t){let i=n.root.activeElement!=n.contentDOM;i&&n.observer.ignore(()=>Ex(n.contentDOM)),n.inputState.startMouseSelection(new IN(n,e,t,i))}};function MS(n,e,t,i){if(i==1)return be.cursor(e,t);if(i==2)return EN(n.state,e,t);{let r=Bi.find(n.docView,e),s=n.state.doc.lineAt(r?r.posAtEnd:e),o=r?r.posAtStart:s.from,l=r?r.posAtEnd:s.to;return l<n.state.doc.length&&l==s.to&&l++,be.range(o,l)}}let ES=(n,e)=>n>=e.top&&n<=e.bottom,TS=(n,e,t)=>ES(e,t)&&n>=t.left&&n<=t.right;function jN(n,e,t,i){let r=Bi.find(n.docView,e);if(!r)return 1;let s=e-r.posAtStart;if(s==0)return 1;if(s==r.length)return-1;let o=r.coordsAt(s,-1);if(o&&TS(t,i,o))return-1;let l=r.coordsAt(s,1);return l&&TS(t,i,l)?1:o&&ES(i,o)?-1:1}function PS(n,e){let t=n.posAtCoords({x:e.clientX,y:e.clientY},!1);return{pos:t,bias:jN(n,t,e.clientX,e.clientY)}}const $N=me.ie&&me.ie_version<=11;let BS=null,RS=0,LS=0;function Im(n){if(!$N)return n.detail;let e=BS,t=LS;return BS=n,LS=Date.now(),RS=!e||t>Date.now()-400&&Math.abs(e.clientX-n.clientX)<2&&Math.abs(e.clientY-n.clientY)<2?(RS+1)%3:1}function UN(n,e){let t=PS(n,e),i=Im(e),r=n.state.selection,s=t,o=e;return{update(l){l.docChanged&&(t&&(t.pos=l.changes.mapPos(t.pos)),r=r.map(l.changes),o=null)},get(l,a,h){let c;if(o&&l.clientX==o.clientX&&l.clientY==o.clientY?c=s:(c=s=PS(n,l),o=l),!c||!t)return r;let u=MS(n,c.pos,c.bias,i);if(t.pos!=c.pos&&!a){let f=MS(n,t.pos,t.bias,i),d=Math.min(f.from,u.from),p=Math.max(f.to,u.to);u=d<u.from?be.range(d,p):be.range(p,d)}return a?r.replaceRange(r.main.extend(u.from,u.to)):h?r.addRange(u):be.create([u])}}}Jt.dragstart=(n,e)=>{let{selection:{main:t}}=n.state,{mouseSelection:i}=n.inputState;i&&(i.dragging=t),e.dataTransfer&&(e.dataTransfer.setData("Text",n.state.sliceDoc(t.from,t.to)),e.dataTransfer.effectAllowed="copyMove")};function FS(n,e,t,i){if(!t)return;let r=n.posAtCoords({x:e.clientX,y:e.clientY},!1);e.preventDefault();let{mouseSelection:s}=n.inputState,o=i&&s&&s.dragging&&s.dragMove?{from:s.dragging.from,to:s.dragging.to}:null,l={from:r,insert:t},a=n.state.changes(o?[o,l]:l);n.focus(),n.dispatch({changes:a,selection:{anchor:a.mapPos(r,-1),head:a.mapPos(r,1)},userEvent:o?"move.drop":"input.drop"})}Jt.drop=(n,e)=>{if(!e.dataTransfer)return;if(n.state.readOnly)return e.preventDefault();let t=e.dataTransfer.files;if(t&&t.length){e.preventDefault();let i=Array(t.length),r=0,s=()=>{++r==t.length&&FS(n,e,i.filter(o=>o!=null).join(n.state.lineBreak),!1)};for(let o=0;o<t.length;o++){let l=new FileReader;l.onerror=s,l.onload=()=>{/[\x00-\x08\x0e-\x1f]{2}/.test(l.result)||(i[o]=l.result),s()},l.readAsText(t[o])}}else FS(n,e,e.dataTransfer.getData("Text"),!0)},Jt.paste=(n,e)=>{if(n.state.readOnly)return e.preventDefault();n.observer.flush();let t=OS?null:e.clipboardData;t?(_S(n,t.getData("text/plain")),e.preventDefault()):zN(n)};function qN(n,e){let t=n.dom.parentNode;if(!t)return;let i=t.appendChild(document.createElement("textarea"));i.style.cssText="position: fixed; left: -10000px; top: 10px",i.value=e,i.focus(),i.selectionEnd=e.length,i.selectionStart=0,setTimeout(()=>{i.remove(),n.focus()},50)}function KN(n){let e=[],t=[],i=!1;for(let r of n.selection.ranges)r.empty||(e.push(n.sliceDoc(r.from,r.to)),t.push(r));if(!e.length){let r=-1;for(let{from:s}of n.selection.ranges){let o=n.doc.lineAt(s);o.number>r&&(e.push(o.text),t.push({from:o.from,to:Math.min(n.doc.length,o.to+1)})),r=o.number}i=!0}return{text:e.join(n.lineBreak),ranges:t,linewise:i}}let Wm=null;Jt.copy=Jt.cut=(n,e)=>{let{text:t,ranges:i,linewise:r}=KN(n.state);if(!t&&!r)return;Wm=r?t:null;let s=OS?null:e.clipboardData;s?(e.preventDefault(),s.clearData(),s.setData("text/plain",t)):qN(n,t),e.type=="cut"&&!n.state.readOnly&&n.dispatch({changes:i,scrollIntoView:!0,userEvent:"delete.cut"})},Jt.focus=Jt.blur=n=>{setTimeout(()=>{n.hasFocus!=n.inputState.notifiedFocused&&n.update([])},10)};function NS(n,e){if(n.docView.compositionDeco.size){n.inputState.rapidCompositionStart=e;try{n.update([])}finally{n.inputState.rapidCompositionStart=!1}}}Jt.compositionstart=Jt.compositionupdate=n=>{n.inputState.compositionFirstChange==null&&(n.inputState.compositionFirstChange=!0),n.inputState.composing<0&&(n.inputState.composing=0,n.docView.compositionDeco.size&&(n.observer.flush(),NS(n,!0)))},Jt.compositionend=n=>{n.inputState.composing=-1,n.inputState.compositionEndedAt=Date.now(),n.inputState.compositionFirstChange=null,setTimeout(()=>{n.inputState.composing<0&&NS(n,!1)},50)},Jt.contextmenu=n=>{n.inputState.lastContextMenu=Date.now()},Jt.beforeinput=(n,e)=>{var t;let i;if(me.chrome&&me.android&&(i=kS.find(r=>r.inputType==e.inputType))&&(n.observer.delayAndroidKey(i.key,i.keyCode),i.key=="Backspace"||i.key=="Delete")){let r=((t=window.visualViewport)===null||t===void 0?void 0:t.height)||0;setTimeout(()=>{var s;(((s=window.visualViewport)===null||s===void 0?void 0:s.height)||0)>r+10&&n.hasFocus&&(n.contentDOM.blur(),n.focus())},100)}};const IS=["pre-wrap","normal","pre-line","break-spaces"];class WS{constructor(){this.doc=j.empty,this.lineWrapping=!1,this.direction=wi.LTR,this.heightSamples={},this.lineHeight=14,this.charWidth=7,this.lineLength=30,this.heightChanged=!1}heightForGap(e,t){let i=this.doc.lineAt(t).number-this.doc.lineAt(e).number+1;return this.lineWrapping&&(i+=Math.ceil((t-e-i*this.lineLength*.5)/this.lineLength)),this.lineHeight*i}heightForLine(e){return this.lineWrapping?(1+Math.max(0,Math.ceil((e-this.lineLength)/(this.lineLength-5))))*this.lineHeight:this.lineHeight}setDoc(e){return this.doc=e,this}mustRefreshForStyle(e,t){return IS.indexOf(e)>-1!=this.lineWrapping||this.direction!=t}mustRefreshForHeights(e){let t=!1;for(let i=0;i<e.length;i++){let r=e[i];r<0?i++:this.heightSamples[Math.floor(r*10)]||(t=!0,this.heightSamples[Math.floor(r*10)]=!0)}return t}refresh(e,t,i,r,s,o){let l=IS.indexOf(e)>-1,a=Math.round(i)!=Math.round(this.lineHeight)||this.lineWrapping!=l||this.direction!=t;if(this.lineWrapping=l,this.direction=t,this.lineHeight=i,this.charWidth=r,this.lineLength=s,a){this.heightSamples={};for(let h=0;h<o.length;h++){let c=o[h];c<0?h++:this.heightSamples[Math.floor(c*10)]=!0}}return a}}class VS{constructor(e,t){this.from=e,this.heights=t,this.index=0}get more(){return this.index<this.heights.length}}class Er{constructor(e,t,i,r,s){this.from=e,this.length=t,this.top=i,this.height=r,this.type=s}get to(){return this.from+this.length}get bottom(){return this.top+this.height}join(e){let t=(Array.isArray(this.type)?this.type:[this]).concat(Array.isArray(e.type)?e.type:[e]);return new Er(this.from,this.length+e.length,this.top,this.height+e.height,t)}moveY(e){return e?new Er(this.from,this.length,this.top+e,this.height,Array.isArray(this.type)?this.type.map(t=>t.moveY(e)):this.type):this}}var tt=function(n){return n[n.ByPos=0]="ByPos",n[n.ByHeight=1]="ByHeight",n[n.ByPosNoHeight=2]="ByPosNoHeight",n}(tt||(tt={}));const Uc=.001;class Ri{constructor(e,t,i=2){this.length=e,this.height=t,this.flags=i}get outdated(){return(this.flags&2)>0}set outdated(e){this.flags=(e?2:0)|this.flags&-3}setHeight(e,t){this.height!=t&&(Math.abs(this.height-t)>Uc&&(e.heightChanged=!0),this.height=t)}replace(e,t,i){return Ri.of(i)}decomposeLeft(e,t){t.push(this)}decomposeRight(e,t){t.push(this)}applyChanges(e,t,i,r){let s=this;for(let o=r.length-1;o>=0;o--){let{fromA:l,toA:a,fromB:h,toB:c}=r[o],u=s.lineAt(l,tt.ByPosNoHeight,t,0,0),f=u.to>=a?u:s.lineAt(a,tt.ByPosNoHeight,t,0,0);for(c+=f.to-a,a=f.to;o>0&&u.from<=r[o-1].toA;)l=r[o-1].fromA,h=r[o-1].fromB,o--,l<u.from&&(u=s.lineAt(l,tt.ByPosNoHeight,t,0,0));h+=u.from-l,l=u.from;let d=Vm.build(i,e,h,c);s=s.replace(l,a,d)}return s.updateHeight(i,0)}static empty(){return new ln(0,0)}static of(e){if(e.length==1)return e[0];let t=0,i=e.length,r=0,s=0;for(;;)if(t==i)if(r>s*2){let l=e[t-1];l.break?e.splice(--t,1,l.left,null,l.right):e.splice(--t,1,l.left,l.right),i+=1+l.break,r-=l.size}else if(s>r*2){let l=e[i];l.break?e.splice(i,1,l.left,null,l.right):e.splice(i,1,l.left,l.right),i+=2+l.break,s-=l.size}else break;else if(r<s){let l=e[t++];l&&(r+=l.size)}else{let l=e[--i];l&&(s+=l.size)}let o=0;return e[t-1]==null?(o=1,t--):e[t]==null&&(o=1,i++),new GN(Ri.of(e.slice(0,t)),o,Ri.of(e.slice(i)))}}Ri.prototype.size=1;class HS extends Ri{constructor(e,t,i){super(e,t),this.type=i}blockAt(e,t,i,r){return new Er(r,this.length,i,this.height,this.type)}lineAt(e,t,i,r,s){return this.blockAt(0,i,r,s)}forEachLine(e,t,i,r,s,o){o(this.blockAt(0,i,r,s))}updateHeight(e,t=0,i=!1,r){return r&&r.from<=t&&r.more&&this.setHeight(e,r.heights[r.index++]),this.outdated=!1,this}toString(){return`block(${this.length})`}}class ln extends HS{constructor(e,t){super(e,t,dt.Text),this.collapsed=0,this.widgetHeight=0}replace(e,t,i){let r=i[0];return i.length==1&&(r instanceof ln||r instanceof ui&&r.flags&4)&&Math.abs(this.length-r.length)<10?(r instanceof ui?r=new ln(r.length,this.height):r.height=this.height,this.outdated||(r.outdated=!1),r):Ri.of(i)}updateHeight(e,t=0,i=!1,r){return r&&r.from<=t&&r.more?this.setHeight(e,r.heights[r.index++]):(i||this.outdated)&&this.setHeight(e,Math.max(this.widgetHeight,e.heightForLine(this.length-this.collapsed))),this.outdated=!1,this}toString(){return`line(${this.length}${this.collapsed?-this.collapsed:""}${this.widgetHeight?":"+this.widgetHeight:""})`}}class ui extends Ri{constructor(e){super(e,0)}lines(e,t){let i=e.lineAt(t).number,r=e.lineAt(t+this.length).number;return{firstLine:i,lastLine:r,lineHeight:this.height/(r-i+1)}}blockAt(e,t,i,r){let{firstLine:s,lastLine:o,lineHeight:l}=this.lines(t,r),a=Math.max(0,Math.min(o-s,Math.floor((e-i)/l))),{from:h,length:c}=t.line(s+a);return new Er(h,c,i+l*a,l,dt.Text)}lineAt(e,t,i,r,s){if(t==tt.ByHeight)return this.blockAt(e,i,r,s);if(t==tt.ByPosNoHeight){let{from:u,to:f}=i.lineAt(e);return new Er(u,f-u,0,0,dt.Text)}let{firstLine:o,lineHeight:l}=this.lines(i,s),{from:a,length:h,number:c}=i.lineAt(e);return new Er(a,h,r+l*(c-o),l,dt.Text)}forEachLine(e,t,i,r,s,o){let{firstLine:l,lineHeight:a}=this.lines(i,s);for(let h=Math.max(e,s),c=Math.min(s+this.length,t);h<=c;){let u=i.lineAt(h);h==e&&(r+=a*(u.number-l)),o(new Er(u.from,u.length,r,a,dt.Text)),r+=a,h=u.to+1}}replace(e,t,i){let r=this.length-t;if(r>0){let s=i[i.length-1];s instanceof ui?i[i.length-1]=new ui(s.length+r):i.push(null,new ui(r-1))}if(e>0){let s=i[0];s instanceof ui?i[0]=new ui(e+s.length):i.unshift(new ui(e-1),null)}return Ri.of(i)}decomposeLeft(e,t){t.push(new ui(e-1),null)}decomposeRight(e,t){t.push(null,new ui(this.length-e-1))}updateHeight(e,t=0,i=!1,r){let s=t+this.length;if(r&&r.from<=t+this.length&&r.more){let o=[],l=Math.max(t,r.from),a=-1,h=e.heightChanged;for(r.from>t&&o.push(new ui(r.from-t-1).updateHeight(e,t));l<=s&&r.more;){let u=e.doc.lineAt(l).length;o.length&&o.push(null);let f=r.heights[r.index++];a==-1?a=f:Math.abs(f-a)>=Uc&&(a=-2);let d=new ln(u,f);d.outdated=!1,o.push(d),l+=u+1}l<=s&&o.push(null,new ui(s-l).updateHeight(e,l));let c=Ri.of(o);return e.heightChanged=h||a<0||Math.abs(c.height-this.height)>=Uc||Math.abs(a-this.lines(e.doc,t).lineHeight)>=Uc,c}else(i||this.outdated)&&(this.setHeight(e,e.heightForGap(t,t+this.length)),this.outdated=!1);return this}toString(){return`gap(${this.length})`}}class GN extends Ri{constructor(e,t,i){super(e.length+t+i.length,e.height+i.height,t|(e.outdated||i.outdated?2:0)),this.left=e,this.right=i,this.size=e.size+i.size}get break(){return this.flags&1}blockAt(e,t,i,r){let s=i+this.left.height;return e<s?this.left.blockAt(e,t,i,r):this.right.blockAt(e,t,s,r+this.left.length+this.break)}lineAt(e,t,i,r,s){let o=r+this.left.height,l=s+this.left.length+this.break,a=t==tt.ByHeight?e<o:e<l,h=a?this.left.lineAt(e,t,i,r,s):this.right.lineAt(e,t,i,o,l);if(this.break||(a?h.to<l:h.from>l))return h;let c=t==tt.ByPosNoHeight?tt.ByPosNoHeight:tt.ByPos;return a?h.join(this.right.lineAt(l,c,i,o,l)):this.left.lineAt(l,c,i,r,s).join(h)}forEachLine(e,t,i,r,s,o){let l=r+this.left.height,a=s+this.left.length+this.break;if(this.break)e<a&&this.left.forEachLine(e,t,i,r,s,o),t>=a&&this.right.forEachLine(e,t,i,l,a,o);else{let h=this.lineAt(a,tt.ByPos,i,r,s);e<h.from&&this.left.forEachLine(e,h.from-1,i,r,s,o),h.to>=e&&h.from<=t&&o(h),t>h.to&&this.right.forEachLine(h.to+1,t,i,l,a,o)}}replace(e,t,i){let r=this.left.length+this.break;if(t<r)return this.balanced(this.left.replace(e,t,i),this.right);if(e>this.left.length)return this.balanced(this.left,this.right.replace(e-r,t-r,i));let s=[];e>0&&this.decomposeLeft(e,s);let o=s.length;for(let l of i)s.push(l);if(e>0&&zS(s,o-1),t<this.length){let l=s.length;this.decomposeRight(t,s),zS(s,l)}return Ri.of(s)}decomposeLeft(e,t){let i=this.left.length;if(e<=i)return this.left.decomposeLeft(e,t);t.push(this.left),this.break&&(i++,e>=i&&t.push(null)),e>i&&this.right.decomposeLeft(e-i,t)}decomposeRight(e,t){let i=this.left.length,r=i+this.break;if(e>=r)return this.right.decomposeRight(e-r,t);e<i&&this.left.decomposeRight(e,t),this.break&&e<r&&t.push(null),t.push(this.right)}balanced(e,t){return e.size>2*t.size||t.size>2*e.size?Ri.of(this.break?[e,null,t]:[e,t]):(this.left=e,this.right=t,this.height=e.height+t.height,this.outdated=e.outdated||t.outdated,this.size=e.size+t.size,this.length=e.length+this.break+t.length,this)}updateHeight(e,t=0,i=!1,r){let{left:s,right:o}=this,l=t+s.length+this.break,a=null;return r&&r.from<=t+s.length&&r.more?a=s=s.updateHeight(e,t,i,r):s.updateHeight(e,t,i),r&&r.from<=l+o.length&&r.more?a=o=o.updateHeight(e,l,i,r):o.updateHeight(e,l,i),a?this.balanced(s,o):(this.height=this.left.height+this.right.height,this.outdated=!1,this)}toString(){return this.left+(this.break?" ":"-")+this.right}}function zS(n,e){let t,i;n[e]==null&&(t=n[e-1])instanceof ui&&(i=n[e+1])instanceof ui&&n.splice(e-1,3,new ui(t.length+1+i.length))}const JN=5;class Vm{constructor(e,t){this.pos=e,this.oracle=t,this.nodes=[],this.lineStart=-1,this.lineEnd=-1,this.covering=null,this.writtenTo=e}get isCovered(){return this.covering&&this.nodes[this.nodes.length-1]==this.covering}span(e,t){if(this.lineStart>-1){let i=Math.min(t,this.lineEnd),r=this.nodes[this.nodes.length-1];r instanceof ln?r.length+=i-this.pos:(i>this.pos||!this.isCovered)&&this.nodes.push(new ln(i-this.pos,-1)),this.writtenTo=i,t>i&&(this.nodes.push(null),this.writtenTo++,this.lineStart=-1)}this.pos=t}point(e,t,i){if(e<t||i.heightRelevant){let r=i.widget?i.widget.estimatedHeight:0;r<0&&(r=this.oracle.lineHeight);let s=t-e;i.block?this.addBlock(new HS(s,r,i.type)):(s||r>=JN)&&this.addLineDeco(r,s)}else t>e&&this.span(e,t);this.lineEnd>-1&&this.lineEnd<this.pos&&(this.lineEnd=this.oracle.doc.lineAt(this.pos).to)}enterLine(){if(this.lineStart>-1)return;let{from:e,to:t}=this.oracle.doc.lineAt(this.pos);this.lineStart=e,this.lineEnd=t,this.writtenTo<e&&((this.writtenTo<e-1||this.nodes[this.nodes.length-1]==null)&&this.nodes.push(this.blankContent(this.writtenTo,e-1)),this.nodes.push(null)),this.pos>e&&this.nodes.push(new ln(this.pos-e,-1)),this.writtenTo=this.pos}blankContent(e,t){let i=new ui(t-e);return this.oracle.doc.lineAt(e).to==t&&(i.flags|=4),i}ensureLine(){this.enterLine();let e=this.nodes.length?this.nodes[this.nodes.length-1]:null;if(e instanceof ln)return e;let t=new ln(0,-1);return this.nodes.push(t),t}addBlock(e){this.enterLine(),e.type==dt.WidgetAfter&&!this.isCovered&&this.ensureLine(),this.nodes.push(e),this.writtenTo=this.pos=this.pos+e.length,e.type!=dt.WidgetBefore&&(this.covering=e)}addLineDeco(e,t){let i=this.ensureLine();i.length+=t,i.collapsed+=t,i.widgetHeight=Math.max(i.widgetHeight,e),this.writtenTo=this.pos=this.pos+t}finish(e){let t=this.nodes.length==0?null:this.nodes[this.nodes.length-1];this.lineStart>-1&&!(t instanceof ln)&&!this.isCovered?this.nodes.push(new ln(0,-1)):(this.writtenTo<this.pos||t==null)&&this.nodes.push(this.blankContent(this.writtenTo,this.pos));let i=e;for(let r of this.nodes)r instanceof ln&&r.updateHeight(this.oracle,i),i+=r?r.length:1;return this.nodes}static build(e,t,i,r){let s=new Vm(i,e);return Te.spans(t,i,r,s,0),s.finish(i)}}function ZN(n,e,t){let i=new YN;return Te.compare(n,e,t,i,0),i.changes}class YN{constructor(){this.changes=[]}compareRange(){}comparePoint(e,t,i,r){(e<t||i&&i.heightRelevant||r&&r.heightRelevant)&&_m(e,t,this.changes,5)}}function XN(n,e){let t=n.getBoundingClientRect(),i=Math.max(0,t.left),r=Math.min(innerWidth,t.right),s=Math.max(0,t.top),o=Math.min(innerHeight,t.bottom),l=n.ownerDocument.body;for(let a=n.parentNode;a&&a!=l;)if(a.nodeType==1){let h=a,c=window.getComputedStyle(h);if((h.scrollHeight>h.clientHeight||h.scrollWidth>h.clientWidth)&&c.overflow!="visible"){let u=h.getBoundingClientRect();i=Math.max(i,u.left),r=Math.min(r,u.right),s=Math.max(s,u.top),o=Math.min(o,u.bottom)}a=c.position=="absolute"||c.position=="fixed"?h.offsetParent:h.parentNode}else if(a.nodeType==11)a=a.host;else break;return{left:i-t.left,right:Math.max(i,r)-t.left,top:s-(t.top+e),bottom:Math.max(s,o)-(t.top+e)}}function QN(n,e){let t=n.getBoundingClientRect();return{left:0,right:t.right-t.left,top:e,bottom:t.bottom-(t.top+e)}}class Hm{constructor(e,t,i){this.from=e,this.to=t,this.size=i}static same(e,t){if(e.length!=t.length)return!1;for(let i=0;i<e.length;i++){let r=e[i],s=t[i];if(r.from!=s.from||r.to!=s.to||r.size!=s.size)return!1}return!0}draw(e){return Xe.replace({widget:new eI(this.size,e)}).range(this.from,this.to)}}class eI extends zc{constructor(e,t){super(),this.size=e,this.vertical=t}eq(e){return e.size==this.size&&e.vertical==this.vertical}toDOM(){let e=document.createElement("div");return this.vertical?e.style.height=this.size+"px":(e.style.width=this.size+"px",e.style.height="2px",e.style.display="inline-block"),e}get estimatedHeight(){return this.vertical?this.size:-1}}class jS{constructor(e){this.state=e,this.pixelViewport={left:0,right:window.innerWidth,top:0,bottom:0},this.inView=!0,this.paddingTop=0,this.paddingBottom=0,this.contentDOMWidth=0,this.contentDOMHeight=0,this.editorHeight=0,this.editorWidth=0,this.heightOracle=new WS,this.scaler=qS,this.scrollTarget=null,this.printing=!1,this.mustMeasureContent=!0,this.visibleRanges=[],this.mustEnforceCursorAssoc=!1,this.heightMap=Ri.empty().applyChanges(e.facet(ro),j.empty,this.heightOracle.setDoc(e.doc),[new Kn(0,0,0,e.doc.length)]),this.viewport=this.getViewport(0,null),this.updateViewportLines(),this.updateForViewport(),this.lineGaps=this.ensureLineGaps([]),this.lineGapDeco=Xe.set(this.lineGaps.map(t=>t.draw(!1))),this.computeVisibleRanges()}updateForViewport(){let e=[this.viewport],{main:t}=this.state.selection;for(let i=0;i<=1;i++){let r=i?t.head:t.anchor;if(!e.some(({from:s,to:o})=>r>=s&&r<=o)){let{from:s,to:o}=this.lineBlockAt(r);e.push(new qc(s,o))}}this.viewports=e.sort((i,r)=>i.from-r.from),this.scaler=this.heightMap.height<=7e6?qS:new nI(this.heightOracle.doc,this.heightMap,this.viewports)}updateViewportLines(){this.viewportLines=[],this.heightMap.forEachLine(this.viewport.from,this.viewport.to,this.state.doc,0,0,e=>{this.viewportLines.push(this.scaler.scale==1?e:ba(e,this.scaler))})}update(e,t=null){let i=this.state;this.state=e.state;let r=this.state.facet(ro),s=e.changedRanges,o=Kn.extendWithRanges(s,ZN(e.startState.facet(ro),r,e?e.changes:hi.empty(this.state.doc.length))),l=this.heightMap.height;this.heightMap=this.heightMap.applyChanges(r,i.doc,this.heightOracle.setDoc(this.state.doc),o),this.heightMap.height!=l&&(e.flags|=2);let a=o.length?this.mapViewport(this.viewport,e.changes):this.viewport;(t&&(t.range.head<a.from||t.range.head>a.to)||!this.viewportIsAppropriate(a))&&(a=this.getViewport(0,t));let h=!e.changes.empty||e.flags&2||a.from!=this.viewport.from||a.to!=this.viewport.to;this.viewport=a,this.updateForViewport(),h&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(this.mapLineGaps(this.lineGaps,e.changes))),e.flags|=this.computeVisibleRanges(),t&&(this.scrollTarget=t),!this.mustEnforceCursorAssoc&&e.selectionSet&&e.view.lineWrapping&&e.state.selection.main.empty&&e.state.selection.main.assoc&&(this.mustEnforceCursorAssoc=!0)}measure(e){let t=e.contentDOM,i=window.getComputedStyle(t),r=this.heightOracle,s=i.whiteSpace,o=i.direction=="rtl"?wi.RTL:wi.LTR,l=this.heightOracle.mustRefreshForStyle(s,o),a=l||this.mustMeasureContent||this.contentDOMHeight!=t.clientHeight,h=0,c=0;if(this.editorWidth!=e.scrollDOM.clientWidth&&(r.lineWrapping&&(a=!0),this.editorWidth=e.scrollDOM.clientWidth,h|=8),a){this.mustMeasureContent=!1,this.contentDOMHeight=t.clientHeight;let v=parseInt(i.paddingTop)||0,C=parseInt(i.paddingBottom)||0;(this.paddingTop!=v||this.paddingBottom!=C)&&(h|=8,this.paddingTop=v,this.paddingBottom=C)}let u=(this.printing?QN:XN)(t,this.paddingTop),f=u.top-this.pixelViewport.top,d=u.bottom-this.pixelViewport.bottom;this.pixelViewport=u;let p=this.pixelViewport.bottom>this.pixelViewport.top&&this.pixelViewport.right>this.pixelViewport.left;if(p!=this.inView&&(this.inView=p,p&&(a=!0)),!this.inView)return 0;let g=t.clientWidth;if((this.contentDOMWidth!=g||this.editorHeight!=e.scrollDOM.clientHeight)&&(this.contentDOMWidth=g,this.editorHeight=e.scrollDOM.clientHeight,h|=8),a){let v=e.docView.measureVisibleLineHeights();if(r.mustRefreshForHeights(v)&&(l=!0),l||r.lineWrapping&&Math.abs(g-this.contentDOMWidth)>r.charWidth){let{lineHeight:C,charWidth:x}=e.docView.measureTextSize();l=r.refresh(s,o,C,x,g/x,v),l&&(e.docView.minWidth=0,h|=8)}f>0&&d>0?c=Math.max(f,d):f<0&&d<0&&(c=Math.min(f,d)),r.heightChanged=!1,this.heightMap=this.heightMap.updateHeight(r,0,l,new VS(this.viewport.from,v)),r.heightChanged&&(h|=2)}let y=!this.viewportIsAppropriate(this.viewport,c)||this.scrollTarget&&(this.scrollTarget.range.head<this.viewport.from||this.scrollTarget.range.head>this.viewport.to);return y&&(this.viewport=this.getViewport(c,this.scrollTarget)),this.updateForViewport(),(h&2||y)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(l?[]:this.lineGaps)),h|=this.computeVisibleRanges(),this.mustEnforceCursorAssoc&&(this.mustEnforceCursorAssoc=!1,e.docView.enforceCursorAssoc()),h}get visibleTop(){return this.scaler.fromDOM(this.pixelViewport.top)}get visibleBottom(){return this.scaler.fromDOM(this.pixelViewport.bottom)}getViewport(e,t){let i=.5-Math.max(-.5,Math.min(.5,e/1e3/2)),r=this.heightMap,s=this.state.doc,{visibleTop:o,visibleBottom:l}=this,a=new qc(r.lineAt(o-i*1e3,tt.ByHeight,s,0,0).from,r.lineAt(l+(1-i)*1e3,tt.ByHeight,s,0,0).to);if(t){let{head:h}=t.range;if(h<a.from||h>a.to){let c=Math.min(this.editorHeight,this.pixelViewport.bottom-this.pixelViewport.top),u=r.lineAt(h,tt.ByPos,s,0,0),f;t.y=="center"?f=(u.top+u.bottom)/2-c/2:t.y=="start"||t.y=="nearest"&&h<a.from?f=u.top:f=u.bottom-c,a=new qc(r.lineAt(f-1e3/2,tt.ByHeight,s,0,0).from,r.lineAt(f+c+1e3/2,tt.ByHeight,s,0,0).to)}}return a}mapViewport(e,t){let i=t.mapPos(e.from,-1),r=t.mapPos(e.to,1);return new qc(this.heightMap.lineAt(i,tt.ByPos,this.state.doc,0,0).from,this.heightMap.lineAt(r,tt.ByPos,this.state.doc,0,0).to)}viewportIsAppropriate({from:e,to:t},i=0){if(!this.inView)return!0;let{top:r}=this.heightMap.lineAt(e,tt.ByPos,this.state.doc,0,0),{bottom:s}=this.heightMap.lineAt(t,tt.ByPos,this.state.doc,0,0),{visibleTop:o,visibleBottom:l}=this;return(e==0||r<=o-Math.max(10,Math.min(-i,250)))&&(t==this.state.doc.length||s>=l+Math.max(10,Math.min(i,250)))&&r>o-2*1e3&&s<l+2*1e3}mapLineGaps(e,t){if(!e.length||t.empty)return e;let i=[];for(let r of e)t.touchesRange(r.from,r.to)||i.push(new Hm(t.mapPos(r.from),t.mapPos(r.to),r.size));return i}ensureLineGaps(e){let t=[];if(this.heightOracle.direction!=wi.LTR)return t;for(let i of this.viewportLines){if(i.length<4e3)continue;let r=tI(i.from,i.to,this.state);if(r.total<4e3)continue;let s,o;if(this.heightOracle.lineWrapping){let h=2e3/this.heightOracle.lineLength*this.heightOracle.lineHeight;s=Kc(r,(this.visibleTop-i.top-h)/i.height),o=Kc(r,(this.visibleBottom-i.top+h)/i.height)}else{let h=r.total*this.heightOracle.charWidth,c=2e3*this.heightOracle.charWidth;s=Kc(r,(this.pixelViewport.left-c)/h),o=Kc(r,(this.pixelViewport.right+c)/h)}let l=[];s>i.from&&l.push({from:i.from,to:s}),o<i.to&&l.push({from:o,to:i.to});let a=this.state.selection.main;a.from>=i.from&&a.from<=i.to&&US(l,a.from-10,a.from+10),!a.empty&&a.to>=i.from&&a.to<=i.to&&US(l,a.to-10,a.to+10);for(let{from:h,to:c}of l)c-h>1e3&&t.push(iI(e,u=>u.from>=i.from&&u.to<=i.to&&Math.abs(u.from-h)<1e3&&Math.abs(u.to-c)<1e3)||new Hm(h,c,this.gapSize(i,h,c,r)))}return t}gapSize(e,t,i,r){let s=$S(r,i)-$S(r,t);return this.heightOracle.lineWrapping?e.height*s:r.total*this.heightOracle.charWidth*s}updateLineGaps(e){Hm.same(e,this.lineGaps)||(this.lineGaps=e,this.lineGapDeco=Xe.set(e.map(t=>t.draw(this.heightOracle.lineWrapping))))}computeVisibleRanges(){let e=this.state.facet(ro);this.lineGaps.length&&(e=e.concat(this.lineGapDeco));let t=[];Te.spans(e,this.viewport.from,this.viewport.to,{span(r,s){t.push({from:r,to:s})},point(){}},20);let i=t.length!=this.visibleRanges.length||this.visibleRanges.some((r,s)=>r.from!=t[s].from||r.to!=t[s].to);return this.visibleRanges=t,i?4:0}lineBlockAt(e){return e>=this.viewport.from&&e<=this.viewport.to&&this.viewportLines.find(t=>t.from<=e&&t.to>=e)||ba(this.heightMap.lineAt(e,tt.ByPos,this.state.doc,0,0),this.scaler)}lineBlockAtHeight(e){return ba(this.heightMap.lineAt(this.scaler.fromDOM(e),tt.ByHeight,this.state.doc,0,0),this.scaler)}elementAtHeight(e){return ba(this.heightMap.blockAt(this.scaler.fromDOM(e),this.state.doc,0,0),this.scaler)}get docHeight(){return this.scaler.toDOM(this.heightMap.height)}get contentHeight(){return this.docHeight+this.paddingTop+this.paddingBottom}}class qc{constructor(e,t){this.from=e,this.to=t}}function tI(n,e,t){let i=[],r=n,s=0;return Te.spans(t.facet(ro),n,e,{span(){},point(o,l){o>r&&(i.push({from:r,to:o}),s+=o-r),r=l}},20),r<e&&(i.push({from:r,to:e}),s+=e-r),{total:s,ranges:i}}function Kc({total:n,ranges:e},t){if(t<=0)return e[0].from;if(t>=1)return e[e.length-1].to;let i=Math.floor(n*t);for(let r=0;;r++){let{from:s,to:o}=e[r],l=o-s;if(i<=l)return s+i;i-=l}}function $S(n,e){let t=0;for(let{from:i,to:r}of n.ranges){if(e<=r){t+=e-i;break}t+=r-i}return t/n.total}function US(n,e,t){for(let i=0;i<n.length;i++){let r=n[i];if(r.from<t&&r.to>e){let s=[];r.from<e&&s.push({from:r.from,to:e}),r.to>t&&s.push({from:t,to:r.to}),n.splice(i,1,...s),i+=s.length-1}}}function iI(n,e){for(let t of n)if(e(t))return t}const qS={toDOM(n){return n},fromDOM(n){return n},scale:1};class nI{constructor(e,t,i){let r=0,s=0,o=0;this.viewports=i.map(({from:l,to:a})=>{let h=t.lineAt(l,tt.ByPos,e,0,0).top,c=t.lineAt(a,tt.ByPos,e,0,0).bottom;return r+=c-h,{from:l,to:a,top:h,bottom:c,domTop:0,domBottom:0}}),this.scale=(7e6-r)/(t.height-r);for(let l of this.viewports)l.domTop=o+(l.top-s)*this.scale,o=l.domBottom=l.domTop+(l.bottom-l.top),s=l.bottom}toDOM(e){for(let t=0,i=0,r=0;;t++){let s=t<this.viewports.length?this.viewports[t]:null;if(!s||e<s.top)return r+(e-i)*this.scale;if(e<=s.bottom)return s.domTop+(e-s.top);i=s.bottom,r=s.domBottom}}fromDOM(e){for(let t=0,i=0,r=0;;t++){let s=t<this.viewports.length?this.viewports[t]:null;if(!s||e<s.domTop)return i+(e-r)/this.scale;if(e<=s.domBottom)return s.top+(e-s.domTop);i=s.bottom,r=s.domBottom}}}function ba(n,e){if(e.scale==1)return n;let t=e.toDOM(n.top),i=e.toDOM(n.bottom);return new Er(n.from,n.length,t,i-t,Array.isArray(n.type)?n.type.map(r=>ba(r,e)):n.type)}const Gc=Re.define({combine:n=>n.join(" ")}),zm=Re.define({combine:n=>n.indexOf(!0)>-1}),jm=Ue.newName(),KS=Ue.newName(),GS=Ue.newName(),JS={"&light":"."+KS,"&dark":"."+GS};function $m(n,e,t){return new Ue(e,{finish(i){return/&/.test(i)?i.replace(/&\w*/,r=>{if(r=="&")return n;if(!t||!t[r])throw new RangeError(`Unsupported selector: ${r}`);return t[r]}):n+" "+i}})}const rI=$m("."+jm,{"&.cm-editor":{position:"relative !important",boxSizing:"border-box","&.cm-focused":{outline:"1px dotted #212121"},display:"flex !important",flexDirection:"column"},".cm-scroller":{display:"flex !important",alignItems:"flex-start !important",fontFamily:"monospace",lineHeight:1.4,height:"100%",overflowX:"auto",position:"relative",zIndex:0},".cm-content":{margin:0,flexGrow:2,minHeight:"100%",display:"block",whiteSpace:"pre",wordWrap:"normal",boxSizing:"border-box",padding:"4px 0",outline:"none","&[contenteditable=true]":{WebkitUserModify:"read-write-plaintext-only"}},".cm-lineWrapping":{whiteSpace_fallback:"pre-wrap",whiteSpace:"break-spaces",wordBreak:"break-word",overflowWrap:"anywhere"},"&light .cm-content":{caretColor:"black"},"&dark .cm-content":{caretColor:"white"},".cm-line":{display:"block",padding:"0 2px 0 4px"},".cm-selectionLayer":{zIndex:-1,contain:"size style"},".cm-selectionBackground":{position:"absolute"},"&light .cm-selectionBackground":{background:"#d9d9d9"},"&dark .cm-selectionBackground":{background:"#222"},"&light.cm-focused .cm-selectionBackground":{background:"#d7d4f0"},"&dark.cm-focused .cm-selectionBackground":{background:"#233"},".cm-cursorLayer":{zIndex:100,contain:"size style",pointerEvents:"none"},"&.cm-focused .cm-cursorLayer":{animation:"steps(1) cm-blink 1.2s infinite"},"@keyframes cm-blink":{"0%":{},"50%":{visibility:"hidden"},"100%":{}},"@keyframes cm-blink2":{"0%":{},"50%":{visibility:"hidden"},"100%":{}},".cm-cursor, .cm-dropCursor":{position:"absolute",borderLeft:"1.2px solid black",marginLeft:"-0.6px",pointerEvents:"none"},".cm-cursor":{display:"none"},"&dark .cm-cursor":{borderLeftColor:"#444"},"&.cm-focused .cm-cursor":{display:"block"},"&light .cm-activeLine":{backgroundColor:"#f3f9ff"},"&dark .cm-activeLine":{backgroundColor:"#223039"},"&light .cm-specialChar":{color:"red"},"&dark .cm-specialChar":{color:"#f78"},".cm-tab":{display:"inline-block",overflow:"hidden",verticalAlign:"bottom"},".cm-widgetBuffer":{verticalAlign:"text-top",height:"1em",display:"inline"},".cm-placeholder":{color:"#888",display:"inline-block",verticalAlign:"top"},".cm-button":{verticalAlign:"middle",color:"inherit",fontSize:"70%",padding:".2em 1em",borderRadius:"1px"},"&light .cm-button":{backgroundImage:"linear-gradient(#eff1f5, #d9d9df)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#b4b4b4, #d0d3d6)"}},"&dark .cm-button":{backgroundImage:"linear-gradient(#393939, #111)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#111, #333)"}},".cm-textfield":{verticalAlign:"middle",color:"inherit",fontSize:"70%",border:"1px solid silver",padding:".2em .5em"},"&light .cm-textfield":{backgroundColor:"white"},"&dark .cm-textfield":{border:"1px solid #555",backgroundColor:"inherit"}},JS),sI={childList:!0,characterData:!0,subtree:!0,attributes:!0,characterDataOldValue:!0},Um=me.ie&&me.ie_version<=11;class oI{constructor(e,t,i){this.view=e,this.onChange=t,this.onScrollChanged=i,this.active=!1,this.selectionRange=new cN,this.selectionChanged=!1,this.delayedFlush=-1,this.resizeTimeout=-1,this.queue=[],this.delayedAndroidKey=null,this.scrollTargets=[],this.intersection=null,this.resize=null,this.intersecting=!1,this.gapIntersection=null,this.gaps=[],this.parentCheck=-1,this.dom=e.contentDOM,this.observer=new MutationObserver(r=>{for(let s of r)this.queue.push(s);(me.ie&&me.ie_version<=11||me.ios&&e.composing)&&r.some(s=>s.type=="childList"&&s.removedNodes.length||s.type=="characterData"&&s.oldValue.length>s.target.nodeValue.length)?this.flushSoon():this.flush()}),Um&&(this.onCharData=r=>{this.queue.push({target:r.target,type:"characterData",oldValue:r.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this),window.addEventListener("resize",this.onResize=this.onResize.bind(this)),typeof ResizeObserver=="function"&&(this.resize=new ResizeObserver(()=>{this.view.docView.lastUpdate<Date.now()-75&&this.onResize()}),this.resize.observe(e.scrollDOM)),window.addEventListener("beforeprint",this.onPrint=this.onPrint.bind(this)),this.start(),window.addEventListener("scroll",this.onScroll=this.onScroll.bind(this)),typeof IntersectionObserver=="function"&&(this.intersection=new IntersectionObserver(r=>{this.parentCheck<0&&(this.parentCheck=setTimeout(this.listenForScroll.bind(this),1e3)),r.length>0&&r[r.length-1].intersectionRatio>0!=this.intersecting&&(this.intersecting=!this.intersecting,this.intersecting!=this.view.inView&&this.onScrollChanged(document.createEvent("Event")))},{}),this.intersection.observe(this.dom),this.gapIntersection=new IntersectionObserver(r=>{r.length>0&&r[r.length-1].intersectionRatio>0&&this.onScrollChanged(document.createEvent("Event"))},{})),this.listenForScroll(),this.readSelectionRange(),this.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}onScroll(e){this.intersecting&&this.flush(!1),this.onScrollChanged(e)}onResize(){this.resizeTimeout<0&&(this.resizeTimeout=setTimeout(()=>{this.resizeTimeout=-1,this.view.requestMeasure()},50))}onPrint(){this.view.viewState.printing=!0,this.view.measure(),setTimeout(()=>{this.view.viewState.printing=!1,this.view.requestMeasure()},500)}updateGaps(e){if(this.gapIntersection&&(e.length!=this.gaps.length||this.gaps.some((t,i)=>t!=e[i]))){this.gapIntersection.disconnect();for(let t of e)this.gapIntersection.observe(t);this.gaps=e}}onSelectionChange(e){if(!this.readSelectionRange()||this.delayedAndroidKey)return;let{view:t}=this,i=this.selectionRange;if(t.state.facet(ya)?t.root.activeElement!=this.dom:!mm(t.dom,i))return;let r=i.anchorNode&&t.docView.nearest(i.anchorNode);r&&r.ignoreEvent(e)||((me.ie&&me.ie_version<=11||me.android&&me.chrome)&&!t.state.selection.main.empty&&i.focusNode&&Ic(i.focusNode,i.focusOffset,i.anchorNode,i.anchorOffset)?this.flushSoon():this.flush(!1))}readSelectionRange(){let{root:e}=this.view,t=Nc(e),i=me.safari&&e.nodeType==11&&lN()==this.view.contentDOM&&lI(this.view)||t;return this.selectionRange.eq(i)?!1:(this.selectionRange.setRange(i),this.selectionChanged=!0)}setSelectionRange(e,t){this.selectionRange.set(e.node,e.offset,t.node,t.offset),this.selectionChanged=!1}listenForScroll(){this.parentCheck=-1;let e=0,t=null;for(let i=this.dom;i;)if(i.nodeType==1)!t&&e<this.scrollTargets.length&&this.scrollTargets[e]==i?e++:t||(t=this.scrollTargets.slice(0,e)),t&&t.push(i),i=i.assignedSlot||i.parentNode;else if(i.nodeType==11)i=i.host;else break;if(e<this.scrollTargets.length&&!t&&(t=this.scrollTargets.slice(0,e)),t){for(let i of this.scrollTargets)i.removeEventListener("scroll",this.onScroll);for(let i of this.scrollTargets=t)i.addEventListener("scroll",this.onScroll)}}ignore(e){if(!this.active)return e();try{return this.stop(),e()}finally{this.start(),this.clear()}}start(){this.active||(this.observer.observe(this.dom,sI),Um&&this.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.active=!0)}stop(){!this.active||(this.active=!1,this.observer.disconnect(),Um&&this.dom.removeEventListener("DOMCharacterDataModified",this.onCharData))}clear(){this.processRecords(),this.queue.length=0,this.selectionChanged=!1}delayAndroidKey(e,t){this.delayedAndroidKey||requestAnimationFrame(()=>{let i=this.delayedAndroidKey;this.delayedAndroidKey=null;let r=this.view.state;ma(this.view.contentDOM,i.key,i.keyCode)?this.processRecords():this.flush(),this.view.state==r&&this.view.update([])}),(!this.delayedAndroidKey||e=="Enter")&&(this.delayedAndroidKey={key:e,keyCode:t})}flushSoon(){this.delayedFlush<0&&(this.delayedFlush=window.setTimeout(()=>{this.delayedFlush=-1,this.flush()},20))}forceFlush(){this.delayedFlush>=0&&(window.clearTimeout(this.delayedFlush),this.delayedFlush=-1,this.flush())}processRecords(){let e=this.queue;for(let s of this.observer.takeRecords())e.push(s);e.length&&(this.queue=[]);let t=-1,i=-1,r=!1;for(let s of e){let o=this.readMutation(s);!o||(o.typeOver&&(r=!0),t==-1?{from:t,to:i}=o:(t=Math.min(o.from,t),i=Math.max(o.to,i)))}return{from:t,to:i,typeOver:r}}flush(e=!0){if(this.delayedFlush>=0||this.delayedAndroidKey)return;e&&this.readSelectionRange();let{from:t,to:i,typeOver:r}=this.processRecords(),s=this.selectionChanged&&mm(this.dom,this.selectionRange);if(t<0&&!s)return;this.selectionChanged=!1;let o=this.view.state;this.onChange(t,i,r),this.view.state==o&&this.view.update([])}readMutation(e){let t=this.view.docView.nearest(e.target);if(!t||t.ignoreMutation(e))return null;if(t.markDirty(e.type=="attributes"),e.type=="attributes"&&(t.dirty|=4),e.type=="childList"){let i=ZS(t,e.previousSibling||e.target.previousSibling,-1),r=ZS(t,e.nextSibling||e.target.nextSibling,1);return{from:i?t.posAfter(i):t.posAtStart,to:r?t.posBefore(r):t.posAtEnd,typeOver:!1}}else return e.type=="characterData"?{from:t.posAtStart,to:t.posAtEnd,typeOver:e.target.nodeValue==e.oldValue}:null}destroy(){var e,t,i;this.stop(),(e=this.intersection)===null||e===void 0||e.disconnect(),(t=this.gapIntersection)===null||t===void 0||t.disconnect(),(i=this.resize)===null||i===void 0||i.disconnect();for(let r of this.scrollTargets)r.removeEventListener("scroll",this.onScroll);window.removeEventListener("scroll",this.onScroll),window.removeEventListener("resize",this.onResize),window.removeEventListener("beforeprint",this.onPrint),this.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange),clearTimeout(this.parentCheck),clearTimeout(this.resizeTimeout)}}function ZS(n,e,t){for(;e;){let i=Dt.get(e);if(i&&i.parent==n)return i;let r=e.parentNode;e=r!=n.dom?r:t>0?e.nextSibling:e.previousSibling}return null}function lI(n){let e=null;function t(a){a.preventDefault(),a.stopImmediatePropagation(),e=a.getTargetRanges()[0]}if(n.contentDOM.addEventListener("beforeinput",t,!0),document.execCommand("indent"),n.contentDOM.removeEventListener("beforeinput",t,!0),!e)return null;let i=e.startContainer,r=e.startOffset,s=e.endContainer,o=e.endOffset,l=n.docView.domAtPos(n.state.selection.main.anchor);return Ic(l.node,l.offset,s,o)&&([i,r,s,o]=[s,o,i,r]),{anchorNode:i,anchorOffset:r,focusNode:s,focusOffset:o}}function aI(n,e,t,i){let r,s,o=n.state.selection.main;if(e>-1){let l=n.docView.domBoundsAround(e,t,0);if(!l||n.state.readOnly)return;let{from:a,to:h}=l,c=n.docView.impreciseHead||n.docView.impreciseAnchor?[]:cI(n),u=new cS(c,n.state);u.readRange(l.startDOM,l.endDOM);let f=o.from,d=null;(n.inputState.lastKeyCode===8&&n.inputState.lastKeyTime>Date.now()-100||me.android&&u.text.length<h-a)&&(f=o.to,d="end");let p=hI(n.state.doc.sliceString(a,h,us),u.text,f-a,d);p&&(me.chrome&&n.inputState.lastKeyCode==13&&p.toB==p.from+2&&u.text.slice(p.from,p.toB)==us+us&&p.toB--,r={from:a+p.from,to:a+p.toA,insert:j.of(u.text.slice(p.from,p.toB).split(us))}),s=uI(c,a)}else if(n.hasFocus||!n.state.facet(ya)){let l=n.observer.selectionRange,{impreciseHead:a,impreciseAnchor:h}=n.docView,c=a&&a.node==l.focusNode&&a.offset==l.focusOffset||!Ko(n.contentDOM,l.focusNode)?n.state.selection.main.head:n.docView.posFromDOM(l.focusNode,l.focusOffset),u=h&&h.node==l.anchorNode&&h.offset==l.anchorOffset||!Ko(n.contentDOM,l.anchorNode)?n.state.selection.main.anchor:n.docView.posFromDOM(l.anchorNode,l.anchorOffset);(c!=o.head||u!=o.anchor)&&(s=be.single(u,c))}if(!(!r&&!s)){if(!r&&i&&!o.empty&&s&&s.main.empty?r={from:o.from,to:o.to,insert:n.state.doc.slice(o.from,o.to)}:r&&r.from>=o.from&&r.to<=o.to&&(r.from!=o.from||r.to!=o.to)&&o.to-o.from-(r.to-r.from)<=4&&(r={from:o.from,to:o.to,insert:n.state.doc.slice(o.from,r.from).append(r.insert).append(n.state.doc.slice(r.to,o.to))}),r){let l=n.state;if(me.ios&&n.inputState.flushIOSKey(n)||me.android&&(r.from==o.from&&r.to==o.to&&r.insert.length==1&&r.insert.lines==2&&ma(n.contentDOM,"Enter",13)||r.from==o.from-1&&r.to==o.to&&r.insert.length==0&&ma(n.contentDOM,"Backspace",8)||r.from==o.from&&r.to==o.to+1&&r.insert.length==0&&ma(n.contentDOM,"Delete",46)))return;let a=r.insert.toString();if(n.state.facet(Qx).some(u=>u(n,r.from,r.to,a)))return;n.inputState.composing>=0&&n.inputState.composing++;let h;if(r.from>=o.from&&r.to<=o.to&&r.to-r.from>=(o.to-o.from)/3&&(!s||s.main.empty&&s.main.from==r.from+r.insert.length)&&n.inputState.composing<0){let u=o.from<r.from?l.sliceDoc(o.from,r.from):"",f=o.to>r.to?l.sliceDoc(r.to,o.to):"";h=l.replaceSelection(n.state.toText(u+r.insert.sliceString(0,void 0,n.state.lineBreak)+f))}else{let u=l.changes(r),f=s&&!l.selection.main.eq(s.main)&&s.main.to<=u.newLength?s.main:void 0;if(l.selection.ranges.length>1&&n.inputState.composing>=0&&r.to<=o.to&&r.to>=o.to-10){let d=n.state.sliceDoc(r.from,r.to),p=mS(n)||n.state.doc.lineAt(o.head),g=o.to-r.to,y=o.to-o.from;h=l.changeByRange(v=>{if(v.from==o.from&&v.to==o.to)return{changes:u,range:f||v.map(u)};let C=v.to-g,x=C-d.length;if(v.to-v.from!=y||n.state.sliceDoc(x,C)!=d||p&&v.to>=p.from&&v.from<=p.to)return{range:v};let b=l.changes({from:x,to:C,insert:r.insert}),S=v.to-o.to;return{changes:b,range:f?be.range(Math.max(0,f.anchor+S),Math.max(0,f.head+S)):v.map(b)}})}else h={changes:u,selection:f&&l.selection.replaceRange(f)}}let c="input.type";n.composing&&(c+=".compose",n.inputState.compositionFirstChange&&(c+=".start",n.inputState.compositionFirstChange=!1)),n.dispatch(h,{scrollIntoView:!0,userEvent:c})}else if(s&&!s.main.eq(o)){let l=!1,a="select";n.inputState.lastSelectionTime>Date.now()-50&&(n.inputState.lastSelectionOrigin=="select"&&(l=!0),a=n.inputState.lastSelectionOrigin),n.dispatch({selection:s,scrollIntoView:l,userEvent:a})}}}function hI(n,e,t,i){let r=Math.min(n.length,e.length),s=0;for(;s<r&&n.charCodeAt(s)==e.charCodeAt(s);)s++;if(s==r&&n.length==e.length)return null;let o=n.length,l=e.length;for(;o>0&&l>0&&n.charCodeAt(o-1)==e.charCodeAt(l-1);)o--,l--;if(i=="end"){let a=Math.max(0,s-Math.min(o,l));t-=o+a-s}return o<s&&n.length<e.length?(s-=t<=s&&t>=o?s-t:0,l=s+(l-o),o=s):l<s&&(s-=t<=s&&t>=l?s-t:0,o=s+(o-l),l=s),{from:s,toA:o,toB:l}}function cI(n){let e=[];if(n.root.activeElement!=n.contentDOM)return e;let{anchorNode:t,anchorOffset:i,focusNode:r,focusOffset:s}=n.observer.selectionRange;return t&&(e.push(new fS(t,i)),(r!=t||s!=i)&&e.push(new fS(r,s))),e}function uI(n,e){if(n.length==0)return null;let t=n[0].pos,i=n.length==2?n[1].pos:t;return t>-1&&i>-1?be.single(t+e,i+e):null}class xt{constructor(e={}){this.plugins=[],this.pluginMap=new Map,this.editorAttrs={},this.contentAttrs={},this.bidiCache=[],this.destroyed=!1,this.updateState=2,this.measureScheduled=-1,this.measureRequests=[],this.contentDOM=document.createElement("div"),this.scrollDOM=document.createElement("div"),this.scrollDOM.tabIndex=-1,this.scrollDOM.className="cm-scroller",this.scrollDOM.appendChild(this.contentDOM),this.announceDOM=document.createElement("div"),this.announceDOM.style.cssText="position: absolute; top: -10000px",this.announceDOM.setAttribute("aria-live","polite"),this.dom=document.createElement("div"),this.dom.appendChild(this.announceDOM),this.dom.appendChild(this.scrollDOM),this._dispatch=e.dispatch||(t=>this.update([t])),this.dispatch=this.dispatch.bind(this),this.root=e.root||uN(e.parent)||document,this.viewState=new jS(e.state||Ke.create()),this.plugins=this.state.facet(va).map(t=>new Tm(t));for(let t of this.plugins)t.update(this);this.observer=new oI(this,(t,i,r)=>{aI(this,t,i,r)},t=>{this.inputState.runScrollHandlers(this,t),this.observer.intersecting&&this.measure()}),this.inputState=new NN(this),this.docView=new dS(this),this.mountStyles(),this.updateAttrs(),this.updateState=0,this.requestMeasure(),e.parent&&e.parent.appendChild(this.dom)}get state(){return this.viewState.state}get viewport(){return this.viewState.viewport}get visibleRanges(){return this.viewState.visibleRanges}get inView(){return this.viewState.inView}get composing(){return this.inputState.composing>0}get compositionStarted(){return this.inputState.composing>=0}dispatch(...e){this._dispatch(e.length==1&&e[0]instanceof Pi?e[0]:this.state.update(...e))}update(e){if(this.updateState!=0)throw new Error("Calls to EditorView.update are not allowed while an update is in progress");let t=!1,i,r=this.state;for(let o of e){if(o.startState!=r)throw new RangeError("Trying to update state with a transaction that doesn't start from the previous state.");r=o.state}if(this.destroyed){this.viewState.state=r;return}if(r.facet(Ke.phrases)!=this.state.facet(Ke.phrases))return this.setState(r);i=new rS(this,r,e);let s=this.viewState.scrollTarget;try{this.updateState=2;for(let o of e){if(s&&(s=s.map(o.changes)),o.scrollIntoView){let{main:l}=o.state.selection;s=new Zo(l.empty?l:be.cursor(l.head,l.head>l.anchor?-1:1))}for(let l of o.effects)l.is(Em)?s=new Zo(l.value):l.is(eS)?s=new Zo(l.value,"center"):l.is(tS)&&(s=l.value)}this.viewState.update(i,s),this.bidiCache=Jc.update(this.bidiCache,i.changes),i.empty||(this.updatePlugins(i),this.inputState.update(i)),t=this.docView.update(i),this.state.facet(wa)!=this.styleModules&&this.mountStyles(),this.updateAttrs(),this.showAnnouncements(e),this.docView.updateSelection(t,e.some(o=>o.isUserEvent("select.pointer")))}finally{this.updateState=0}if(i.startState.facet(Gc)!=i.state.facet(Gc)&&(this.viewState.mustMeasureContent=!0),(t||s||this.viewState.mustEnforceCursorAssoc||this.viewState.mustMeasureContent)&&this.requestMeasure(),!i.empty)for(let o of this.state.facet(Mm))o(i)}setState(e){if(this.updateState!=0)throw new Error("Calls to EditorView.setState are not allowed while an update is in progress");if(this.destroyed){this.viewState.state=e;return}this.updateState=2;let t=this.hasFocus;try{for(let i of this.plugins)i.destroy(this);this.viewState=new jS(e),this.plugins=e.facet(va).map(i=>new Tm(i)),this.pluginMap.clear();for(let i of this.plugins)i.update(this);this.docView=new dS(this),this.inputState.ensureHandlers(this),this.mountStyles(),this.updateAttrs(),this.bidiCache=[]}finally{this.updateState=0}t&&this.focus(),this.requestMeasure()}updatePlugins(e){let t=e.startState.facet(va),i=e.state.facet(va);if(t!=i){let r=[];for(let s of i){let o=t.indexOf(s);if(o<0)r.push(new Tm(s));else{let l=this.plugins[o];l.mustUpdate=e,r.push(l)}}for(let s of this.plugins)s.mustUpdate!=e&&s.destroy(this);this.plugins=r,this.pluginMap.clear(),this.inputState.ensureHandlers(this)}else for(let r of this.plugins)r.mustUpdate=e;for(let r=0;r<this.plugins.length;r++)this.plugins[r].update(this)}measure(e=!0){if(this.destroyed)return;this.measureScheduled>-1&&cancelAnimationFrame(this.measureScheduled),this.measureScheduled=0,e&&this.observer.flush();let t=null;try{for(let i=0;;i++){this.updateState=1;let r=this.viewport,s=this.viewState.measure(this);if(!s&&!this.measureRequests.length&&this.viewState.scrollTarget==null)break;if(i>5){console.warn(this.measureRequests.length?"Measure loop restarted more than 5 times":"Viewport failed to stabilize");break}let o=[];s&4||([this.measureRequests,o]=[o,this.measureRequests]);let l=o.map(u=>{try{return u.read(this)}catch(f){return cs(this.state,f),YS}}),a=new rS(this,this.state),h=!1,c=!1;a.flags|=s,t?t.flags|=s:t=a,this.updateState=2,a.empty||(this.updatePlugins(a),this.inputState.update(a),this.updateAttrs(),h=this.docView.update(a));for(let u=0;u<o.length;u++)if(l[u]!=YS)try{let f=o[u];f.write&&f.write(l[u],this)}catch(f){cs(this.state,f)}if(this.viewState.scrollTarget&&(this.docView.scrollIntoView(this.viewState.scrollTarget),this.viewState.scrollTarget=null,c=!0),h&&this.docView.updateSelection(!0),this.viewport.from==r.from&&this.viewport.to==r.to&&!c&&this.measureRequests.length==0)break}}finally{this.updateState=0,this.measureScheduled=-1}if(t&&!t.empty)for(let i of this.state.facet(Mm))i(t)}get themeClasses(){return jm+" "+(this.state.facet(zm)?GS:KS)+" "+this.state.facet(Gc)}updateAttrs(){let e=XS(this,nS,{class:"cm-editor"+(this.hasFocus?" cm-focused ":" ")+this.themeClasses}),t={spellcheck:"false",autocorrect:"off",autocapitalize:"off",translate:"no",contenteditable:this.state.facet(ya)?"true":"false",class:"cm-content",style:`${me.tabSize}: ${this.state.tabSize}`,role:"textbox","aria-multiline":"true"};this.state.readOnly&&(t["aria-readonly"]="true"),XS(this,Pm,t),this.observer.ignore(()=>{Om(this.contentDOM,this.contentAttrs,t),Om(this.dom,this.editorAttrs,e)}),this.editorAttrs=e,this.contentAttrs=t}showAnnouncements(e){let t=!0;for(let i of e)for(let r of i.effects)if(r.is(xt.announce)){t&&(this.announceDOM.textContent=""),t=!1;let s=this.announceDOM.appendChild(document.createElement("div"));s.textContent=r.value}}mountStyles(){this.styleModules=this.state.facet(wa),Ue.mount(this.root,this.styleModules.concat(rI).reverse())}readMeasured(){if(this.updateState==2)throw new Error("Reading the editor layout isn't allowed during an update");this.updateState==0&&this.measureScheduled>-1&&this.measure(!1)}requestMeasure(e){if(this.measureScheduled<0&&(this.measureScheduled=requestAnimationFrame(()=>this.measure())),e){if(e.key!=null){for(let t=0;t<this.measureRequests.length;t++)if(this.measureRequests[t].key===e.key){this.measureRequests[t]=e;return}}this.measureRequests.push(e)}}pluginField(e){let t=[];for(let i of this.plugins)i.update(this).takeField(e,t);return t}plugin(e){let t=this.pluginMap.get(e);return(t===void 0||t&&t.spec!=e)&&this.pluginMap.set(e,t=this.plugins.find(i=>i.spec==e)||null),t&&t.update(this).value}get documentTop(){return this.contentDOM.getBoundingClientRect().top+this.viewState.paddingTop}get documentPadding(){return{top:this.viewState.paddingTop,bottom:this.viewState.paddingBottom}}blockAtHeight(e,t){let i=qm(t,this);return this.elementAtHeight(e-i).moveY(i)}elementAtHeight(e){return this.readMeasured(),this.viewState.elementAtHeight(e)}visualLineAtHeight(e,t){let i=qm(t,this);return this.lineBlockAtHeight(e-i).moveY(i)}lineBlockAtHeight(e){return this.readMeasured(),this.viewState.lineBlockAtHeight(e)}viewportLines(e,t){let i=qm(t,this);for(let r of this.viewportLineBlocks)e(r.moveY(i))}get viewportLineBlocks(){return this.viewState.viewportLines}visualLineAt(e,t=0){return this.lineBlockAt(e).moveY(t+this.viewState.paddingTop)}lineBlockAt(e){return this.viewState.lineBlockAt(e)}get contentHeight(){return this.viewState.contentHeight}moveByChar(e,t,i){return Nm(this,e,SS(this,e,t,i))}moveByGroup(e,t){return Nm(this,e,SS(this,e,t,i=>LN(this,e.head,i)))}moveToLineBoundary(e,t,i=!0){return RN(this,e,t,i)}moveVertically(e,t,i){return Nm(this,e,FN(this,e,t,i))}scrollPosIntoView(e){this.dispatch({effects:Em.of(be.cursor(e))})}domAtPos(e){return this.docView.domAtPos(e)}posAtDOM(e,t=0){return this.docView.posFromDOM(e,t)}posAtCoords(e,t=!0){return this.readMeasured(),bS(this,e,t)}coordsAtPos(e,t=1){this.readMeasured();let i=this.docView.coordsAt(e,t);if(!i||i.left==i.right)return i;let r=this.state.doc.lineAt(e),s=this.bidiSpans(r),o=s[Yo.find(s,e-r.from,-1,t)];return Vc(i,o.dir==wi.LTR==t>0)}get defaultCharacterWidth(){return this.viewState.heightOracle.charWidth}get defaultLineHeight(){return this.viewState.heightOracle.lineHeight}get textDirection(){return this.viewState.heightOracle.direction}get lineWrapping(){return this.viewState.heightOracle.lineWrapping}bidiSpans(e){if(e.length>fI)return lS(e.length);let t=this.textDirection;for(let r of this.bidiCache)if(r.from==e.from&&r.dir==t)return r.order;let i=oS(e.text,this.textDirection);return this.bidiCache.push(new Jc(e.from,e.to,t,i)),i}get hasFocus(){var e;return(document.hasFocus()||me.safari&&((e=this.inputState)===null||e===void 0?void 0:e.lastContextMenu)>Date.now()-3e4)&&this.root.activeElement==this.contentDOM}focus(){this.observer.ignore(()=>{Ex(this.contentDOM),this.docView.updateSelection()})}destroy(){for(let e of this.plugins)e.destroy(this);this.plugins=[],this.inputState.destroy(),this.dom.remove(),this.observer.destroy(),this.measureScheduled>-1&&cancelAnimationFrame(this.measureScheduled),this.destroyed=!0}static scrollIntoView(e,t={}){return tS.of(new Zo(typeof e=="number"?be.cursor(e):e,t.y,t.x,t.yMargin,t.xMargin))}static domEventHandlers(e){return qn.define(()=>({}),{eventHandlers:e})}static theme(e,t){let i=Ue.newName(),r=[Gc.of(i),wa.of($m(`.${i}`,e))];return t&&t.dark&&r.push(zm.of(!0)),r}static baseTheme(e){return gx.lowest(wa.of($m("."+jm,e,JS)))}}xt.scrollTo=Em,xt.centerOn=eS,xt.styleModule=wa,xt.inputHandler=Qx,xt.exceptionSink=Xx,xt.updateListener=Mm,xt.editable=ya,xt.mouseSelectionStyle=Yx,xt.dragMovesSelection=Zx,xt.clickAddsSelectionRange=Jx,xt.decorations=ro,xt.darkTheme=zm,xt.contentAttributes=Pm,xt.editorAttributes=nS,xt.lineWrapping=xt.contentAttributes.of({class:"cm-lineWrapping"}),xt.announce=Rt.define();const fI=4096;function qm(n,e){return(n==null?e.contentDOM.getBoundingClientRect().top:n)+e.viewState.paddingTop}const YS={};class Jc{constructor(e,t,i,r){this.from=e,this.to=t,this.dir=i,this.order=r}static update(e,t){if(t.empty)return e;let i=[],r=e.length?e[e.length-1].dir:wi.LTR;for(let s=Math.max(0,e.length-10);s<e.length;s++){let o=e[s];o.dir==r&&!t.touchesRange(o.from,o.to)&&i.push(new Jc(t.mapPos(o.from,1),t.mapPos(o.to,-1),o.dir,o.order))}return i}}function XS(n,e,t){for(let i=n.state.facet(e),r=i.length-1;r>=0;r--){let s=i[r],o=typeof s=="function"?s(n):s;o&&Cm(o,t)}return t}const dI=me.mac?"mac":me.windows?"win":me.linux?"linux":"key";function pI(n,e){const t=n.split(/-(?!$)/);let i=t[t.length-1];i=="Space"&&(i=" ");let r,s,o,l;for(let a=0;a<t.length-1;++a){const h=t[a];if(/^(cmd|meta|m)$/i.test(h))l=!0;else if(/^a(lt)?$/i.test(h))r=!0;else if(/^(c|ctrl|control)$/i.test(h))s=!0;else if(/^s(hift)?$/i.test(h))o=!0;else if(/^mod$/i.test(h))e=="mac"?l=!0:s=!0;else throw new Error("Unrecognized modifier name: "+h)}return r&&(i="Alt-"+i),s&&(i="Ctrl-"+i),l&&(i="Meta-"+i),o&&(i="Shift-"+i),i}function Km(n,e,t){return e.altKey&&(n="Alt-"+n),e.ctrlKey&&(n="Ctrl-"+n),e.metaKey&&(n="Meta-"+n),t!==!1&&e.shiftKey&&(n="Shift-"+n),n}const mI=xt.domEventHandlers({keydown(n,e){return tk(ek(e.state),n,e,"editor")}}),gI=Re.define({enables:mI}),QS=new WeakMap;function ek(n){let e=n.facet(gI),t=QS.get(e);return t||QS.set(e,t=vI(e.reduce((i,r)=>i.concat(r),[]))),t}function Gj(n,e,t){return tk(ek(n.state),e,n,t)}let fs=null;const yI=4e3;function vI(n,e=dI){let t=Object.create(null),i=Object.create(null),r=(o,l)=>{let a=i[o];if(a==null)i[o]=l;else if(a!=l)throw new Error("Key binding "+o+" is used both as a regular binding and as a multi-stroke prefix")},s=(o,l,a,h)=>{let c=t[o]||(t[o]=Object.create(null)),u=l.split(/ (?!$)/).map(p=>pI(p,e));for(let p=1;p<u.length;p++){let g=u.slice(0,p).join(" ");r(g,!0),c[g]||(c[g]={preventDefault:!0,commands:[y=>{let v=fs={view:y,prefix:g,scope:o};return setTimeout(()=>{fs==v&&(fs=null)},yI),!0}]})}let f=u.join(" ");r(f,!1);let d=c[f]||(c[f]={preventDefault:!1,commands:[]});d.commands.push(a),h&&(d.preventDefault=!0)};for(let o of n){let l=o[e]||o.key;if(!!l)for(let a of o.scope?o.scope.split(" "):["editor"])s(a,l,o.run,o.preventDefault),o.shift&&s(a,"Shift-"+l,o.shift,o.preventDefault)}return t}function tk(n,e,t,i){let r=uc(e),s=r.length==1&&r!=" ",o="",l=!1;fs&&fs.view==t&&fs.scope==i&&(o=fs.prefix+" ",(l=CS.indexOf(e.keyCode)<0)&&(fs=null));let a=u=>{if(u){for(let f of u.commands)if(f(t))return!0;u.preventDefault&&(l=!0)}return!1},h=n[i],c;if(h){if(a(h[o+Km(r,e,!s)]))return!0;if(s&&(e.shiftKey||e.altKey||e.metaKey)&&(c=Bn[e.keyCode])&&c!=r){if(a(h[o+Km(c,e,!0)]))return!0}else if(s&&e.shiftKey&&a(h[o+Km(r,e,!0)]))return!0}return l}const wI=!me.ios,bI=Re.define({combine(n){return _x(n,{cursorBlinkRate:1200,drawRangeCursor:!0},{cursorBlinkRate:(e,t)=>Math.min(e,t),drawRangeCursor:(e,t)=>e||t})}});function Jj(n={}){return[bI.of(n),xI,kI]}class ik{constructor(e,t,i,r,s){this.left=e,this.top=t,this.width=i,this.height=r,this.className=s}draw(){let e=document.createElement("div");return e.className=this.className,this.adjust(e),e}adjust(e){e.style.left=this.left+"px",e.style.top=this.top+"px",this.width>=0&&(e.style.width=this.width+"px"),e.style.height=this.height+"px"}eq(e){return this.left==e.left&&this.top==e.top&&this.width==e.width&&this.height==e.height&&this.className==e.className}}const xI=null,SI={".cm-line":{"& ::selection":{backgroundColor:"transparent !important"},"&::selection":{backgroundColor:"transparent !important"}}};wI&&(SI[".cm-line"].caretColor="transparent !important");const kI=null;function nk(n){let e=n.scrollDOM.getBoundingClientRect();return{left:(n.textDirection==wi.LTR?e.left:e.right-n.scrollDOM.clientWidth)-n.scrollDOM.scrollLeft,top:e.top-n.scrollDOM.scrollTop}}function rk(n,e,t){let i=EditorSelection.cursor(e);return{from:Math.max(t.from,n.moveToLineBoundary(i,!1,!0).from),to:Math.min(t.to,n.moveToLineBoundary(i,!0,!0).from),type:dt.Text}}function sk(n,e){let t=n.lineBlockAt(e);if(Array.isArray(t.type)){for(let i of t.type)if(i.to>e||i.to==e&&(i.to==t.to||i.type==dt.Text))return i}return t}function Zj(n,e){if(e.to<=n.viewport.from||e.from>=n.viewport.to)return[];let t=Math.max(e.from,n.viewport.from),i=Math.min(e.to,n.viewport.to),r=n.textDirection==wi.LTR,s=n.contentDOM,o=s.getBoundingClientRect(),l=nk(n),a=window.getComputedStyle(s.firstChild),h=o.left+parseInt(a.paddingLeft)+Math.min(0,parseInt(a.textIndent)),c=o.right-parseInt(a.paddingRight),u=sk(n,t),f=sk(n,i),d=u.type==dt.Text?u:null,p=f.type==dt.Text?f:null;if(n.lineWrapping&&(d&&(d=rk(n,t,d)),p&&(p=rk(n,i,p))),d&&p&&d.from==p.from)return y(v(e.from,e.to,d));{let x=d?v(e.from,null,d):C(u,!1),b=p?v(null,e.to,p):C(f,!0),S=[];return(d||u).to<(p||f).from-1?S.push(g(h,x.bottom,c,b.top)):x.bottom<b.top&&n.elementAtHeight((x.bottom+b.top)/2).type==dt.Text&&(x.bottom=b.top=(x.bottom+b.top)/2),y(x).concat(S).concat(y(b))}function g(x,b,S,k){return new ik(x-l.left,b-l.top-.01,S-x,k-b+.01,"cm-selectionBackground")}function y({top:x,bottom:b,horizontal:S}){let k=[];for(let A=0;A<S.length;A+=2)k.push(g(S[A],x,S[A+1],b));return k}function v(x,b,S){let k=1e9,A=-1e9,_=[];function O(B,N,ne,W,J){let re=n.coordsAtPos(B,B==S.to?-2:2),ie=n.coordsAtPos(ne,ne==S.from?2:-2);k=Math.min(re.top,ie.top,k),A=Math.max(re.bottom,ie.bottom,A),J==wi.LTR?_.push(r&&N?h:re.left,r&&W?c:ie.right):_.push(!r&&W?h:ie.left,!r&&N?c:re.right)}let D=x!=null?x:S.from,T=b!=null?b:S.to;for(let B of n.visibleRanges)if(B.to>D&&B.from<T)for(let N=Math.max(B.from,D),ne=Math.min(B.to,T);;){let W=n.state.doc.lineAt(N);for(let J of n.bidiSpans(W)){let re=J.from+W.from,ie=J.to+W.from;if(re>=ne)break;ie>N&&O(Math.max(re,N),x==null&&re<=D,Math.min(ie,ne),b==null&&ie>=T,J.dir)}if(N=W.to+1,N>=ne)break}return _.length==0&&O(D,x==null,T,b==null,n.textDirection),{top:k,bottom:A,horizontal:_}}function C(x,b){let S=o.top+(b?x.top:x.bottom);return{top:S,bottom:S,horizontal:[]}}}function Yj(n,e,t){let i=n.coordsAtPos(e.head,e.assoc||1);if(!i)return null;let r=nk(n);return new ik(i.left-r.left,i.top-r.top,-1,i.bottom-i.top,t?"cm-cursor cm-cursor-primary":"cm-cursor cm-cursor-secondary")}const ok=Rt.define({map(n,e){return n==null?null:e.mapPos(n)}}),xa=eo.define({create(){return null},update(n,e){return n!=null&&(n=e.changes.mapPos(n)),e.effects.reduce((t,i)=>i.is(ok)?i.value:t,n)}}),CI=qn.fromClass(class{constructor(n){this.view=n,this.cursor=null,this.measureReq={read:this.readPos.bind(this),write:this.drawCursor.bind(this)}}update(n){var e;let t=n.state.field(xa);t==null?this.cursor!=null&&((e=this.cursor)===null||e===void 0||e.remove(),this.cursor=null):(this.cursor||(this.cursor=this.view.scrollDOM.appendChild(document.createElement("div")),this.cursor.className="cm-dropCursor"),(n.startState.field(xa)!=t||n.docChanged||n.geometryChanged)&&this.view.requestMeasure(this.measureReq))}readPos(){let n=this.view.state.field(xa),e=n!=null&&this.view.coordsAtPos(n);if(!e)return null;let t=this.view.scrollDOM.getBoundingClientRect();return{left:e.left-t.left+this.view.scrollDOM.scrollLeft,top:e.top-t.top+this.view.scrollDOM.scrollTop,height:e.bottom-e.top}}drawCursor(n){this.cursor&&(n?(this.cursor.style.left=n.left+"px",this.cursor.style.top=n.top+"px",this.cursor.style.height=n.height+"px"):this.cursor.style.left="-100000px")}destroy(){this.cursor&&this.cursor.remove()}setDropPos(n){this.view.state.field(xa)!=n&&this.view.dispatch({effects:ok.of(n)})}},{eventHandlers:{dragover(n){this.setDropPos(this.view.posAtCoords({x:n.clientX,y:n.clientY}))},dragleave(n){(n.target==this.view.contentDOM||!this.view.contentDOM.contains(n.relatedTarget))&&this.setDropPos(null)},dragend(){this.setDropPos(null)},drop(){this.setDropPos(null)}}});function Xj(){return[xa,CI]}function lk(n,e,t,i,r){e.lastIndex=0;for(let s=n.iterRange(t,i),o=t,l;!s.next().done;o+=s.value.length)if(!s.lineBreak)for(;l=e.exec(s.value);)r(o+l.index,o+l.index+l[0].length,l)}function AI(n,e){let t=n.visibleRanges;if(t.length==1&&t[0].from==n.viewport.from&&t[0].to==n.viewport.to)return t;let i=[];for(let{from:r,to:s}of t)r=Math.max(n.state.doc.lineAt(r).from,r-e),s=Math.min(n.state.doc.lineAt(s).to,s+e),i.length&&i[i.length-1].to>=r?i[i.length-1].to=s:i.push({from:r,to:s});return i}class OI{constructor(e){let{regexp:t,decoration:i,boundary:r,maxLength:s=1e3}=e;if(!t.global)throw new RangeError("The regular expression given to MatchDecorator should have its 'g' flag set");this.regexp=t,this.getDeco=typeof i=="function"?i:()=>i,this.boundary=r,this.maxLength=s}createDeco(e){let t=new RangeSetBuilder;for(let{from:i,to:r}of AI(e,this.maxLength))lk(e.state.doc,this.regexp,i,r,(s,o,l)=>t.add(s,o,this.getDeco(l,e,s)));return t.finish()}updateDeco(e,t){let i=1e9,r=-1;return e.docChanged&&e.changes.iterChanges((s,o,l,a)=>{a>e.view.viewport.from&&l<e.view.viewport.to&&(i=Math.min(l,i),r=Math.max(a,r))}),e.viewportChanged||r-i>1e3?this.createDeco(e.view):r>-1?this.updateRange(e.view,t.map(e.changes),i,r):t}updateRange(e,t,i,r){for(let s of e.visibleRanges){let o=Math.max(s.from,i),l=Math.min(s.to,r);if(l>o){let a=e.state.doc.lineAt(o),h=a.to<l?e.state.doc.lineAt(l):a,c=Math.max(s.from,a.from),u=Math.min(s.to,h.to);if(this.boundary){for(;o>a.from;o--)if(this.boundary.test(a.text[o-1-a.from])){c=o;break}for(;l<h.to;l++)if(this.boundary.test(h.text[l-h.from])){u=l;break}}let f=[],d;if(a==h)for(this.regexp.lastIndex=c-a.from;(d=this.regexp.exec(a.text))&&d.index<u-a.from;){let p=d.index+a.from;f.push(this.getDeco(d,e,p).range(p,p+d[0].length))}else lk(e.state.doc,this.regexp,c,u,(p,g,y)=>f.push(this.getDeco(y,e,p).range(p,g)));t=t.update({filterFrom:c,filterTo:u,filter:(p,g)=>p<c||g>u,add:f})}}return t}}const Gm=/x/.unicode!=null?"gu":"g",_I=new RegExp(`[\0-\b
-\x7F-\x9F\xAD\u061C\u200B\u200E\u200F\u2028\u2029\u202D\u202E\uFEFF\uFFF9-\uFFFC]`,Gm),DI={0:"null",7:"bell",8:"backspace",10:"newline",11:"vertical tab",13:"carriage return",27:"escape",8203:"zero width space",8204:"zero width non-joiner",8205:"zero width joiner",8206:"left-to-right mark",8207:"right-to-left mark",8232:"line separator",8237:"left-to-right override",8238:"right-to-left override",8233:"paragraph separator",65279:"zero width no-break space",65532:"object replacement"};let Jm=null;function MI(){var n;if(Jm==null&&typeof document!="undefined"&&document.body){let e=document.body.style;Jm=((n=e.tabSize)!==null&&n!==void 0?n:e.MozTabSize)!=null}return Jm||!1}const Zc=Re.define({combine(n){let e=_x(n,{render:null,specialChars:_I,addSpecialChars:null});return(e.replaceTabs=!MI())&&(e.specialChars=new RegExp("	|"+e.specialChars.source,Gm)),e.addSpecialChars&&(e.specialChars=new RegExp(e.specialChars.source+"|"+e.addSpecialChars.source,Gm)),e}});function Qj(n={}){return[Zc.of(n),EI()]}let ak=null;function EI(){return ak||(ak=qn.fromClass(class{constructor(n){this.view=n,this.decorations=Xe.none,this.decorationCache=Object.create(null),this.decorator=this.makeDecorator(n.state.facet(Zc)),this.decorations=this.decorator.createDeco(n)}makeDecorator(n){return new OI({regexp:n.specialChars,decoration:(e,t,i)=>{let{doc:r}=t.state,s=codePointAt(e[0],0);if(s==9){let o=r.lineAt(i),l=t.state.tabSize,a=countColumn(o.text,l,i-o.from);return Xe.replace({widget:new RI((l-a%l)*this.view.defaultCharacterWidth)})}return this.decorationCache[s]||(this.decorationCache[s]=Xe.replace({widget:new BI(n,s)}))},boundary:n.replaceTabs?void 0:/[^]/})}update(n){let e=n.state.facet(Zc);n.startState.facet(Zc)!=e?(this.decorator=this.makeDecorator(e),this.decorations=this.decorator.createDeco(n.view)):this.decorations=this.decorator.updateDeco(n,this.decorations)}},{decorations:n=>n.decorations}))}const TI="\u2022";function PI(n){return n>=32?TI:n==10?"\u2424":String.fromCharCode(9216+n)}class BI extends null{constructor(e,t){super(),this.options=e,this.code=t}eq(e){return e.code==this.code}toDOM(e){let t=PI(this.code),i=e.state.phrase("Control character")+" "+(DI[this.code]||"0x"+this.code.toString(16)),r=this.options.render&&this.options.render(this.code,i,t);if(r)return r;let s=document.createElement("span");return s.textContent=t,s.title=i,s.setAttribute("aria-label",i),s.className="cm-specialChar",s}ignoreEvent(){return!1}}class RI extends null{constructor(e){super(),this.width=e}eq(e){return e.width==this.width}toDOM(){let e=document.createElement("span");return e.textContent="	",e.className="cm-tab",e.style.width=this.width+"px",e}ignoreEvent(){return!1}}const hk=null;function e6(){return[hk,Pm.of(n=>{var e;return((e=n.plugin(hk))===null||e===void 0?void 0:e.attrs)||null})]}function t6(){return FI}const LI=Xe.line({class:"cm-activeLine"}),FI=qn.fromClass(class{constructor(n){this.decorations=this.getDeco(n)}update(n){(n.docChanged||n.selectionSet)&&(this.decorations=this.getDeco(n.view))}getDeco(n){let e=-1,t=[];for(let i of n.state.selection.ranges){if(!i.empty)return Xe.none;let r=n.lineBlockAt(i.head);r.from>e&&(t.push(LI.range(r.from)),e=r.from)}return Xe.set(t)}},{decorations:n=>n.decorations});class NI extends null{constructor(e){super(),this.content=e}toDOM(){let e=document.createElement("span");return e.className="cm-placeholder",e.style.pointerEvents="none",e.appendChild(typeof this.content=="string"?document.createTextNode(this.content):this.content),typeof this.content=="string"?e.setAttribute("aria-label","placeholder "+this.content):e.setAttribute("aria-hidden","true"),e}ignoreEvent(){return!1}}function i6(n){return qn.fromClass(class{constructor(e){this.view=e,this.placeholder=Xe.set([Xe.widget({widget:new NI(n),side:1}).range(0)])}get decorations(){return this.view.state.doc.length?Xe.none:this.placeholder}},{decorations:e=>e.decorations})}const n6={HeightMap:Ri,HeightOracle:WS,MeasuredHeights:VS,QueryType:tt,ChangedRange:Kn,computeOrder:oS,moveVisually:hS};var Zm;const Yc=new je;function II(n){return Facet.define({combine:n?e=>e.concat(n):void 0})}class Ln{constructor(e,t,i,r=[]){this.data=e,this.topNode=i,Ke.prototype.hasOwnProperty("tree")||Object.defineProperty(Ke.prototype,"tree",{get(){return so(this)}}),this.parser=t,this.extension=[Qo.of(this),Ke.languageData.of((s,o,l)=>s.facet(ck(s,o,l)))].concat(r)}isActiveAt(e,t,i=-1){return ck(e,t,i)==this.data}findRegions(e){let t=e.facet(Qo);if((t==null?void 0:t.data)==this.data)return[{from:0,to:e.doc.length}];if(!t||!t.allowsNesting)return[];let i=[],r=(s,o)=>{if(s.prop(Yc)==this.data){i.push({from:o,to:o+s.length});return}let l=s.prop(je.mounted);if(l){if(l.tree.prop(Yc)==this.data){if(l.overlay)for(let a of l.overlay)i.push({from:a.from+o,to:a.to+o});else i.push({from:o,to:o+s.length});return}else if(l.overlay){let a=i.length;if(r(l.tree,l.overlay[0].from+o),i.length>a)return}}for(let a=0;a<s.children.length;a++){let h=s.children[a];h instanceof $t&&r(h,s.positions[a]+o)}};return r(so(e),0),i}get allowsNesting(){return!0}}Ln.setState=Rt.define();function ck(n,e,t){let i=n.facet(Qo);if(!i)return null;let r=i.data;if(i.allowsNesting)for(let s=so(n).topNode;s;s=s.enter(e,t,!0,!1))r=s.type.prop(Yc)||r;return r}class Ym extends null{constructor(e,t){super(e,t,t.topNode),this.parser=t}static define(e){let t=II(e.languageData);return new Ym(t,e.parser.configure({props:[Yc.add(i=>i.isTop?t:void 0)]}))}configure(e){return new Ym(this.data,this.parser.configure(e))}get allowsNesting(){return this.parser.wrappers.length>0}}function so(n){let e=n.field(Ln.state,!1);return e?e.tree:$t.empty}function r6(n,e,t=50){var i;let r=(i=n.field(Ln.state,!1))===null||i===void 0?void 0:i.context;return r&&(r.isDone(e)||r.work(t,e))?r.tree:null}function s6(n,e=n.doc.length){var t;return((t=n.field(Ln.state,!1))===null||t===void 0?void 0:t.context.isDone(e))||!1}function o6(n){var e;return((e=n.plugin(dk))===null||e===void 0?void 0:e.isWorking())||!1}class WI{constructor(e,t=e.length){this.doc=e,this.length=t,this.cursorPos=0,this.string="",this.cursor=e.iter()}syncTo(e){return this.string=this.cursor.next(e-this.cursorPos).value,this.cursorPos=e+this.string.length,this.cursorPos-this.string.length}chunk(e){return this.syncTo(e),this.string}get lineChunks(){return!0}read(e,t){let i=this.cursorPos-this.string.length;return e<i||t>=this.cursorPos?this.doc.sliceString(e,t):this.string.slice(e-i,t-i)}}let Sa=null;class Xm{constructor(e,t,i=[],r,s,o,l,a){this.parser=e,this.state=t,this.fragments=i,this.tree=r,this.treeLen=s,this.viewport=o,this.skipped=l,this.scheduleOn=a,this.parse=null,this.tempSkipped=[]}startParse(){return this.parser.startParse(new WI(this.state.doc),this.fragments)}work(e,t){return t!=null&&t>=this.state.doc.length&&(t=void 0),this.tree!=$t.empty&&this.isDone(t!=null?t:this.state.doc.length)?(this.takeTree(),!0):this.withContext(()=>{var i;if(typeof e=="number"){let r=Date.now()+e;e=()=>Date.now()>r}for(this.parse||(this.parse=this.startParse()),t!=null&&(this.parse.stoppedAt==null||this.parse.stoppedAt>t)&&t<this.state.doc.length&&this.parse.stopAt(t);;){let r=this.parse.advance();if(r)if(this.fragments=this.withoutTempSkipped(_r.addTree(r,this.fragments,this.parse.stoppedAt!=null)),this.treeLen=(i=this.parse.stoppedAt)!==null&&i!==void 0?i:this.state.doc.length,this.tree=r,this.parse=null,this.treeLen<(t!=null?t:this.state.doc.length))this.parse=this.startParse();else return!0;if(e())return!1}})}takeTree(){let e,t;this.parse&&(e=this.parse.parsedPos)>=this.treeLen&&((this.parse.stoppedAt==null||this.parse.stoppedAt>e)&&this.parse.stopAt(e),this.withContext(()=>{for(;!(t=this.parse.advance()););}),this.treeLen=e,this.tree=t,this.fragments=this.withoutTempSkipped(_r.addTree(this.tree,this.fragments,!0)),this.parse=null)}withContext(e){let t=Sa;Sa=this;try{return e()}finally{Sa=t}}withoutTempSkipped(e){for(let t;t=this.tempSkipped.pop();)e=uk(e,t.from,t.to);return e}changes(e,t){let{fragments:i,tree:r,treeLen:s,viewport:o,skipped:l}=this;if(this.takeTree(),!e.empty){let a=[];if(e.iterChangedRanges((h,c,u,f)=>a.push({fromA:h,toA:c,fromB:u,toB:f})),i=_r.applyChanges(i,a),r=$t.empty,s=0,o={from:e.mapPos(o.from,-1),to:e.mapPos(o.to,1)},this.skipped.length){l=[];for(let h of this.skipped){let c=e.mapPos(h.from,1),u=e.mapPos(h.to,-1);c<u&&l.push({from:c,to:u})}}}return new Xm(this.parser,t,i,r,s,o,l,this.scheduleOn)}updateViewport(e){if(this.viewport.from==e.from&&this.viewport.to==e.to)return!1;this.viewport=e;let t=this.skipped.length;for(let i=0;i<this.skipped.length;i++){let{from:r,to:s}=this.skipped[i];r<e.to&&s>e.from&&(this.fragments=uk(this.fragments,r,s),this.skipped.splice(i--,1))}return this.skipped.length>=t?!1:(this.reset(),!0)}reset(){this.parse&&(this.takeTree(),this.parse=null)}skipUntilInView(e,t){this.skipped.push({from:e,to:t})}static getSkippingParser(e){return new class extends HF{createParse(t,i,r){let s=r[0].from,o=r[r.length-1].to;return{parsedPos:s,advance(){let a=Sa;if(a){for(let h of r)a.tempSkipped.push(h);e&&(a.scheduleOn=a.scheduleOn?Promise.all([a.scheduleOn,e]):e)}return this.parsedPos=o,new $t(rn.none,[],[],o-s)},stoppedAt:null,stopAt(){}}}}}isDone(e){e=Math.min(e,this.state.doc.length);let t=this.fragments;return this.treeLen>=e&&t.length&&t[0].from==0&&t[0].to>=e}static get(){return Sa}}function uk(n,e,t){return _r.applyChanges(n,[{fromA:e,toA:t,fromB:e,toB:t}])}class Xo{constructor(e){this.context=e,this.tree=e.tree}apply(e){if(!e.docChanged&&this.tree==this.context.tree)return this;let t=this.context.changes(e.changes,e.state),i=this.context.treeLen==e.startState.doc.length?void 0:Math.max(e.changes.mapPos(this.context.treeLen),t.viewport.to);return t.work(20,i)||t.takeTree(),new Xo(t)}static init(e){let t=Math.min(3e3,e.doc.length),i=new Xm(e.facet(Qo).parser,e,[],$t.empty,0,{from:0,to:t},[],null);return i.work(20,t)||i.takeTree(),new Xo(i)}}Ln.state=eo.define({create:Xo.init,update(n,e){for(let t of e.effects)if(t.is(Ln.setState))return t.value;return e.startState.facet(Qo)!=e.state.facet(Qo)?Xo.init(e.state):n.apply(e)}});let fk=n=>{let e=setTimeout(()=>n(),500);return()=>clearTimeout(e)};typeof requestIdleCallback!="undefined"&&(fk=n=>{let e=-1,t=setTimeout(()=>{e=requestIdleCallback(n,{timeout:500-100})},100);return()=>e<0?clearTimeout(t):cancelIdleCallback(e)});const Qm=typeof navigator!="undefined"&&((Zm=navigator.scheduling)===null||Zm===void 0?void 0:Zm.isInputPending)?()=>navigator.scheduling.isInputPending():null,dk=qn.fromClass(class{constructor(e){this.view=e,this.working=null,this.workScheduled=0,this.chunkEnd=-1,this.chunkBudget=-1,this.work=this.work.bind(this),this.scheduleWork()}update(e){let t=this.view.state.field(Ln.state).context;(t.updateViewport(e.view.viewport)||this.view.viewport.to>t.treeLen)&&this.scheduleWork(),e.docChanged&&(this.view.hasFocus&&(this.chunkBudget+=50),this.scheduleWork()),this.checkAsyncSchedule(t)}scheduleWork(){if(this.working)return;let{state:e}=this.view,t=e.field(Ln.state);(t.tree!=t.context.tree||!t.context.isDone(e.doc.length))&&(this.working=fk(this.work))}work(e){this.working=null;let t=Date.now();if(this.chunkEnd<t&&(this.chunkEnd<0||this.view.hasFocus)&&(this.chunkEnd=t+3e4,this.chunkBudget=3e3),this.chunkBudget<=0)return;let{state:i,viewport:{to:r}}=this.view,s=i.field(Ln.state);if(s.tree==s.context.tree&&s.context.isDone(r+1e5))return;let o=Date.now()+Math.min(this.chunkBudget,100,e&&!Qm?Math.max(25,e.timeRemaining()-5):1e9),l=s.context.treeLen<r&&i.doc.length>r+1e3,a=s.context.work(()=>Qm&&Qm()||Date.now()>o,r+(l?0:1e5));this.chunkBudget-=Date.now()-t,(a||this.chunkBudget<=0)&&(s.context.takeTree(),this.view.dispatch({effects:Ln.setState.of(new Xo(s.context))})),this.chunkBudget>0&&!(a&&!l)&&this.scheduleWork(),this.checkAsyncSchedule(s.context)}checkAsyncSchedule(e){e.scheduleOn&&(this.workScheduled++,e.scheduleOn.then(()=>this.scheduleWork()).catch(t=>cs(this.view.state,t)).then(()=>this.workScheduled--),e.scheduleOn=null)}destroy(){this.working&&this.working()}isWorking(){return!!(this.working||this.workScheduled>0)}},{eventHandlers:{focus(){this.scheduleWork()}}}),Qo=Re.define({combine(n){return n.length?n[0]:null},enables:[Ln.state,dk]});class l6{constructor(e,t=[]){this.language=e,this.support=t,this.extension=[e,t]}}class pk{constructor(e,t,i,r,s,o=void 0){this.name=e,this.alias=t,this.extensions=i,this.filename=r,this.loadFunc=s,this.support=o,this.loading=null}load(){return this.loading||(this.loading=this.loadFunc().then(e=>this.support=e,e=>{throw this.loading=null,e}))}static of(e){let{load:t,support:i}=e;if(!t){if(!i)throw new RangeError("Must pass either 'load' or 'support' to LanguageDescription.of");t=()=>Promise.resolve(i)}return new pk(e.name,(e.alias||[]).concat(e.name).map(r=>r.toLowerCase()),e.extensions||[],e.filename,t,i)}static matchFilename(e,t){for(let r of e)if(r.filename&&r.filename.test(t))return r;let i=/\.([^.]+)$/.exec(t);if(i){for(let r of e)if(r.extensions.indexOf(i[1])>-1)return r}return null}static matchLanguageName(e,t,i=!0){t=t.toLowerCase();for(let r of e)if(r.alias.some(s=>s==t))return r;if(i)for(let r of e)for(let s of r.alias){let o=t.indexOf(s);if(o>-1&&(s.length>2||!/\w/.test(t[o-1])&&!/\w/.test(t[o+s.length])))return r}return null}}const VI=null,mk=Re.define({combine:n=>{if(!n.length)return"  ";if(!/^(?: +|\t+)$/.test(n[0]))throw new Error("Invalid indent unit: "+JSON.stringify(n[0]));return n[0]}});function HI(n){let e=n.facet(mk);return e.charCodeAt(0)==9?n.tabSize*e.length:e.length}function zI(n,e){let t="",i=n.tabSize;if(n.facet(mk).charCodeAt(0)==9)for(;e>=i;)t+="	",e-=i;for(let r=0;r<e;r++)t+=" ";return t}function jI(n,e){n instanceof EditorState&&(n=new $I(n));for(let i of n.state.facet(VI)){let r=i(n,e);if(r!=null)return r}let t=so(n.state);return t?qI(n,t,e):null}class $I{constructor(e,t={}){this.state=e,this.options=t,this.unit=HI(e)}lineAt(e,t=1){let i=this.state.doc.lineAt(e),{simulateBreak:r,simulateDoubleBreak:s}=this.options;return r!=null&&r>=i.from&&r<=i.to?s&&r==e?{text:"",from:e}:(t<0?r<e:r<=e)?{text:i.text.slice(r-i.from),from:r}:{text:i.text.slice(0,r-i.from),from:i.from}:i}textAfterPos(e,t=1){if(this.options.simulateDoubleBreak&&e==this.options.simulateBreak)return"";let{text:i,from:r}=this.lineAt(e,t);return i.slice(e-r,Math.min(i.length,e+100-r))}column(e,t=1){let{text:i,from:r}=this.lineAt(e,t),s=this.countColumn(i,e-r),o=this.options.overrideIndentation?this.options.overrideIndentation(r):-1;return o>-1&&(s+=o-this.countColumn(i,i.search(/\S|$/))),s}countColumn(e,t=e.length){return countColumn(e,this.state.tabSize,t)}lineIndent(e,t=1){let{text:i,from:r}=this.lineAt(e,t),s=this.options.overrideIndentation;if(s){let o=s(r);if(o>-1)return o}return this.countColumn(i,i.search(/\S|$/))}get simulatedBreak(){return this.options.simulateBreak||null}}const UI=new je;function qI(n,e,t){return gk(e.resolveInner(t).enterUnfinishedNodesBefore(t),t,n)}function KI(n){return n.pos==n.options.simulateBreak&&n.options.simulateDoubleBreak}function GI(n){let e=n.type.prop(UI);if(e)return e;let t=n.firstChild,i;if(t&&(i=t.type.prop(NodeProp.closedBy))){let r=n.lastChild,s=r&&i.indexOf(r.name)>-1;return o=>yk(o,!0,1,void 0,s&&!KI(o)?r.from:void 0)}return n.parent==null?JI:null}function gk(n,e,t){for(;n;n=n.parent){let i=GI(n);if(i)return i(new ZI(t,e,n))}return null}function JI(){return 0}class ZI extends null{constructor(e,t,i){super(e.state,e.options),this.base=e,this.pos=t,this.node=i}get textAfter(){return this.textAfterPos(this.pos)}get baseIndent(){let e=this.state.doc.lineAt(this.node.from);for(;;){let t=this.node.resolve(e.from);for(;t.parent&&t.parent.from==t.from;)t=t.parent;if(YI(t,this.node))break;e=this.state.doc.lineAt(t.from)}return this.lineIndent(e.from)}continue(){let e=this.node.parent;return e?gk(e,this.pos,this.base):0}}function YI(n,e){for(let t=e;t;t=t.parent)if(n==t)return!0;return!1}function XI(n){let e=n.node,t=e.childAfter(e.from),i=e.lastChild;if(!t)return null;let r=n.options.simulateBreak,s=n.state.doc.lineAt(t.from),o=r==null||r<=s.from?s.to:Math.min(s.to,r);for(let l=t.to;;){let a=e.childAfter(l);if(!a||a==i)return null;if(!a.type.isSkipped)return a.from<o?t:null;l=a.to}}function a6({closing:n,align:e=!0,units:t=1}){return i=>yk(i,e,t,n)}function yk(n,e,t,i,r){let s=n.textAfter,o=s.match(/^\s*/)[0].length,l=i&&s.slice(o,o+i.length)==i||r==n.pos+o,a=e?XI(n):null;return a?l?n.column(a.from):n.column(a.to):n.baseIndent+(l?0:n.unit*t)}const h6=n=>n.baseIndent;function c6({except:n,units:e=1}={}){return t=>{let i=n&&n.test(t.textAfter);return t.baseIndent+(i?0:e*t.unit)}}const QI=200;function u6(){return EditorState.transactionFilter.of(n=>{if(!n.docChanged||!n.isUserEvent("input.type")&&!n.isUserEvent("input.complete"))return n;let e=n.startState.languageDataAt("indentOnInput",n.startState.selection.main.head);if(!e.length)return n;let t=n.newDoc,{head:i}=n.newSelection.main,r=t.lineAt(i);if(i>r.from+QI)return n;let s=t.sliceString(r.from,i);if(!e.some(h=>h.test(s)))return n;let{state:o}=n,l=-1,a=[];for(let{head:h}of o.selection.ranges){let c=o.doc.lineAt(h);if(c.from==l)continue;l=c.from;let u=jI(o,c.from);if(u==null)continue;let f=/^\s*/.exec(c.text)[0],d=zI(o,u);f!=d&&a.push({from:c.from,to:c.from+f.length,insert:d})}return a.length?[n,{changes:a,sequential:!0}]:n})}const eW=null,tW=new je;function f6(n){let e=n.firstChild,t=n.lastChild;return e&&e.to<t.from?{from:e.to,to:t.type.isError?n.to:t.from}:null}function iW(n,e,t){let i=so(n);if(i.length==0)return null;let r=i.resolveInner(t),s=null;for(let o=r;o;o=o.parent){if(o.to<=t||o.from>t)continue;if(s&&o.from<e)break;let l=o.type.prop(tW);if(l&&(o.to<i.length-50||i.length==n.doc.length||!nW(o))){let a=l(o,n);a&&a.from<=t&&a.from>=e&&a.to>t&&(s=a)}}return s}function nW(n){let e=n.lastChild;return e&&e.to==n.to&&e.type.isError}function d6(n,e,t){for(let i of n.facet(eW)){let r=i(n,e,t);if(r)return r}return iW(n,e,t)}let rW=0;class Jn{constructor(e,t,i){this.set=e,this.base=t,this.modified=i,this.id=rW++}static define(e){if(e!=null&&e.base)throw new Error("Can not derive from a modified tag");let t=new Jn([],null,[]);if(t.set.push(t),e)for(let i of e.set)t.set.push(i);return t}static defineModifier(){let e=new Xc;return t=>t.modified.indexOf(e)>-1?t:Xc.get(t.base||t,t.modified.concat(e).sort((i,r)=>i.id-r.id))}}let sW=0;class Xc{constructor(){this.instances=[],this.id=sW++}static get(e,t){if(!t.length)return e;let i=t[0].instances.find(l=>l.base==e&&oW(t,l.modified));if(i)return i;let r=[],s=new Jn(r,e,t);for(let l of t)l.instances.push(s);let o=vk(t);for(let l of e.set)for(let a of o)r.push(Xc.get(l,a));return s}}function oW(n,e){return n.length==e.length&&n.every((t,i)=>t==e[i])}function vk(n){let e=[n];for(let t=0;t<n.length;t++)for(let i of vk(n.slice(0,t).concat(n.slice(t+1))))e.push(i);return e}function lW(n){let e=Object.create(null);for(let t in n){let i=n[t];Array.isArray(i)||(i=[i]);for(let r of t.split(" "))if(r){let s=[],o=2,l=r;for(let u=0;;){if(l=="..."&&u>0&&u+3==r.length){o=1;break}let f=/^"(?:[^"\\]|\\.)*?"|[^\/!]+/.exec(l);if(!f)throw new RangeError("Invalid path: "+r);if(s.push(f[0]=="*"?null:f[0][0]=='"'?JSON.parse(f[0]):f[0]),u+=f[0].length,u==r.length)break;let d=r[u++];if(u==r.length&&d=="!"){o=0;break}if(d!="/")throw new RangeError("Invalid path: "+r);l=r.slice(u)}let a=s.length-1,h=s[a];if(!h)throw new RangeError("Invalid path: "+r);let c=new aW(i,o,a>0?s.slice(0,a):null);e[h]=c.sort(e[h])}}return wk.add(e)}const wk=new je,Qc=Re.define({combine(n){return n.length?ka.combinedMatch(n):null}}),bk=Re.define({combine(n){return n.length?n[0].match:null}});function eg(n){return n.facet(Qc)||n.facet(bk)}class aW{constructor(e,t,i,r){this.tags=e,this.mode=t,this.context=i,this.next=r}sort(e){return!e||e.depth<this.depth?(this.next=e,this):(e.next=this.sort(e.next),e)}get depth(){return this.context?this.context.length:0}}class ka{constructor(e,t){this.map=Object.create(null);let i;function r(o){let l=Ue.newName();return(i||(i=Object.create(null)))["."+l]=o,l}this.all=typeof t.all=="string"?t.all:t.all?r(t.all):null;for(let o of e){let l=(o.class||r(Object.assign({},o,{tag:null})))+(this.all?" "+this.all:""),a=o.tag;if(!Array.isArray(a))this.map[a.id]=l;else for(let h of a)this.map[h.id]=l}this.module=i?new Ue(i):null,this.scope=t.scope||null,this.match=this.match.bind(this);let s=[cW];this.module&&s.push(xt.styleModule.of(this.module)),this.extension=s.concat(t.themeType==null?Qc.of(this):Qc.computeN([xt.darkTheme],o=>o.facet(xt.darkTheme)==(t.themeType=="dark")?[this]:[])),this.fallback=s.concat(bk.of(this))}match(e,t){if(this.scope&&t!=this.scope)return null;for(let i of e.set){let r=this.map[i.id];if(r!==void 0)return i!=e&&(this.map[e.id]=r),r}return this.map[e.id]=this.all}static combinedMatch(e){if(e.length==1)return e[0].match;let t=e.some(i=>i.scope)?void 0:Object.create(null);return(i,r)=>{let s=t&&t[i.id];if(s!==void 0)return s;let o=null;for(let l of e){let a=l.match(i,r);a&&(o=o?o+" "+a:a)}return t&&(t[i.id]=o),o}}static define(e,t){return new ka(e,t||{})}static get(e,t,i){let r=eg(e);return r&&r(t,i||rn.none)}}function p6(n,e,t,i=0,r=n.length){Sk(n,i,r,e,t)}class hW{constructor(e){this.markCache=Object.create(null),this.tree=so(e.state),this.decorations=this.buildDeco(e,eg(e.state))}update(e){let t=so(e.state),i=eg(e.state),r=i!=e.startState.facet(Qc);t.length<e.view.viewport.to&&!r&&t.type==this.tree.type?this.decorations=this.decorations.map(e.changes):(t!=this.tree||e.viewportChanged||r)&&(this.tree=t,this.decorations=this.buildDeco(e.view,i))}buildDeco(e,t){if(!t||!this.tree.length)return Xe.none;let i=new Yl;for(let{from:r,to:s}of e.visibleRanges)Sk(this.tree,r,s,t,(o,l,a)=>{i.add(o,l,this.markCache[a]||(this.markCache[a]=Xe.mark({class:a})))});return i.finish()}}const cW=gx.high(qn.fromClass(hW,{decorations:n=>n.decorations})),xk=[""];class uW{constructor(e,t,i){this.at=e,this.style=t,this.span=i,this.class=""}startSpan(e,t){t!=this.class&&(this.flush(e),e>this.at&&(this.at=e),this.class=t)}flush(e){e>this.at&&this.class&&this.span(this.at,e,this.class)}highlightRange(e,t,i,r,s,o){let{type:l,from:a,to:h}=e;if(a>=i||h<=t)return;xk[s]=l.name,l.isTop&&(o=l);let c=r,u=l.prop(wk),f=!1;for(;u;){if(!u.context||fW(u.context,xk,s)){for(let p of u.tags){let g=this.style(p,o);g&&(c&&(c+=" "),c+=g,u.mode==1?r+=(r?" ":"")+g:u.mode==0&&(f=!0))}break}u=u.next}if(this.startSpan(e.from,c),f)return;let d=e.tree&&e.tree.prop(je.mounted);if(d&&d.overlay){let p=e.node.enter(d.overlay[0].from+a,1),g=e.firstChild();for(let y=0,v=a;;y++){let C=y<d.overlay.length?d.overlay[y]:null,x=C?C.from+a:h,b=Math.max(t,v),S=Math.min(i,x);if(b<S&&g)for(;e.from<S&&(this.highlightRange(e,b,S,r,s+1,o),this.startSpan(Math.min(i,e.to),c),!(e.to>=x||!e.nextSibling())););if(!C||x>i)break;v=C.to+a,v>t&&(this.highlightRange(p.cursor,Math.max(t,C.from+a),Math.min(i,v),r,s,d.tree.type),this.startSpan(v,c))}g&&e.parent()}else if(e.firstChild()){do if(!(e.to<=t)){if(e.from>=i)break;this.highlightRange(e,t,i,r,s+1,o),this.startSpan(Math.min(i,e.to),c)}while(e.nextSibling());e.parent()}}}function Sk(n,e,t,i,r){let s=new uW(e,i,r);s.highlightRange(n.cursor(),e,t,"",0,n.type),s.flush(t)}function fW(n,e,t){if(n.length>t-1)return!1;for(let i=t-1,r=n.length-1;r>=0;r--,i--){let s=n[r];if(s&&s!=e[i])return!1}return!0}const U=Jn.define,eu=U(),ds=U(),kk=U(ds),Ck=U(ds),ps=U(),tu=U(ps),tg=U(ps),Zn=U(),oo=U(Zn),Yn=U(),Xn=U(),ig=U(),Ca=U(ig),iu=U(),te={comment:eu,lineComment:U(eu),blockComment:U(eu),docComment:U(eu),name:ds,variableName:U(ds),typeName:kk,tagName:U(kk),propertyName:Ck,attributeName:U(Ck),className:U(ds),labelName:U(ds),namespace:U(ds),macroName:U(ds),literal:ps,string:tu,docString:U(tu),character:U(tu),attributeValue:U(tu),number:tg,integer:U(tg),float:U(tg),bool:U(ps),regexp:U(ps),escape:U(ps),color:U(ps),url:U(ps),keyword:Yn,self:U(Yn),null:U(Yn),atom:U(Yn),unit:U(Yn),modifier:U(Yn),operatorKeyword:U(Yn),controlKeyword:U(Yn),definitionKeyword:U(Yn),moduleKeyword:U(Yn),operator:Xn,derefOperator:U(Xn),arithmeticOperator:U(Xn),logicOperator:U(Xn),bitwiseOperator:U(Xn),compareOperator:U(Xn),updateOperator:U(Xn),definitionOperator:U(Xn),typeOperator:U(Xn),controlOperator:U(Xn),punctuation:ig,separator:U(ig),bracket:Ca,angleBracket:U(Ca),squareBracket:U(Ca),paren:U(Ca),brace:U(Ca),content:Zn,heading:oo,heading1:U(oo),heading2:U(oo),heading3:U(oo),heading4:U(oo),heading5:U(oo),heading6:U(oo),contentSeparator:U(Zn),list:U(Zn),quote:U(Zn),emphasis:U(Zn),strong:U(Zn),link:U(Zn),monospace:U(Zn),strikethrough:U(Zn),inserted:U(),deleted:U(),changed:U(),invalid:U(),meta:iu,documentMeta:U(iu),annotation:U(iu),processingInstruction:U(iu),definition:Jn.defineModifier(),constant:Jn.defineModifier(),function:Jn.defineModifier(),standard:Jn.defineModifier(),local:Jn.defineModifier(),special:Jn.defineModifier()},m6=ka.define([{tag:te.link,textDecoration:"underline"},{tag:te.heading,textDecoration:"underline",fontWeight:"bold"},{tag:te.emphasis,fontStyle:"italic"},{tag:te.strong,fontWeight:"bold"},{tag:te.strikethrough,textDecoration:"line-through"},{tag:te.keyword,color:"#708"},{tag:[te.atom,te.bool,te.url,te.contentSeparator,te.labelName],color:"#219"},{tag:[te.literal,te.inserted],color:"#164"},{tag:[te.string,te.deleted],color:"#a11"},{tag:[te.regexp,te.escape,te.special(te.string)],color:"#e40"},{tag:te.definition(te.variableName),color:"#00f"},{tag:te.local(te.variableName),color:"#30a"},{tag:[te.typeName,te.namespace],color:"#085"},{tag:te.className,color:"#167"},{tag:[te.special(te.variableName),te.macroName],color:"#256"},{tag:te.definition(te.propertyName),color:"#00c"},{tag:te.comment,color:"#940"},{tag:te.meta,color:"#7a757a"},{tag:te.invalid,color:"#f00"}]),g6=ka.define([{tag:te.link,class:"cmt-link"},{tag:te.heading,class:"cmt-heading"},{tag:te.emphasis,class:"cmt-emphasis"},{tag:te.strong,class:"cmt-strong"},{tag:te.keyword,class:"cmt-keyword"},{tag:te.atom,class:"cmt-atom"},{tag:te.bool,class:"cmt-bool"},{tag:te.url,class:"cmt-url"},{tag:te.labelName,class:"cmt-labelName"},{tag:te.inserted,class:"cmt-inserted"},{tag:te.deleted,class:"cmt-deleted"},{tag:te.literal,class:"cmt-literal"},{tag:te.string,class:"cmt-string"},{tag:te.number,class:"cmt-number"},{tag:[te.regexp,te.escape,te.special(te.string)],class:"cmt-string2"},{tag:te.variableName,class:"cmt-variableName"},{tag:te.local(te.variableName),class:"cmt-variableName cmt-local"},{tag:te.definition(te.variableName),class:"cmt-variableName cmt-definition"},{tag:te.special(te.variableName),class:"cmt-variableName2"},{tag:te.definition(te.propertyName),class:"cmt-propertyName cmt-definition"},{tag:te.typeName,class:"cmt-typeName"},{tag:te.namespace,class:"cmt-namespace"},{tag:te.className,class:"cmt-className"},{tag:te.macroName,class:"cmt-macroName"},{tag:te.propertyName,class:"cmt-propertyName"},{tag:te.operator,class:"cmt-operator"},{tag:te.comment,class:"cmt-comment"},{tag:te.meta,class:"cmt-meta"},{tag:te.invalid,class:"cmt-invalid"},{tag:te.punctuation,class:"cmt-punctuation"}]),ng=/\r\n?|\n/;var Fn=function(n){return n[n.Simple=0]="Simple",n[n.TrackDel=1]="TrackDel",n[n.TrackBefore=2]="TrackBefore",n[n.TrackAfter=3]="TrackAfter",n}(Fn||(Fn={}));class ms{constructor(e){this.sections=e}get length(){let e=0;for(let t=0;t<this.sections.length;t+=2)e+=this.sections[t];return e}get newLength(){let e=0;for(let t=0;t<this.sections.length;t+=2){let i=this.sections[t+1];e+=i<0?this.sections[t]:i}return e}get empty(){return this.sections.length==0||this.sections.length==2&&this.sections[1]<0}iterGaps(e){for(let t=0,i=0,r=0;t<this.sections.length;){let s=this.sections[t++],o=this.sections[t++];o<0?(e(i,r,s),r+=s):r+=o,i+=s}}iterChangedRanges(e,t=!1){rg(this,e,t)}get invertedDesc(){let e=[];for(let t=0;t<this.sections.length;){let i=this.sections[t++],r=this.sections[t++];r<0?e.push(i,r):e.push(r,i)}return new ms(e)}composeDesc(e){return this.empty?e:e.empty?this:Ak(this,e)}mapDesc(e,t=!1){return e.empty?this:sg(this,e,t)}mapPos(e,t=-1,i=Fn.Simple){let r=0,s=0;for(let o=0;o<this.sections.length;){let l=this.sections[o++],a=this.sections[o++],h=r+l;if(a<0){if(h>e)return s+(e-r);s+=l}else{if(i!=Fn.Simple&&h>=e&&(i==Fn.TrackDel&&r<e&&h>e||i==Fn.TrackBefore&&r<e||i==Fn.TrackAfter&&h>e))return null;if(h>e||h==e&&t<0&&!l)return e==r||t<0?s:s+a;s+=a}r=h}if(e>r)throw new RangeError(`Position ${e} is out of range for changeset of length ${r}`);return s}touchesRange(e,t=e){for(let i=0,r=0;i<this.sections.length&&r<=t;){let s=this.sections[i++],o=this.sections[i++],l=r+s;if(o>=0&&r<=t&&l>=e)return r<e&&l>t?"cover":!0;r=l}return!1}toString(){let e="";for(let t=0;t<this.sections.length;){let i=this.sections[t++],r=this.sections[t++];e+=(e?" ":"")+i+(r>=0?":"+r:"")}return e}toJSON(){return this.sections}static fromJSON(e){if(!Array.isArray(e)||e.length%2||e.some(t=>typeof t!="number"))throw new RangeError("Invalid JSON representation of ChangeDesc");return new ms(e)}}class fi extends ms{constructor(e,t){super(e),this.inserted=t}apply(e){if(this.length!=e.length)throw new RangeError("Applying change set to a document with the wrong length");return rg(this,(t,i,r,s,o)=>e=e.replace(r,r+(i-t),o),!1),e}mapDesc(e,t=!1){return sg(this,e,t,!0)}invert(e){let t=this.sections.slice(),i=[];for(let r=0,s=0;r<t.length;r+=2){let o=t[r],l=t[r+1];if(l>=0){t[r]=l,t[r+1]=o;let a=r>>1;for(;i.length<a;)i.push(j.empty);i.push(o?e.slice(s,s+o):j.empty)}s+=o}return new fi(t,i)}compose(e){return this.empty?e:e.empty?this:Ak(this,e,!0)}map(e,t=!1){return e.empty?this:sg(this,e,t,!0)}iterChanges(e,t=!1){rg(this,e,t)}get desc(){return new ms(this.sections)}filter(e){let t=[],i=[],r=[],s=new Aa(this);e:for(let o=0,l=0;;){let a=o==e.length?1e9:e[o++];for(;l<a||l==a&&s.len==0;){if(s.done)break e;let c=Math.min(s.len,a-l);Li(r,c,-1);let u=s.ins==-1?-1:s.off==0?s.ins:0;Li(t,c,u),u>0&&lo(i,t,s.text),s.forward(c),l+=c}let h=e[o++];for(;l<h;){if(s.done)break e;let c=Math.min(s.len,h-l);Li(t,c,-1),Li(r,c,s.ins==-1?-1:s.off==0?s.ins:0),s.forward(c),l+=c}}return{changes:new fi(t,i),filtered:new ms(r)}}toJSON(){let e=[];for(let t=0;t<this.sections.length;t+=2){let i=this.sections[t],r=this.sections[t+1];r<0?e.push(i):r==0?e.push([i]):e.push([i].concat(this.inserted[t>>1].toJSON()))}return e}static of(e,t,i){let r=[],s=[],o=0,l=null;function a(c=!1){if(!c&&!r.length)return;o<t&&Li(r,t-o,-1);let u=new fi(r,s);l=l?l.compose(u.map(l)):u,r=[],s=[],o=0}function h(c){if(Array.isArray(c))for(let u of c)h(u);else if(c instanceof fi){if(c.length!=t)throw new RangeError(`Mismatched change set length (got ${c.length}, expected ${t})`);a(),l=l?l.compose(c.map(l)):c}else{let{from:u,to:f=u,insert:d}=c;if(u>f||u<0||f>t)throw new RangeError(`Invalid change range ${u} to ${f} (in doc of length ${t})`);let p=d?typeof d=="string"?j.of(d.split(i||ng)):d:j.empty,g=p.length;if(u==f&&g==0)return;u<o&&a(),u>o&&Li(r,u-o,-1),Li(r,f-u,g),lo(s,r,p),o=f}}return h(e),a(!l),l}static empty(e){return new fi(e?[e,-1]:[],[])}static fromJSON(e){if(!Array.isArray(e))throw new RangeError("Invalid JSON representation of ChangeSet");let t=[],i=[];for(let r=0;r<e.length;r++){let s=e[r];if(typeof s=="number")t.push(s,-1);else{if(!Array.isArray(s)||typeof s[0]!="number"||s.some((o,l)=>l&&typeof o!="string"))throw new RangeError("Invalid JSON representation of ChangeSet");if(s.length==1)t.push(s[0],0);else{for(;i.length<r;)i.push(j.empty);i[r]=j.of(s.slice(1)),t.push(s[0],i[r].length)}}}return new fi(t,i)}}function Li(n,e,t,i=!1){if(e==0&&t<=0)return;let r=n.length-2;r>=0&&t<=0&&t==n[r+1]?n[r]+=e:e==0&&n[r]==0?n[r+1]+=t:i?(n[r]+=e,n[r+1]+=t):n.push(e,t)}function lo(n,e,t){if(t.length==0)return;let i=e.length-2>>1;if(i<n.length)n[n.length-1]=n[n.length-1].append(t);else{for(;n.length<i;)n.push(j.empty);n.push(t)}}function rg(n,e,t){let i=n.inserted;for(let r=0,s=0,o=0;o<n.sections.length;){let l=n.sections[o++],a=n.sections[o++];if(a<0)r+=l,s+=l;else{let h=r,c=s,u=j.empty;for(;h+=l,c+=a,a&&i&&(u=u.append(i[o-2>>1])),!(t||o==n.sections.length||n.sections[o+1]<0);)l=n.sections[o++],a=n.sections[o++];e(r,h,s,c,u),r=h,s=c}}}function sg(n,e,t,i=!1){let r=[],s=i?[]:null,o=new Aa(n),l=new Aa(e);for(let a=0,h=0;;)if(o.ins==-1)a+=o.len,o.next();else if(l.ins==-1&&h<a){let c=Math.min(l.len,a-h);l.forward(c),Li(r,c,-1),h+=c}else if(l.ins>=0&&(o.done||h<a||h==a&&(l.len<o.len||l.len==o.len&&!t))){for(Li(r,l.ins,-1);a>h&&!o.done&&a+o.len<h+l.len;)a+=o.len,o.next();h+=l.len,l.next()}else if(o.ins>=0){let c=0,u=a+o.len;for(;;)if(l.ins>=0&&h>a&&h+l.len<u)c+=l.ins,h+=l.len,l.next();else if(l.ins==-1&&h<u){let f=Math.min(l.len,u-h);c+=f,l.forward(f),h+=f}else break;Li(r,c,o.ins),s&&lo(s,r,o.text),a=u,o.next()}else{if(o.done&&l.done)return s?new fi(r,s):new ms(r);throw new Error("Mismatched change set lengths")}}function Ak(n,e,t=!1){let i=[],r=t?[]:null,s=new Aa(n),o=new Aa(e);for(let l=!1;;){if(s.done&&o.done)return r?new fi(i,r):new ms(i);if(s.ins==0)Li(i,s.len,0,l),s.next();else if(o.len==0&&!o.done)Li(i,0,o.ins,l),r&&lo(r,i,o.text),o.next();else{if(s.done||o.done)throw new Error("Mismatched change set lengths");{let a=Math.min(s.len2,o.len),h=i.length;if(s.ins==-1){let c=o.ins==-1?-1:o.off?0:o.ins;Li(i,a,c,l),r&&c&&lo(r,i,o.text)}else o.ins==-1?(Li(i,s.off?0:s.len,a,l),r&&lo(r,i,s.textBit(a))):(Li(i,s.off?0:s.len,o.off?0:o.ins,l),r&&!o.off&&lo(r,i,o.text));l=(s.ins>a||o.ins>=0&&o.len>a)&&(l||i.length>h),s.forward2(a),o.forward(a)}}}}class Aa{constructor(e){this.set=e,this.i=0,this.next()}next(){let{sections:e}=this.set;this.i<e.length?(this.len=e[this.i++],this.ins=e[this.i++]):(this.len=0,this.ins=-2),this.off=0}get done(){return this.ins==-2}get len2(){return this.ins<0?this.len:this.ins}get text(){let{inserted:e}=this.set,t=this.i-2>>1;return t>=e.length?j.empty:e[t]}textBit(e){let{inserted:t}=this.set,i=this.i-2>>1;return i>=t.length&&!e?j.empty:t[i].slice(this.off,e==null?void 0:this.off+e)}forward(e){e==this.len?this.next():(this.len-=e,this.off+=e)}forward2(e){this.ins==-1?this.forward(e):e==this.ins?this.next():(this.ins-=e,this.off+=e)}}class el{constructor(e,t,i){this.from=e,this.to=t,this.flags=i}get anchor(){return this.flags&16?this.to:this.from}get head(){return this.flags&16?this.from:this.to}get empty(){return this.from==this.to}get assoc(){return this.flags&4?-1:this.flags&8?1:0}get bidiLevel(){let e=this.flags&3;return e==3?null:e}get goalColumn(){let e=this.flags>>5;return e==33554431?void 0:e}map(e,t=-1){let i,r;return this.empty?i=r=e.mapPos(this.from,t):(i=e.mapPos(this.from,1),r=e.mapPos(this.to,-1)),i==this.from&&r==this.to?this:new el(i,r,this.flags)}extend(e,t=e){if(e<=this.anchor&&t>=this.anchor)return xe.range(e,t);let i=Math.abs(e-this.anchor)>Math.abs(t-this.anchor)?e:t;return xe.range(this.anchor,i)}eq(e){return this.anchor==e.anchor&&this.head==e.head}toJSON(){return{anchor:this.anchor,head:this.head}}static fromJSON(e){if(!e||typeof e.anchor!="number"||typeof e.head!="number")throw new RangeError("Invalid JSON representation for SelectionRange");return xe.range(e.anchor,e.head)}}class xe{constructor(e,t=0){this.ranges=e,this.mainIndex=t}map(e,t=-1){return e.empty?this:xe.create(this.ranges.map(i=>i.map(e,t)),this.mainIndex)}eq(e){if(this.ranges.length!=e.ranges.length||this.mainIndex!=e.mainIndex)return!1;for(let t=0;t<this.ranges.length;t++)if(!this.ranges[t].eq(e.ranges[t]))return!1;return!0}get main(){return this.ranges[this.mainIndex]}asSingle(){return this.ranges.length==1?this:new xe([this.main])}addRange(e,t=!0){return xe.create([e].concat(this.ranges),t?0:this.mainIndex+1)}replaceRange(e,t=this.mainIndex){let i=this.ranges.slice();return i[t]=e,xe.create(i,this.mainIndex)}toJSON(){return{ranges:this.ranges.map(e=>e.toJSON()),main:this.mainIndex}}static fromJSON(e){if(!e||!Array.isArray(e.ranges)||typeof e.main!="number"||e.main>=e.ranges.length)throw new RangeError("Invalid JSON representation for EditorSelection");return new xe(e.ranges.map(t=>el.fromJSON(t)),e.main)}static single(e,t=e){return new xe([xe.range(e,t)],0)}static create(e,t=0){if(e.length==0)throw new RangeError("A selection needs at least one range");for(let i=0,r=0;r<e.length;r++){let s=e[r];if(s.empty?s.from<=i:s.from<i)return dW(e.slice(),t);i=s.to}return new xe(e,t)}static cursor(e,t=0,i,r){return new el(e,e,(t==0?0:t<0?4:8)|(i==null?3:Math.min(2,i))|(r!=null?r:33554431)<<5)}static range(e,t,i){let r=(i!=null?i:33554431)<<5;return t<e?new el(t,e,16|r|8):new el(e,t,r|(t>e?4:0))}}function dW(n,e=0){let t=n[e];n.sort((i,r)=>i.from-r.from),e=n.indexOf(t);for(let i=1;i<n.length;i++){let r=n[i],s=n[i-1];if(r.empty?r.from<=s.to:r.from<s.to){let o=s.from,l=Math.max(r.to,s.to);i<=e&&e--,n.splice(--i,2,r.anchor>r.head?xe.range(l,o):xe.range(o,l))}}return new xe(n,e)}function Ok(n,e){for(let t of n.ranges)if(t.to>e)throw new RangeError("Selection points outside of document")}let og=0;class Le{constructor(e,t,i,r,s){this.combine=e,this.compareInput=t,this.compare=i,this.isStatic=r,this.extensions=s,this.id=og++,this.default=e([])}static define(e={}){return new Le(e.combine||(t=>t),e.compareInput||((t,i)=>t===i),e.compare||(e.combine?(t,i)=>t===i:lg),!!e.static,e.enables)}of(e){return new nu([],this,0,e)}compute(e,t){if(this.isStatic)throw new Error("Can't compute a static facet");return new nu(e,this,1,t)}computeN(e,t){if(this.isStatic)throw new Error("Can't compute a static facet");return new nu(e,this,2,t)}from(e,t){return t||(t=i=>i),this.compute([e],i=>t(i.field(e)))}}function lg(n,e){return n==e||n.length==e.length&&n.every((t,i)=>t===e[i])}class nu{constructor(e,t,i,r){this.dependencies=e,this.facet=t,this.type=i,this.value=r,this.id=og++}dynamicSlot(e){var t;let i=this.value,r=this.facet.compareInput,s=this.id,o=e[s]>>1,l=this.type==2,a=!1,h=!1,c=[];for(let u of this.dependencies)u=="doc"?a=!0:u=="selection"?h=!0:(((t=e[u.id])!==null&&t!==void 0?t:1)&1)==0&&c.push(e[u.id]);return{create(u){return u.values[o]=i(u),1},update(u,f){if(a&&f.docChanged||h&&(f.docChanged||f.selection)||c.some(d=>(ho(u,d)&1)>0)){let d=i(u);if(l?!_k(d,u.values[o],r):!r(d,u.values[o]))return u.values[o]=d,1}return 0},reconfigure(u,f){let d=i(u),p=f.config.address[s];if(p!=null){let g=ou(f,p);if(l?_k(d,g,r):r(d,g))return u.values[o]=g,0}return u.values[o]=d,1}}}}function _k(n,e,t){if(n.length!=e.length)return!1;for(let i=0;i<n.length;i++)if(!t(n[i],e[i]))return!1;return!0}function pW(n,e,t){let i=t.map(a=>n[a.id]),r=t.map(a=>a.type),s=i.filter(a=>!(a&1)),o=n[e.id]>>1;function l(a){let h=[];for(let c=0;c<i.length;c++){let u=ou(a,i[c]);if(r[c]==2)for(let f of u)h.push(f);else h.push(u)}return e.combine(h)}return{create(a){for(let h of i)ho(a,h);return a.values[o]=l(a),1},update(a,h){if(!s.some(u=>ho(a,u)&1))return 0;let c=l(a);return e.compare(c,a.values[o])?0:(a.values[o]=c,1)},reconfigure(a,h){let c=i.some(p=>ho(a,p)&1),u=h.config.facets[e.id],f=h.facet(e);if(u&&!c&&lg(t,u))return a.values[o]=f,0;let d=l(a);return e.compare(d,f)?(a.values[o]=f,0):(a.values[o]=d,1)}}}const Dk=Le.define({static:!0});class ao{constructor(e,t,i,r,s){this.id=e,this.createF=t,this.updateF=i,this.compareF=r,this.spec=s,this.provides=void 0}static define(e){let t=new ao(og++,e.create,e.update,e.compare||((i,r)=>i===r),e);return e.provide&&(t.provides=e.provide(t)),t}create(e){let t=e.facet(Dk).find(i=>i.field==this);return((t==null?void 0:t.create)||this.createF)(e)}slot(e){let t=e[this.id]>>1;return{create:i=>(i.values[t]=this.create(i),1),update:(i,r)=>{let s=i.values[t],o=this.updateF(s,r);return this.compareF(s,o)?0:(i.values[t]=o,1)},reconfigure:(i,r)=>r.config.address[this.id]!=null?(i.values[t]=r.field(this),0):(i.values[t]=this.create(i),1)}}init(e){return[this,Dk.of({field:this,create:e})]}get extension(){return this}}const Tr={lowest:4,low:3,default:2,high:1,highest:0};function gs(n){return e=>new Mk(e,n)}const mW={lowest:gs(Tr.lowest),low:gs(Tr.low),default:gs(Tr.default),high:gs(Tr.high),highest:gs(Tr.highest),fallback:gs(Tr.lowest),extend:gs(Tr.high),override:gs(Tr.highest)};class Mk{constructor(e,t){this.inner=e,this.prec=t}}class ru{of(e){return new ag(this,e)}reconfigure(e){return ru.reconfigure.of({compartment:this,extension:e})}get(e){return e.config.compartments.get(this)}}class ag{constructor(e,t){this.compartment=e,this.inner=t}}class su{constructor(e,t,i,r,s,o){for(this.base=e,this.compartments=t,this.dynamicSlots=i,this.address=r,this.staticValues=s,this.facets=o,this.statusTemplate=[];this.statusTemplate.length<i.length;)this.statusTemplate.push(0)}staticFacet(e){let t=this.address[e.id];return t==null?e.default:this.staticValues[t>>1]}static resolve(e,t,i){let r=[],s=Object.create(null),o=new Map;for(let f of gW(e,t,o))f instanceof ao?r.push(f):(s[f.facet.id]||(s[f.facet.id]=[])).push(f);let l=Object.create(null),a=[],h=[];for(let f of r)l[f.id]=h.length<<1,h.push(d=>f.slot(d));let c=i==null?void 0:i.config.facets;for(let f in s){let d=s[f],p=d[0].facet,g=c&&c[f]||[];if(d.every(y=>y.type==0))if(l[p.id]=a.length<<1|1,lg(g,d))a.push(i.facet(p));else{let y=p.combine(d.map(v=>v.value));a.push(i&&p.compare(y,i.facet(p))?i.facet(p):y)}else{for(let y of d)y.type==0?(l[y.id]=a.length<<1|1,a.push(y.value)):(l[y.id]=h.length<<1,h.push(v=>y.dynamicSlot(v)));l[p.id]=h.length<<1,h.push(y=>pW(y,p,d))}}let u=h.map(f=>f(l));return new su(e,o,u,l,a,s)}}function gW(n,e,t){let i=[[],[],[],[],[]],r=new Map;function s(o,l){let a=r.get(o);if(a!=null){if(a>=l)return;let h=i[a].indexOf(o);h>-1&&i[a].splice(h,1),o instanceof ag&&t.delete(o.compartment)}if(r.set(o,l),Array.isArray(o))for(let h of o)s(h,l);else if(o instanceof ag){if(t.has(o.compartment))throw new RangeError("Duplicate use of compartment in extensions");let h=e.get(o.compartment)||o.inner;t.set(o.compartment,h),s(h,l)}else if(o instanceof Mk)s(o.inner,o.prec);else if(o instanceof ao)i[l].push(o),o.provides&&s(o.provides,l);else if(o instanceof nu)i[l].push(o),o.facet.extensions&&s(o.facet.extensions,l);else{let h=o.extension;if(!h)throw new Error(`Unrecognized extension value in extension set (${o}). This sometimes happens because multiple instances of @codemirror/state are loaded, breaking instanceof checks.`);s(h,l)}}return s(n,Tr.default),i.reduce((o,l)=>o.concat(l))}function ho(n,e){if(e&1)return 2;let t=e>>1,i=n.status[t];if(i==4)throw new Error("Cyclic dependency between fields and/or facets");if(i&2)return i;n.status[t]=4;let r=n.computeSlot(n,n.config.dynamicSlots[t]);return n.status[t]=2|r}function ou(n,e){return e&1?n.config.staticValues[e>>1]:n.values[e>>1]}const Ek=Le.define(),Tk=Le.define({combine:n=>n.some(e=>e),static:!0}),Pk=Le.define({combine:n=>n.length?n[0]:void 0,static:!0}),Bk=Le.define(),Rk=Le.define(),Lk=Le.define(),Fk=Le.define({combine:n=>n.length?n[0]:!1});class Oa{constructor(e,t){this.type=e,this.value=t}static define(){return new yW}}class yW{of(e){return new Oa(this,e)}}class vW{constructor(e){this.map=e}of(e){return new Lt(this,e)}}class Lt{constructor(e,t){this.type=e,this.value=t}map(e){let t=this.type.map(this.value,e);return t===void 0?void 0:t==this.value?this:new Lt(this.type,t)}is(e){return this.type==e}static define(e={}){return new vW(e.map||(t=>t))}static mapEffects(e,t){if(!e.length)return e;let i=[];for(let r of e){let s=r.map(t);s&&i.push(s)}return i}}Lt.reconfigure=Lt.define(),Lt.appendConfig=Lt.define();class Fi{constructor(e,t,i,r,s,o){this.startState=e,this.changes=t,this.selection=i,this.effects=r,this.annotations=s,this.scrollIntoView=o,this._doc=null,this._state=null,i&&Ok(i,t.newLength),s.some(l=>l.type==Fi.time)||(this.annotations=s.concat(Fi.time.of(Date.now())))}get newDoc(){return this._doc||(this._doc=this.changes.apply(this.startState.doc))}get newSelection(){return this.selection||this.startState.selection.map(this.changes)}get state(){return this._state||this.startState.applyTransaction(this),this._state}annotation(e){for(let t of this.annotations)if(t.type==e)return t.value}get docChanged(){return!this.changes.empty}get reconfigured(){return this.startState.config!=this.state.config}isUserEvent(e){let t=this.annotation(Fi.userEvent);return!!(t&&(t==e||t.length>e.length&&t.slice(0,e.length)==e&&t[e.length]=="."))}}Fi.time=Oa.define(),Fi.userEvent=Oa.define(),Fi.addToHistory=Oa.define(),Fi.remote=Oa.define();function wW(n,e){let t=[];for(let i=0,r=0;;){let s,o;if(i<n.length&&(r==e.length||e[r]>=n[i]))s=n[i++],o=n[i++];else if(r<e.length)s=e[r++],o=e[r++];else return t;!t.length||t[t.length-1]<s?t.push(s,o):t[t.length-1]<o&&(t[t.length-1]=o)}}function Nk(n,e,t){var i;let r,s,o;return t?(r=e.changes,s=fi.empty(e.changes.length),o=n.changes.compose(e.changes)):(r=e.changes.map(n.changes),s=n.changes.mapDesc(e.changes,!0),o=n.changes.compose(r)),{changes:o,selection:e.selection?e.selection.map(s):(i=n.selection)===null||i===void 0?void 0:i.map(r),effects:Lt.mapEffects(n.effects,r).concat(Lt.mapEffects(e.effects,s)),annotations:n.annotations.length?n.annotations.concat(e.annotations):e.annotations,scrollIntoView:n.scrollIntoView||e.scrollIntoView}}function hg(n,e,t){let i=e.selection,r=tl(e.annotations);return e.userEvent&&(r=r.concat(Fi.userEvent.of(e.userEvent))),{changes:e.changes instanceof fi?e.changes:fi.of(e.changes||[],t,n.facet(Pk)),selection:i&&(i instanceof xe?i:xe.single(i.anchor,i.head)),effects:tl(e.effects),annotations:r,scrollIntoView:!!e.scrollIntoView}}function Ik(n,e,t){let i=hg(n,e.length?e[0]:{},n.doc.length);e.length&&e[0].filter===!1&&(t=!1);for(let s=1;s<e.length;s++){e[s].filter===!1&&(t=!1);let o=!!e[s].sequential;i=Nk(i,hg(n,e[s],o?i.changes.newLength:n.doc.length),o)}let r=new Fi(n,i.changes,i.selection,i.effects,i.annotations,i.scrollIntoView);return xW(t?bW(r):r)}function bW(n){let e=n.startState,t=!0;for(let r of e.facet(Bk)){let s=r(n);if(s===!1){t=!1;break}Array.isArray(s)&&(t=t===!0?s:wW(t,s))}if(t!==!0){let r,s;if(t===!1)s=n.changes.invertedDesc,r=fi.empty(e.doc.length);else{let o=n.changes.filter(t);r=o.changes,s=o.filtered.invertedDesc}n=new Fi(e,r,n.selection&&n.selection.map(s),Lt.mapEffects(n.effects,s),n.annotations,n.scrollIntoView)}let i=e.facet(Rk);for(let r=i.length-1;r>=0;r--){let s=i[r](n);s instanceof Fi?n=s:Array.isArray(s)&&s.length==1&&s[0]instanceof Fi?n=s[0]:n=Ik(e,tl(s),!1)}return n}function xW(n){let e=n.startState,t=e.facet(Lk),i=n;for(let r=t.length-1;r>=0;r--){let s=t[r](n);s&&Object.keys(s).length&&(i=Nk(n,hg(e,s,n.changes.newLength),!0))}return i==n?n:new Fi(e,n.changes,n.selection,i.effects,i.annotations,i.scrollIntoView)}const SW=[];function tl(n){return n==null?SW:Array.isArray(n)?n:[n]}var Pr=function(n){return n[n.Word=0]="Word",n[n.Space=1]="Space",n[n.Other=2]="Other",n}(Pr||(Pr={}));const kW=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;let cg;try{cg=new RegExp("[\\p{Alphabetic}\\p{Number}_]","u")}catch{}function CW(n){if(cg)return cg.test(n);for(let e=0;e<n.length;e++){let t=n[e];if(/\w/.test(t)||t>"\x80"&&(t.toUpperCase()!=t.toLowerCase()||kW.test(t)))return!0}return!1}function AW(n){return e=>{if(!/\S/.test(e))return Pr.Space;if(CW(e))return Pr.Word;for(let t=0;t<n.length;t++)if(e.indexOf(n[t])>-1)return Pr.Word;return Pr.Other}}class Ge{constructor(e,t,i,r,s,o){this.config=e,this.doc=t,this.selection=i,this.values=r,this.status=e.statusTemplate.slice(),this.computeSlot=s,o&&(o._state=this);for(let l=0;l<this.config.dynamicSlots.length;l++)ho(this,l<<1);this.computeSlot=null}field(e,t=!0){let i=this.config.address[e.id];if(i==null){if(t)throw new RangeError("Field is not present in this state");return}return ho(this,i),ou(this,i)}update(...e){return Ik(this,e,!0)}applyTransaction(e){let t=this.config,{base:i,compartments:r}=t;for(let o of e.effects)o.is(ru.reconfigure)?(t&&(r=new Map,t.compartments.forEach((l,a)=>r.set(a,l)),t=null),r.set(o.value.compartment,o.value.extension)):o.is(Lt.reconfigure)?(t=null,i=o.value):o.is(Lt.appendConfig)&&(t=null,i=tl(i).concat(o.value));let s;t?s=e.startState.values.slice():(t=su.resolve(i,r,this),s=new Ge(t,this.doc,this.selection,t.dynamicSlots.map(()=>null),(l,a)=>a.reconfigure(l,this),null).values),new Ge(t,e.newDoc,e.newSelection,s,(o,l)=>l.update(o,e),e)}replaceSelection(e){return typeof e=="string"&&(e=this.toText(e)),this.changeByRange(t=>({changes:{from:t.from,to:t.to,insert:e},range:xe.cursor(t.from+e.length)}))}changeByRange(e){let t=this.selection,i=e(t.ranges[0]),r=this.changes(i.changes),s=[i.range],o=tl(i.effects);for(let l=1;l<t.ranges.length;l++){let a=e(t.ranges[l]),h=this.changes(a.changes),c=h.map(r);for(let f=0;f<l;f++)s[f]=s[f].map(c);let u=r.mapDesc(h,!0);s.push(a.range.map(u)),r=r.compose(c),o=Lt.mapEffects(o,c).concat(Lt.mapEffects(tl(a.effects),u))}return{changes:r,selection:xe.create(s,t.mainIndex),effects:o}}changes(e=[]){return e instanceof fi?e:fi.of(e,this.doc.length,this.facet(Ge.lineSeparator))}toText(e){return j.of(e.split(this.facet(Ge.lineSeparator)||ng))}sliceDoc(e=0,t=this.doc.length){return this.doc.sliceString(e,t,this.lineBreak)}facet(e){let t=this.config.address[e.id];return t==null?e.default:(ho(this,t),ou(this,t))}toJSON(e){let t={doc:this.sliceDoc(),selection:this.selection.toJSON()};if(e)for(let i in e){let r=e[i];r instanceof ao&&(t[i]=r.spec.toJSON(this.field(e[i]),this))}return t}static fromJSON(e,t={},i){if(!e||typeof e.doc!="string")throw new RangeError("Invalid JSON representation for EditorState");let r=[];if(i)for(let s in i){let o=i[s],l=e[s];r.push(o.init(a=>o.spec.fromJSON(l,a)))}return Ge.create({doc:e.doc,selection:xe.fromJSON(e.selection),extensions:t.extensions?r.concat([t.extensions]):r})}static create(e={}){let t=su.resolve(e.extensions||[],new Map),i=e.doc instanceof j?e.doc:j.of((e.doc||"").split(t.staticFacet(Ge.lineSeparator)||ng)),r=e.selection?e.selection instanceof xe?e.selection:xe.single(e.selection.anchor,e.selection.head):xe.single(0);return Ok(r,i.length),t.staticFacet(Tk)||(r=r.asSingle()),new Ge(t,i,r,t.dynamicSlots.map(()=>null),(s,o)=>o.create(s),null)}get tabSize(){return this.facet(Ge.tabSize)}get lineBreak(){return this.facet(Ge.lineSeparator)||`
`}get readOnly(){return this.facet(Fk)}phrase(e){for(let t of this.facet(Ge.phrases))if(Object.prototype.hasOwnProperty.call(t,e))return t[e];return e}languageDataAt(e,t,i=-1){let r=[];for(let s of this.facet(Ek))for(let o of s(this,t,i))Object.prototype.hasOwnProperty.call(o,e)&&r.push(o[e]);return r}charCategorizer(e){return AW(this.languageDataAt("wordChars",e).join(""))}wordAt(e){let{text:t,from:i,length:r}=this.doc.lineAt(e),s=this.charCategorizer(e),o=e-i,l=e-i;for(;o>0;){let a=lt(t,o,!1);if(s(t.slice(a,o))!=Pr.Word)break;o=a}for(;l<r;){let a=lt(t,l);if(s(t.slice(l,a))!=Pr.Word)break;l=a}return o==l?null:xe.range(o+i,l+i)}}Ge.allowMultipleSelections=Tk,Ge.tabSize=Le.define({combine:n=>n.length?n[0]:4}),Ge.lineSeparator=Pk,Ge.readOnly=Fk,Ge.phrases=Le.define(),Ge.languageData=Ek,Ge.changeFilter=Bk,Ge.transactionFilter=Rk,Ge.transactionExtender=Lk,ru.reconfigure=Lt.define();function Wk(n,e,t={}){let i={};for(let r of n)for(let s of Object.keys(r)){let o=r[s],l=i[s];if(l===void 0)i[s]=o;else if(!(l===o||o===void 0))if(Object.hasOwnProperty.call(t,s))i[s]=t[s](l,o);else throw new Error("Config merge conflict for field "+s)}for(let r in e)i[r]===void 0&&(i[r]=e[r]);return i}function lu(n){let e;return n.nodeType==11?e=n.getSelection?n:n.ownerDocument:e=n,e.getSelection()}function il(n,e){return e?n==e||n.contains(e.nodeType!=1?e.parentNode:e):!1}function OW(){let n=document.activeElement;for(;n&&n.shadowRoot;)n=n.shadowRoot.activeElement;return n}function ug(n,e){if(!e.anchorNode)return!1;try{return il(n,e.anchorNode)}catch{return!1}}function _a(n){return n.nodeType==3?Da(n,0,n.nodeValue.length).getClientRects():n.nodeType==1?n.getClientRects():[]}function au(n,e,t,i){return t?Vk(n,e,t,i,-1)||Vk(n,e,t,i,1):!1}function fg(n){for(var e=0;;e++)if(n=n.previousSibling,!n)return e}function Vk(n,e,t,i,r){for(;;){if(n==t&&e==i)return!0;if(e==(r<0?0:hu(n))){if(n.nodeName=="DIV")return!1;let s=n.parentNode;if(!s||s.nodeType!=1)return!1;e=fg(n)+(r<0?0:1),n=s}else if(n.nodeType==1){if(n=n.childNodes[e+(r<0?-1:0)],n.nodeType==1&&n.contentEditable=="false")return!1;e=r<0?hu(n):0}else return!1}}function hu(n){return n.nodeType==3?n.nodeValue.length:n.childNodes.length}const Hk={left:0,right:0,top:0,bottom:0};function cu(n,e){let t=e?n.left:n.right;return{left:t,right:t,top:n.top,bottom:n.bottom}}function _W(n){return{left:0,right:n.innerWidth,top:0,bottom:n.innerHeight}}function DW(n,e,t,i,r,s,o,l){let a=n.ownerDocument,h=a.defaultView;for(let c=n;c;)if(c.nodeType==1){let u,f=c==a.body;if(f)u=_W(h);else{if(c.scrollHeight<=c.clientHeight&&c.scrollWidth<=c.clientWidth){c=c.parentNode;continue}let g=c.getBoundingClientRect();u={left:g.left,right:g.left+c.clientWidth,top:g.top,bottom:g.top+c.clientHeight}}let d=0,p=0;if(r=="nearest")e.top<u.top?(p=-(u.top-e.top+o),t>0&&e.bottom>u.bottom+p&&(p=e.bottom-u.bottom+p+o)):e.bottom>u.bottom&&(p=e.bottom-u.bottom+o,t<0&&e.top-p<u.top&&(p=-(u.top+p-e.top+o)));else{let g=e.bottom-e.top,y=u.bottom-u.top;p=(r=="center"&&g<=y?e.top+g/2-y/2:r=="start"||r=="center"&&t<0?e.top-o:e.bottom-y+o)-u.top}if(i=="nearest"?e.left<u.left?(d=-(u.left-e.left+s),t>0&&e.right>u.right+d&&(d=e.right-u.right+d+s)):e.right>u.right&&(d=e.right-u.right+s,t<0&&e.left<u.left+d&&(d=-(u.left+d-e.left+s))):d=(i=="center"?e.left+(e.right-e.left)/2-(u.right-u.left)/2:i=="start"==l?e.left-s:e.right-(u.right-u.left)+s)-u.left,d||p)if(f)h.scrollBy(d,p);else{if(p){let g=c.scrollTop;c.scrollTop+=p,p=c.scrollTop-g}if(d){let g=c.scrollLeft;c.scrollLeft+=d,d=c.scrollLeft-g}e={left:e.left-d,top:e.top-p,right:e.right-d,bottom:e.bottom-p}}if(f)break;c=c.assignedSlot||c.parentNode,i=r="nearest"}else if(c.nodeType==11)c=c.host;else break}class MW{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}eq(e){return this.anchorNode==e.anchorNode&&this.anchorOffset==e.anchorOffset&&this.focusNode==e.focusNode&&this.focusOffset==e.focusOffset}setRange(e){this.set(e.anchorNode,e.anchorOffset,e.focusNode,e.focusOffset)}set(e,t,i,r){this.anchorNode=e,this.anchorOffset=t,this.focusNode=i,this.focusOffset=r}}let nl=null;function zk(n){if(n.setActive)return n.setActive();if(nl)return n.focus(nl);let e=[];for(let t=n;t&&(e.push(t,t.scrollTop,t.scrollLeft),t!=t.ownerDocument);t=t.parentNode);if(n.focus(nl==null?{get preventScroll(){return nl={preventScroll:!0},!0}}:void 0),!nl){nl=!1;for(let t=0;t<e.length;){let i=e[t++],r=e[t++],s=e[t++];i.scrollTop!=r&&(i.scrollTop=r),i.scrollLeft!=s&&(i.scrollLeft=s)}}}let jk;function Da(n,e,t=e){let i=jk||(jk=document.createRange());return i.setEnd(n,t),i.setStart(n,e),i}function Ma(n,e,t){let i={key:e,code:e,keyCode:t,which:t,cancelable:!0},r=new KeyboardEvent("keydown",i);r.synthetic=!0,n.dispatchEvent(r);let s=new KeyboardEvent("keyup",i);return s.synthetic=!0,n.dispatchEvent(s),r.defaultPrevented||s.defaultPrevented}function EW(n){for(;n;){if(n&&(n.nodeType==9||n.nodeType==11&&n.host))return n;n=n.assignedSlot||n.parentNode}return null}function $k(n){for(;n.attributes.length;)n.removeAttributeNode(n.attributes[0])}class di{constructor(e,t,i=!0){this.node=e,this.offset=t,this.precise=i}static before(e,t){return new di(e.parentNode,fg(e),t)}static after(e,t){return new di(e.parentNode,fg(e)+1,t)}}const dg=[];class Mt{constructor(){this.parent=null,this.dom=null,this.dirty=2}get editorView(){if(!this.parent)throw new Error("Accessing view in orphan content view");return this.parent.editorView}get overrideDOMText(){return null}get posAtStart(){return this.parent?this.parent.posBefore(this):0}get posAtEnd(){return this.posAtStart+this.length}posBefore(e){let t=this.posAtStart;for(let i of this.children){if(i==e)return t;t+=i.length+i.breakAfter}throw new RangeError("Invalid child in posBefore")}posAfter(e){return this.posBefore(e)+e.length}coordsAt(e,t){return null}sync(e){if(this.dirty&2){let t=this.dom,i=null,r;for(let s of this.children){if(s.dirty){if(!s.dom&&(r=i?i.nextSibling:t.firstChild)){let o=Mt.get(r);(!o||!o.parent&&o.constructor==s.constructor)&&s.reuseDOM(r)}s.sync(e),s.dirty=0}if(r=i?i.nextSibling:t.firstChild,e&&!e.written&&e.node==t&&r!=s.dom&&(e.written=!0),s.dom.parentNode==t)for(;r&&r!=s.dom;)r=Uk(r);else t.insertBefore(s.dom,r);i=s.dom}for(r=i?i.nextSibling:t.firstChild,r&&e&&e.node==t&&(e.written=!0);r;)r=Uk(r)}else if(this.dirty&1)for(let t of this.children)t.dirty&&(t.sync(e),t.dirty=0)}reuseDOM(e){}localPosFromDOM(e,t){let i;if(e==this.dom)i=this.dom.childNodes[t];else{let r=hu(e)==0?0:t==0?-1:1;for(;;){let s=e.parentNode;if(s==this.dom)break;r==0&&s.firstChild!=s.lastChild&&(e==s.firstChild?r=-1:r=1),e=s}r<0?i=e:i=e.nextSibling}if(i==this.dom.firstChild)return 0;for(;i&&!Mt.get(i);)i=i.nextSibling;if(!i)return this.length;for(let r=0,s=0;;r++){let o=this.children[r];if(o.dom==i)return s;s+=o.length+o.breakAfter}}domBoundsAround(e,t,i=0){let r=-1,s=-1,o=-1,l=-1;for(let a=0,h=i,c=i;a<this.children.length;a++){let u=this.children[a],f=h+u.length;if(h<e&&f>t)return u.domBoundsAround(e,t,h);if(f>=e&&r==-1&&(r=a,s=h),h>t&&u.dom.parentNode==this.dom){o=a,l=c;break}c=f,h=f+u.breakAfter}return{from:s,to:l<0?i+this.length:l,startDOM:(r?this.children[r-1].dom.nextSibling:null)||this.dom.firstChild,endDOM:o<this.children.length&&o>=0?this.children[o].dom:null}}markDirty(e=!1){this.dirty|=2,this.markParentsDirty(e)}markParentsDirty(e){for(let t=this.parent;t;t=t.parent){if(e&&(t.dirty|=2),t.dirty&1)return;t.dirty|=1,e=!1}}setParent(e){this.parent!=e&&(this.parent=e,this.dirty&&this.markParentsDirty(!0))}setDOM(e){this.dom&&(this.dom.cmView=null),this.dom=e,e.cmView=this}get rootView(){for(let e=this;;){let t=e.parent;if(!t)return e;e=t}}replaceChildren(e,t,i=dg){this.markDirty();for(let r=e;r<t;r++){let s=this.children[r];s.parent==this&&s.destroy()}this.children.splice(e,t-e,...i);for(let r=0;r<i.length;r++)i[r].setParent(this)}ignoreMutation(e){return!1}ignoreEvent(e){return!1}childCursor(e=this.length){return new qk(this.children,e,this.children.length)}childPos(e,t=1){return this.childCursor().findPos(e,t)}toString(){let e=this.constructor.name.replace("View","");return e+(this.children.length?"("+this.children.join()+")":this.length?"["+(e=="Text"?this.text:this.length)+"]":"")+(this.breakAfter?"#":"")}static get(e){return e.cmView}get isEditable(){return!0}merge(e,t,i,r,s,o){return!1}become(e){return!1}getSide(){return 0}destroy(){this.parent=null}}Mt.prototype.breakAfter=0;function Uk(n){let e=n.nextSibling;return n.parentNode.removeChild(n),e}class qk{constructor(e,t,i){this.children=e,this.pos=t,this.i=i,this.off=0}findPos(e,t=1){for(;;){if(e>this.pos||e==this.pos&&(t>0||this.i==0||this.children[this.i-1].breakAfter))return this.off=e-this.pos,this;let i=this.children[--this.i];this.pos-=i.length+i.breakAfter}}}function Kk(n,e,t,i,r,s,o,l,a){let{children:h}=n,c=h.length?h[e]:null,u=s.length?s[s.length-1]:null,f=u?u.breakAfter:o;if(!(e==i&&c&&!o&&!f&&s.length<2&&c.merge(t,r,s.length?u:null,t==0,l,a))){if(i<h.length){let d=h[i];d&&r<d.length?(e==i&&(d=d.split(r),r=0),!f&&u&&d.merge(0,r,u,!0,0,a)?s[s.length-1]=d:(r&&d.merge(0,r,null,!1,0,a),s.push(d))):d!=null&&d.breakAfter&&(u?u.breakAfter=1:o=1),i++}for(c&&(c.breakAfter=o,t>0&&(!o&&s.length&&c.merge(t,c.length,s[0],!1,l,0)?c.breakAfter=s.shift().breakAfter:(t<c.length||c.children.length&&c.children[c.children.length-1].length==0)&&c.merge(t,c.length,null,!1,l,0),e++));e<i&&s.length;)if(h[i-1].become(s[s.length-1]))i--,s.pop(),a=s.length?0:l;else if(h[e].become(s[0]))e++,s.shift(),l=s.length?0:a;else break;!s.length&&e&&i<h.length&&!h[e-1].breakAfter&&h[i].merge(0,0,h[e-1],!1,l,a)&&e--,(e<i||s.length)&&n.replaceChildren(e,i,s)}}function Gk(n,e,t,i,r,s){let o=n.childCursor(),{i:l,off:a}=o.findPos(t,1),{i:h,off:c}=o.findPos(e,-1),u=e-t;for(let f of i)u+=f.length;n.length+=u,Kk(n,h,c,l,a,i,0,r,s)}let an=typeof navigator!="undefined"?navigator:{userAgent:"",vendor:"",platform:""},pg=typeof document!="undefined"?document:{documentElement:{style:{}}};const mg=/Edge\/(\d+)/.exec(an.userAgent),Jk=/MSIE \d/.test(an.userAgent),gg=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(an.userAgent),uu=!!(Jk||gg||mg),Zk=!uu&&/gecko\/(\d+)/i.test(an.userAgent),yg=!uu&&/Chrome\/(\d+)/.exec(an.userAgent),Yk="webkitFontSmoothing"in pg.documentElement.style,Xk=!uu&&/Apple Computer/.test(an.vendor),Qk=Xk&&(/Mobile\/\w+/.test(an.userAgent)||an.maxTouchPoints>2);var ge={mac:Qk||/Mac/.test(an.platform),windows:/Win/.test(an.platform),linux:/Linux|X11/.test(an.platform),ie:uu,ie_version:Jk?pg.documentMode||6:gg?+gg[1]:mg?+mg[1]:0,gecko:Zk,gecko_version:Zk?+(/Firefox\/(\d+)/.exec(an.userAgent)||[0,0])[1]:0,chrome:!!yg,chrome_version:yg?+yg[1]:0,ios:Qk,android:/Android\b/.test(an.userAgent),webkit:Yk,safari:Xk,webkit_version:Yk?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0,tabSize:pg.documentElement.style.tabSize!=null?"tab-size":"-moz-tab-size"};const TW=256;class ys extends Mt{constructor(e){super(),this.text=e}get length(){return this.text.length}createDOM(e){this.setDOM(e||document.createTextNode(this.text))}sync(e){this.dom||this.createDOM(),this.dom.nodeValue!=this.text&&(e&&e.node==this.dom&&(e.written=!0),this.dom.nodeValue=this.text)}reuseDOM(e){e.nodeType==3&&this.createDOM(e)}merge(e,t,i){return i&&(!(i instanceof ys)||this.length-(t-e)+i.length>TW)?!1:(this.text=this.text.slice(0,e)+(i?i.text:"")+this.text.slice(t),this.markDirty(),!0)}split(e){let t=new ys(this.text.slice(e));return this.text=this.text.slice(0,e),this.markDirty(),t}localPosFromDOM(e,t){return e==this.dom?t:t?this.text.length:0}domAtPos(e){return new di(this.dom,e)}domBoundsAround(e,t,i){return{from:i,to:i+this.length,startDOM:this.dom,endDOM:this.dom.nextSibling}}coordsAt(e,t){return vg(this.dom,e,t)}}class Qn extends Mt{constructor(e,t=[],i=0){super(),this.mark=e,this.children=t,this.length=i;for(let r of t)r.setParent(this)}setAttrs(e){if($k(e),this.mark.class&&(e.className=this.mark.class),this.mark.attrs)for(let t in this.mark.attrs)e.setAttribute(t,this.mark.attrs[t]);return e}reuseDOM(e){e.nodeName==this.mark.tagName.toUpperCase()&&(this.setDOM(e),this.dirty|=6)}sync(e){this.dom?this.dirty&4&&this.setAttrs(this.dom):this.setDOM(this.setAttrs(document.createElement(this.mark.tagName))),super.sync(e)}merge(e,t,i,r,s,o){return i&&(!(i instanceof Qn&&i.mark.eq(this.mark))||e&&s<=0||t<this.length&&o<=0)?!1:(Gk(this,e,t,i?i.children:[],s-1,o-1),this.markDirty(),!0)}split(e){let t=[],i=0,r=-1,s=0;for(let l of this.children){let a=i+l.length;a>e&&t.push(i<e?l.split(e-i):l),r<0&&i>=e&&(r=s),i=a,s++}let o=this.length-e;return this.length=e,r>-1&&(this.children.length=r,this.markDirty()),new Qn(this.mark,t,o)}domAtPos(e){return iC(this.dom,this.children,e)}coordsAt(e,t){return rC(this,e,t)}}function vg(n,e,t){let i=n.nodeValue.length;e>i&&(e=i);let r=e,s=e,o=0;e==0&&t<0||e==i&&t>=0?ge.chrome||ge.gecko||(e?(r--,o=1):(s++,o=-1)):t<0?r--:s++;let l=Da(n,r,s).getClientRects();if(!l.length)return Hk;let a=l[(o?o<0:t>=0)?0:l.length-1];return ge.safari&&!o&&a.width==0&&(a=Array.prototype.find.call(l,h=>h.width)||a),o?cu(a,o<0):a||null}class vs extends Mt{constructor(e,t,i){super(),this.widget=e,this.length=t,this.side=i,this.prevWidget=null}static create(e,t,i){return new(e.customView||vs)(e,t,i)}split(e){let t=vs.create(this.widget,this.length-e,this.side);return this.length-=e,t}sync(){(!this.dom||!this.widget.updateDOM(this.dom))&&(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(this.editorView)),this.dom.contentEditable="false")}getSide(){return this.side}merge(e,t,i,r,s,o){return i&&(!(i instanceof vs)||!this.widget.compare(i.widget)||e>0&&s<=0||t<this.length&&o<=0)?!1:(this.length=e+(i?i.length:0)+(this.length-t),!0)}become(e){return e.length==this.length&&e instanceof vs&&e.side==this.side&&this.widget.constructor==e.widget.constructor?(this.widget.eq(e.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=e.widget,!0):!1}ignoreMutation(){return!0}ignoreEvent(e){return this.widget.ignoreEvent(e)}get overrideDOMText(){if(this.length==0)return j.empty;let e=this;for(;e.parent;)e=e.parent;let t=e.editorView,i=t&&t.state.doc,r=this.posAtStart;return i?i.slice(r,r+this.length):j.empty}domAtPos(e){return e==0?di.before(this.dom):di.after(this.dom,e==this.length)}domBoundsAround(){return null}coordsAt(e,t){let i=this.dom.getClientRects(),r=null;if(!i.length)return Hk;for(let s=e>0?i.length-1:0;r=i[s],!(e>0?s==0:s==i.length-1||r.top<r.bottom);s+=e>0?-1:1);return e==0&&t>0||e==this.length&&t<=0?r:cu(r,e==0)}get isEditable(){return!1}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class eC extends vs{domAtPos(e){let{topView:t,text:i}=this.widget;return t?wg(e,0,t,i,(r,s)=>r.domAtPos(s),r=>new di(i,Math.min(r,i.nodeValue.length))):new di(i,Math.min(e,i.nodeValue.length))}sync(){this.setDOM(this.widget.toDOM())}localPosFromDOM(e,t){let{topView:i,text:r}=this.widget;return i?tC(e,t,i,r):Math.min(t,this.length)}ignoreMutation(){return!1}get overrideDOMText(){return null}coordsAt(e,t){let{topView:i,text:r}=this.widget;return i?wg(e,t,i,r,(s,o,l)=>s.coordsAt(o,l),(s,o)=>vg(r,s,o)):vg(r,e,t)}destroy(){var e;super.destroy(),(e=this.widget.topView)===null||e===void 0||e.destroy()}get isEditable(){return!0}}function wg(n,e,t,i,r,s){if(t instanceof Qn){for(let o of t.children){let l=il(o.dom,i),a=l?i.nodeValue.length:o.length;if(n<a||n==a&&o.getSide()<=0)return l?wg(n,e,o,i,r,s):r(o,n,e);n-=a}return r(t,t.length,-1)}else return t.dom==i?s(n,e):r(t,n,e)}function tC(n,e,t,i){if(t instanceof Qn)for(let r of t.children){let s=0,o=il(r.dom,i);if(il(r.dom,n))return s+(o?tC(n,e,r,i):r.localPosFromDOM(n,e));s+=o?i.nodeValue.length:r.length}else if(t.dom==i)return Math.min(e,i.nodeValue.length);return t.localPosFromDOM(n,e)}class rl extends Mt{constructor(e){super(),this.side=e}get length(){return 0}merge(){return!1}become(e){return e instanceof rl&&e.side==this.side}split(){return new rl(this.side)}sync(){if(!this.dom){let e=document.createElement("img");e.className="cm-widgetBuffer",e.setAttribute("aria-hidden","true"),this.setDOM(e)}}getSide(){return this.side}domAtPos(e){return di.before(this.dom)}localPosFromDOM(){return 0}domBoundsAround(){return null}coordsAt(e){let t=this.dom.getBoundingClientRect(),i=PW(this,this.side>0?-1:1);return i&&i.top<t.bottom&&i.bottom>t.top?{left:t.left,right:t.right,top:i.top,bottom:i.bottom}:t}get overrideDOMText(){return j.empty}}ys.prototype.children=vs.prototype.children=rl.prototype.children=dg;function PW(n,e){let t=n.parent,i=t?t.children.indexOf(n):-1;for(;t&&i>=0;)if(e<0?i>0:i<t.children.length){let r=t.children[i+e];if(r instanceof ys){let s=r.coordsAt(e<0?r.length:0,e);if(s)return s}i+=e}else if(t instanceof Qn&&t.parent)i=t.parent.children.indexOf(t)+(e<0?0:1),t=t.parent;else{let r=t.dom.lastChild;if(r&&r.nodeName=="BR")return r.getClientRects()[0];break}}function iC(n,e,t){let i=0;for(let r=0;i<e.length;i++){let s=e[i],o=r+s.length;if(!(o==r&&s.getSide()<=0)){if(t>r&&t<o&&s.dom.parentNode==n)return s.domAtPos(t-r);if(t<=r)break;r=o}}for(;i>0;i--){let r=e[i-1].dom;if(r.parentNode==n)return di.after(r)}return new di(n,0)}function nC(n,e,t){let i,{children:r}=n;t>0&&e instanceof Qn&&r.length&&(i=r[r.length-1])instanceof Qn&&i.mark.eq(e.mark)?nC(i,e.children[0],t-1):(r.push(e),e.setParent(n)),n.length+=e.length}function rC(n,e,t){for(let s=0,o=0;o<n.children.length;o++){let l=n.children[o],a=s+l.length,h;if((t<=0||a==n.length||l.getSide()>0?a>=e:a>e)&&(e<a||o+1==n.children.length||(h=n.children[o+1]).length||h.getSide()>0)){let c=0;if(a==s){if(l.getSide()<=0)continue;c=t=-l.getSide()}let u=l.coordsAt(Math.max(0,e-s),t);return c&&u?cu(u,t<0):u}s=a}let i=n.dom.lastChild;if(!i)return n.dom.getBoundingClientRect();let r=_a(i);return r[r.length-1]||null}function bg(n,e){for(let t in n)t=="class"&&e.class?e.class+=" "+n.class:t=="style"&&e.style?e.style+=";"+n.style:e[t]=n[t];return e}function xg(n,e){if(n==e)return!0;if(!n||!e)return!1;let t=Object.keys(n),i=Object.keys(e);if(t.length!=i.length)return!1;for(let r of t)if(i.indexOf(r)==-1||n[r]!==e[r])return!1;return!0}function Sg(n,e,t){if(e)for(let i in e)t&&i in t||n.removeAttribute(i);if(t)for(let i in t)e&&e[i]==t[i]||n.setAttribute(i,t[i])}class fu{eq(e){return!1}updateDOM(e){return!1}compare(e){return this==e||this.constructor==e.constructor&&this.eq(e)}get estimatedHeight(){return-1}ignoreEvent(e){return!0}get customView(){return null}destroy(e){}}var pt=function(n){return n[n.Text=0]="Text",n[n.WidgetBefore=1]="WidgetBefore",n[n.WidgetAfter=2]="WidgetAfter",n[n.WidgetRange=3]="WidgetRange",n}(pt||(pt={}));class ct extends qs{constructor(e,t,i,r){super(),this.startSide=e,this.endSide=t,this.widget=i,this.spec=r}get heightRelevant(){return!1}static mark(e){return new du(e)}static widget(e){let t=e.side||0,i=!!e.block;return t+=i?t>0?3e8:-4e8:t>0?1e8:-1e8,new co(e,t,t,i,e.widget||null,!1)}static replace(e){let t=!!e.block,i,r;if(e.isBlockGap)i=-5e8,r=4e8;else{let{start:s,end:o}=sC(e,t);i=(s?t?-3e8:-1:5e8)-1,r=(o?t?2e8:1:-6e8)+1}return new co(e,i,r,t,e.widget||null,!0)}static line(e){return new Ea(e)}static set(e,t=!1){return Te.of(e,t)}hasHeight(){return this.widget?this.widget.estimatedHeight>-1:!1}}ct.none=Te.empty;class du extends ct{constructor(e){let{start:t,end:i}=sC(e);super(t?-1:5e8,i?1:-6e8,null,e),this.tagName=e.tagName||"span",this.class=e.class||"",this.attrs=e.attributes||null}eq(e){return this==e||e instanceof du&&this.tagName==e.tagName&&this.class==e.class&&xg(this.attrs,e.attrs)}range(e,t=e){if(e>=t)throw new RangeError("Mark decorations may not be empty");return super.range(e,t)}}du.prototype.point=!1;class Ea extends ct{constructor(e){super(-2e8,-2e8,null,e)}eq(e){return e instanceof Ea&&xg(this.spec.attributes,e.spec.attributes)}range(e,t=e){if(t!=e)throw new RangeError("Line decoration ranges must be zero-length");return super.range(e,t)}}Ea.prototype.mapMode=Fn.TrackBefore,Ea.prototype.point=!0;class co extends ct{constructor(e,t,i,r,s,o){super(t,i,s,e),this.block=r,this.isReplace=o,this.mapMode=r?t<=0?Fn.TrackBefore:Fn.TrackAfter:Fn.TrackDel}get type(){return this.startSide<this.endSide?pt.WidgetRange:this.startSide<=0?pt.WidgetBefore:pt.WidgetAfter}get heightRelevant(){return this.block||!!this.widget&&this.widget.estimatedHeight>=5}eq(e){return e instanceof co&&BW(this.widget,e.widget)&&this.block==e.block&&this.startSide==e.startSide&&this.endSide==e.endSide}range(e,t=e){if(this.isReplace&&(e>t||e==t&&this.startSide>0&&this.endSide<=0))throw new RangeError("Invalid range for replacement decoration");if(!this.isReplace&&t!=e)throw new RangeError("Widget decorations can only have zero-length ranges");return super.range(e,t)}}co.prototype.point=!0;function sC(n,e=!1){let{inclusiveStart:t,inclusiveEnd:i}=n;return t==null&&(t=n.inclusive),i==null&&(i=n.inclusive),{start:t!=null?t:e,end:i!=null?i:e}}function BW(n,e){return n==e||!!(n&&e&&n.compare(e))}function kg(n,e,t,i=0){let r=t.length-1;r>=0&&t[r]+i>=n?t[r]=Math.max(t[r],e):t.push(n,e)}class Ni extends Mt{constructor(){super(...arguments),this.children=[],this.length=0,this.prevAttrs=void 0,this.attrs=null,this.breakAfter=0}merge(e,t,i,r,s,o){if(i){if(!(i instanceof Ni))return!1;this.dom||i.transferDOM(this)}return r&&this.setDeco(i?i.attrs:null),Gk(this,e,t,i?i.children:[],s,o),!0}split(e){let t=new Ni;if(t.breakAfter=this.breakAfter,this.length==0)return t;let{i,off:r}=this.childPos(e);r&&(t.append(this.children[i].split(r),0),this.children[i].merge(r,this.children[i].length,null,!1,0,0),i++);for(let s=i;s<this.children.length;s++)t.append(this.children[s],0);for(;i>0&&this.children[i-1].length==0;)this.children[--i].destroy();return this.children.length=i,this.markDirty(),this.length=e,t}transferDOM(e){!this.dom||(e.setDOM(this.dom),e.prevAttrs=this.prevAttrs===void 0?this.attrs:this.prevAttrs,this.prevAttrs=void 0,this.dom=null)}setDeco(e){xg(this.attrs,e)||(this.dom&&(this.prevAttrs=this.attrs,this.markDirty()),this.attrs=e)}append(e,t){nC(this,e,t)}addLineDeco(e){let t=e.spec.attributes,i=e.spec.class;t&&(this.attrs=bg(t,this.attrs||{})),i&&(this.attrs=bg({class:i},this.attrs||{}))}domAtPos(e){return iC(this.dom,this.children,e)}reuseDOM(e){e.nodeName=="DIV"&&(this.setDOM(e),this.dirty|=6)}sync(e){var t;this.dom?this.dirty&4&&($k(this.dom),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0):(this.setDOM(document.createElement("div")),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0),this.prevAttrs!==void 0&&(Sg(this.dom,this.prevAttrs,this.attrs),this.dom.classList.add("cm-line"),this.prevAttrs=void 0),super.sync(e);let i=this.dom.lastChild;for(;i&&Mt.get(i)instanceof Qn;)i=i.lastChild;if(!i||!this.length||i.nodeName!="BR"&&((t=Mt.get(i))===null||t===void 0?void 0:t.isEditable)==!1&&(!ge.ios||!this.children.some(r=>r instanceof ys))){let r=document.createElement("BR");r.cmIgnore=!0,this.dom.appendChild(r)}}measureTextSize(){if(this.children.length==0||this.length>20)return null;let e=0;for(let t of this.children){if(!(t instanceof ys))return null;let i=_a(t.dom);if(i.length!=1)return null;e+=i[0].width}return{lineHeight:this.dom.getBoundingClientRect().height,charWidth:e/this.length}}coordsAt(e,t){return rC(this,e,t)}become(e){return!1}get type(){return pt.Text}static find(e,t){for(let i=0,r=0;i<e.children.length;i++){let s=e.children[i],o=r+s.length;if(o>=t){if(s instanceof Ni)return s;if(o>t)break}r=o+s.breakAfter}return null}}class uo extends Mt{constructor(e,t,i){super(),this.widget=e,this.length=t,this.type=i,this.breakAfter=0,this.prevWidget=null}merge(e,t,i,r,s,o){return i&&(!(i instanceof uo)||!this.widget.compare(i.widget)||e>0&&s<=0||t<this.length&&o<=0)?!1:(this.length=e+(i?i.length:0)+(this.length-t),!0)}domAtPos(e){return e==0?di.before(this.dom):di.after(this.dom,e==this.length)}split(e){let t=this.length-e;this.length=e;let i=new uo(this.widget,t,this.type);return i.breakAfter=this.breakAfter,i}get children(){return dg}sync(){(!this.dom||!this.widget.updateDOM(this.dom))&&(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(this.editorView)),this.dom.contentEditable="false")}get overrideDOMText(){return this.parent?this.parent.view.state.doc.slice(this.posAtStart,this.posAtEnd):j.empty}domBoundsAround(){return null}become(e){return e instanceof uo&&e.type==this.type&&e.widget.constructor==this.widget.constructor?(e.widget.eq(this.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=e.widget,this.length=e.length,this.breakAfter=e.breakAfter,!0):!1}ignoreMutation(){return!0}ignoreEvent(e){return this.widget.ignoreEvent(e)}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class Cg{constructor(e,t,i,r){this.doc=e,this.pos=t,this.end=i,this.disallowBlockEffectsBelow=r,this.content=[],this.curLine=null,this.breakAtStart=0,this.pendingBuffer=0,this.atCursorPos=!0,this.openStart=-1,this.openEnd=-1,this.text="",this.textOff=0,this.cursor=e.iter(),this.skip=t}posCovered(){if(this.content.length==0)return!this.breakAtStart&&this.doc.lineAt(this.pos).from!=this.pos;let e=this.content[this.content.length-1];return!e.breakAfter&&!(e instanceof uo&&e.type==pt.WidgetBefore)}getLine(){return this.curLine||(this.content.push(this.curLine=new Ni),this.atCursorPos=!0),this.curLine}flushBuffer(e){this.pendingBuffer&&(this.curLine.append(pu(new rl(-1),e),e.length),this.pendingBuffer=0)}addBlockWidget(e){this.flushBuffer([]),this.curLine=null,this.content.push(e)}finish(e){e?this.pendingBuffer=0:this.flushBuffer([]),this.posCovered()||this.getLine()}buildText(e,t,i){for(;e>0;){if(this.textOff==this.text.length){let{value:s,lineBreak:o,done:l}=this.cursor.next(this.skip);if(this.skip=0,l)throw new Error("Ran out of text content when drawing inline views");if(o){this.posCovered()||this.getLine(),this.content.length?this.content[this.content.length-1].breakAfter=1:this.breakAtStart=1,this.flushBuffer([]),this.curLine=null,e--;continue}else this.text=s,this.textOff=0}let r=Math.min(this.text.length-this.textOff,e,512);this.flushBuffer(t.slice(0,i)),this.getLine().append(pu(new ys(this.text.slice(this.textOff,this.textOff+r)),t),i),this.atCursorPos=!0,this.textOff+=r,e-=r,i=0}}span(e,t,i,r){this.buildText(t-e,i,r),this.pos=t,this.openStart<0&&(this.openStart=r)}point(e,t,i,r,s){let o=t-e;if(i instanceof co)if(i.block){let{type:l}=i;l==pt.WidgetAfter&&!this.posCovered()&&this.getLine(),this.addBlockWidget(new uo(i.widget||new oC("div"),o,l))}else{let l=vs.create(i.widget||new oC("span"),o,i.startSide),a=this.atCursorPos&&!l.isEditable&&s<=r.length&&(e<t||i.startSide>0),h=!l.isEditable&&(e<t||i.startSide<=0),c=this.getLine();this.pendingBuffer==2&&!a&&(this.pendingBuffer=0),this.flushBuffer(r),a&&(c.append(pu(new rl(1),r),s),s=r.length+Math.max(0,s-r.length)),c.append(pu(l,r),s),this.atCursorPos=h,this.pendingBuffer=h?e<t?1:2:0}else this.doc.lineAt(this.pos).from==this.pos&&this.getLine().addLineDeco(i);o&&(this.textOff+o<=this.text.length?this.textOff+=o:(this.skip+=o-(this.text.length-this.textOff),this.text="",this.textOff=0),this.pos=t),this.openStart<0&&(this.openStart=s)}filterPoint(e,t,i,r){if(r<this.disallowBlockEffectsBelow&&i instanceof co){if(i.block)throw new RangeError("Block decorations may not be specified via plugins");if(t>this.doc.lineAt(this.pos).to)throw new RangeError("Decorations that replace line breaks may not be specified via plugins")}return!0}static build(e,t,i,r,s){let o=new Cg(e,t,i,s);return o.openEnd=Te.spans(r,t,i,o),o.openStart<0&&(o.openStart=o.openEnd),o.finish(o.openEnd),o}}function pu(n,e){for(let t of e)n=new Qn(t,[n],n.length);return n}class oC extends fu{constructor(e){super(),this.tag=e}eq(e){return e.tag==this.tag}toDOM(){return document.createElement(this.tag)}updateDOM(e){return e.nodeName.toLowerCase()==this.tag}}const RW=[],lC=Le.define(),aC=Le.define(),hC=Le.define(),cC=Le.define(),Ag=Le.define(),uC=Le.define(),Og=Lt.define({map:(n,e)=>n.map(e)}),fC=Lt.define({map:(n,e)=>n.map(e)});class sl{constructor(e,t="nearest",i="nearest",r=5,s=5){this.range=e,this.y=t,this.x=i,this.yMargin=r,this.xMargin=s}map(e){return e.empty?this:new sl(this.range.map(e),this.y,this.x,this.yMargin,this.xMargin)}}const dC=Lt.define({map:(n,e)=>n.map(e)});function ws(n,e,t){let i=n.facet(cC);i.length?i[0](e):window.onerror?window.onerror(String(e),t,void 0,void 0,e):t?console.error(t+":",e):console.error(e)}const Ta=Le.define({combine:n=>n.length?n[0]:!0});class LW{constructor(e,t){this.field=e,this.get=t}}class hn{from(e){return new LW(this,e)}static define(){return new hn}}hn.decorations=hn.define(),hn.atomicRanges=hn.define(),hn.scrollMargins=hn.define();let FW=0;const Pa=Le.define();class Br{constructor(e,t,i){this.id=e,this.create=t,this.fields=i,this.extension=Pa.of(this)}static define(e,t){let{eventHandlers:i,provide:r,decorations:s}=t||{},o=[];if(r)for(let l of Array.isArray(r)?r:[r])o.push(l);return i&&o.push(pC.from(l=>({plugin:l,handlers:i}))),s&&o.push(hn.decorations.from(s)),new Br(FW++,e,o)}static fromClass(e,t){return Br.define(i=>new e(i),t)}}const pC=hn.define();class _g{constructor(e){this.spec=e,this.mustUpdate=null,this.value=null}takeField(e,t){if(this.spec)for(let{field:i,get:r}of this.spec.fields)i==e&&t.push(r(this.value))}update(e){if(this.value){if(this.mustUpdate){let t=this.mustUpdate;if(this.mustUpdate=null,this.value.update)try{this.value.update(t)}catch(i){if(ws(t.state,i,"CodeMirror plugin crashed"),this.value.destroy)try{this.value.destroy()}catch{}this.deactivate()}}}else if(this.spec)try{this.value=this.spec.create(e)}catch(t){ws(e.state,t,"CodeMirror plugin crashed"),this.deactivate()}return this}destroy(e){var t;if(!((t=this.value)===null||t===void 0)&&t.destroy)try{this.value.destroy()}catch(i){ws(e.state,i,"CodeMirror plugin crashed")}}deactivate(){this.spec=this.value=null}}const mC=Le.define(),Dg=Le.define(),fo=Le.define(),Ba=Le.define();class er{constructor(e,t,i,r){this.fromA=e,this.toA=t,this.fromB=i,this.toB=r}join(e){return new er(Math.min(this.fromA,e.fromA),Math.max(this.toA,e.toA),Math.min(this.fromB,e.fromB),Math.max(this.toB,e.toB))}addToSet(e){let t=e.length,i=this;for(;t>0;t--){let r=e[t-1];if(!(r.fromA>i.toA)){if(r.toA<i.fromA)break;i=i.join(r),e.splice(t-1,1)}}return e.splice(t,0,i),e}static extendWithRanges(e,t){if(t.length==0)return e;let i=[];for(let r=0,s=0,o=0,l=0;;r++){let a=r==e.length?null:e[r],h=o-l,c=a?a.fromB:1e9;for(;s<t.length&&t[s]<c;){let u=t[s],f=t[s+1],d=Math.max(l,u),p=Math.min(c,f);if(d<=p&&new er(d+h,p+h,d,p).addToSet(i),f>c)break;s+=2}if(!a)return i;new er(a.fromA,a.toA,a.fromB,a.toB).addToSet(i),o=a.toA,l=a.toB}}}class gC{constructor(e,t,i=RW){this.view=e,this.state=t,this.transactions=i,this.flags=0,this.startState=e.state,this.changes=fi.empty(this.startState.doc.length);for(let o of i)this.changes=this.changes.compose(o.changes);let r=[];this.changes.iterChangedRanges((o,l,a,h)=>r.push(new er(o,l,a,h))),this.changedRanges=r;let s=e.hasFocus;s!=e.inputState.notifiedFocused&&(e.inputState.notifiedFocused=s,this.flags|=1)}get viewportChanged(){return(this.flags&4)>0}get heightChanged(){return(this.flags&2)>0}get geometryChanged(){return this.docChanged||(this.flags&10)>0}get focusChanged(){return(this.flags&1)>0}get docChanged(){return!this.changes.empty}get selectionSet(){return this.transactions.some(e=>e.selection)}get empty(){return this.flags==0&&this.transactions.length==0}}var bi=function(n){return n[n.LTR=0]="LTR",n[n.RTL=1]="RTL",n}(bi||(bi={}));const Mg=bi.LTR,NW=bi.RTL;function yC(n){let e=[];for(let t=0;t<n.length;t++)e.push(1<<+n[t]);return e}const IW=yC("88888888888888888888888888888888888666888888787833333333337888888000000000000000000000000008888880000000000000000000000000088888888888888888888888888888888888887866668888088888663380888308888800000000000000000000000800000000000000000000000000000008"),WW=yC("4444448826627288999999999992222222222222222222222222222222222222222222222229999999999999999999994444444444644222822222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222999999949999999229989999223333333333"),Eg=Object.create(null),tr=[];for(let n of["()","[]","{}"]){let e=n.charCodeAt(0),t=n.charCodeAt(1);Eg[e]=t,Eg[t]=-e}function VW(n){return n<=247?IW[n]:1424<=n&&n<=1524?2:1536<=n&&n<=1785?WW[n-1536]:1774<=n&&n<=2220?4:8192<=n&&n<=8203||n==8204?256:1}const HW=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;class ol{constructor(e,t,i){this.from=e,this.to=t,this.level=i}get dir(){return this.level%2?NW:Mg}side(e,t){return this.dir==t==e?this.to:this.from}static find(e,t,i,r){let s=-1;for(let o=0;o<e.length;o++){let l=e[o];if(l.from<=t&&l.to>=t){if(l.level==i)return o;(s<0||(r!=0?r<0?l.from<t:l.to>t:e[s].level>l.level))&&(s=o)}}if(s<0)throw new RangeError("Index out of range");return s}}const St=[];function vC(n,e){let t=n.length,i=e==Mg?1:2,r=e==Mg?2:1;if(!n||i==1&&!HW.test(n))return wC(t);for(let o=0,l=i,a=i;o<t;o++){let h=VW(n.charCodeAt(o));h==512?h=l:h==8&&a==4&&(h=16),St[o]=h==4?2:h,h&7&&(a=h),l=h}for(let o=0,l=i,a=i;o<t;o++){let h=St[o];if(h==128)o<t-1&&l==St[o+1]&&l&24?h=St[o]=l:St[o]=256;else if(h==64){let c=o+1;for(;c<t&&St[c]==64;)c++;let u=o&&l==8||c<t&&St[c]==8?a==1?1:8:256;for(let f=o;f<c;f++)St[f]=u;o=c-1}else h==8&&a==1&&(St[o]=1);l=h,h&7&&(a=h)}for(let o=0,l=0,a=0,h,c,u;o<t;o++)if(c=Eg[h=n.charCodeAt(o)])if(c<0){for(let f=l-3;f>=0;f-=3)if(tr[f+1]==-c){let d=tr[f+2],p=d&2?i:d&4?d&1?r:i:0;p&&(St[o]=St[tr[f]]=p),l=f;break}}else{if(tr.length==189)break;tr[l++]=o,tr[l++]=h,tr[l++]=a}else if((u=St[o])==2||u==1){let f=u==i;a=f?0:1;for(let d=l-3;d>=0;d-=3){let p=tr[d+2];if(p&2)break;if(f)tr[d+2]|=2;else{if(p&4)break;tr[d+2]|=4}}}for(let o=0;o<t;o++)if(St[o]==256){let l=o+1;for(;l<t&&St[l]==256;)l++;let a=(o?St[o-1]:i)==1,h=(l<t?St[l]:i)==1,c=a==h?a?1:2:i;for(let u=o;u<l;u++)St[u]=c;o=l-1}let s=[];if(i==1)for(let o=0;o<t;){let l=o,a=St[o++]!=1;for(;o<t&&a==(St[o]!=1);)o++;if(a)for(let h=o;h>l;){let c=h,u=St[--h]!=2;for(;h>l&&u==(St[h-1]!=2);)h--;s.push(new ol(h,c,u?2:1))}else s.push(new ol(l,o,0))}else for(let o=0;o<t;){let l=o,a=St[o++]==2;for(;o<t&&a==(St[o]==2);)o++;s.push(new ol(l,o,a?1:2))}return s}function wC(n){return[new ol(0,n,0)]}let bC="";function xC(n,e,t,i,r){var s;let o=i.head-n.from,l=-1;if(o==0){if(!r||!n.length)return null;e[0].level!=t&&(o=e[0].side(!1,t),l=0)}else if(o==n.length){if(r)return null;let f=e[e.length-1];f.level!=t&&(o=f.side(!0,t),l=e.length-1)}l<0&&(l=ol.find(e,o,(s=i.bidiLevel)!==null&&s!==void 0?s:-1,i.assoc));let a=e[l];o==a.side(r,t)&&(a=e[l+=r?1:-1],o=a.side(!r,t));let h=r==(a.dir==t),c=lt(n.text,o,h);if(bC=n.text.slice(Math.min(o,c),Math.max(o,c)),c!=a.side(r,t))return xe.cursor(c+n.from,h?-1:1,a.level);let u=l==(r?e.length-1:0)?null:e[l+(r?1:-1)];return!u&&a.level!=t?xe.cursor(r?n.to:n.from,r?-1:1,t):u&&u.level<a.level?xe.cursor(u.side(!r,t)+n.from,r?1:-1,u.level):xe.cursor(c+n.from,r?-1:1,a.level)}const bs="\uFFFF";class SC{constructor(e,t){this.points=e,this.text="",this.lineSeparator=t.facet(Ge.lineSeparator)}append(e){this.text+=e}lineBreak(){this.text+=bs}readRange(e,t){if(!e)return this;let i=e.parentNode;for(let r=e;;){this.findPointBefore(i,r),this.readNode(r);let s=r.nextSibling;if(s==t)break;let o=Mt.get(r),l=Mt.get(s);(o&&l?o.breakAfter:(o?o.breakAfter:kC(r))||kC(s)&&(r.nodeName!="BR"||r.cmIgnore))&&this.lineBreak(),r=s}return this.findPointBefore(i,t),this}readTextNode(e){let t=e.nodeValue;for(let i of this.points)i.node==e&&(i.pos=this.text.length+Math.min(i.offset,t.length));for(let i=0,r=this.lineSeparator?null:/\r\n?|\n/g;;){let s=-1,o=1,l;if(this.lineSeparator?(s=t.indexOf(this.lineSeparator,i),o=this.lineSeparator.length):(l=r.exec(t))&&(s=l.index,o=l[0].length),this.append(t.slice(i,s<0?t.length:s)),s<0)break;if(this.lineBreak(),o>1)for(let a of this.points)a.node==e&&a.pos>this.text.length&&(a.pos-=o-1);i=s+o}}readNode(e){if(e.cmIgnore)return;let t=Mt.get(e),i=t&&t.overrideDOMText;if(i!=null){this.findPointInside(e,i.length);for(let r=i.iter();!r.next().done;)r.lineBreak?this.lineBreak():this.append(r.value)}else e.nodeType==3?this.readTextNode(e):e.nodeName=="BR"?e.nextSibling&&this.lineBreak():e.nodeType==1&&this.readRange(e.firstChild,null)}findPointBefore(e,t){for(let i of this.points)i.node==e&&e.childNodes[i.offset]==t&&(i.pos=this.text.length)}findPointInside(e,t){for(let i of this.points)(e.nodeType==3?i.node==e:e.contains(i.node))&&(i.pos=this.text.length+Math.min(t,i.offset))}}function kC(n){return n.nodeType==1&&/^(DIV|P|LI|UL|OL|BLOCKQUOTE|DD|DT|H\d|SECTION|PRE)$/.test(n.nodeName)}class CC{constructor(e,t){this.node=e,this.offset=t,this.pos=-1}}class AC extends Mt{constructor(e){super(),this.view=e,this.compositionDeco=ct.none,this.decorations=[],this.pluginDecorationLength=0,this.minWidth=0,this.minWidthFrom=0,this.minWidthTo=0,this.impreciseAnchor=null,this.impreciseHead=null,this.forceSelection=!1,this.lastUpdate=Date.now(),this.setDOM(e.contentDOM),this.children=[new Ni],this.children[0].setParent(this),this.updateDeco(),this.updateInner([new er(0,0,0,e.state.doc.length)],0)}get root(){return this.view.root}get editorView(){return this.view}get length(){return this.view.state.doc.length}update(e){let t=e.changedRanges;this.minWidth>0&&t.length&&(t.every(({fromA:o,toA:l})=>l<this.minWidthFrom||o>this.minWidthTo)?(this.minWidthFrom=e.changes.mapPos(this.minWidthFrom,1),this.minWidthTo=e.changes.mapPos(this.minWidthTo,1)):this.minWidth=this.minWidthFrom=this.minWidthTo=0),this.view.inputState.composing<0?this.compositionDeco=ct.none:(e.transactions.length||this.dirty)&&(this.compositionDeco=jW(this.view,e.changes)),(ge.ie||ge.chrome)&&!this.compositionDeco.size&&e&&e.state.doc.lines!=e.startState.doc.lines&&(this.forceSelection=!0);let i=this.decorations,r=this.updateDeco(),s=KW(i,r,e.changes);return t=er.extendWithRanges(t,s),this.dirty==0&&t.length==0?!1:(this.updateInner(t,e.startState.doc.length),e.transactions.length&&(this.lastUpdate=Date.now()),!0)}updateInner(e,t){this.view.viewState.mustMeasureContent=!0,this.updateChildren(e,t);let{observer:i}=this.view;i.ignore(()=>{this.dom.style.height=this.view.viewState.contentHeight+"px",this.dom.style.minWidth=this.minWidth?this.minWidth+"px":"";let s=ge.chrome||ge.ios?{node:i.selectionRange.focusNode,written:!1}:void 0;this.sync(s),this.dirty=0,s&&(s.written||i.selectionRange.focusNode!=s.node)&&(this.forceSelection=!0),this.dom.style.height=""});let r=[];if(this.view.viewport.from||this.view.viewport.to<this.view.state.doc.length)for(let s of this.children)s instanceof uo&&s.widget instanceof OC&&r.push(s.dom);i.updateGaps(r)}updateChildren(e,t){let i=this.childCursor(t);for(let r=e.length-1;;r--){let s=r>=0?e[r]:null;if(!s)break;let{fromA:o,toA:l,fromB:a,toB:h}=s,{content:c,breakAtStart:u,openStart:f,openEnd:d}=Cg.build(this.view.state.doc,a,h,this.decorations,this.pluginDecorationLength),{i:p,off:g}=i.findPos(l,1),{i:y,off:v}=i.findPos(o,-1);Kk(this,y,v,p,g,c,u,f,d)}}updateSelection(e=!1,t=!1){if(e&&this.view.observer.readSelectionRange(),!(t||this.mayControlSelection())||ge.ios&&this.view.inputState.rapidCompositionStart)return;let i=this.forceSelection;this.forceSelection=!1;let r=this.view.state.selection.main,s=this.domAtPos(r.anchor),o=r.empty?s:this.domAtPos(r.head);if(ge.gecko&&r.empty&&zW(s)){let a=document.createTextNode("");this.view.observer.ignore(()=>s.node.insertBefore(a,s.node.childNodes[s.offset]||null)),s=o=new di(a,0),i=!0}let l=this.view.observer.selectionRange;(i||!l.focusNode||!au(s.node,s.offset,l.anchorNode,l.anchorOffset)||!au(o.node,o.offset,l.focusNode,l.focusOffset))&&(this.view.observer.ignore(()=>{ge.android&&ge.chrome&&this.dom.contains(l.focusNode)&&GW(l.focusNode,this.dom)&&(this.dom.blur(),this.dom.focus({preventScroll:!0}));let a=lu(this.root);if(r.empty){if(ge.gecko){let h=UW(s.node,s.offset);if(h&&h!=3){let c=DC(s.node,s.offset,h==1?1:-1);c&&(s=new di(c,h==1?0:c.nodeValue.length))}}a.collapse(s.node,s.offset),r.bidiLevel!=null&&l.cursorBidiLevel!=null&&(l.cursorBidiLevel=r.bidiLevel)}else if(a.extend)a.collapse(s.node,s.offset),a.extend(o.node,o.offset);else{let h=document.createRange();r.anchor>r.head&&([s,o]=[o,s]),h.setEnd(o.node,o.offset),h.setStart(s.node,s.offset),a.removeAllRanges(),a.addRange(h)}}),this.view.observer.setSelectionRange(s,o)),this.impreciseAnchor=s.precise?null:new di(l.anchorNode,l.anchorOffset),this.impreciseHead=o.precise?null:new di(l.focusNode,l.focusOffset)}enforceCursorAssoc(){if(this.compositionDeco.size)return;let e=this.view.state.selection.main,t=lu(this.root);if(!e.empty||!e.assoc||!t.modify)return;let i=Ni.find(this,e.head);if(!i)return;let r=i.posAtStart;if(e.head==r||e.head==r+i.length)return;let s=this.coordsAt(e.head,-1),o=this.coordsAt(e.head,1);if(!s||!o||s.bottom>o.top)return;let l=this.domAtPos(e.head+e.assoc);t.collapse(l.node,l.offset),t.modify("move",e.assoc<0?"forward":"backward","lineboundary")}mayControlSelection(){return this.view.state.facet(Ta)?this.root.activeElement==this.dom:ug(this.dom,this.view.observer.selectionRange)}nearest(e){for(let t=e;t;){let i=Mt.get(t);if(i&&i.rootView==this)return i;t=t.parentNode}return null}posFromDOM(e,t){let i=this.nearest(e);if(!i)throw new RangeError("Trying to find position for a DOM position outside of the document");return i.localPosFromDOM(e,t)+i.posAtStart}domAtPos(e){let{i:t,off:i}=this.childCursor().findPos(e,-1);for(;t<this.children.length-1;){let r=this.children[t];if(i<r.length||r instanceof Ni)break;t++,i=0}return this.children[t].domAtPos(i)}coordsAt(e,t){for(let i=this.length,r=this.children.length-1;;r--){let s=this.children[r],o=i-s.breakAfter-s.length;if(e>o||e==o&&s.type!=pt.WidgetBefore&&s.type!=pt.WidgetAfter&&(!r||t==2||this.children[r-1].breakAfter||this.children[r-1].type==pt.WidgetBefore&&t>-2))return s.coordsAt(e-o,t);i=o}}measureVisibleLineHeights(){let e=[],{from:t,to:i}=this.view.viewState.viewport,r=this.view.contentDOM.clientWidth,s=r>Math.max(this.view.scrollDOM.clientWidth,this.minWidth)+1,o=-1;for(let l=0,a=0;a<this.children.length;a++){let h=this.children[a],c=l+h.length;if(c>i)break;if(l>=t){let u=h.dom.getBoundingClientRect();if(e.push(u.height),s){let f=h.dom.lastChild,d=f?_a(f):[];if(d.length){let p=d[d.length-1],g=this.view.textDirection==bi.LTR?p.right-u.left:u.right-p.left;g>o&&(o=g,this.minWidth=r,this.minWidthFrom=l,this.minWidthTo=c)}}}l=c+h.breakAfter}return e}measureTextSize(){for(let r of this.children)if(r instanceof Ni){let s=r.measureTextSize();if(s)return s}let e=document.createElement("div"),t,i;return e.className="cm-line",e.textContent="abc def ghi jkl mno pqr stu",this.view.observer.ignore(()=>{this.dom.appendChild(e);let r=_a(e.firstChild)[0];t=e.getBoundingClientRect().height,i=r?r.width/27:7,e.remove()}),{lineHeight:t,charWidth:i}}childCursor(e=this.length){let t=this.children.length;return t&&(e-=this.children[--t].length),new qk(this.children,e,t)}computeBlockGapDeco(){let e=[],t=this.view.viewState;for(let i=0,r=0;;r++){let s=r==t.viewports.length?null:t.viewports[r],o=s?s.from-1:this.length;if(o>i){let l=t.lineBlockAt(o).bottom-t.lineBlockAt(i).top;e.push(ct.replace({widget:new OC(l),block:!0,inclusive:!0,isBlockGap:!0}).range(i,o))}if(!s)break;i=s.to+1}return ct.set(e)}updateDeco(){let e=this.view.pluginField(hn.decorations);return this.pluginDecorationLength=e.length,this.decorations=[...e,...this.view.state.facet(fo),this.compositionDeco,this.computeBlockGapDeco(),this.view.viewState.lineGapDeco]}scrollIntoView(e){let{range:t}=e,i=this.coordsAt(t.head,t.empty?t.assoc:t.head>t.anchor?-1:1),r;if(!i)return;!t.empty&&(r=this.coordsAt(t.anchor,t.anchor>t.head?-1:1))&&(i={left:Math.min(i.left,r.left),top:Math.min(i.top,r.top),right:Math.max(i.right,r.right),bottom:Math.max(i.bottom,r.bottom)});let s=0,o=0,l=0,a=0;for(let c of this.view.pluginField(hn.scrollMargins))if(c){let{left:u,right:f,top:d,bottom:p}=c;u!=null&&(s=Math.max(s,u)),f!=null&&(o=Math.max(o,f)),d!=null&&(l=Math.max(l,d)),p!=null&&(a=Math.max(a,p))}let h={left:i.left-s,top:i.top-l,right:i.right+o,bottom:i.bottom+a};DW(this.view.scrollDOM,h,t.head<t.anchor?-1:1,e.x,e.y,e.xMargin,e.yMargin,this.view.textDirection==bi.LTR)}}function zW(n){return n.node.nodeType==1&&n.node.firstChild&&(n.offset==0||n.node.childNodes[n.offset-1].contentEditable=="false")&&(n.offset==n.node.childNodes.length||n.node.childNodes[n.offset].contentEditable=="false")}class OC extends fu{constructor(e){super(),this.height=e}toDOM(){let e=document.createElement("div");return this.updateDOM(e),e}eq(e){return e.height==this.height}updateDOM(e){return e.style.height=this.height+"px",!0}get estimatedHeight(){return this.height}}function _C(n){let e=n.observer.selectionRange,t=e.focusNode&&DC(e.focusNode,e.focusOffset,0);if(!t)return null;let i=n.docView.nearest(t);if(!i)return null;if(i instanceof Ni){let r=t;for(;r.parentNode!=i.dom;)r=r.parentNode;let s=r.previousSibling;for(;s&&!Mt.get(s);)s=s.previousSibling;let o=s?Mt.get(s).posAtEnd:i.posAtStart;return{from:o,to:o,node:r,text:t}}else{for(;;){let{parent:s}=i;if(!s)return null;if(s instanceof Ni)break;i=s}let r=i.posAtStart;return{from:r,to:r+i.length,node:i.dom,text:t}}}function jW(n,e){let t=_C(n);if(!t)return ct.none;let{from:i,to:r,node:s,text:o}=t,l=e.mapPos(i,1),a=Math.max(l,e.mapPos(r,-1)),{state:h}=n,c=s.nodeType==3?s.nodeValue:new SC([],h).readRange(s.firstChild,null).text;if(a-l<c.length)if(h.doc.sliceString(l,Math.min(h.doc.length,l+c.length),bs)==c)a=l+c.length;else if(h.doc.sliceString(Math.max(0,a-c.length),a,bs)==c)l=a-c.length;else return ct.none;else if(h.doc.sliceString(l,a,bs)!=c)return ct.none;let u=Mt.get(s);return u instanceof eC?u=u.widget.topView:u&&(u.parent=null),ct.set(ct.replace({widget:new $W(s,o,u)}).range(l,a))}class $W extends fu{constructor(e,t,i){super(),this.top=e,this.text=t,this.topView=i}eq(e){return this.top==e.top&&this.text==e.text}toDOM(){return this.top}ignoreEvent(){return!1}get customView(){return eC}}function DC(n,e,t){for(;;){if(n.nodeType==3)return n;if(n.nodeType==1&&e>0&&t<=0)n=n.childNodes[e-1],e=hu(n);else if(n.nodeType==1&&e<n.childNodes.length&&t>=0)n=n.childNodes[e],e=0;else return null}}function UW(n,e){return n.nodeType!=1?0:(e&&n.childNodes[e-1].contentEditable=="false"?1:0)|(e<n.childNodes.length&&n.childNodes[e].contentEditable=="false"?2:0)}class qW{constructor(){this.changes=[]}compareRange(e,t){kg(e,t,this.changes)}comparePoint(e,t){kg(e,t,this.changes)}}function KW(n,e,t){let i=new qW;return Te.compare(n,e,t,i),i.changes}function GW(n,e){for(let t=n;t&&t!=e;t=t.assignedSlot||t.parentNode)if(t.nodeType==1&&t.contentEditable=="false")return!0;return!1}function JW(n,e,t=1){let i=n.charCategorizer(e),r=n.doc.lineAt(e),s=e-r.from;if(r.length==0)return xe.cursor(e);s==0?t=1:s==r.length&&(t=-1);let o=s,l=s;t<0?o=lt(r.text,s,!1):l=lt(r.text,s);let a=i(r.text.slice(o,l));for(;o>0;){let h=lt(r.text,o,!1);if(i(r.text.slice(h,o))!=a)break;o=h}for(;l<r.length;){let h=lt(r.text,l);if(i(r.text.slice(l,h))!=a)break;l=h}return xe.range(o+r.from,l+r.from)}function ZW(n,e){return e.left>n?e.left-n:Math.max(0,n-e.right)}function YW(n,e){return e.top>n?e.top-n:Math.max(0,n-e.bottom)}function Tg(n,e){return n.top<e.bottom-1&&n.bottom>e.top+1}function MC(n,e){return e<n.top?{top:e,left:n.left,right:n.right,bottom:n.bottom}:n}function EC(n,e){return e>n.bottom?{top:n.top,left:n.left,right:n.right,bottom:e}:n}function Pg(n,e,t){let i,r,s,o,l,a,h,c;for(let d=n.firstChild;d;d=d.nextSibling){let p=_a(d);for(let g=0;g<p.length;g++){let y=p[g];r&&Tg(r,y)&&(y=MC(EC(y,r.bottom),r.top));let v=ZW(e,y),C=YW(t,y);if(v==0&&C==0)return d.nodeType==3?TC(d,e,t):Pg(d,e,t);(!i||o>C||o==C&&s>v)&&(i=d,r=y,s=v,o=C),v==0?t>y.bottom&&(!h||h.bottom<y.bottom)?(l=d,h=y):t<y.top&&(!c||c.top>y.top)&&(a=d,c=y):h&&Tg(h,y)?h=EC(h,y.bottom):c&&Tg(c,y)&&(c=MC(c,y.top))}}if(h&&h.bottom>=t?(i=l,r=h):c&&c.top<=t&&(i=a,r=c),!i)return{node:n,offset:0};let u=Math.max(r.left,Math.min(r.right,e));if(i.nodeType==3)return TC(i,u,t);if(!s&&i.contentEditable=="true")return Pg(i,u,t);let f=Array.prototype.indexOf.call(n.childNodes,i)+(e>=(r.left+r.right)/2?1:0);return{node:n,offset:f}}function TC(n,e,t){let i=n.nodeValue.length,r=-1,s=1e9,o=0;for(let l=0;l<i;l++){let a=Da(n,l,l+1).getClientRects();for(let h=0;h<a.length;h++){let c=a[h];if(c.top==c.bottom)continue;o||(o=e-c.left);let u=(c.top>t?c.top-t:t-c.bottom)-1;if(c.left-1<=e&&c.right+1>=e&&u<s){let f=e>=(c.left+c.right)/2,d=f;if((ge.chrome||ge.gecko)&&Da(n,l).getBoundingClientRect().left==c.right&&(d=!f),u<=0)return{node:n,offset:l+(d?1:0)};r=l+(d?1:0),s=u}}}return{node:n,offset:r>-1?r:o>0?n.nodeValue.length:0}}function PC(n,{x:e,y:t},i,r=-1){var s;let o=n.contentDOM.getBoundingClientRect(),l=o.top+n.viewState.paddingTop,a,{docHeight:h}=n.viewState,c=t-l;if(c<0)return 0;if(c>h)return n.state.doc.length;for(let v=n.defaultLineHeight/2,C=!1;a=n.elementAtHeight(c),a.type!=pt.Text;)for(;c=r>0?a.bottom+v:a.top-v,!(c>=0&&c<=h);){if(C)return i?null:0;C=!0,r=-r}t=l+c;let u=a.from;if(u<n.viewport.from)return n.viewport.from==0?0:i?null:BC(n,o,a,e,t);if(u>n.viewport.to)return n.viewport.to==n.state.doc.length?n.state.doc.length:i?null:BC(n,o,a,e,t);let f=n.dom.ownerDocument,d=n.root.elementFromPoint?n.root:f,p=d.elementFromPoint(e,t);p&&!n.contentDOM.contains(p)&&(p=null),p||(e=Math.max(o.left+1,Math.min(o.right-1,e)),p=d.elementFromPoint(e,t),p&&!n.contentDOM.contains(p)&&(p=null));let g,y=-1;if(p&&((s=n.docView.nearest(p))===null||s===void 0?void 0:s.isEditable)!=!1){if(f.caretPositionFromPoint){let v=f.caretPositionFromPoint(e,t);v&&({offsetNode:g,offset:y}=v)}else if(f.caretRangeFromPoint){let v=f.caretRangeFromPoint(e,t);v&&({startContainer:g,startOffset:y}=v,ge.safari&&XW(g,y,e)&&(g=void 0))}}if(!g||!n.docView.dom.contains(g)){let v=Ni.find(n.docView,u);if(!v)return c>a.top+a.height/2?a.to:a.from;({node:g,offset:y}=Pg(v.dom,e,t))}return n.docView.posFromDOM(g,y)}function BC(n,e,t,i,r){let s=Math.round((i-e.left)*n.defaultCharacterWidth);n.lineWrapping&&t.height>n.defaultLineHeight*1.5&&(s+=Math.floor((r-t.top)/n.defaultLineHeight)*n.viewState.heightOracle.lineLength);let o=n.state.sliceDoc(t.from,t.to);return t.from+$d(o,s,n.state.tabSize)}function XW(n,e,t){let i;if(n.nodeType!=3||e!=(i=n.nodeValue.length))return!1;for(let r=n.nextSibling;r;r=r.nextSibling)if(r.nodeType!=1||r.nodeName!="BR")return!1;return Da(n,i-1,i).getBoundingClientRect().left>t}function QW(n,e,t,i){let r=n.state.doc.lineAt(e.head),s=!i||!n.lineWrapping?null:n.coordsAtPos(e.assoc<0&&e.head>r.from?e.head-1:e.head);if(s){let a=n.dom.getBoundingClientRect(),h=n.posAtCoords({x:t==(n.textDirection==bi.LTR)?a.right-1:a.left+1,y:(s.top+s.bottom)/2});if(h!=null)return xe.cursor(h,t?-1:1)}let o=Ni.find(n.docView,e.head),l=o?t?o.posAtEnd:o.posAtStart:t?r.to:r.from;return xe.cursor(l,t?-1:1)}function RC(n,e,t,i){let r=n.state.doc.lineAt(e.head),s=n.bidiSpans(r);for(let o=e,l=null;;){let a=xC(r,s,n.textDirection,o,t),h=bC;if(!a){if(r.number==(t?n.state.doc.lines:1))return o;h=`
`,r=n.state.doc.line(r.number+(t?1:-1)),s=n.bidiSpans(r),a=xe.cursor(t?r.from:r.to)}if(l){if(!l(h))return o}else{if(!i)return a;l=i(h)}o=a}}function e8(n,e,t){let i=n.state.charCategorizer(e),r=i(t);return s=>{let o=i(s);return r==Pr.Space&&(r=o),r==o}}function t8(n,e,t,i){let r=e.head,s=t?1:-1;if(r==(t?n.state.doc.length:0))return xe.cursor(r,e.assoc);let o=e.goalColumn,l,a=n.contentDOM.getBoundingClientRect(),h=n.coordsAtPos(r),c=n.documentTop;if(h)o==null&&(o=h.left-a.left),l=s<0?h.top:h.bottom;else{let d=n.viewState.lineBlockAt(r-c);o==null&&(o=Math.min(a.right-a.left,n.defaultCharacterWidth*(r-d.from))),l=(s<0?d.top:d.bottom)+c}let u=a.left+o,f=i!=null?i:n.defaultLineHeight>>1;for(let d=0;;d+=10){let p=l+(f+d)*s,g=PC(n,{x:u,y:p},!1,s);if(p<a.top||p>a.bottom||(s<0?g<r:g>r))return xe.cursor(g,e.assoc,void 0,o)}}function Bg(n,e,t){let i=n.pluginField(hn.atomicRanges);for(;;){let r=!1;for(let s of i)s.between(t.from-1,t.from+1,(o,l,a)=>{t.from>o&&t.from<l&&(t=e.from>t.from?xe.cursor(o,1):xe.cursor(l,-1),r=!0)});if(!r)return t}}class i8{constructor(e){this.lastKeyCode=0,this.lastKeyTime=0,this.pendingIOSKey=void 0,this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastEscPress=0,this.lastContextMenu=0,this.scrollHandlers=[],this.registeredEvents=[],this.customHandlers=[],this.composing=-1,this.compositionFirstChange=null,this.compositionEndedAt=0,this.rapidCompositionStart=!1,this.mouseSelection=null;for(let t in Zt){let i=Zt[t];e.contentDOM.addEventListener(t,r=>{!NC(e,r)||this.ignoreDuringComposition(r)||t=="keydown"&&this.keydown(e,r)||(this.mustFlushObserver(r)&&e.observer.forceFlush(),this.runCustomHandlers(t,e,r)?r.preventDefault():i(e,r))}),this.registeredEvents.push(t)}this.notifiedFocused=e.hasFocus,this.ensureHandlers(e),ge.safari&&e.contentDOM.addEventListener("input",()=>null)}setSelectionOrigin(e){this.lastSelectionOrigin=e,this.lastSelectionTime=Date.now()}ensureHandlers(e){let t=this.customHandlers=e.pluginField(pC);for(let i of t)for(let r in i.handlers)this.registeredEvents.indexOf(r)<0&&r!="scroll"&&(this.registeredEvents.push(r),e.contentDOM.addEventListener(r,s=>{!NC(e,s)||this.runCustomHandlers(r,e,s)&&s.preventDefault()}))}runCustomHandlers(e,t,i){for(let r of this.customHandlers){let s=r.handlers[e];if(s)try{if(s.call(r.plugin,i,t)||i.defaultPrevented)return!0}catch(o){ws(t.state,o)}}return!1}runScrollHandlers(e,t){for(let i of this.customHandlers){let r=i.handlers.scroll;if(r)try{r.call(i.plugin,t,e)}catch(s){ws(e.state,s)}}}keydown(e,t){if(this.lastKeyCode=t.keyCode,this.lastKeyTime=Date.now(),t.keyCode==9&&Date.now()<this.lastEscPress+2e3)return!0;if(ge.android&&ge.chrome&&!t.synthetic&&(t.keyCode==13||t.keyCode==8))return e.observer.delayAndroidKey(t.key,t.keyCode),!0;let i;return ge.ios&&(i=LC.find(r=>r.keyCode==t.keyCode))&&!(t.ctrlKey||t.altKey||t.metaKey)&&!t.synthetic?(this.pendingIOSKey=i,setTimeout(()=>this.flushIOSKey(e),250),!0):!1}flushIOSKey(e){let t=this.pendingIOSKey;return t?(this.pendingIOSKey=void 0,Ma(e.contentDOM,t.key,t.keyCode)):!1}ignoreDuringComposition(e){return/^key/.test(e.type)?this.composing>0?!0:ge.safari&&Date.now()-this.compositionEndedAt<500?(this.compositionEndedAt=0,!0):!1:!1}mustFlushObserver(e){return e.type=="keydown"&&e.keyCode!=229||e.type=="compositionend"&&!ge.ios}startMouseSelection(e){this.mouseSelection&&this.mouseSelection.destroy(),this.mouseSelection=e}update(e){this.mouseSelection&&this.mouseSelection.update(e),e.transactions.length&&(this.lastKeyCode=this.lastSelectionTime=0)}destroy(){this.mouseSelection&&this.mouseSelection.destroy()}}const LC=[{key:"Backspace",keyCode:8,inputType:"deleteContentBackward"},{key:"Enter",keyCode:13,inputType:"insertParagraph"},{key:"Delete",keyCode:46,inputType:"deleteContentForward"}],FC=[16,17,18,20,91,92,224,225];class n8{constructor(e,t,i,r){this.view=e,this.style=i,this.mustSelect=r,this.lastEvent=t;let s=e.contentDOM.ownerDocument;s.addEventListener("mousemove",this.move=this.move.bind(this)),s.addEventListener("mouseup",this.up=this.up.bind(this)),this.extend=t.shiftKey,this.multiple=e.state.facet(Ge.allowMultipleSelections)&&r8(e,t),this.dragMove=s8(e,t),this.dragging=o8(e,t)&&Rg(t)==1?null:!1,this.dragging===!1&&(t.preventDefault(),this.select(t))}move(e){if(e.buttons==0)return this.destroy();this.dragging===!1&&this.select(this.lastEvent=e)}up(e){this.dragging==null&&this.select(this.lastEvent),this.dragging||e.preventDefault(),this.destroy()}destroy(){let e=this.view.contentDOM.ownerDocument;e.removeEventListener("mousemove",this.move),e.removeEventListener("mouseup",this.up),this.view.inputState.mouseSelection=null}select(e){let t=this.style.get(e,this.extend,this.multiple);(this.mustSelect||!t.eq(this.view.state.selection)||t.main.assoc!=this.view.state.selection.main.assoc)&&this.view.dispatch({selection:t,userEvent:"select.pointer",scrollIntoView:!0}),this.mustSelect=!1}update(e){e.docChanged&&this.dragging&&(this.dragging=this.dragging.map(e.changes)),this.style.update(e)&&setTimeout(()=>this.select(this.lastEvent),20)}}function r8(n,e){let t=n.state.facet(lC);return t.length?t[0](e):ge.mac?e.metaKey:e.ctrlKey}function s8(n,e){let t=n.state.facet(aC);return t.length?t[0](e):ge.mac?!e.altKey:!e.ctrlKey}function o8(n,e){let{main:t}=n.state.selection;if(t.empty)return!1;let i=lu(n.root);if(i.rangeCount==0)return!0;let r=i.getRangeAt(0).getClientRects();for(let s=0;s<r.length;s++){let o=r[s];if(o.left<=e.clientX&&o.right>=e.clientX&&o.top<=e.clientY&&o.bottom>=e.clientY)return!0}return!1}function NC(n,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let t=e.target,i;t!=n.contentDOM;t=t.parentNode)if(!t||t.nodeType==11||(i=Mt.get(t))&&i.ignoreEvent(e))return!1;return!0}const Zt=Object.create(null),IC=ge.ie&&ge.ie_version<15||ge.ios&&ge.webkit_version<604;function l8(n){let e=n.dom.parentNode;if(!e)return;let t=e.appendChild(document.createElement("textarea"));t.style.cssText="position: fixed; left: -10000px; top: 10px",t.focus(),setTimeout(()=>{n.focus(),t.remove(),WC(n,t.value)},50)}function WC(n,e){let{state:t}=n,i,r=1,s=t.toText(e),o=s.lines==t.selection.ranges.length;if(Lg!=null&&t.selection.ranges.every(a=>a.empty)&&Lg==s.toString()){let a=-1;i=t.changeByRange(h=>{let c=t.doc.lineAt(h.from);if(c.from==a)return{range:h};a=c.from;let u=t.toText((o?s.line(r++).text:e)+t.lineBreak);return{changes:{from:c.from,insert:u},range:xe.cursor(h.from+u.length)}})}else o?i=t.changeByRange(a=>{let h=s.line(r++);return{changes:{from:a.from,to:a.to,insert:h.text},range:xe.cursor(a.from+h.length)}}):i=t.replaceSelection(s);n.dispatch(i,{userEvent:"input.paste",scrollIntoView:!0})}Zt.keydown=(n,e)=>{n.inputState.setSelectionOrigin("select"),e.keyCode==27?n.inputState.lastEscPress=Date.now():FC.indexOf(e.keyCode)<0&&(n.inputState.lastEscPress=0)};let VC=0;Zt.touchstart=(n,e)=>{VC=Date.now(),n.inputState.setSelectionOrigin("select.pointer")},Zt.touchmove=n=>{n.inputState.setSelectionOrigin("select.pointer")},Zt.mousedown=(n,e)=>{if(n.observer.flush(),VC>Date.now()-2e3&&Rg(e)==1)return;let t=null;for(let i of n.state.facet(hC))if(t=i(n,e),t)break;if(!t&&e.button==0&&(t=c8(n,e)),t){let i=n.root.activeElement!=n.contentDOM;i&&n.observer.ignore(()=>zk(n.contentDOM)),n.inputState.startMouseSelection(new n8(n,e,t,i))}};function HC(n,e,t,i){if(i==1)return xe.cursor(e,t);if(i==2)return JW(n.state,e,t);{let r=Ni.find(n.docView,e),s=n.state.doc.lineAt(r?r.posAtEnd:e),o=r?r.posAtStart:s.from,l=r?r.posAtEnd:s.to;return l<n.state.doc.length&&l==s.to&&l++,xe.range(o,l)}}let zC=(n,e)=>n>=e.top&&n<=e.bottom,jC=(n,e,t)=>zC(e,t)&&n>=t.left&&n<=t.right;function a8(n,e,t,i){let r=Ni.find(n.docView,e);if(!r)return 1;let s=e-r.posAtStart;if(s==0)return 1;if(s==r.length)return-1;let o=r.coordsAt(s,-1);if(o&&jC(t,i,o))return-1;let l=r.coordsAt(s,1);return l&&jC(t,i,l)?1:o&&zC(i,o)?-1:1}function $C(n,e){let t=n.posAtCoords({x:e.clientX,y:e.clientY},!1);return{pos:t,bias:a8(n,t,e.clientX,e.clientY)}}const h8=ge.ie&&ge.ie_version<=11;let UC=null,qC=0,KC=0;function Rg(n){if(!h8)return n.detail;let e=UC,t=KC;return UC=n,KC=Date.now(),qC=!e||t>Date.now()-400&&Math.abs(e.clientX-n.clientX)<2&&Math.abs(e.clientY-n.clientY)<2?(qC+1)%3:1}function c8(n,e){let t=$C(n,e),i=Rg(e),r=n.state.selection,s=t,o=e;return{update(l){l.docChanged&&(t&&(t.pos=l.changes.mapPos(t.pos)),r=r.map(l.changes),o=null)},get(l,a,h){let c;if(o&&l.clientX==o.clientX&&l.clientY==o.clientY?c=s:(c=s=$C(n,l),o=l),!c||!t)return r;let u=HC(n,c.pos,c.bias,i);if(t.pos!=c.pos&&!a){let f=HC(n,t.pos,t.bias,i),d=Math.min(f.from,u.from),p=Math.max(f.to,u.to);u=d<u.from?xe.range(d,p):xe.range(p,d)}return a?r.replaceRange(r.main.extend(u.from,u.to)):h?r.addRange(u):xe.create([u])}}}Zt.dragstart=(n,e)=>{let{selection:{main:t}}=n.state,{mouseSelection:i}=n.inputState;i&&(i.dragging=t),e.dataTransfer&&(e.dataTransfer.setData("Text",n.state.sliceDoc(t.from,t.to)),e.dataTransfer.effectAllowed="copyMove")};function GC(n,e,t,i){if(!t)return;let r=n.posAtCoords({x:e.clientX,y:e.clientY},!1);e.preventDefault();let{mouseSelection:s}=n.inputState,o=i&&s&&s.dragging&&s.dragMove?{from:s.dragging.from,to:s.dragging.to}:null,l={from:r,insert:t},a=n.state.changes(o?[o,l]:l);n.focus(),n.dispatch({changes:a,selection:{anchor:a.mapPos(r,-1),head:a.mapPos(r,1)},userEvent:o?"move.drop":"input.drop"})}Zt.drop=(n,e)=>{if(!e.dataTransfer)return;if(n.state.readOnly)return e.preventDefault();let t=e.dataTransfer.files;if(t&&t.length){e.preventDefault();let i=Array(t.length),r=0,s=()=>{++r==t.length&&GC(n,e,i.filter(o=>o!=null).join(n.state.lineBreak),!1)};for(let o=0;o<t.length;o++){let l=new FileReader;l.onerror=s,l.onload=()=>{/[\x00-\x08\x0e-\x1f]{2}/.test(l.result)||(i[o]=l.result),s()},l.readAsText(t[o])}}else GC(n,e,e.dataTransfer.getData("Text"),!0)},Zt.paste=(n,e)=>{if(n.state.readOnly)return e.preventDefault();n.observer.flush();let t=IC?null:e.clipboardData;t?(WC(n,t.getData("text/plain")),e.preventDefault()):l8(n)};function u8(n,e){let t=n.dom.parentNode;if(!t)return;let i=t.appendChild(document.createElement("textarea"));i.style.cssText="position: fixed; left: -10000px; top: 10px",i.value=e,i.focus(),i.selectionEnd=e.length,i.selectionStart=0,setTimeout(()=>{i.remove(),n.focus()},50)}function f8(n){let e=[],t=[],i=!1;for(let r of n.selection.ranges)r.empty||(e.push(n.sliceDoc(r.from,r.to)),t.push(r));if(!e.length){let r=-1;for(let{from:s}of n.selection.ranges){let o=n.doc.lineAt(s);o.number>r&&(e.push(o.text),t.push({from:o.from,to:Math.min(n.doc.length,o.to+1)})),r=o.number}i=!0}return{text:e.join(n.lineBreak),ranges:t,linewise:i}}let Lg=null;Zt.copy=Zt.cut=(n,e)=>{let{text:t,ranges:i,linewise:r}=f8(n.state);if(!t&&!r)return;Lg=r?t:null;let s=IC?null:e.clipboardData;s?(e.preventDefault(),s.clearData(),s.setData("text/plain",t)):u8(n,t),e.type=="cut"&&!n.state.readOnly&&n.dispatch({changes:i,scrollIntoView:!0,userEvent:"delete.cut"})},Zt.focus=Zt.blur=n=>{setTimeout(()=>{n.hasFocus!=n.inputState.notifiedFocused&&n.update([])},10)};function JC(n,e){if(n.docView.compositionDeco.size){n.inputState.rapidCompositionStart=e;try{n.update([])}finally{n.inputState.rapidCompositionStart=!1}}}Zt.compositionstart=Zt.compositionupdate=n=>{n.inputState.compositionFirstChange==null&&(n.inputState.compositionFirstChange=!0),n.inputState.composing<0&&(n.inputState.composing=0,n.docView.compositionDeco.size&&(n.observer.flush(),JC(n,!0)))},Zt.compositionend=n=>{n.inputState.composing=-1,n.inputState.compositionEndedAt=Date.now(),n.inputState.compositionFirstChange=null,setTimeout(()=>{n.inputState.composing<0&&JC(n,!1)},50)},Zt.contextmenu=n=>{n.inputState.lastContextMenu=Date.now()},Zt.beforeinput=(n,e)=>{var t;let i;if(ge.chrome&&ge.android&&(i=LC.find(r=>r.inputType==e.inputType))&&(n.observer.delayAndroidKey(i.key,i.keyCode),i.key=="Backspace"||i.key=="Delete")){let r=((t=window.visualViewport)===null||t===void 0?void 0:t.height)||0;setTimeout(()=>{var s;(((s=window.visualViewport)===null||s===void 0?void 0:s.height)||0)>r+10&&n.hasFocus&&(n.contentDOM.blur(),n.focus())},100)}};const ZC=["pre-wrap","normal","pre-line","break-spaces"];class YC{constructor(){this.doc=j.empty,this.lineWrapping=!1,this.direction=bi.LTR,this.heightSamples={},this.lineHeight=14,this.charWidth=7,this.lineLength=30,this.heightChanged=!1}heightForGap(e,t){let i=this.doc.lineAt(t).number-this.doc.lineAt(e).number+1;return this.lineWrapping&&(i+=Math.ceil((t-e-i*this.lineLength*.5)/this.lineLength)),this.lineHeight*i}heightForLine(e){return this.lineWrapping?(1+Math.max(0,Math.ceil((e-this.lineLength)/(this.lineLength-5))))*this.lineHeight:this.lineHeight}setDoc(e){return this.doc=e,this}mustRefreshForStyle(e,t){return ZC.indexOf(e)>-1!=this.lineWrapping||this.direction!=t}mustRefreshForHeights(e){let t=!1;for(let i=0;i<e.length;i++){let r=e[i];r<0?i++:this.heightSamples[Math.floor(r*10)]||(t=!0,this.heightSamples[Math.floor(r*10)]=!0)}return t}refresh(e,t,i,r,s,o){let l=ZC.indexOf(e)>-1,a=Math.round(i)!=Math.round(this.lineHeight)||this.lineWrapping!=l||this.direction!=t;if(this.lineWrapping=l,this.direction=t,this.lineHeight=i,this.charWidth=r,this.lineLength=s,a){this.heightSamples={};for(let h=0;h<o.length;h++){let c=o[h];c<0?h++:this.heightSamples[Math.floor(c*10)]=!0}}return a}}class XC{constructor(e,t){this.from=e,this.heights=t,this.index=0}get more(){return this.index<this.heights.length}}class Rr{constructor(e,t,i,r,s){this.from=e,this.length=t,this.top=i,this.height=r,this.type=s}get to(){return this.from+this.length}get bottom(){return this.top+this.height}join(e){let t=(Array.isArray(this.type)?this.type:[this]).concat(Array.isArray(e.type)?e.type:[e]);return new Rr(this.from,this.length+e.length,this.top,this.height+e.height,t)}moveY(e){return e?new Rr(this.from,this.length,this.top+e,this.height,Array.isArray(this.type)?this.type.map(t=>t.moveY(e)):this.type):this}}var it=function(n){return n[n.ByPos=0]="ByPos",n[n.ByHeight=1]="ByHeight",n[n.ByPosNoHeight=2]="ByPosNoHeight",n}(it||(it={}));const mu=.001;class Ii{constructor(e,t,i=2){this.length=e,this.height=t,this.flags=i}get outdated(){return(this.flags&2)>0}set outdated(e){this.flags=(e?2:0)|this.flags&-3}setHeight(e,t){this.height!=t&&(Math.abs(this.height-t)>mu&&(e.heightChanged=!0),this.height=t)}replace(e,t,i){return Ii.of(i)}decomposeLeft(e,t){t.push(this)}decomposeRight(e,t){t.push(this)}applyChanges(e,t,i,r){let s=this;for(let o=r.length-1;o>=0;o--){let{fromA:l,toA:a,fromB:h,toB:c}=r[o],u=s.lineAt(l,it.ByPosNoHeight,t,0,0),f=u.to>=a?u:s.lineAt(a,it.ByPosNoHeight,t,0,0);for(c+=f.to-a,a=f.to;o>0&&u.from<=r[o-1].toA;)l=r[o-1].fromA,h=r[o-1].fromB,o--,l<u.from&&(u=s.lineAt(l,it.ByPosNoHeight,t,0,0));h+=u.from-l,l=u.from;let d=Fg.build(i,e,h,c);s=s.replace(l,a,d)}return s.updateHeight(i,0)}static empty(){return new cn(0,0)}static of(e){if(e.length==1)return e[0];let t=0,i=e.length,r=0,s=0;for(;;)if(t==i)if(r>s*2){let l=e[t-1];l.break?e.splice(--t,1,l.left,null,l.right):e.splice(--t,1,l.left,l.right),i+=1+l.break,r-=l.size}else if(s>r*2){let l=e[i];l.break?e.splice(i,1,l.left,null,l.right):e.splice(i,1,l.left,l.right),i+=2+l.break,s-=l.size}else break;else if(r<s){let l=e[t++];l&&(r+=l.size)}else{let l=e[--i];l&&(s+=l.size)}let o=0;return e[t-1]==null?(o=1,t--):e[t]==null&&(o=1,i++),new d8(Ii.of(e.slice(0,t)),o,Ii.of(e.slice(i)))}}Ii.prototype.size=1;class QC extends Ii{constructor(e,t,i){super(e,t),this.type=i}blockAt(e,t,i,r){return new Rr(r,this.length,i,this.height,this.type)}lineAt(e,t,i,r,s){return this.blockAt(0,i,r,s)}forEachLine(e,t,i,r,s,o){o(this.blockAt(0,i,r,s))}updateHeight(e,t=0,i=!1,r){return r&&r.from<=t&&r.more&&this.setHeight(e,r.heights[r.index++]),this.outdated=!1,this}toString(){return`block(${this.length})`}}class cn extends QC{constructor(e,t){super(e,t,pt.Text),this.collapsed=0,this.widgetHeight=0}replace(e,t,i){let r=i[0];return i.length==1&&(r instanceof cn||r instanceof pi&&r.flags&4)&&Math.abs(this.length-r.length)<10?(r instanceof pi?r=new cn(r.length,this.height):r.height=this.height,this.outdated||(r.outdated=!1),r):Ii.of(i)}updateHeight(e,t=0,i=!1,r){return r&&r.from<=t&&r.more?this.setHeight(e,r.heights[r.index++]):(i||this.outdated)&&this.setHeight(e,Math.max(this.widgetHeight,e.heightForLine(this.length-this.collapsed))),this.outdated=!1,this}toString(){return`line(${this.length}${this.collapsed?-this.collapsed:""}${this.widgetHeight?":"+this.widgetHeight:""})`}}class pi extends Ii{constructor(e){super(e,0)}lines(e,t){let i=e.lineAt(t).number,r=e.lineAt(t+this.length).number;return{firstLine:i,lastLine:r,lineHeight:this.height/(r-i+1)}}blockAt(e,t,i,r){let{firstLine:s,lastLine:o,lineHeight:l}=this.lines(t,r),a=Math.max(0,Math.min(o-s,Math.floor((e-i)/l))),{from:h,length:c}=t.line(s+a);return new Rr(h,c,i+l*a,l,pt.Text)}lineAt(e,t,i,r,s){if(t==it.ByHeight)return this.blockAt(e,i,r,s);if(t==it.ByPosNoHeight){let{from:u,to:f}=i.lineAt(e);return new Rr(u,f-u,0,0,pt.Text)}let{firstLine:o,lineHeight:l}=this.lines(i,s),{from:a,length:h,number:c}=i.lineAt(e);return new Rr(a,h,r+l*(c-o),l,pt.Text)}forEachLine(e,t,i,r,s,o){let{firstLine:l,lineHeight:a}=this.lines(i,s);for(let h=Math.max(e,s),c=Math.min(s+this.length,t);h<=c;){let u=i.lineAt(h);h==e&&(r+=a*(u.number-l)),o(new Rr(u.from,u.length,r,a,pt.Text)),r+=a,h=u.to+1}}replace(e,t,i){let r=this.length-t;if(r>0){let s=i[i.length-1];s instanceof pi?i[i.length-1]=new pi(s.length+r):i.push(null,new pi(r-1))}if(e>0){let s=i[0];s instanceof pi?i[0]=new pi(e+s.length):i.unshift(new pi(e-1),null)}return Ii.of(i)}decomposeLeft(e,t){t.push(new pi(e-1),null)}decomposeRight(e,t){t.push(null,new pi(this.length-e-1))}updateHeight(e,t=0,i=!1,r){let s=t+this.length;if(r&&r.from<=t+this.length&&r.more){let o=[],l=Math.max(t,r.from),a=-1,h=e.heightChanged;for(r.from>t&&o.push(new pi(r.from-t-1).updateHeight(e,t));l<=s&&r.more;){let u=e.doc.lineAt(l).length;o.length&&o.push(null);let f=r.heights[r.index++];a==-1?a=f:Math.abs(f-a)>=mu&&(a=-2);let d=new cn(u,f);d.outdated=!1,o.push(d),l+=u+1}l<=s&&o.push(null,new pi(s-l).updateHeight(e,l));let c=Ii.of(o);return e.heightChanged=h||a<0||Math.abs(c.height-this.height)>=mu||Math.abs(a-this.lines(e.doc,t).lineHeight)>=mu,c}else(i||this.outdated)&&(this.setHeight(e,e.heightForGap(t,t+this.length)),this.outdated=!1);return this}toString(){return`gap(${this.length})`}}class d8 extends Ii{constructor(e,t,i){super(e.length+t+i.length,e.height+i.height,t|(e.outdated||i.outdated?2:0)),this.left=e,this.right=i,this.size=e.size+i.size}get break(){return this.flags&1}blockAt(e,t,i,r){let s=i+this.left.height;return e<s?this.left.blockAt(e,t,i,r):this.right.blockAt(e,t,s,r+this.left.length+this.break)}lineAt(e,t,i,r,s){let o=r+this.left.height,l=s+this.left.length+this.break,a=t==it.ByHeight?e<o:e<l,h=a?this.left.lineAt(e,t,i,r,s):this.right.lineAt(e,t,i,o,l);if(this.break||(a?h.to<l:h.from>l))return h;let c=t==it.ByPosNoHeight?it.ByPosNoHeight:it.ByPos;return a?h.join(this.right.lineAt(l,c,i,o,l)):this.left.lineAt(l,c,i,r,s).join(h)}forEachLine(e,t,i,r,s,o){let l=r+this.left.height,a=s+this.left.length+this.break;if(this.break)e<a&&this.left.forEachLine(e,t,i,r,s,o),t>=a&&this.right.forEachLine(e,t,i,l,a,o);else{let h=this.lineAt(a,it.ByPos,i,r,s);e<h.from&&this.left.forEachLine(e,h.from-1,i,r,s,o),h.to>=e&&h.from<=t&&o(h),t>h.to&&this.right.forEachLine(h.to+1,t,i,l,a,o)}}replace(e,t,i){let r=this.left.length+this.break;if(t<r)return this.balanced(this.left.replace(e,t,i),this.right);if(e>this.left.length)return this.balanced(this.left,this.right.replace(e-r,t-r,i));let s=[];e>0&&this.decomposeLeft(e,s);let o=s.length;for(let l of i)s.push(l);if(e>0&&eA(s,o-1),t<this.length){let l=s.length;this.decomposeRight(t,s),eA(s,l)}return Ii.of(s)}decomposeLeft(e,t){let i=this.left.length;if(e<=i)return this.left.decomposeLeft(e,t);t.push(this.left),this.break&&(i++,e>=i&&t.push(null)),e>i&&this.right.decomposeLeft(e-i,t)}decomposeRight(e,t){let i=this.left.length,r=i+this.break;if(e>=r)return this.right.decomposeRight(e-r,t);e<i&&this.left.decomposeRight(e,t),this.break&&e<r&&t.push(null),t.push(this.right)}balanced(e,t){return e.size>2*t.size||t.size>2*e.size?Ii.of(this.break?[e,null,t]:[e,t]):(this.left=e,this.right=t,this.height=e.height+t.height,this.outdated=e.outdated||t.outdated,this.size=e.size+t.size,this.length=e.length+this.break+t.length,this)}updateHeight(e,t=0,i=!1,r){let{left:s,right:o}=this,l=t+s.length+this.break,a=null;return r&&r.from<=t+s.length&&r.more?a=s=s.updateHeight(e,t,i,r):s.updateHeight(e,t,i),r&&r.from<=l+o.length&&r.more?a=o=o.updateHeight(e,l,i,r):o.updateHeight(e,l,i),a?this.balanced(s,o):(this.height=this.left.height+this.right.height,this.outdated=!1,this)}toString(){return this.left+(this.break?" ":"-")+this.right}}function eA(n,e){let t,i;n[e]==null&&(t=n[e-1])instanceof pi&&(i=n[e+1])instanceof pi&&n.splice(e-1,3,new pi(t.length+1+i.length))}const p8=5;class Fg{constructor(e,t){this.pos=e,this.oracle=t,this.nodes=[],this.lineStart=-1,this.lineEnd=-1,this.covering=null,this.writtenTo=e}get isCovered(){return this.covering&&this.nodes[this.nodes.length-1]==this.covering}span(e,t){if(this.lineStart>-1){let i=Math.min(t,this.lineEnd),r=this.nodes[this.nodes.length-1];r instanceof cn?r.length+=i-this.pos:(i>this.pos||!this.isCovered)&&this.nodes.push(new cn(i-this.pos,-1)),this.writtenTo=i,t>i&&(this.nodes.push(null),this.writtenTo++,this.lineStart=-1)}this.pos=t}point(e,t,i){if(e<t||i.heightRelevant){let r=i.widget?i.widget.estimatedHeight:0;r<0&&(r=this.oracle.lineHeight);let s=t-e;i.block?this.addBlock(new QC(s,r,i.type)):(s||r>=p8)&&this.addLineDeco(r,s)}else t>e&&this.span(e,t);this.lineEnd>-1&&this.lineEnd<this.pos&&(this.lineEnd=this.oracle.doc.lineAt(this.pos).to)}enterLine(){if(this.lineStart>-1)return;let{from:e,to:t}=this.oracle.doc.lineAt(this.pos);this.lineStart=e,this.lineEnd=t,this.writtenTo<e&&((this.writtenTo<e-1||this.nodes[this.nodes.length-1]==null)&&this.nodes.push(this.blankContent(this.writtenTo,e-1)),this.nodes.push(null)),this.pos>e&&this.nodes.push(new cn(this.pos-e,-1)),this.writtenTo=this.pos}blankContent(e,t){let i=new pi(t-e);return this.oracle.doc.lineAt(e).to==t&&(i.flags|=4),i}ensureLine(){this.enterLine();let e=this.nodes.length?this.nodes[this.nodes.length-1]:null;if(e instanceof cn)return e;let t=new cn(0,-1);return this.nodes.push(t),t}addBlock(e){this.enterLine(),e.type==pt.WidgetAfter&&!this.isCovered&&this.ensureLine(),this.nodes.push(e),this.writtenTo=this.pos=this.pos+e.length,e.type!=pt.WidgetBefore&&(this.covering=e)}addLineDeco(e,t){let i=this.ensureLine();i.length+=t,i.collapsed+=t,i.widgetHeight=Math.max(i.widgetHeight,e),this.writtenTo=this.pos=this.pos+t}finish(e){let t=this.nodes.length==0?null:this.nodes[this.nodes.length-1];this.lineStart>-1&&!(t instanceof cn)&&!this.isCovered?this.nodes.push(new cn(0,-1)):(this.writtenTo<this.pos||t==null)&&this.nodes.push(this.blankContent(this.writtenTo,this.pos));let i=e;for(let r of this.nodes)r instanceof cn&&r.updateHeight(this.oracle,i),i+=r?r.length:1;return this.nodes}static build(e,t,i,r){let s=new Fg(i,e);return Te.spans(t,i,r,s,0),s.finish(i)}}function m8(n,e,t){let i=new g8;return Te.compare(n,e,t,i,0),i.changes}class g8{constructor(){this.changes=[]}compareRange(){}comparePoint(e,t,i,r){(e<t||i&&i.heightRelevant||r&&r.heightRelevant)&&kg(e,t,this.changes,5)}}function y8(n,e){let t=n.getBoundingClientRect(),i=Math.max(0,t.left),r=Math.min(innerWidth,t.right),s=Math.max(0,t.top),o=Math.min(innerHeight,t.bottom),l=n.ownerDocument.body;for(let a=n.parentNode;a&&a!=l;)if(a.nodeType==1){let h=a,c=window.getComputedStyle(h);if((h.scrollHeight>h.clientHeight||h.scrollWidth>h.clientWidth)&&c.overflow!="visible"){let u=h.getBoundingClientRect();i=Math.max(i,u.left),r=Math.min(r,u.right),s=Math.max(s,u.top),o=Math.min(o,u.bottom)}a=c.position=="absolute"||c.position=="fixed"?h.offsetParent:h.parentNode}else if(a.nodeType==11)a=a.host;else break;return{left:i-t.left,right:Math.max(i,r)-t.left,top:s-(t.top+e),bottom:Math.max(s,o)-(t.top+e)}}function v8(n,e){let t=n.getBoundingClientRect();return{left:0,right:t.right-t.left,top:e,bottom:t.bottom-(t.top+e)}}class Ng{constructor(e,t,i){this.from=e,this.to=t,this.size=i}static same(e,t){if(e.length!=t.length)return!1;for(let i=0;i<e.length;i++){let r=e[i],s=t[i];if(r.from!=s.from||r.to!=s.to||r.size!=s.size)return!1}return!0}draw(e){return ct.replace({widget:new w8(this.size,e)}).range(this.from,this.to)}}class w8 extends fu{constructor(e,t){super(),this.size=e,this.vertical=t}eq(e){return e.size==this.size&&e.vertical==this.vertical}toDOM(){let e=document.createElement("div");return this.vertical?e.style.height=this.size+"px":(e.style.width=this.size+"px",e.style.height="2px",e.style.display="inline-block"),e}get estimatedHeight(){return this.vertical?this.size:-1}}class tA{constructor(e){this.state=e,this.pixelViewport={left:0,right:window.innerWidth,top:0,bottom:0},this.inView=!0,this.paddingTop=0,this.paddingBottom=0,this.contentDOMWidth=0,this.contentDOMHeight=0,this.editorHeight=0,this.editorWidth=0,this.heightOracle=new YC,this.scaler=rA,this.scrollTarget=null,this.printing=!1,this.mustMeasureContent=!0,this.visibleRanges=[],this.mustEnforceCursorAssoc=!1,this.heightMap=Ii.empty().applyChanges(e.facet(fo),j.empty,this.heightOracle.setDoc(e.doc),[new er(0,0,0,e.doc.length)]),this.viewport=this.getViewport(0,null),this.updateViewportLines(),this.updateForViewport(),this.lineGaps=this.ensureLineGaps([]),this.lineGapDeco=ct.set(this.lineGaps.map(t=>t.draw(!1))),this.computeVisibleRanges()}updateForViewport(){let e=[this.viewport],{main:t}=this.state.selection;for(let i=0;i<=1;i++){let r=i?t.head:t.anchor;if(!e.some(({from:s,to:o})=>r>=s&&r<=o)){let{from:s,to:o}=this.lineBlockAt(r);e.push(new gu(s,o))}}this.viewports=e.sort((i,r)=>i.from-r.from),this.scaler=this.heightMap.height<=7e6?rA:new S8(this.heightOracle.doc,this.heightMap,this.viewports)}updateViewportLines(){this.viewportLines=[],this.heightMap.forEachLine(this.viewport.from,this.viewport.to,this.state.doc,0,0,e=>{this.viewportLines.push(this.scaler.scale==1?e:Ra(e,this.scaler))})}update(e,t=null){let i=this.state;this.state=e.state;let r=this.state.facet(fo),s=e.changedRanges,o=er.extendWithRanges(s,m8(e.startState.facet(fo),r,e?e.changes:fi.empty(this.state.doc.length))),l=this.heightMap.height;this.heightMap=this.heightMap.applyChanges(r,i.doc,this.heightOracle.setDoc(this.state.doc),o),this.heightMap.height!=l&&(e.flags|=2);let a=o.length?this.mapViewport(this.viewport,e.changes):this.viewport;(t&&(t.range.head<a.from||t.range.head>a.to)||!this.viewportIsAppropriate(a))&&(a=this.getViewport(0,t));let h=!e.changes.empty||e.flags&2||a.from!=this.viewport.from||a.to!=this.viewport.to;this.viewport=a,this.updateForViewport(),h&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(this.mapLineGaps(this.lineGaps,e.changes))),e.flags|=this.computeVisibleRanges(),t&&(this.scrollTarget=t),!this.mustEnforceCursorAssoc&&e.selectionSet&&e.view.lineWrapping&&e.state.selection.main.empty&&e.state.selection.main.assoc&&(this.mustEnforceCursorAssoc=!0)}measure(e){let t=e.contentDOM,i=window.getComputedStyle(t),r=this.heightOracle,s=i.whiteSpace,o=i.direction=="rtl"?bi.RTL:bi.LTR,l=this.heightOracle.mustRefreshForStyle(s,o),a=l||this.mustMeasureContent||this.contentDOMHeight!=t.clientHeight,h=0,c=0;if(this.editorWidth!=e.scrollDOM.clientWidth&&(r.lineWrapping&&(a=!0),this.editorWidth=e.scrollDOM.clientWidth,h|=8),a){this.mustMeasureContent=!1,this.contentDOMHeight=t.clientHeight;let v=parseInt(i.paddingTop)||0,C=parseInt(i.paddingBottom)||0;(this.paddingTop!=v||this.paddingBottom!=C)&&(h|=8,this.paddingTop=v,this.paddingBottom=C)}let u=(this.printing?v8:y8)(t,this.paddingTop),f=u.top-this.pixelViewport.top,d=u.bottom-this.pixelViewport.bottom;this.pixelViewport=u;let p=this.pixelViewport.bottom>this.pixelViewport.top&&this.pixelViewport.right>this.pixelViewport.left;if(p!=this.inView&&(this.inView=p,p&&(a=!0)),!this.inView)return 0;let g=t.clientWidth;if((this.contentDOMWidth!=g||this.editorHeight!=e.scrollDOM.clientHeight)&&(this.contentDOMWidth=g,this.editorHeight=e.scrollDOM.clientHeight,h|=8),a){let v=e.docView.measureVisibleLineHeights();if(r.mustRefreshForHeights(v)&&(l=!0),l||r.lineWrapping&&Math.abs(g-this.contentDOMWidth)>r.charWidth){let{lineHeight:C,charWidth:x}=e.docView.measureTextSize();l=r.refresh(s,o,C,x,g/x,v),l&&(e.docView.minWidth=0,h|=8)}f>0&&d>0?c=Math.max(f,d):f<0&&d<0&&(c=Math.min(f,d)),r.heightChanged=!1,this.heightMap=this.heightMap.updateHeight(r,0,l,new XC(this.viewport.from,v)),r.heightChanged&&(h|=2)}let y=!this.viewportIsAppropriate(this.viewport,c)||this.scrollTarget&&(this.scrollTarget.range.head<this.viewport.from||this.scrollTarget.range.head>this.viewport.to);return y&&(this.viewport=this.getViewport(c,this.scrollTarget)),this.updateForViewport(),(h&2||y)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(l?[]:this.lineGaps)),h|=this.computeVisibleRanges(),this.mustEnforceCursorAssoc&&(this.mustEnforceCursorAssoc=!1,e.docView.enforceCursorAssoc()),h}get visibleTop(){return this.scaler.fromDOM(this.pixelViewport.top)}get visibleBottom(){return this.scaler.fromDOM(this.pixelViewport.bottom)}getViewport(e,t){let i=.5-Math.max(-.5,Math.min(.5,e/1e3/2)),r=this.heightMap,s=this.state.doc,{visibleTop:o,visibleBottom:l}=this,a=new gu(r.lineAt(o-i*1e3,it.ByHeight,s,0,0).from,r.lineAt(l+(1-i)*1e3,it.ByHeight,s,0,0).to);if(t){let{head:h}=t.range;if(h<a.from||h>a.to){let c=Math.min(this.editorHeight,this.pixelViewport.bottom-this.pixelViewport.top),u=r.lineAt(h,it.ByPos,s,0,0),f;t.y=="center"?f=(u.top+u.bottom)/2-c/2:t.y=="start"||t.y=="nearest"&&h<a.from?f=u.top:f=u.bottom-c,a=new gu(r.lineAt(f-1e3/2,it.ByHeight,s,0,0).from,r.lineAt(f+c+1e3/2,it.ByHeight,s,0,0).to)}}return a}mapViewport(e,t){let i=t.mapPos(e.from,-1),r=t.mapPos(e.to,1);return new gu(this.heightMap.lineAt(i,it.ByPos,this.state.doc,0,0).from,this.heightMap.lineAt(r,it.ByPos,this.state.doc,0,0).to)}viewportIsAppropriate({from:e,to:t},i=0){if(!this.inView)return!0;let{top:r}=this.heightMap.lineAt(e,it.ByPos,this.state.doc,0,0),{bottom:s}=this.heightMap.lineAt(t,it.ByPos,this.state.doc,0,0),{visibleTop:o,visibleBottom:l}=this;return(e==0||r<=o-Math.max(10,Math.min(-i,250)))&&(t==this.state.doc.length||s>=l+Math.max(10,Math.min(i,250)))&&r>o-2*1e3&&s<l+2*1e3}mapLineGaps(e,t){if(!e.length||t.empty)return e;let i=[];for(let r of e)t.touchesRange(r.from,r.to)||i.push(new Ng(t.mapPos(r.from),t.mapPos(r.to),r.size));return i}ensureLineGaps(e){let t=[];if(this.heightOracle.direction!=bi.LTR)return t;for(let i of this.viewportLines){if(i.length<4e3)continue;let r=b8(i.from,i.to,this.state);if(r.total<4e3)continue;let s,o;if(this.heightOracle.lineWrapping){let h=2e3/this.heightOracle.lineLength*this.heightOracle.lineHeight;s=yu(r,(this.visibleTop-i.top-h)/i.height),o=yu(r,(this.visibleBottom-i.top+h)/i.height)}else{let h=r.total*this.heightOracle.charWidth,c=2e3*this.heightOracle.charWidth;s=yu(r,(this.pixelViewport.left-c)/h),o=yu(r,(this.pixelViewport.right+c)/h)}let l=[];s>i.from&&l.push({from:i.from,to:s}),o<i.to&&l.push({from:o,to:i.to});let a=this.state.selection.main;a.from>=i.from&&a.from<=i.to&&nA(l,a.from-10,a.from+10),!a.empty&&a.to>=i.from&&a.to<=i.to&&nA(l,a.to-10,a.to+10);for(let{from:h,to:c}of l)c-h>1e3&&t.push(x8(e,u=>u.from>=i.from&&u.to<=i.to&&Math.abs(u.from-h)<1e3&&Math.abs(u.to-c)<1e3)||new Ng(h,c,this.gapSize(i,h,c,r)))}return t}gapSize(e,t,i,r){let s=iA(r,i)-iA(r,t);return this.heightOracle.lineWrapping?e.height*s:r.total*this.heightOracle.charWidth*s}updateLineGaps(e){Ng.same(e,this.lineGaps)||(this.lineGaps=e,this.lineGapDeco=ct.set(e.map(t=>t.draw(this.heightOracle.lineWrapping))))}computeVisibleRanges(){let e=this.state.facet(fo);this.lineGaps.length&&(e=e.concat(this.lineGapDeco));let t=[];Te.spans(e,this.viewport.from,this.viewport.to,{span(r,s){t.push({from:r,to:s})},point(){}},20);let i=t.length!=this.visibleRanges.length||this.visibleRanges.some((r,s)=>r.from!=t[s].from||r.to!=t[s].to);return this.visibleRanges=t,i?4:0}lineBlockAt(e){return e>=this.viewport.from&&e<=this.viewport.to&&this.viewportLines.find(t=>t.from<=e&&t.to>=e)||Ra(this.heightMap.lineAt(e,it.ByPos,this.state.doc,0,0),this.scaler)}lineBlockAtHeight(e){return Ra(this.heightMap.lineAt(this.scaler.fromDOM(e),it.ByHeight,this.state.doc,0,0),this.scaler)}elementAtHeight(e){return Ra(this.heightMap.blockAt(this.scaler.fromDOM(e),this.state.doc,0,0),this.scaler)}get docHeight(){return this.scaler.toDOM(this.heightMap.height)}get contentHeight(){return this.docHeight+this.paddingTop+this.paddingBottom}}class gu{constructor(e,t){this.from=e,this.to=t}}function b8(n,e,t){let i=[],r=n,s=0;return Te.spans(t.facet(fo),n,e,{span(){},point(o,l){o>r&&(i.push({from:r,to:o}),s+=o-r),r=l}},20),r<e&&(i.push({from:r,to:e}),s+=e-r),{total:s,ranges:i}}function yu({total:n,ranges:e},t){if(t<=0)return e[0].from;if(t>=1)return e[e.length-1].to;let i=Math.floor(n*t);for(let r=0;;r++){let{from:s,to:o}=e[r],l=o-s;if(i<=l)return s+i;i-=l}}function iA(n,e){let t=0;for(let{from:i,to:r}of n.ranges){if(e<=r){t+=e-i;break}t+=r-i}return t/n.total}function nA(n,e,t){for(let i=0;i<n.length;i++){let r=n[i];if(r.from<t&&r.to>e){let s=[];r.from<e&&s.push({from:r.from,to:e}),r.to>t&&s.push({from:t,to:r.to}),n.splice(i,1,...s),i+=s.length-1}}}function x8(n,e){for(let t of n)if(e(t))return t}const rA={toDOM(n){return n},fromDOM(n){return n},scale:1};class S8{constructor(e,t,i){let r=0,s=0,o=0;this.viewports=i.map(({from:l,to:a})=>{let h=t.lineAt(l,it.ByPos,e,0,0).top,c=t.lineAt(a,it.ByPos,e,0,0).bottom;return r+=c-h,{from:l,to:a,top:h,bottom:c,domTop:0,domBottom:0}}),this.scale=(7e6-r)/(t.height-r);for(let l of this.viewports)l.domTop=o+(l.top-s)*this.scale,o=l.domBottom=l.domTop+(l.bottom-l.top),s=l.bottom}toDOM(e){for(let t=0,i=0,r=0;;t++){let s=t<this.viewports.length?this.viewports[t]:null;if(!s||e<s.top)return r+(e-i)*this.scale;if(e<=s.bottom)return s.domTop+(e-s.top);i=s.bottom,r=s.domBottom}}fromDOM(e){for(let t=0,i=0,r=0;;t++){let s=t<this.viewports.length?this.viewports[t]:null;if(!s||e<s.domTop)return i+(e-r)/this.scale;if(e<=s.domBottom)return s.top+(e-s.domTop);i=s.bottom,r=s.domBottom}}}function Ra(n,e){if(e.scale==1)return n;let t=e.toDOM(n.top),i=e.toDOM(n.bottom);return new Rr(n.from,n.length,t,i-t,Array.isArray(n.type)?n.type.map(r=>Ra(r,e)):n.type)}const vu=Le.define({combine:n=>n.join(" ")}),Ig=Le.define({combine:n=>n.indexOf(!0)>-1}),Wg=Ue.newName(),sA=Ue.newName(),oA=Ue.newName(),lA={"&light":"."+sA,"&dark":"."+oA};function Vg(n,e,t){return new Ue(e,{finish(i){return/&/.test(i)?i.replace(/&\w*/,r=>{if(r=="&")return n;if(!t||!t[r])throw new RangeError(`Unsupported selector: ${r}`);return t[r]}):n+" "+i}})}const k8=Vg("."+Wg,{"&.cm-editor":{position:"relative !important",boxSizing:"border-box","&.cm-focused":{outline:"1px dotted #212121"},display:"flex !important",flexDirection:"column"},".cm-scroller":{display:"flex !important",alignItems:"flex-start !important",fontFamily:"monospace",lineHeight:1.4,height:"100%",overflowX:"auto",position:"relative",zIndex:0},".cm-content":{margin:0,flexGrow:2,minHeight:"100%",display:"block",whiteSpace:"pre",wordWrap:"normal",boxSizing:"border-box",padding:"4px 0",outline:"none","&[contenteditable=true]":{WebkitUserModify:"read-write-plaintext-only"}},".cm-lineWrapping":{whiteSpace_fallback:"pre-wrap",whiteSpace:"break-spaces",wordBreak:"break-word",overflowWrap:"anywhere"},"&light .cm-content":{caretColor:"black"},"&dark .cm-content":{caretColor:"white"},".cm-line":{display:"block",padding:"0 2px 0 4px"},".cm-selectionLayer":{zIndex:-1,contain:"size style"},".cm-selectionBackground":{position:"absolute"},"&light .cm-selectionBackground":{background:"#d9d9d9"},"&dark .cm-selectionBackground":{background:"#222"},"&light.cm-focused .cm-selectionBackground":{background:"#d7d4f0"},"&dark.cm-focused .cm-selectionBackground":{background:"#233"},".cm-cursorLayer":{zIndex:100,contain:"size style",pointerEvents:"none"},"&.cm-focused .cm-cursorLayer":{animation:"steps(1) cm-blink 1.2s infinite"},"@keyframes cm-blink":{"0%":{},"50%":{visibility:"hidden"},"100%":{}},"@keyframes cm-blink2":{"0%":{},"50%":{visibility:"hidden"},"100%":{}},".cm-cursor, .cm-dropCursor":{position:"absolute",borderLeft:"1.2px solid black",marginLeft:"-0.6px",pointerEvents:"none"},".cm-cursor":{display:"none"},"&dark .cm-cursor":{borderLeftColor:"#444"},"&.cm-focused .cm-cursor":{display:"block"},"&light .cm-activeLine":{backgroundColor:"#f3f9ff"},"&dark .cm-activeLine":{backgroundColor:"#223039"},"&light .cm-specialChar":{color:"red"},"&dark .cm-specialChar":{color:"#f78"},".cm-tab":{display:"inline-block",overflow:"hidden",verticalAlign:"bottom"},".cm-widgetBuffer":{verticalAlign:"text-top",height:"1em",display:"inline"},".cm-placeholder":{color:"#888",display:"inline-block",verticalAlign:"top"},".cm-button":{verticalAlign:"middle",color:"inherit",fontSize:"70%",padding:".2em 1em",borderRadius:"1px"},"&light .cm-button":{backgroundImage:"linear-gradient(#eff1f5, #d9d9df)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#b4b4b4, #d0d3d6)"}},"&dark .cm-button":{backgroundImage:"linear-gradient(#393939, #111)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#111, #333)"}},".cm-textfield":{verticalAlign:"middle",color:"inherit",fontSize:"70%",border:"1px solid silver",padding:".2em .5em"},"&light .cm-textfield":{backgroundColor:"white"},"&dark .cm-textfield":{border:"1px solid #555",backgroundColor:"inherit"}},lA),C8={childList:!0,characterData:!0,subtree:!0,attributes:!0,characterDataOldValue:!0},Hg=ge.ie&&ge.ie_version<=11;class A8{constructor(e,t,i){this.view=e,this.onChange=t,this.onScrollChanged=i,this.active=!1,this.selectionRange=new MW,this.selectionChanged=!1,this.delayedFlush=-1,this.resizeTimeout=-1,this.queue=[],this.delayedAndroidKey=null,this.scrollTargets=[],this.intersection=null,this.resize=null,this.intersecting=!1,this.gapIntersection=null,this.gaps=[],this.parentCheck=-1,this.dom=e.contentDOM,this.observer=new MutationObserver(r=>{for(let s of r)this.queue.push(s);(ge.ie&&ge.ie_version<=11||ge.ios&&e.composing)&&r.some(s=>s.type=="childList"&&s.removedNodes.length||s.type=="characterData"&&s.oldValue.length>s.target.nodeValue.length)?this.flushSoon():this.flush()}),Hg&&(this.onCharData=r=>{this.queue.push({target:r.target,type:"characterData",oldValue:r.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this),window.addEventListener("resize",this.onResize=this.onResize.bind(this)),typeof ResizeObserver=="function"&&(this.resize=new ResizeObserver(()=>{this.view.docView.lastUpdate<Date.now()-75&&this.onResize()}),this.resize.observe(e.scrollDOM)),window.addEventListener("beforeprint",this.onPrint=this.onPrint.bind(this)),this.start(),window.addEventListener("scroll",this.onScroll=this.onScroll.bind(this)),typeof IntersectionObserver=="function"&&(this.intersection=new IntersectionObserver(r=>{this.parentCheck<0&&(this.parentCheck=setTimeout(this.listenForScroll.bind(this),1e3)),r.length>0&&r[r.length-1].intersectionRatio>0!=this.intersecting&&(this.intersecting=!this.intersecting,this.intersecting!=this.view.inView&&this.onScrollChanged(document.createEvent("Event")))},{}),this.intersection.observe(this.dom),this.gapIntersection=new IntersectionObserver(r=>{r.length>0&&r[r.length-1].intersectionRatio>0&&this.onScrollChanged(document.createEvent("Event"))},{})),this.listenForScroll(),this.readSelectionRange(),this.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}onScroll(e){this.intersecting&&this.flush(!1),this.onScrollChanged(e)}onResize(){this.resizeTimeout<0&&(this.resizeTimeout=setTimeout(()=>{this.resizeTimeout=-1,this.view.requestMeasure()},50))}onPrint(){this.view.viewState.printing=!0,this.view.measure(),setTimeout(()=>{this.view.viewState.printing=!1,this.view.requestMeasure()},500)}updateGaps(e){if(this.gapIntersection&&(e.length!=this.gaps.length||this.gaps.some((t,i)=>t!=e[i]))){this.gapIntersection.disconnect();for(let t of e)this.gapIntersection.observe(t);this.gaps=e}}onSelectionChange(e){if(!this.readSelectionRange()||this.delayedAndroidKey)return;let{view:t}=this,i=this.selectionRange;if(t.state.facet(Ta)?t.root.activeElement!=this.dom:!ug(t.dom,i))return;let r=i.anchorNode&&t.docView.nearest(i.anchorNode);r&&r.ignoreEvent(e)||((ge.ie&&ge.ie_version<=11||ge.android&&ge.chrome)&&!t.state.selection.main.empty&&i.focusNode&&au(i.focusNode,i.focusOffset,i.anchorNode,i.anchorOffset)?this.flushSoon():this.flush(!1))}readSelectionRange(){let{root:e}=this.view,t=lu(e),i=ge.safari&&e.nodeType==11&&OW()==this.view.contentDOM&&O8(this.view)||t;return this.selectionRange.eq(i)?!1:(this.selectionRange.setRange(i),this.selectionChanged=!0)}setSelectionRange(e,t){this.selectionRange.set(e.node,e.offset,t.node,t.offset),this.selectionChanged=!1}listenForScroll(){this.parentCheck=-1;let e=0,t=null;for(let i=this.dom;i;)if(i.nodeType==1)!t&&e<this.scrollTargets.length&&this.scrollTargets[e]==i?e++:t||(t=this.scrollTargets.slice(0,e)),t&&t.push(i),i=i.assignedSlot||i.parentNode;else if(i.nodeType==11)i=i.host;else break;if(e<this.scrollTargets.length&&!t&&(t=this.scrollTargets.slice(0,e)),t){for(let i of this.scrollTargets)i.removeEventListener("scroll",this.onScroll);for(let i of this.scrollTargets=t)i.addEventListener("scroll",this.onScroll)}}ignore(e){if(!this.active)return e();try{return this.stop(),e()}finally{this.start(),this.clear()}}start(){this.active||(this.observer.observe(this.dom,C8),Hg&&this.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.active=!0)}stop(){!this.active||(this.active=!1,this.observer.disconnect(),Hg&&this.dom.removeEventListener("DOMCharacterDataModified",this.onCharData))}clear(){this.processRecords(),this.queue.length=0,this.selectionChanged=!1}delayAndroidKey(e,t){this.delayedAndroidKey||requestAnimationFrame(()=>{let i=this.delayedAndroidKey;this.delayedAndroidKey=null;let r=this.view.state;Ma(this.view.contentDOM,i.key,i.keyCode)?this.processRecords():this.flush(),this.view.state==r&&this.view.update([])}),(!this.delayedAndroidKey||e=="Enter")&&(this.delayedAndroidKey={key:e,keyCode:t})}flushSoon(){this.delayedFlush<0&&(this.delayedFlush=window.setTimeout(()=>{this.delayedFlush=-1,this.flush()},20))}forceFlush(){this.delayedFlush>=0&&(window.clearTimeout(this.delayedFlush),this.delayedFlush=-1,this.flush())}processRecords(){let e=this.queue;for(let s of this.observer.takeRecords())e.push(s);e.length&&(this.queue=[]);let t=-1,i=-1,r=!1;for(let s of e){let o=this.readMutation(s);!o||(o.typeOver&&(r=!0),t==-1?{from:t,to:i}=o:(t=Math.min(o.from,t),i=Math.max(o.to,i)))}return{from:t,to:i,typeOver:r}}flush(e=!0){if(this.delayedFlush>=0||this.delayedAndroidKey)return;e&&this.readSelectionRange();let{from:t,to:i,typeOver:r}=this.processRecords(),s=this.selectionChanged&&ug(this.dom,this.selectionRange);if(t<0&&!s)return;this.selectionChanged=!1;let o=this.view.state;this.onChange(t,i,r),this.view.state==o&&this.view.update([])}readMutation(e){let t=this.view.docView.nearest(e.target);if(!t||t.ignoreMutation(e))return null;if(t.markDirty(e.type=="attributes"),e.type=="attributes"&&(t.dirty|=4),e.type=="childList"){let i=aA(t,e.previousSibling||e.target.previousSibling,-1),r=aA(t,e.nextSibling||e.target.nextSibling,1);return{from:i?t.posAfter(i):t.posAtStart,to:r?t.posBefore(r):t.posAtEnd,typeOver:!1}}else return e.type=="characterData"?{from:t.posAtStart,to:t.posAtEnd,typeOver:e.target.nodeValue==e.oldValue}:null}destroy(){var e,t,i;this.stop(),(e=this.intersection)===null||e===void 0||e.disconnect(),(t=this.gapIntersection)===null||t===void 0||t.disconnect(),(i=this.resize)===null||i===void 0||i.disconnect();for(let r of this.scrollTargets)r.removeEventListener("scroll",this.onScroll);window.removeEventListener("scroll",this.onScroll),window.removeEventListener("resize",this.onResize),window.removeEventListener("beforeprint",this.onPrint),this.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange),clearTimeout(this.parentCheck),clearTimeout(this.resizeTimeout)}}function aA(n,e,t){for(;e;){let i=Mt.get(e);if(i&&i.parent==n)return i;let r=e.parentNode;e=r!=n.dom?r:t>0?e.nextSibling:e.previousSibling}return null}function O8(n){let e=null;function t(a){a.preventDefault(),a.stopImmediatePropagation(),e=a.getTargetRanges()[0]}if(n.contentDOM.addEventListener("beforeinput",t,!0),document.execCommand("indent"),n.contentDOM.removeEventListener("beforeinput",t,!0),!e)return null;let i=e.startContainer,r=e.startOffset,s=e.endContainer,o=e.endOffset,l=n.docView.domAtPos(n.state.selection.main.anchor);return au(l.node,l.offset,s,o)&&([i,r,s,o]=[s,o,i,r]),{anchorNode:i,anchorOffset:r,focusNode:s,focusOffset:o}}function _8(n,e,t,i){let r,s,o=n.state.selection.main;if(e>-1){let l=n.docView.domBoundsAround(e,t,0);if(!l||n.state.readOnly)return;let{from:a,to:h}=l,c=n.docView.impreciseHead||n.docView.impreciseAnchor?[]:M8(n),u=new SC(c,n.state);u.readRange(l.startDOM,l.endDOM);let f=o.from,d=null;(n.inputState.lastKeyCode===8&&n.inputState.lastKeyTime>Date.now()-100||ge.android&&u.text.length<h-a)&&(f=o.to,d="end");let p=D8(n.state.doc.sliceString(a,h,bs),u.text,f-a,d);p&&(ge.chrome&&n.inputState.lastKeyCode==13&&p.toB==p.from+2&&u.text.slice(p.from,p.toB)==bs+bs&&p.toB--,r={from:a+p.from,to:a+p.toA,insert:j.of(u.text.slice(p.from,p.toB).split(bs))}),s=E8(c,a)}else if(n.hasFocus||!n.state.facet(Ta)){let l=n.observer.selectionRange,{impreciseHead:a,impreciseAnchor:h}=n.docView,c=a&&a.node==l.focusNode&&a.offset==l.focusOffset||!il(n.contentDOM,l.focusNode)?n.state.selection.main.head:n.docView.posFromDOM(l.focusNode,l.focusOffset),u=h&&h.node==l.anchorNode&&h.offset==l.anchorOffset||!il(n.contentDOM,l.anchorNode)?n.state.selection.main.anchor:n.docView.posFromDOM(l.anchorNode,l.anchorOffset);(c!=o.head||u!=o.anchor)&&(s=xe.single(u,c))}if(!(!r&&!s)){if(!r&&i&&!o.empty&&s&&s.main.empty?r={from:o.from,to:o.to,insert:n.state.doc.slice(o.from,o.to)}:r&&r.from>=o.from&&r.to<=o.to&&(r.from!=o.from||r.to!=o.to)&&o.to-o.from-(r.to-r.from)<=4&&(r={from:o.from,to:o.to,insert:n.state.doc.slice(o.from,r.from).append(r.insert).append(n.state.doc.slice(r.to,o.to))}),r){let l=n.state;if(ge.ios&&n.inputState.flushIOSKey(n)||ge.android&&(r.from==o.from&&r.to==o.to&&r.insert.length==1&&r.insert.lines==2&&Ma(n.contentDOM,"Enter",13)||r.from==o.from-1&&r.to==o.to&&r.insert.length==0&&Ma(n.contentDOM,"Backspace",8)||r.from==o.from&&r.to==o.to+1&&r.insert.length==0&&Ma(n.contentDOM,"Delete",46)))return;let a=r.insert.toString();if(n.state.facet(uC).some(u=>u(n,r.from,r.to,a)))return;n.inputState.composing>=0&&n.inputState.composing++;let h;if(r.from>=o.from&&r.to<=o.to&&r.to-r.from>=(o.to-o.from)/3&&(!s||s.main.empty&&s.main.from==r.from+r.insert.length)&&n.inputState.composing<0){let u=o.from<r.from?l.sliceDoc(o.from,r.from):"",f=o.to>r.to?l.sliceDoc(r.to,o.to):"";h=l.replaceSelection(n.state.toText(u+r.insert.sliceString(0,void 0,n.state.lineBreak)+f))}else{let u=l.changes(r),f=s&&!l.selection.main.eq(s.main)&&s.main.to<=u.newLength?s.main:void 0;if(l.selection.ranges.length>1&&n.inputState.composing>=0&&r.to<=o.to&&r.to>=o.to-10){let d=n.state.sliceDoc(r.from,r.to),p=_C(n)||n.state.doc.lineAt(o.head),g=o.to-r.to,y=o.to-o.from;h=l.changeByRange(v=>{if(v.from==o.from&&v.to==o.to)return{changes:u,range:f||v.map(u)};let C=v.to-g,x=C-d.length;if(v.to-v.from!=y||n.state.sliceDoc(x,C)!=d||p&&v.to>=p.from&&v.from<=p.to)return{range:v};let b=l.changes({from:x,to:C,insert:r.insert}),S=v.to-o.to;return{changes:b,range:f?xe.range(Math.max(0,f.anchor+S),Math.max(0,f.head+S)):v.map(b)}})}else h={changes:u,selection:f&&l.selection.replaceRange(f)}}let c="input.type";n.composing&&(c+=".compose",n.inputState.compositionFirstChange&&(c+=".start",n.inputState.compositionFirstChange=!1)),n.dispatch(h,{scrollIntoView:!0,userEvent:c})}else if(s&&!s.main.eq(o)){let l=!1,a="select";n.inputState.lastSelectionTime>Date.now()-50&&(n.inputState.lastSelectionOrigin=="select"&&(l=!0),a=n.inputState.lastSelectionOrigin),n.dispatch({selection:s,scrollIntoView:l,userEvent:a})}}}function D8(n,e,t,i){let r=Math.min(n.length,e.length),s=0;for(;s<r&&n.charCodeAt(s)==e.charCodeAt(s);)s++;if(s==r&&n.length==e.length)return null;let o=n.length,l=e.length;for(;o>0&&l>0&&n.charCodeAt(o-1)==e.charCodeAt(l-1);)o--,l--;if(i=="end"){let a=Math.max(0,s-Math.min(o,l));t-=o+a-s}return o<s&&n.length<e.length?(s-=t<=s&&t>=o?s-t:0,l=s+(l-o),o=s):l<s&&(s-=t<=s&&t>=l?s-t:0,o=s+(o-l),l=s),{from:s,toA:o,toB:l}}function M8(n){let e=[];if(n.root.activeElement!=n.contentDOM)return e;let{anchorNode:t,anchorOffset:i,focusNode:r,focusOffset:s}=n.observer.selectionRange;return t&&(e.push(new CC(t,i)),(r!=t||s!=i)&&e.push(new CC(r,s))),e}function E8(n,e){if(n.length==0)return null;let t=n[0].pos,i=n.length==2?n[1].pos:t;return t>-1&&i>-1?xe.single(t+e,i+e):null}class Ht{constructor(e={}){this.plugins=[],this.pluginMap=new Map,this.editorAttrs={},this.contentAttrs={},this.bidiCache=[],this.destroyed=!1,this.updateState=2,this.measureScheduled=-1,this.measureRequests=[],this.contentDOM=document.createElement("div"),this.scrollDOM=document.createElement("div"),this.scrollDOM.tabIndex=-1,this.scrollDOM.className="cm-scroller",this.scrollDOM.appendChild(this.contentDOM),this.announceDOM=document.createElement("div"),this.announceDOM.style.cssText="position: absolute; top: -10000px",this.announceDOM.setAttribute("aria-live","polite"),this.dom=document.createElement("div"),this.dom.appendChild(this.announceDOM),this.dom.appendChild(this.scrollDOM),this._dispatch=e.dispatch||(t=>this.update([t])),this.dispatch=this.dispatch.bind(this),this.root=e.root||EW(e.parent)||document,this.viewState=new tA(e.state||Ge.create()),this.plugins=this.state.facet(Pa).map(t=>new _g(t));for(let t of this.plugins)t.update(this);this.observer=new A8(this,(t,i,r)=>{_8(this,t,i,r)},t=>{this.inputState.runScrollHandlers(this,t),this.observer.intersecting&&this.measure()}),this.inputState=new i8(this),this.docView=new AC(this),this.mountStyles(),this.updateAttrs(),this.updateState=0,this.requestMeasure(),e.parent&&e.parent.appendChild(this.dom)}get state(){return this.viewState.state}get viewport(){return this.viewState.viewport}get visibleRanges(){return this.viewState.visibleRanges}get inView(){return this.viewState.inView}get composing(){return this.inputState.composing>0}get compositionStarted(){return this.inputState.composing>=0}dispatch(...e){this._dispatch(e.length==1&&e[0]instanceof Fi?e[0]:this.state.update(...e))}update(e){if(this.updateState!=0)throw new Error("Calls to EditorView.update are not allowed while an update is in progress");let t=!1,i,r=this.state;for(let o of e){if(o.startState!=r)throw new RangeError("Trying to update state with a transaction that doesn't start from the previous state.");r=o.state}if(this.destroyed){this.viewState.state=r;return}if(r.facet(Ge.phrases)!=this.state.facet(Ge.phrases))return this.setState(r);i=new gC(this,r,e);let s=this.viewState.scrollTarget;try{this.updateState=2;for(let o of e){if(s&&(s=s.map(o.changes)),o.scrollIntoView){let{main:l}=o.state.selection;s=new sl(l.empty?l:xe.cursor(l.head,l.head>l.anchor?-1:1))}for(let l of o.effects)l.is(Og)?s=new sl(l.value):l.is(fC)?s=new sl(l.value,"center"):l.is(dC)&&(s=l.value)}this.viewState.update(i,s),this.bidiCache=wu.update(this.bidiCache,i.changes),i.empty||(this.updatePlugins(i),this.inputState.update(i)),t=this.docView.update(i),this.state.facet(Ba)!=this.styleModules&&this.mountStyles(),this.updateAttrs(),this.showAnnouncements(e),this.docView.updateSelection(t,e.some(o=>o.isUserEvent("select.pointer")))}finally{this.updateState=0}if(i.startState.facet(vu)!=i.state.facet(vu)&&(this.viewState.mustMeasureContent=!0),(t||s||this.viewState.mustEnforceCursorAssoc||this.viewState.mustMeasureContent)&&this.requestMeasure(),!i.empty)for(let o of this.state.facet(Ag))o(i)}setState(e){if(this.updateState!=0)throw new Error("Calls to EditorView.setState are not allowed while an update is in progress");if(this.destroyed){this.viewState.state=e;return}this.updateState=2;let t=this.hasFocus;try{for(let i of this.plugins)i.destroy(this);this.viewState=new tA(e),this.plugins=e.facet(Pa).map(i=>new _g(i)),this.pluginMap.clear();for(let i of this.plugins)i.update(this);this.docView=new AC(this),this.inputState.ensureHandlers(this),this.mountStyles(),this.updateAttrs(),this.bidiCache=[]}finally{this.updateState=0}t&&this.focus(),this.requestMeasure()}updatePlugins(e){let t=e.startState.facet(Pa),i=e.state.facet(Pa);if(t!=i){let r=[];for(let s of i){let o=t.indexOf(s);if(o<0)r.push(new _g(s));else{let l=this.plugins[o];l.mustUpdate=e,r.push(l)}}for(let s of this.plugins)s.mustUpdate!=e&&s.destroy(this);this.plugins=r,this.pluginMap.clear(),this.inputState.ensureHandlers(this)}else for(let r of this.plugins)r.mustUpdate=e;for(let r=0;r<this.plugins.length;r++)this.plugins[r].update(this)}measure(e=!0){if(this.destroyed)return;this.measureScheduled>-1&&cancelAnimationFrame(this.measureScheduled),this.measureScheduled=0,e&&this.observer.flush();let t=null;try{for(let i=0;;i++){this.updateState=1;let r=this.viewport,s=this.viewState.measure(this);if(!s&&!this.measureRequests.length&&this.viewState.scrollTarget==null)break;if(i>5){console.warn(this.measureRequests.length?"Measure loop restarted more than 5 times":"Viewport failed to stabilize");break}let o=[];s&4||([this.measureRequests,o]=[o,this.measureRequests]);let l=o.map(u=>{try{return u.read(this)}catch(f){return ws(this.state,f),hA}}),a=new gC(this,this.state),h=!1,c=!1;a.flags|=s,t?t.flags|=s:t=a,this.updateState=2,a.empty||(this.updatePlugins(a),this.inputState.update(a),this.updateAttrs(),h=this.docView.update(a));for(let u=0;u<o.length;u++)if(l[u]!=hA)try{let f=o[u];f.write&&f.write(l[u],this)}catch(f){ws(this.state,f)}if(this.viewState.scrollTarget&&(this.docView.scrollIntoView(this.viewState.scrollTarget),this.viewState.scrollTarget=null,c=!0),h&&this.docView.updateSelection(!0),this.viewport.from==r.from&&this.viewport.to==r.to&&!c&&this.measureRequests.length==0)break}}finally{this.updateState=0,this.measureScheduled=-1}if(t&&!t.empty)for(let i of this.state.facet(Ag))i(t)}get themeClasses(){return Wg+" "+(this.state.facet(Ig)?oA:sA)+" "+this.state.facet(vu)}updateAttrs(){let e=cA(this,mC,{class:"cm-editor"+(this.hasFocus?" cm-focused ":" ")+this.themeClasses}),t={spellcheck:"false",autocorrect:"off",autocapitalize:"off",translate:"no",contenteditable:this.state.facet(Ta)?"true":"false",class:"cm-content",style:`${ge.tabSize}: ${this.state.tabSize}`,role:"textbox","aria-multiline":"true"};this.state.readOnly&&(t["aria-readonly"]="true"),cA(this,Dg,t),this.observer.ignore(()=>{Sg(this.contentDOM,this.contentAttrs,t),Sg(this.dom,this.editorAttrs,e)}),this.editorAttrs=e,this.contentAttrs=t}showAnnouncements(e){let t=!0;for(let i of e)for(let r of i.effects)if(r.is(Ht.announce)){t&&(this.announceDOM.textContent=""),t=!1;let s=this.announceDOM.appendChild(document.createElement("div"));s.textContent=r.value}}mountStyles(){this.styleModules=this.state.facet(Ba),Ue.mount(this.root,this.styleModules.concat(k8).reverse())}readMeasured(){if(this.updateState==2)throw new Error("Reading the editor layout isn't allowed during an update");this.updateState==0&&this.measureScheduled>-1&&this.measure(!1)}requestMeasure(e){if(this.measureScheduled<0&&(this.measureScheduled=requestAnimationFrame(()=>this.measure())),e){if(e.key!=null){for(let t=0;t<this.measureRequests.length;t++)if(this.measureRequests[t].key===e.key){this.measureRequests[t]=e;return}}this.measureRequests.push(e)}}pluginField(e){let t=[];for(let i of this.plugins)i.update(this).takeField(e,t);return t}plugin(e){let t=this.pluginMap.get(e);return(t===void 0||t&&t.spec!=e)&&this.pluginMap.set(e,t=this.plugins.find(i=>i.spec==e)||null),t&&t.update(this).value}get documentTop(){return this.contentDOM.getBoundingClientRect().top+this.viewState.paddingTop}get documentPadding(){return{top:this.viewState.paddingTop,bottom:this.viewState.paddingBottom}}blockAtHeight(e,t){let i=zg(t,this);return this.elementAtHeight(e-i).moveY(i)}elementAtHeight(e){return this.readMeasured(),this.viewState.elementAtHeight(e)}visualLineAtHeight(e,t){let i=zg(t,this);return this.lineBlockAtHeight(e-i).moveY(i)}lineBlockAtHeight(e){return this.readMeasured(),this.viewState.lineBlockAtHeight(e)}viewportLines(e,t){let i=zg(t,this);for(let r of this.viewportLineBlocks)e(r.moveY(i))}get viewportLineBlocks(){return this.viewState.viewportLines}visualLineAt(e,t=0){return this.lineBlockAt(e).moveY(t+this.viewState.paddingTop)}lineBlockAt(e){return this.viewState.lineBlockAt(e)}get contentHeight(){return this.viewState.contentHeight}moveByChar(e,t,i){return Bg(this,e,RC(this,e,t,i))}moveByGroup(e,t){return Bg(this,e,RC(this,e,t,i=>e8(this,e.head,i)))}moveToLineBoundary(e,t,i=!0){return QW(this,e,t,i)}moveVertically(e,t,i){return Bg(this,e,t8(this,e,t,i))}scrollPosIntoView(e){this.dispatch({effects:Og.of(xe.cursor(e))})}domAtPos(e){return this.docView.domAtPos(e)}posAtDOM(e,t=0){return this.docView.posFromDOM(e,t)}posAtCoords(e,t=!0){return this.readMeasured(),PC(this,e,t)}coordsAtPos(e,t=1){this.readMeasured();let i=this.docView.coordsAt(e,t);if(!i||i.left==i.right)return i;let r=this.state.doc.lineAt(e),s=this.bidiSpans(r),o=s[ol.find(s,e-r.from,-1,t)];return cu(i,o.dir==bi.LTR==t>0)}get defaultCharacterWidth(){return this.viewState.heightOracle.charWidth}get defaultLineHeight(){return this.viewState.heightOracle.lineHeight}get textDirection(){return this.viewState.heightOracle.direction}get lineWrapping(){return this.viewState.heightOracle.lineWrapping}bidiSpans(e){if(e.length>T8)return wC(e.length);let t=this.textDirection;for(let r of this.bidiCache)if(r.from==e.from&&r.dir==t)return r.order;let i=vC(e.text,this.textDirection);return this.bidiCache.push(new wu(e.from,e.to,t,i)),i}get hasFocus(){var e;return(document.hasFocus()||ge.safari&&((e=this.inputState)===null||e===void 0?void 0:e.lastContextMenu)>Date.now()-3e4)&&this.root.activeElement==this.contentDOM}focus(){this.observer.ignore(()=>{zk(this.contentDOM),this.docView.updateSelection()})}destroy(){for(let e of this.plugins)e.destroy(this);this.plugins=[],this.inputState.destroy(),this.dom.remove(),this.observer.destroy(),this.measureScheduled>-1&&cancelAnimationFrame(this.measureScheduled),this.destroyed=!0}static scrollIntoView(e,t={}){return dC.of(new sl(typeof e=="number"?xe.cursor(e):e,t.y,t.x,t.yMargin,t.xMargin))}static domEventHandlers(e){return Br.define(()=>({}),{eventHandlers:e})}static theme(e,t){let i=Ue.newName(),r=[vu.of(i),Ba.of(Vg(`.${i}`,e))];return t&&t.dark&&r.push(Ig.of(!0)),r}static baseTheme(e){return mW.lowest(Ba.of(Vg("."+Wg,e,lA)))}}Ht.scrollTo=Og,Ht.centerOn=fC,Ht.styleModule=Ba,Ht.inputHandler=uC,Ht.exceptionSink=cC,Ht.updateListener=Ag,Ht.editable=Ta,Ht.mouseSelectionStyle=hC,Ht.dragMovesSelection=aC,Ht.clickAddsSelectionRange=lC,Ht.decorations=fo,Ht.darkTheme=Ig,Ht.contentAttributes=Dg,Ht.editorAttributes=mC,Ht.lineWrapping=Ht.contentAttributes.of({class:"cm-lineWrapping"}),Ht.announce=Lt.define();const T8=4096;function zg(n,e){return(n==null?e.contentDOM.getBoundingClientRect().top:n)+e.viewState.paddingTop}const hA={};class wu{constructor(e,t,i,r){this.from=e,this.to=t,this.dir=i,this.order=r}static update(e,t){if(t.empty)return e;let i=[],r=e.length?e[e.length-1].dir:bi.LTR;for(let s=Math.max(0,e.length-10);s<e.length;s++){let o=e[s];o.dir==r&&!t.touchesRange(o.from,o.to)&&i.push(new wu(t.mapPos(o.from,1),t.mapPos(o.to,-1),o.dir,o.order))}return i}}function cA(n,e,t){for(let i=n.state.facet(e),r=i.length-1;r>=0;r--){let s=i[r],o=typeof s=="function"?s(n):s;o&&bg(o,t)}return t}const P8=ge.mac?"mac":ge.windows?"win":ge.linux?"linux":"key";function B8(n,e){const t=n.split(/-(?!$)/);let i=t[t.length-1];i=="Space"&&(i=" ");let r,s,o,l;for(let a=0;a<t.length-1;++a){const h=t[a];if(/^(cmd|meta|m)$/i.test(h))l=!0;else if(/^a(lt)?$/i.test(h))r=!0;else if(/^(c|ctrl|control)$/i.test(h))s=!0;else if(/^s(hift)?$/i.test(h))o=!0;else if(/^mod$/i.test(h))e=="mac"?l=!0:s=!0;else throw new Error("Unrecognized modifier name: "+h)}return r&&(i="Alt-"+i),s&&(i="Ctrl-"+i),l&&(i="Meta-"+i),o&&(i="Shift-"+i),i}function jg(n,e,t){return e.altKey&&(n="Alt-"+n),e.ctrlKey&&(n="Ctrl-"+n),e.metaKey&&(n="Meta-"+n),t!==!1&&e.shiftKey&&(n="Shift-"+n),n}const R8=Ht.domEventHandlers({keydown(n,e){return dA(fA(e.state),n,e,"editor")}}),L8=Le.define({enables:R8}),uA=new WeakMap;function fA(n){let e=n.facet(L8),t=uA.get(e);return t||uA.set(e,t=N8(e.reduce((i,r)=>i.concat(r),[]))),t}function y6(n,e,t){return dA(fA(n.state),e,n,t)}let xs=null;const F8=4e3;function N8(n,e=P8){let t=Object.create(null),i=Object.create(null),r=(o,l)=>{let a=i[o];if(a==null)i[o]=l;else if(a!=l)throw new Error("Key binding "+o+" is used both as a regular binding and as a multi-stroke prefix")},s=(o,l,a,h)=>{let c=t[o]||(t[o]=Object.create(null)),u=l.split(/ (?!$)/).map(p=>B8(p,e));for(let p=1;p<u.length;p++){let g=u.slice(0,p).join(" ");r(g,!0),c[g]||(c[g]={preventDefault:!0,commands:[y=>{let v=xs={view:y,prefix:g,scope:o};return setTimeout(()=>{xs==v&&(xs=null)},F8),!0}]})}let f=u.join(" ");r(f,!1);let d=c[f]||(c[f]={preventDefault:!1,commands:[]});d.commands.push(a),h&&(d.preventDefault=!0)};for(let o of n){let l=o[e]||o.key;if(!!l)for(let a of o.scope?o.scope.split(" "):["editor"])s(a,l,o.run,o.preventDefault),o.shift&&s(a,"Shift-"+l,o.shift,o.preventDefault)}return t}function dA(n,e,t,i){let r=uc(e),s=r.length==1&&r!=" ",o="",l=!1;xs&&xs.view==t&&xs.scope==i&&(o=xs.prefix+" ",(l=FC.indexOf(e.keyCode)<0)&&(xs=null));let a=u=>{if(u){for(let f of u.commands)if(f(t))return!0;u.preventDefault&&(l=!0)}return!1},h=n[i],c;if(h){if(a(h[o+jg(r,e,!s)]))return!0;if(s&&(e.shiftKey||e.altKey||e.metaKey)&&(c=Bn[e.keyCode])&&c!=r){if(a(h[o+jg(c,e,!0)]))return!0}else if(s&&e.shiftKey&&a(h[o+jg(r,e,!0)]))return!0}return l}const I8=!ge.ios,W8=Le.define({combine(n){return Wk(n,{cursorBlinkRate:1200,drawRangeCursor:!0},{cursorBlinkRate:(e,t)=>Math.min(e,t),drawRangeCursor:(e,t)=>e||t})}});function v6(n={}){return[W8.of(n),V8,z8]}class pA{constructor(e,t,i,r,s){this.left=e,this.top=t,this.width=i,this.height=r,this.className=s}draw(){let e=document.createElement("div");return e.className=this.className,this.adjust(e),e}adjust(e){e.style.left=this.left+"px",e.style.top=this.top+"px",this.width>=0&&(e.style.width=this.width+"px"),e.style.height=this.height+"px"}eq(e){return this.left==e.left&&this.top==e.top&&this.width==e.width&&this.height==e.height&&this.className==e.className}}const V8=null,H8={".cm-line":{"& ::selection":{backgroundColor:"transparent !important"},"&::selection":{backgroundColor:"transparent !important"}}};I8&&(H8[".cm-line"].caretColor="transparent !important");const z8=null;function mA(n){let e=n.scrollDOM.getBoundingClientRect();return{left:(n.textDirection==bi.LTR?e.left:e.right-n.scrollDOM.clientWidth)-n.scrollDOM.scrollLeft,top:e.top-n.scrollDOM.scrollTop}}function gA(n,e,t){let i=EditorSelection.cursor(e);return{from:Math.max(t.from,n.moveToLineBoundary(i,!1,!0).from),to:Math.min(t.to,n.moveToLineBoundary(i,!0,!0).from),type:pt.Text}}function yA(n,e){let t=n.lineBlockAt(e);if(Array.isArray(t.type)){for(let i of t.type)if(i.to>e||i.to==e&&(i.to==t.to||i.type==pt.Text))return i}return t}function w6(n,e){if(e.to<=n.viewport.from||e.from>=n.viewport.to)return[];let t=Math.max(e.from,n.viewport.from),i=Math.min(e.to,n.viewport.to),r=n.textDirection==bi.LTR,s=n.contentDOM,o=s.getBoundingClientRect(),l=mA(n),a=window.getComputedStyle(s.firstChild),h=o.left+parseInt(a.paddingLeft)+Math.min(0,parseInt(a.textIndent)),c=o.right-parseInt(a.paddingRight),u=yA(n,t),f=yA(n,i),d=u.type==pt.Text?u:null,p=f.type==pt.Text?f:null;if(n.lineWrapping&&(d&&(d=gA(n,t,d)),p&&(p=gA(n,i,p))),d&&p&&d.from==p.from)return y(v(e.from,e.to,d));{let x=d?v(e.from,null,d):C(u,!1),b=p?v(null,e.to,p):C(f,!0),S=[];return(d||u).to<(p||f).from-1?S.push(g(h,x.bottom,c,b.top)):x.bottom<b.top&&n.elementAtHeight((x.bottom+b.top)/2).type==pt.Text&&(x.bottom=b.top=(x.bottom+b.top)/2),y(x).concat(S).concat(y(b))}function g(x,b,S,k){return new pA(x-l.left,b-l.top-.01,S-x,k-b+.01,"cm-selectionBackground")}function y({top:x,bottom:b,horizontal:S}){let k=[];for(let A=0;A<S.length;A+=2)k.push(g(S[A],x,S[A+1],b));return k}function v(x,b,S){let k=1e9,A=-1e9,_=[];function O(B,N,ne,W,J){let re=n.coordsAtPos(B,B==S.to?-2:2),ie=n.coordsAtPos(ne,ne==S.from?2:-2);k=Math.min(re.top,ie.top,k),A=Math.max(re.bottom,ie.bottom,A),J==bi.LTR?_.push(r&&N?h:re.left,r&&W?c:ie.right):_.push(!r&&W?h:ie.left,!r&&N?c:re.right)}let D=x!=null?x:S.from,T=b!=null?b:S.to;for(let B of n.visibleRanges)if(B.to>D&&B.from<T)for(let N=Math.max(B.from,D),ne=Math.min(B.to,T);;){let W=n.state.doc.lineAt(N);for(let J of n.bidiSpans(W)){let re=J.from+W.from,ie=J.to+W.from;if(re>=ne)break;ie>N&&O(Math.max(re,N),x==null&&re<=D,Math.min(ie,ne),b==null&&ie>=T,J.dir)}if(N=W.to+1,N>=ne)break}return _.length==0&&O(D,x==null,T,b==null,n.textDirection),{top:k,bottom:A,horizontal:_}}function C(x,b){let S=o.top+(b?x.top:x.bottom);return{top:S,bottom:S,horizontal:[]}}}function b6(n,e,t){let i=n.coordsAtPos(e.head,e.assoc||1);if(!i)return null;let r=mA(n);return new pA(i.left-r.left,i.top-r.top,-1,i.bottom-i.top,t?"cm-cursor cm-cursor-primary":"cm-cursor cm-cursor-secondary")}const vA=Lt.define({map(n,e){return n==null?null:e.mapPos(n)}}),La=ao.define({create(){return null},update(n,e){return n!=null&&(n=e.changes.mapPos(n)),e.effects.reduce((t,i)=>i.is(vA)?i.value:t,n)}}),j8=Br.fromClass(class{constructor(n){this.view=n,this.cursor=null,this.measureReq={read:this.readPos.bind(this),write:this.drawCursor.bind(this)}}update(n){var e;let t=n.state.field(La);t==null?this.cursor!=null&&((e=this.cursor)===null||e===void 0||e.remove(),this.cursor=null):(this.cursor||(this.cursor=this.view.scrollDOM.appendChild(document.createElement("div")),this.cursor.className="cm-dropCursor"),(n.startState.field(La)!=t||n.docChanged||n.geometryChanged)&&this.view.requestMeasure(this.measureReq))}readPos(){let n=this.view.state.field(La),e=n!=null&&this.view.coordsAtPos(n);if(!e)return null;let t=this.view.scrollDOM.getBoundingClientRect();return{left:e.left-t.left+this.view.scrollDOM.scrollLeft,top:e.top-t.top+this.view.scrollDOM.scrollTop,height:e.bottom-e.top}}drawCursor(n){this.cursor&&(n?(this.cursor.style.left=n.left+"px",this.cursor.style.top=n.top+"px",this.cursor.style.height=n.height+"px"):this.cursor.style.left="-100000px")}destroy(){this.cursor&&this.cursor.remove()}setDropPos(n){this.view.state.field(La)!=n&&this.view.dispatch({effects:vA.of(n)})}},{eventHandlers:{dragover(n){this.setDropPos(this.view.posAtCoords({x:n.clientX,y:n.clientY}))},dragleave(n){(n.target==this.view.contentDOM||!this.view.contentDOM.contains(n.relatedTarget))&&this.setDropPos(null)},dragend(){this.setDropPos(null)},drop(){this.setDropPos(null)}}});function x6(){return[La,j8]}function wA(n,e,t,i,r){e.lastIndex=0;for(let s=n.iterRange(t,i),o=t,l;!s.next().done;o+=s.value.length)if(!s.lineBreak)for(;l=e.exec(s.value);)r(o+l.index,o+l.index+l[0].length,l)}function $8(n,e){let t=n.visibleRanges;if(t.length==1&&t[0].from==n.viewport.from&&t[0].to==n.viewport.to)return t;let i=[];for(let{from:r,to:s}of t)r=Math.max(n.state.doc.lineAt(r).from,r-e),s=Math.min(n.state.doc.lineAt(s).to,s+e),i.length&&i[i.length-1].to>=r?i[i.length-1].to=s:i.push({from:r,to:s});return i}class U8{constructor(e){let{regexp:t,decoration:i,boundary:r,maxLength:s=1e3}=e;if(!t.global)throw new RangeError("The regular expression given to MatchDecorator should have its 'g' flag set");this.regexp=t,this.getDeco=typeof i=="function"?i:()=>i,this.boundary=r,this.maxLength=s}createDeco(e){let t=new RangeSetBuilder;for(let{from:i,to:r}of $8(e,this.maxLength))wA(e.state.doc,this.regexp,i,r,(s,o,l)=>t.add(s,o,this.getDeco(l,e,s)));return t.finish()}updateDeco(e,t){let i=1e9,r=-1;return e.docChanged&&e.changes.iterChanges((s,o,l,a)=>{a>e.view.viewport.from&&l<e.view.viewport.to&&(i=Math.min(l,i),r=Math.max(a,r))}),e.viewportChanged||r-i>1e3?this.createDeco(e.view):r>-1?this.updateRange(e.view,t.map(e.changes),i,r):t}updateRange(e,t,i,r){for(let s of e.visibleRanges){let o=Math.max(s.from,i),l=Math.min(s.to,r);if(l>o){let a=e.state.doc.lineAt(o),h=a.to<l?e.state.doc.lineAt(l):a,c=Math.max(s.from,a.from),u=Math.min(s.to,h.to);if(this.boundary){for(;o>a.from;o--)if(this.boundary.test(a.text[o-1-a.from])){c=o;break}for(;l<h.to;l++)if(this.boundary.test(h.text[l-h.from])){u=l;break}}let f=[],d;if(a==h)for(this.regexp.lastIndex=c-a.from;(d=this.regexp.exec(a.text))&&d.index<u-a.from;){let p=d.index+a.from;f.push(this.getDeco(d,e,p).range(p,p+d[0].length))}else wA(e.state.doc,this.regexp,c,u,(p,g,y)=>f.push(this.getDeco(y,e,p).range(p,g)));t=t.update({filterFrom:c,filterTo:u,filter:(p,g)=>p<c||g>u,add:f})}}return t}}const $g=/x/.unicode!=null?"gu":"g",q8=new RegExp(`[\0-\b
-\x7F-\x9F\xAD\u061C\u200B\u200E\u200F\u2028\u2029\u202D\u202E\uFEFF\uFFF9-\uFFFC]`,$g),K8={0:"null",7:"bell",8:"backspace",10:"newline",11:"vertical tab",13:"carriage return",27:"escape",8203:"zero width space",8204:"zero width non-joiner",8205:"zero width joiner",8206:"left-to-right mark",8207:"right-to-left mark",8232:"line separator",8237:"left-to-right override",8238:"right-to-left override",8233:"paragraph separator",65279:"zero width no-break space",65532:"object replacement"};let Ug=null;function G8(){var n;if(Ug==null&&typeof document!="undefined"&&document.body){let e=document.body.style;Ug=((n=e.tabSize)!==null&&n!==void 0?n:e.MozTabSize)!=null}return Ug||!1}const bu=Le.define({combine(n){let e=Wk(n,{render:null,specialChars:q8,addSpecialChars:null});return(e.replaceTabs=!G8())&&(e.specialChars=new RegExp("	|"+e.specialChars.source,$g)),e.addSpecialChars&&(e.specialChars=new RegExp(e.specialChars.source+"|"+e.addSpecialChars.source,$g)),e}});function S6(n={}){return[bu.of(n),J8()]}let bA=null;function J8(){return bA||(bA=Br.fromClass(class{constructor(n){this.view=n,this.decorations=ct.none,this.decorationCache=Object.create(null),this.decorator=this.makeDecorator(n.state.facet(bu)),this.decorations=this.decorator.createDeco(n)}makeDecorator(n){return new U8({regexp:n.specialChars,decoration:(e,t,i)=>{let{doc:r}=t.state,s=codePointAt(e[0],0);if(s==9){let o=r.lineAt(i),l=t.state.tabSize,a=countColumn(o.text,l,i-o.from);return ct.replace({widget:new Q8((l-a%l)*this.view.defaultCharacterWidth)})}return this.decorationCache[s]||(this.decorationCache[s]=ct.replace({widget:new X8(n,s)}))},boundary:n.replaceTabs?void 0:/[^]/})}update(n){let e=n.state.facet(bu);n.startState.facet(bu)!=e?(this.decorator=this.makeDecorator(e),this.decorations=this.decorator.createDeco(n.view)):this.decorations=this.decorator.updateDeco(n,this.decorations)}},{decorations:n=>n.decorations}))}const Z8="\u2022";function Y8(n){return n>=32?Z8:n==10?"\u2424":String.fromCharCode(9216+n)}class X8 extends null{constructor(e,t){super(),this.options=e,this.code=t}eq(e){return e.code==this.code}toDOM(e){let t=Y8(this.code),i=e.state.phrase("Control character")+" "+(K8[this.code]||"0x"+this.code.toString(16)),r=this.options.render&&this.options.render(this.code,i,t);if(r)return r;let s=document.createElement("span");return s.textContent=t,s.title=i,s.setAttribute("aria-label",i),s.className="cm-specialChar",s}ignoreEvent(){return!1}}class Q8 extends null{constructor(e){super(),this.width=e}eq(e){return e.width==this.width}toDOM(){let e=document.createElement("span");return e.textContent="	",e.className="cm-tab",e.style.width=this.width+"px",e}ignoreEvent(){return!1}}const xA=null;function k6(){return[xA,Dg.of(n=>{var e;return((e=n.plugin(xA))===null||e===void 0?void 0:e.attrs)||null})]}function C6(){return tV}const eV=ct.line({class:"cm-activeLine"}),tV=Br.fromClass(class{constructor(n){this.decorations=this.getDeco(n)}update(n){(n.docChanged||n.selectionSet)&&(this.decorations=this.getDeco(n.view))}getDeco(n){let e=-1,t=[];for(let i of n.state.selection.ranges){if(!i.empty)return ct.none;let r=n.lineBlockAt(i.head);r.from>e&&(t.push(eV.range(r.from)),e=r.from)}return ct.set(t)}},{decorations:n=>n.decorations});class iV extends null{constructor(e){super(),this.content=e}toDOM(){let e=document.createElement("span");return e.className="cm-placeholder",e.style.pointerEvents="none",e.appendChild(typeof this.content=="string"?document.createTextNode(this.content):this.content),typeof this.content=="string"?e.setAttribute("aria-label","placeholder "+this.content):e.setAttribute("aria-hidden","true"),e}ignoreEvent(){return!1}}function A6(n){return Br.fromClass(class{constructor(e){this.view=e,this.placeholder=ct.set([ct.widget({widget:new iV(n),side:1}).range(0)])}get decorations(){return this.view.state.doc.length?ct.none:this.placeholder}},{decorations:e=>e.decorations})}const O6={HeightMap:Ii,HeightOracle:YC,MeasuredHeights:XC,QueryType:it,ChangedRange:er,computeOrder:vC,moveVisually:xC};var qg;const Fa=new qe;function SA(n){return Le.define({combine:n?e=>e.concat(n):void 0})}class Sn{constructor(e,t,i,r=[]){this.data=e,this.topNode=i,Ge.prototype.hasOwnProperty("tree")||Object.defineProperty(Ge.prototype,"tree",{get(){return ll(this)}}),this.parser=t,this.extension=[hl.of(this),Ge.languageData.of((s,o,l)=>s.facet(kA(s,o,l)))].concat(r)}isActiveAt(e,t,i=-1){return kA(e,t,i)==this.data}findRegions(e){let t=e.facet(hl);if((t==null?void 0:t.data)==this.data)return[{from:0,to:e.doc.length}];if(!t||!t.allowsNesting)return[];let i=[],r=(s,o)=>{if(s.prop(Fa)==this.data){i.push({from:o,to:o+s.length});return}let l=s.prop(qe.mounted);if(l){if(l.tree.prop(Fa)==this.data){if(l.overlay)for(let a of l.overlay)i.push({from:a.from+o,to:a.to+o});else i.push({from:o,to:o+s.length});return}else if(l.overlay){let a=i.length;if(r(l.tree,l.overlay[0].from+o),i.length>a)return}}for(let a=0;a<s.children.length;a++){let h=s.children[a];h instanceof et&&r(h,s.positions[a]+o)}};return r(ll(e),0),i}get allowsNesting(){return!0}}Sn.setState=Lt.define();function kA(n,e,t){let i=n.facet(hl);if(!i)return null;let r=i.data;if(i.allowsNesting)for(let s=ll(n).topNode;s;s=s.enter(e,t,!0,!1))r=s.type.prop(Fa)||r;return r}class Kg extends null{constructor(e,t){super(e,t,t.topNode),this.parser=t}static define(e){let t=SA(e.languageData);return new Kg(t,e.parser.configure({props:[Fa.add(i=>i.isTop?t:void 0)]}))}configure(e){return new Kg(this.data,this.parser.configure(e))}get allowsNesting(){return this.parser.wrappers.length>0}}function ll(n){let e=n.field(Sn.state,!1);return e?e.tree:et.empty}function _6(n,e,t=50){var i;let r=(i=n.field(Sn.state,!1))===null||i===void 0?void 0:i.context;return r&&(r.isDone(e)||r.work(t,e))?r.tree:null}function D6(n,e=n.doc.length){var t;return((t=n.field(Sn.state,!1))===null||t===void 0?void 0:t.context.isDone(e))||!1}function M6(n){var e;return((e=n.plugin(OA))===null||e===void 0?void 0:e.isWorking())||!1}class nV{constructor(e,t=e.length){this.doc=e,this.length=t,this.cursorPos=0,this.string="",this.cursor=e.iter()}syncTo(e){return this.string=this.cursor.next(e-this.cursorPos).value,this.cursorPos=e+this.string.length,this.cursorPos-this.string.length}chunk(e){return this.syncTo(e),this.string}get lineChunks(){return!0}read(e,t){let i=this.cursorPos-this.string.length;return e<i||t>=this.cursorPos?this.doc.sliceString(e,t):this.string.slice(e-i,t-i)}}let Na=null;class Ia{constructor(e,t,i=[],r,s,o,l,a){this.parser=e,this.state=t,this.fragments=i,this.tree=r,this.treeLen=s,this.viewport=o,this.skipped=l,this.scheduleOn=a,this.parse=null,this.tempSkipped=[]}startParse(){return this.parser.startParse(new nV(this.state.doc),this.fragments)}work(e,t){return t!=null&&t>=this.state.doc.length&&(t=void 0),this.tree!=et.empty&&this.isDone(t!=null?t:this.state.doc.length)?(this.takeTree(),!0):this.withContext(()=>{var i;if(typeof e=="number"){let r=Date.now()+e;e=()=>Date.now()>r}for(this.parse||(this.parse=this.startParse()),t!=null&&(this.parse.stoppedAt==null||this.parse.stoppedAt>t)&&t<this.state.doc.length&&this.parse.stopAt(t);;){let r=this.parse.advance();if(r)if(this.fragments=this.withoutTempSkipped(Or.addTree(r,this.fragments,this.parse.stoppedAt!=null)),this.treeLen=(i=this.parse.stoppedAt)!==null&&i!==void 0?i:this.state.doc.length,this.tree=r,this.parse=null,this.treeLen<(t!=null?t:this.state.doc.length))this.parse=this.startParse();else return!0;if(e())return!1}})}takeTree(){let e,t;this.parse&&(e=this.parse.parsedPos)>=this.treeLen&&((this.parse.stoppedAt==null||this.parse.stoppedAt>e)&&this.parse.stopAt(e),this.withContext(()=>{for(;!(t=this.parse.advance()););}),this.treeLen=e,this.tree=t,this.fragments=this.withoutTempSkipped(Or.addTree(this.tree,this.fragments,!0)),this.parse=null)}withContext(e){let t=Na;Na=this;try{return e()}finally{Na=t}}withoutTempSkipped(e){for(let t;t=this.tempSkipped.pop();)e=CA(e,t.from,t.to);return e}changes(e,t){let{fragments:i,tree:r,treeLen:s,viewport:o,skipped:l}=this;if(this.takeTree(),!e.empty){let a=[];if(e.iterChangedRanges((h,c,u,f)=>a.push({fromA:h,toA:c,fromB:u,toB:f})),i=Or.applyChanges(i,a),r=et.empty,s=0,o={from:e.mapPos(o.from,-1),to:e.mapPos(o.to,1)},this.skipped.length){l=[];for(let h of this.skipped){let c=e.mapPos(h.from,1),u=e.mapPos(h.to,-1);c<u&&l.push({from:c,to:u})}}}return new Ia(this.parser,t,i,r,s,o,l,this.scheduleOn)}updateViewport(e){if(this.viewport.from==e.from&&this.viewport.to==e.to)return!1;this.viewport=e;let t=this.skipped.length;for(let i=0;i<this.skipped.length;i++){let{from:r,to:s}=this.skipped[i];r<e.to&&s>e.from&&(this.fragments=CA(this.fragments,r,s),this.skipped.splice(i--,1))}return this.skipped.length>=t?!1:(this.reset(),!0)}reset(){this.parse&&(this.takeTree(),this.parse=null)}skipUntilInView(e,t){this.skipped.push({from:e,to:t})}static getSkippingParser(e){return new class extends Z1{createParse(t,i,r){let s=r[0].from,o=r[r.length-1].to;return{parsedPos:s,advance(){let a=Na;if(a){for(let h of r)a.tempSkipped.push(h);e&&(a.scheduleOn=a.scheduleOn?Promise.all([a.scheduleOn,e]):e)}return this.parsedPos=o,new et(Ei.none,[],[],o-s)},stoppedAt:null,stopAt(){}}}}}isDone(e){e=Math.min(e,this.state.doc.length);let t=this.fragments;return this.treeLen>=e&&t.length&&t[0].from==0&&t[0].to>=e}static get(){return Na}}function CA(n,e,t){return Or.applyChanges(n,[{fromA:e,toA:t,fromB:e,toB:t}])}class al{constructor(e){this.context=e,this.tree=e.tree}apply(e){if(!e.docChanged&&this.tree==this.context.tree)return this;let t=this.context.changes(e.changes,e.state),i=this.context.treeLen==e.startState.doc.length?void 0:Math.max(e.changes.mapPos(this.context.treeLen),t.viewport.to);return t.work(20,i)||t.takeTree(),new al(t)}static init(e){let t=Math.min(3e3,e.doc.length),i=new Ia(e.facet(hl).parser,e,[],et.empty,0,{from:0,to:t},[],null);return i.work(20,t)||i.takeTree(),new al(i)}}Sn.state=ao.define({create:al.init,update(n,e){for(let t of e.effects)if(t.is(Sn.setState))return t.value;return e.startState.facet(hl)!=e.state.facet(hl)?al.init(e.state):n.apply(e)}});let AA=n=>{let e=setTimeout(()=>n(),500);return()=>clearTimeout(e)};typeof requestIdleCallback!="undefined"&&(AA=n=>{let e=-1,t=setTimeout(()=>{e=requestIdleCallback(n,{timeout:500-100})},100);return()=>e<0?clearTimeout(t):cancelIdleCallback(e)});const Gg=typeof navigator!="undefined"&&((qg=navigator.scheduling)===null||qg===void 0?void 0:qg.isInputPending)?()=>navigator.scheduling.isInputPending():null,OA=Br.fromClass(class{constructor(e){this.view=e,this.working=null,this.workScheduled=0,this.chunkEnd=-1,this.chunkBudget=-1,this.work=this.work.bind(this),this.scheduleWork()}update(e){let t=this.view.state.field(Sn.state).context;(t.updateViewport(e.view.viewport)||this.view.viewport.to>t.treeLen)&&this.scheduleWork(),e.docChanged&&(this.view.hasFocus&&(this.chunkBudget+=50),this.scheduleWork()),this.checkAsyncSchedule(t)}scheduleWork(){if(this.working)return;let{state:e}=this.view,t=e.field(Sn.state);(t.tree!=t.context.tree||!t.context.isDone(e.doc.length))&&(this.working=AA(this.work))}work(e){this.working=null;let t=Date.now();if(this.chunkEnd<t&&(this.chunkEnd<0||this.view.hasFocus)&&(this.chunkEnd=t+3e4,this.chunkBudget=3e3),this.chunkBudget<=0)return;let{state:i,viewport:{to:r}}=this.view,s=i.field(Sn.state);if(s.tree==s.context.tree&&s.context.isDone(r+1e5))return;let o=Date.now()+Math.min(this.chunkBudget,100,e&&!Gg?Math.max(25,e.timeRemaining()-5):1e9),l=s.context.treeLen<r&&i.doc.length>r+1e3,a=s.context.work(()=>Gg&&Gg()||Date.now()>o,r+(l?0:1e5));this.chunkBudget-=Date.now()-t,(a||this.chunkBudget<=0)&&(s.context.takeTree(),this.view.dispatch({effects:Sn.setState.of(new al(s.context))})),this.chunkBudget>0&&!(a&&!l)&&this.scheduleWork(),this.checkAsyncSchedule(s.context)}checkAsyncSchedule(e){e.scheduleOn&&(this.workScheduled++,e.scheduleOn.then(()=>this.scheduleWork()).catch(t=>ws(this.view.state,t)).then(()=>this.workScheduled--),e.scheduleOn=null)}destroy(){this.working&&this.working()}isWorking(){return!!(this.working||this.workScheduled>0)}},{eventHandlers:{focus(){this.scheduleWork()}}}),hl=Le.define({combine(n){return n.length?n[0]:null},enables:[Sn.state,OA]});class E6{constructor(e,t=[]){this.language=e,this.support=t,this.extension=[e,t]}}class _A{constructor(e,t,i,r,s,o=void 0){this.name=e,this.alias=t,this.extensions=i,this.filename=r,this.loadFunc=s,this.support=o,this.loading=null}load(){return this.loading||(this.loading=this.loadFunc().then(e=>this.support=e,e=>{throw this.loading=null,e}))}static of(e){let{load:t,support:i}=e;if(!t){if(!i)throw new RangeError("Must pass either 'load' or 'support' to LanguageDescription.of");t=()=>Promise.resolve(i)}return new _A(e.name,(e.alias||[]).concat(e.name).map(r=>r.toLowerCase()),e.extensions||[],e.filename,t,i)}static matchFilename(e,t){for(let r of e)if(r.filename&&r.filename.test(t))return r;let i=/\.([^.]+)$/.exec(t);if(i){for(let r of e)if(r.extensions.indexOf(i[1])>-1)return r}return null}static matchLanguageName(e,t,i=!0){t=t.toLowerCase();for(let r of e)if(r.alias.some(s=>s==t))return r;if(i)for(let r of e)for(let s of r.alias){let o=t.indexOf(s);if(o>-1&&(s.length>2||!/\w/.test(t[o-1])&&!/\w/.test(t[o+s.length])))return r}return null}}const DA=Le.define(),MA=Le.define({combine:n=>{if(!n.length)return"  ";if(!/^(?: +|\t+)$/.test(n[0]))throw new Error("Invalid indent unit: "+JSON.stringify(n[0]));return n[0]}});function xu(n){let e=n.facet(MA);return e.charCodeAt(0)==9?n.tabSize*e.length:e.length}function rV(n,e){let t="",i=n.tabSize;if(n.facet(MA).charCodeAt(0)==9)for(;e>=i;)t+="	",e-=i;for(let r=0;r<e;r++)t+=" ";return t}function sV(n,e){n instanceof EditorState&&(n=new oV(n));for(let i of n.state.facet(DA)){let r=i(n,e);if(r!=null)return r}let t=ll(n.state);return t?aV(n,t,e):null}class oV{constructor(e,t={}){this.state=e,this.options=t,this.unit=xu(e)}lineAt(e,t=1){let i=this.state.doc.lineAt(e),{simulateBreak:r,simulateDoubleBreak:s}=this.options;return r!=null&&r>=i.from&&r<=i.to?s&&r==e?{text:"",from:e}:(t<0?r<e:r<=e)?{text:i.text.slice(r-i.from),from:r}:{text:i.text.slice(0,r-i.from),from:i.from}:i}textAfterPos(e,t=1){if(this.options.simulateDoubleBreak&&e==this.options.simulateBreak)return"";let{text:i,from:r}=this.lineAt(e,t);return i.slice(e-r,Math.min(i.length,e+100-r))}column(e,t=1){let{text:i,from:r}=this.lineAt(e,t),s=this.countColumn(i,e-r),o=this.options.overrideIndentation?this.options.overrideIndentation(r):-1;return o>-1&&(s+=o-this.countColumn(i,i.search(/\S|$/))),s}countColumn(e,t=e.length){return countColumn(e,this.state.tabSize,t)}lineIndent(e,t=1){let{text:i,from:r}=this.lineAt(e,t),s=this.options.overrideIndentation;if(s){let o=s(r);if(o>-1)return o}return this.countColumn(i,i.search(/\S|$/))}get simulatedBreak(){return this.options.simulateBreak||null}}const lV=new qe;function aV(n,e,t){return EA(e.resolveInner(t).enterUnfinishedNodesBefore(t),t,n)}function hV(n){return n.pos==n.options.simulateBreak&&n.options.simulateDoubleBreak}function cV(n){let e=n.type.prop(lV);if(e)return e;let t=n.firstChild,i;if(t&&(i=t.type.prop(NodeProp.closedBy))){let r=n.lastChild,s=r&&i.indexOf(r.name)>-1;return o=>TA(o,!0,1,void 0,s&&!hV(o)?r.from:void 0)}return n.parent==null?uV:null}function EA(n,e,t){for(;n;n=n.parent){let i=cV(n);if(i)return i(new fV(t,e,n))}return null}function uV(){return 0}class fV extends null{constructor(e,t,i){super(e.state,e.options),this.base=e,this.pos=t,this.node=i}get textAfter(){return this.textAfterPos(this.pos)}get baseIndent(){let e=this.state.doc.lineAt(this.node.from);for(;;){let t=this.node.resolve(e.from);for(;t.parent&&t.parent.from==t.from;)t=t.parent;if(dV(t,this.node))break;e=this.state.doc.lineAt(t.from)}return this.lineIndent(e.from)}continue(){let e=this.node.parent;return e?EA(e,this.pos,this.base):0}}function dV(n,e){for(let t=e;t;t=t.parent)if(n==t)return!0;return!1}function pV(n){let e=n.node,t=e.childAfter(e.from),i=e.lastChild;if(!t)return null;let r=n.options.simulateBreak,s=n.state.doc.lineAt(t.from),o=r==null||r<=s.from?s.to:Math.min(s.to,r);for(let l=t.to;;){let a=e.childAfter(l);if(!a||a==i)return null;if(!a.type.isSkipped)return a.from<o?t:null;l=a.to}}function T6({closing:n,align:e=!0,units:t=1}){return i=>TA(i,e,t,n)}function TA(n,e,t,i,r){let s=n.textAfter,o=s.match(/^\s*/)[0].length,l=i&&s.slice(o,o+i.length)==i||r==n.pos+o,a=e?pV(n):null;return a?l?n.column(a.from):n.column(a.to):n.baseIndent+(l?0:n.unit*t)}const P6=n=>n.baseIndent;function B6({except:n,units:e=1}={}){return t=>{let i=n&&n.test(t.textAfter);return t.baseIndent+(i?0:e*t.unit)}}const mV=200;function R6(){return EditorState.transactionFilter.of(n=>{if(!n.docChanged||!n.isUserEvent("input.type")&&!n.isUserEvent("input.complete"))return n;let e=n.startState.languageDataAt("indentOnInput",n.startState.selection.main.head);if(!e.length)return n;let t=n.newDoc,{head:i}=n.newSelection.main,r=t.lineAt(i);if(i>r.from+mV)return n;let s=t.sliceString(r.from,i);if(!e.some(h=>h.test(s)))return n;let{state:o}=n,l=-1,a=[];for(let{head:h}of o.selection.ranges){let c=o.doc.lineAt(h);if(c.from==l)continue;l=c.from;let u=sV(o,c.from);if(u==null)continue;let f=/^\s*/.exec(c.text)[0],d=rV(o,u);f!=d&&a.push({from:c.from,to:c.from+f.length,insert:d})}return a.length?[n,{changes:a,sequential:!0}]:n})}const gV=null,yV=new qe;function L6(n){let e=n.firstChild,t=n.lastChild;return e&&e.to<t.from?{from:e.to,to:t.type.isError?n.to:t.from}:null}function vV(n,e,t){let i=ll(n);if(i.length==0)return null;let r=i.resolveInner(t),s=null;for(let o=r;o;o=o.parent){if(o.to<=t||o.from>t)continue;if(s&&o.from<e)break;let l=o.type.prop(yV);if(l&&(o.to<i.length-50||i.length==n.doc.length||!wV(o))){let a=l(o,n);a&&a.from<=t&&a.from>=e&&a.to>t&&(s=a)}}return s}function wV(n){let e=n.lastChild;return e&&e.to==n.to&&e.type.isError}function F6(n,e,t){for(let i of n.facet(gV)){let r=i(n,e,t);if(r)return r}return vV(n,e,t)}function PA(n,e,t,i=0,r=0){e==null&&(e=n.search(/[^\s\u00a0]/),e==-1&&(e=n.length));let s=r;for(let o=i;o<e;o++)n.charCodeAt(o)==9?s+=t-s%t:s++;return s}class BA{constructor(e,t,i){this.string=e,this.tabSize=t,this.indentUnit=i,this.pos=0,this.start=0,this.lastColumnPos=0,this.lastColumnValue=0}eol(){return this.pos>=this.string.length}sol(){return this.pos==0}peek(){return this.string.charAt(this.pos)||void 0}next(){if(this.pos<this.string.length)return this.string.charAt(this.pos++)}eat(e){let t=this.string.charAt(this.pos),i;if(typeof e=="string"?i=t==e:i=t&&(e instanceof RegExp?e.test(t):e(t)),i)return++this.pos,t}eatWhile(e){let t=this.pos;for(;this.eat(e););return this.pos>t}eatSpace(){let e=this.pos;for(;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++this.pos;return this.pos>e}skipToEnd(){this.pos=this.string.length}skipTo(e){let t=this.string.indexOf(e,this.pos);if(t>-1)return this.pos=t,!0}backUp(e){this.pos-=e}column(){return this.lastColumnPos<this.start&&(this.lastColumnValue=PA(this.string,this.start,this.tabSize,this.lastColumnPos,this.lastColumnValue),this.lastColumnPos=this.start),this.lastColumnValue}indentation(){return PA(this.string,null,this.tabSize)}match(e,t,i){if(typeof e=="string"){let r=o=>i?o.toLowerCase():o,s=this.string.substr(this.pos,e.length);return r(s)==r(e)?(t!==!1&&(this.pos+=e.length),!0):null}else{let r=this.string.slice(this.pos).match(e);return r&&r.index>0?null:(r&&t!==!1&&(this.pos+=r[0].length),r)}}current(){return this.string.slice(this.start,this.pos)}}function bV(n){return{token:n.token,blankLine:n.blankLine||(()=>{}),startState:n.startState||(()=>!0),copyState:n.copyState||xV,indent:n.indent||(()=>null),languageData:n.languageData||{},tokenTable:n.tokenTable||Yg}}function xV(n){if(typeof n!="object")return n;let e={};for(let t in n){let i=n[t];e[t]=i instanceof Array?i.slice():i}return e}class Jg extends Sn{constructor(e){let t=SA(e.languageData),i=bV(e),r,s=new class extends Z1{createParse(o,l,a){return new kV(r,o,l,a)}};super(t,s,OV(t),[DA.of((o,l)=>this.getIndent(o,l))]),r=this,this.streamParser=i,this.stateAfter=new qe({perNode:!0}),this.tokenTable=e.tokenTable?new IA(i.tokenTable):AV}static define(e){return new Jg(e)}getIndent(e,t){let i=ll(e.state),r=i.resolve(t);for(;r&&r.type!=this.topNode;)r=r.parent;if(!r)return null;let s=Zg(this,i,0,r.from,t),o,l;if(s?(l=s.state,o=s.pos+1):(l=this.streamParser.startState(e.unit),o=0),t-o>1e4)return null;for(;o<t;){let h=e.state.doc.lineAt(o),c=Math.min(t,h.to);if(h.length){let u=new BA(h.text,e.state.tabSize,e.unit);for(;u.pos<c-h.from;)LA(this.streamParser.token,u,l)}else this.streamParser.blankLine(l,e.unit);if(c==t)break;o=h.to+1}let{text:a}=e.lineAt(t);return this.streamParser.indent(l,/^\s*(.*)/.exec(a)[1],e)}get allowsNesting(){return!1}}function Zg(n,e,t,i,r){let s=t>=i&&t+e.length<=r&&e.prop(n.stateAfter);if(s)return{state:n.streamParser.copyState(s),pos:t+e.length};for(let o=e.children.length-1;o>=0;o--){let l=e.children[o],a=t+e.positions[o],h=l instanceof et&&a<r&&Zg(n,l,a,i,r);if(h)return h}return null}function RA(n,e,t,i,r){if(r&&t<=0&&i>=e.length)return e;!r&&e.type==n.topNode&&(r=!0);for(let s=e.children.length-1;s>=0;s--){let o=e.positions[s],l=e.children[s],a;if(o<i&&l instanceof et){if(!(a=RA(n,l,t-o,i-o,r)))break;return r?new et(e.type,e.children.slice(0,s).concat(a),e.positions.slice(0,s+1),o+a.length):a}}return null}function SV(n,e,t,i){for(let r of e){let s=r.from+(r.openStart?25:0),o=r.to-(r.openEnd?25:0),l=s<=t&&o>t&&Zg(n,r.tree,0-r.offset,t,o),a;if(l&&(a=RA(n,r.tree,t+r.offset,l.pos+r.offset,!1)))return{state:l.state,tree:a}}return{state:n.streamParser.startState(i?xu(i):4),tree:et.empty}}class kV{constructor(e,t,i,r){this.lang=e,this.input=t,this.fragments=i,this.ranges=r,this.stoppedAt=null,this.chunks=[],this.chunkPos=[],this.chunk=[],this.chunkReused=void 0,this.rangeIndex=0,this.to=r[r.length-1].to;let s=Ia.get(),o=r[0].from,{state:l,tree:a}=SV(e,i,o,s==null?void 0:s.state);this.state=l,this.parsedPos=this.chunkStart=o+a.length;for(let h=0;h<a.children.length;h++)this.chunks.push(a.children[h]),this.chunkPos.push(a.positions[h]);s&&this.parsedPos<s.viewport.from-1e5&&(this.state=this.lang.streamParser.startState(xu(s.state)),s.skipUntilInView(this.parsedPos,s.viewport.from),this.parsedPos=s.viewport.from),this.moveRangeIndex()}advance(){let e=Ia.get(),t=this.stoppedAt==null?this.to:Math.min(this.to,this.stoppedAt),i=Math.min(t,this.chunkStart+2048);for(e&&(i=Math.min(i,e.viewport.to));this.parsedPos<i;)this.parseLine(e);return this.chunkStart<this.parsedPos&&this.finishChunk(),this.parsedPos>=t?this.finish():e&&this.parsedPos>=e.viewport.to?(e.skipUntilInView(this.parsedPos,t),this.finish()):null}stopAt(e){this.stoppedAt=e}lineAfter(e){let t=this.input.chunk(e);if(this.input.lineChunks)t==`
`&&(t="");else{let i=t.indexOf(`
`);i>-1&&(t=t.slice(0,i))}return e+t.length<=this.to?t:t.slice(0,this.to-e)}nextLine(){let e=this.parsedPos,t=this.lineAfter(e),i=e+t.length;for(let r=this.rangeIndex;;){let s=this.ranges[r].to;if(s>=i||(t=t.slice(0,s-(i-t.length)),r++,r==this.ranges.length))break;let o=this.ranges[r].from,l=this.lineAfter(o);t+=l,i=o+l.length}return{line:t,end:i}}skipGapsTo(e,t,i){for(;;){let r=this.ranges[this.rangeIndex].to,s=e+t;if(i>0?r>s:r>=s)break;t+=this.ranges[++this.rangeIndex].from-r}return t}moveRangeIndex(){for(;this.ranges[this.rangeIndex].to<this.parsedPos;)this.rangeIndex++}emitToken(e,t,i,r,s){if(this.ranges.length>1){s=this.skipGapsTo(t,s,1),t+=s;let o=this.chunk.length;s=this.skipGapsTo(i,s,-1),i+=s,r+=this.chunk.length-o}return this.chunk.push(e,t,i,r),s}parseLine(e){let{line:t,end:i}=this.nextLine(),r=0,{streamParser:s}=this.lang,o=new BA(t,e?e.state.tabSize:4,e?xu(e.state):2);if(o.eol())s.blankLine(this.state,o.indentUnit);else for(;!o.eol();){let l=LA(s.token,o,this.state);if(l&&(r=this.emitToken(this.lang.tokenTable.resolve(l),this.parsedPos+o.start,this.parsedPos+o.pos,4,r)),o.start>1e4)break}this.parsedPos=i,this.moveRangeIndex(),this.parsedPos<this.to&&this.parsedPos++}finishChunk(){let e=et.build({buffer:this.chunk,start:this.chunkStart,length:this.parsedPos-this.chunkStart,nodeSet:CV,topID:0,maxBufferLength:2048,reused:this.chunkReused});e=new et(e.type,e.children,e.positions,e.length,[[this.lang.stateAfter,this.lang.streamParser.copyState(this.state)]]),this.chunks.push(e),this.chunkPos.push(this.chunkStart-this.ranges[0].from),this.chunk=[],this.chunkReused=void 0,this.chunkStart=this.parsedPos}finish(){return new et(this.lang.topNode,this.chunks,this.chunkPos,this.parsedPos-this.ranges[0].from).balance()}}function LA(n,e,t){e.start=e.pos;for(let i=0;i<10;i++){let r=n(e,t);if(e.pos>e.start)return r}throw new Error("Stream parser failed to advance stream.")}const Yg=Object.create(null),Wa=[Ei.none],CV=new Xp(Wa),FA=[],NA=Object.create(null);for(let[n,e]of[["variable","variableName"],["variable-2","variableName.special"],["string-2","string.special"],["def","variableName.definition"],["tag","typeName"],["attribute","propertyName"],["type","typeName"],["builtin","variableName.standard"],["qualifier","modifier"],["error","invalid"],["header","heading"],["property","propertyName"]])NA[n]=WA(Yg,e);class IA{constructor(e){this.extra=e,this.table=Object.assign(Object.create(null),NA)}resolve(e){return e?this.table[e]||(this.table[e]=WA(this.extra,e)):0}}const AV=new IA(Yg);function Xg(n,e){FA.indexOf(n)>-1||(FA.push(n),console.warn(e))}function WA(n,e){let t=null;for(let s of e.split(".")){let o=n[s]||te[s];o?typeof o=="function"?t?t=o(t):Xg(s,`Modifier ${s} used at start of tag`):t?Xg(s,`Tag ${s} used as modifier`):t=o:Xg(s,`Unknown highlighting tag ${s}`)}if(!t)return 0;let i=e.replace(/ /g,"_"),r=Ei.define({id:Wa.length,name:i,props:[lW({[i]:t})]});return Wa.push(r),r.id}function OV(n){let e=Ei.define({id:Wa.length,name:"Document",props:[Fa.add(()=>n)]});return Wa.push(e),e}var _V=w(7896),DV=w(31461);class $e{constructor(){}lineAt(e){if(e<0||e>this.length)throw new RangeError(`Invalid position ${e} in document of length ${this.length}`);return this.lineInner(e,!1,1,0)}line(e){if(e<1||e>this.lines)throw new RangeError(`Invalid line number ${e} in ${this.lines}-line document`);return this.lineInner(e,!0,1,0)}replace(e,t,i){let r=[];return this.decompose(0,e,r,2),i.length&&i.decompose(0,i.length,r,3),this.decompose(t,this.length,r,1),ir.from(r,this.length-(t-e)+i.length)}append(e){return this.replace(this.length,this.length,e)}slice(e,t=this.length){let i=[];return this.decompose(e,t,i,0),ir.from(i,t-e)}eq(e){if(e==this)return!0;if(e.length!=this.length||e.lines!=this.lines)return!1;let t=this.scanIdentical(e,1),i=this.length-this.scanIdentical(e,-1),r=new Va(this),s=new Va(e);for(let o=t,l=t;;){if(r.next(o),s.next(o),o=0,r.lineBreak!=s.lineBreak||r.done!=s.done||r.value!=s.value)return!1;if(l+=r.value.length,r.done||l>=i)return!0}}iter(e=1){return new Va(this,e)}iterRange(e,t=this.length){return new HA(this,e,t)}iterLines(e,t){let i;if(e==null)i=this.iter();else{t==null&&(t=this.lines+1);let r=this.line(e).from;i=this.iterRange(r,Math.max(r,t==this.lines+1?this.length:t<=1?0:this.line(t-1).to))}return new zA(i)}toString(){return this.sliceString(0)}toJSON(){let e=[];return this.flatten(e),e}static of(e){if(e.length==0)throw new RangeError("A document must have at least one line");return e.length==1&&!e[0]?$e.empty:e.length<=32?new Ft(e):ir.from(Ft.split(e,[]))}}class Ft extends $e{constructor(e,t=MV(e)){super(),this.text=e,this.length=t}get lines(){return this.text.length}get children(){return null}lineInner(e,t,i,r){for(let s=0;;s++){let o=this.text[s],l=r+o.length;if((t?i:l)>=e)return new EV(r,l,i,o);r=l+1,i++}}decompose(e,t,i,r){let s=e<=0&&t>=this.length?this:new Ft(VA(this.text,e,t),Math.min(t,this.length)-Math.max(0,e));if(r&1){let o=i.pop(),l=Su(s.text,o.text.slice(),0,s.length);if(l.length<=32)i.push(new Ft(l,o.length+s.length));else{let a=l.length>>1;i.push(new Ft(l.slice(0,a)),new Ft(l.slice(a)))}}else i.push(s)}replace(e,t,i){if(!(i instanceof Ft))return super.replace(e,t,i);let r=Su(this.text,Su(i.text,VA(this.text,0,e)),t),s=this.length+i.length-(t-e);return r.length<=32?new Ft(r,s):ir.from(Ft.split(r,[]),s)}sliceString(e,t=this.length,i=`
`){let r="";for(let s=0,o=0;s<=t&&o<this.text.length;o++){let l=this.text[o],a=s+l.length;s>e&&o&&(r+=i),e<a&&t>s&&(r+=l.slice(Math.max(0,e-s),t-s)),s=a+1}return r}flatten(e){for(let t of this.text)e.push(t)}scanIdentical(){return 0}static split(e,t){let i=[],r=-1;for(let s of e)i.push(s),r+=s.length+1,i.length==32&&(t.push(new Ft(i,r)),i=[],r=-1);return r>-1&&t.push(new Ft(i,r)),t}}class ir extends $e{constructor(e,t){super(),this.children=e,this.length=t,this.lines=0;for(let i of e)this.lines+=i.lines}lineInner(e,t,i,r){for(let s=0;;s++){let o=this.children[s],l=r+o.length,a=i+o.lines-1;if((t?a:l)>=e)return o.lineInner(e,t,i,r);r=l+1,i=a+1}}decompose(e,t,i,r){for(let s=0,o=0;o<=t&&s<this.children.length;s++){let l=this.children[s],a=o+l.length;if(e<=a&&t>=o){let h=r&((o<=e?1:0)|(a>=t?2:0));o>=e&&a<=t&&!h?i.push(l):l.decompose(e-o,t-o,i,h)}o=a+1}}replace(e,t,i){if(i.lines<this.lines)for(let r=0,s=0;r<this.children.length;r++){let o=this.children[r],l=s+o.length;if(e>=s&&t<=l){let a=o.replace(e-s,t-s,i),h=this.lines-o.lines+a.lines;if(a.lines<h>>5-1&&a.lines>h>>5+1){let c=this.children.slice();return c[r]=a,new ir(c,this.length-(t-e)+i.length)}return super.replace(s,l,a)}s=l+1}return super.replace(e,t,i)}sliceString(e,t=this.length,i=`
`){let r="";for(let s=0,o=0;s<this.children.length&&o<=t;s++){let l=this.children[s],a=o+l.length;o>e&&s&&(r+=i),e<a&&t>o&&(r+=l.sliceString(e-o,t-o,i)),o=a+1}return r}flatten(e){for(let t of this.children)t.flatten(e)}scanIdentical(e,t){if(!(e instanceof ir))return 0;let i=0,[r,s,o,l]=t>0?[0,0,this.children.length,e.children.length]:[this.children.length-1,e.children.length-1,-1,-1];for(;;r+=t,s+=t){if(r==o||s==l)return i;let a=this.children[r],h=e.children[s];if(a!=h)return i+a.scanIdentical(h,t);i+=a.length+1}}static from(e,t=e.reduce((i,r)=>i+r.length+1,-1)){let i=0;for(let d of e)i+=d.lines;if(i<32){let d=[];for(let p of e)p.flatten(d);return new Ft(d,t)}let r=Math.max(32,i>>5),s=r<<1,o=r>>1,l=[],a=0,h=-1,c=[];function u(d){let p;if(d.lines>s&&d instanceof ir)for(let g of d.children)u(g);else d.lines>o&&(a>o||!a)?(f(),l.push(d)):d instanceof Ft&&a&&(p=c[c.length-1])instanceof Ft&&d.lines+p.lines<=32?(a+=d.lines,h+=d.length+1,c[c.length-1]=new Ft(p.text.concat(d.text),p.length+1+d.length)):(a+d.lines>r&&f(),a+=d.lines,h+=d.length+1,c.push(d))}function f(){a!=0&&(l.push(c.length==1?c[0]:ir.from(c,h)),h=-1,a=c.length=0)}for(let d of e)u(d);return f(),l.length==1?l[0]:new ir(l,t)}}$e.empty=new Ft([""],0);function MV(n){let e=-1;for(let t of n)e+=t.length+1;return e}function Su(n,e,t=0,i=1e9){for(let r=0,s=0,o=!0;s<n.length&&r<=i;s++){let l=n[s],a=r+l.length;a>=t&&(a>i&&(l=l.slice(0,i-r)),r<t&&(l=l.slice(t-r)),o?(e[e.length-1]+=l,o=!1):e.push(l)),r=a+1}return e}function VA(n,e,t){return Su(n,[""],e,t)}class Va{constructor(e,t=1){this.dir=t,this.done=!1,this.lineBreak=!1,this.value="",this.nodes=[e],this.offsets=[t>0?1:(e instanceof Ft?e.text.length:e.children.length)<<1]}nextInner(e,t){for(this.done=this.lineBreak=!1;;){let i=this.nodes.length-1,r=this.nodes[i],s=this.offsets[i],o=s>>1,l=r instanceof Ft?r.text.length:r.children.length;if(o==(t>0?l:0)){if(i==0)return this.done=!0,this.value="",this;t>0&&this.offsets[i-1]++,this.nodes.pop(),this.offsets.pop()}else if((s&1)==(t>0?0:1)){if(this.offsets[i]+=t,e==0)return this.lineBreak=!0,this.value=`
`,this;e--}else if(r instanceof Ft){let a=r.text[o+(t<0?-1:0)];if(this.offsets[i]+=t,a.length>Math.max(0,e))return this.value=e==0?a:t>0?a.slice(e):a.slice(0,a.length-e),this;e-=a.length}else{let a=r.children[o+(t<0?-1:0)];e>a.length?(e-=a.length,this.offsets[i]+=t):(t<0&&this.offsets[i]--,this.nodes.push(a),this.offsets.push(t>0?1:(a instanceof Ft?a.text.length:a.children.length)<<1))}}}next(e=0){return e<0&&(this.nextInner(-e,-this.dir),e=this.value.length),this.nextInner(e,this.dir)}}class HA{constructor(e,t,i){this.value="",this.done=!1,this.cursor=new Va(e,t>i?-1:1),this.pos=t>i?e.length:0,this.from=Math.min(t,i),this.to=Math.max(t,i)}nextInner(e,t){if(t<0?this.pos<=this.from:this.pos>=this.to)return this.value="",this.done=!0,this;e+=Math.max(0,t<0?this.pos-this.to:this.from-this.pos);let i=t<0?this.pos-this.from:this.to-this.pos;e>i&&(e=i),i-=e;let{value:r}=this.cursor.next(e);return this.pos+=(r.length+e)*t,this.value=r.length<=i?r:t<0?r.slice(r.length-i):r.slice(0,i),this.done=!this.value,this}next(e=0){return e<0?e=Math.max(e,this.from-this.pos):e>0&&(e=Math.min(e,this.to-this.pos)),this.nextInner(e,this.cursor.dir)}get lineBreak(){return this.cursor.lineBreak&&this.value!=""}}class zA{constructor(e){this.inner=e,this.afterBreak=!0,this.value="",this.done=!1}next(e=0){let{done:t,lineBreak:i,value:r}=this.inner.next(e);return t?(this.done=!0,this.value=""):i?this.afterBreak?this.value="":(this.afterBreak=!0,this.next()):(this.value=r,this.afterBreak=!1),this}get lineBreak(){return!1}}typeof Symbol!="undefined"&&($e.prototype[Symbol.iterator]=function(){return this.iter()},Va.prototype[Symbol.iterator]=HA.prototype[Symbol.iterator]=zA.prototype[Symbol.iterator]=function(){return this});class EV{constructor(e,t,i,r){this.from=e,this.to=t,this.number=i,this.text=r}get length(){return this.to-this.from}}let cl="lc,34,7n,7,7b,19,,,,2,,2,,,20,b,1c,l,g,,2t,7,2,6,2,2,,4,z,,u,r,2j,b,1m,9,9,,o,4,,9,,3,,5,17,3,3b,f,,w,1j,,,,4,8,4,,3,7,a,2,t,,1m,,,,2,4,8,,9,,a,2,q,,2,2,1l,,4,2,4,2,2,3,3,,u,2,3,,b,2,1l,,4,5,,2,4,,k,2,m,6,,,1m,,,2,,4,8,,7,3,a,2,u,,1n,,,,c,,9,,14,,3,,1l,3,5,3,,4,7,2,b,2,t,,1m,,2,,2,,3,,5,2,7,2,b,2,s,2,1l,2,,,2,4,8,,9,,a,2,t,,20,,4,,2,3,,,8,,29,,2,7,c,8,2q,,2,9,b,6,22,2,r,,,,,,1j,e,,5,,2,5,b,,10,9,,2u,4,,6,,2,2,2,p,2,4,3,g,4,d,,2,2,6,,f,,jj,3,qa,3,t,3,t,2,u,2,1s,2,,7,8,,2,b,9,,19,3,3b,2,y,,3a,3,4,2,9,,6,3,63,2,2,,1m,,,7,,,,,2,8,6,a,2,,1c,h,1r,4,1c,7,,,5,,14,9,c,2,w,4,2,2,,3,1k,,,2,3,,,3,1m,8,2,2,48,3,,d,,7,4,,6,,3,2,5i,1m,,5,ek,,5f,x,2da,3,3x,,2o,w,fe,6,2x,2,n9w,4,,a,w,2,28,2,7k,,3,,4,,p,2,5,,47,2,q,i,d,,12,8,p,b,1a,3,1c,,2,4,2,2,13,,1v,6,2,2,2,2,c,,8,,1b,,1f,,,3,2,2,5,2,,,16,2,8,,6m,,2,,4,,fn4,,kh,g,g,g,a6,2,gt,,6a,,45,5,1ae,3,,2,5,4,14,3,4,,4l,2,fx,4,ar,2,49,b,4w,,1i,f,1k,3,1d,4,2,2,1x,3,10,5,,8,1q,,c,2,1g,9,a,4,2,,2n,3,2,,,2,6,,4g,,3,8,l,2,1l,2,,,,,m,,e,7,3,5,5f,8,2,3,,,n,,29,,2,6,,,2,,,2,,2,6j,,2,4,6,2,,2,r,2,2d,8,2,,,2,2y,,,,2,6,,,2t,3,2,4,,5,77,9,,2,6t,,a,2,,,4,,40,4,2,2,4,,w,a,14,6,2,4,8,,9,6,2,3,1a,d,,2,ba,7,,6,,,2a,m,2,7,,2,,2,3e,6,3,,,2,,7,,,20,2,3,,,,9n,2,f0b,5,1n,7,t4,,1r,4,29,,f5k,2,43q,,,3,4,5,8,8,2,7,u,4,44,3,1iz,1j,4,1e,8,,e,,m,5,,f,11s,7,,h,2,7,,2,,5,79,7,c5,4,15s,7,31,7,240,5,gx7k,2o,3k,6o".split(",").map(n=>n?parseInt(n,36):1);for(let n=1;n<cl.length;n++)cl[n]+=cl[n-1];function TV(n){for(let e=1;e<cl.length;e+=2)if(cl[e]>n)return cl[e-1]<=n;return!1}function jA(n){return n>=127462&&n<=127487}const $A=8205;function un(n,e,t=!0,i=!0){return(t?UA:PV)(n,e,i)}function UA(n,e,t){if(e==n.length)return e;e&&qA(n.charCodeAt(e))&&KA(n.charCodeAt(e-1))&&e--;let i=xi(n,e);for(e+=kn(i);e<n.length;){let r=xi(n,e);if(i==$A||r==$A||t&&TV(r))e+=kn(r),i=r;else if(jA(r)){let s=0,o=e-2;for(;o>=0&&jA(xi(n,o));)s++,o-=2;if(s%2==0)break;e+=2}else break}return e}function PV(n,e,t){for(;e>0;){let i=UA(n,e-2,t);if(i<e)return i;e--}return 0}function qA(n){return n>=56320&&n<57344}function KA(n){return n>=55296&&n<56320}function xi(n,e){let t=n.charCodeAt(e);if(!KA(t)||e+1==n.length)return t;let i=n.charCodeAt(e+1);return qA(i)?(t-55296<<10)+(i-56320)+65536:t}function Qg(n){return n<=65535?String.fromCharCode(n):(n-=65536,String.fromCharCode((n>>10)+55296,(n&1023)+56320))}function kn(n){return n<65536?1:2}const e0=/\r\n?|\n/;var Wi=function(n){return n[n.Simple=0]="Simple",n[n.TrackDel=1]="TrackDel",n[n.TrackBefore=2]="TrackBefore",n[n.TrackAfter=3]="TrackAfter",n}(Wi||(Wi={}));class Lr{constructor(e){this.sections=e}get length(){let e=0;for(let t=0;t<this.sections.length;t+=2)e+=this.sections[t];return e}get newLength(){let e=0;for(let t=0;t<this.sections.length;t+=2){let i=this.sections[t+1];e+=i<0?this.sections[t]:i}return e}get empty(){return this.sections.length==0||this.sections.length==2&&this.sections[1]<0}iterGaps(e){for(let t=0,i=0,r=0;t<this.sections.length;){let s=this.sections[t++],o=this.sections[t++];o<0?(e(i,r,s),r+=s):r+=o,i+=s}}iterChangedRanges(e,t=!1){t0(this,e,t)}get invertedDesc(){let e=[];for(let t=0;t<this.sections.length;){let i=this.sections[t++],r=this.sections[t++];r<0?e.push(i,r):e.push(r,i)}return new Lr(e)}composeDesc(e){return this.empty?e:e.empty?this:GA(this,e)}mapDesc(e,t=!1){return e.empty?this:i0(this,e,t)}mapPos(e,t=-1,i=Wi.Simple){let r=0,s=0;for(let o=0;o<this.sections.length;){let l=this.sections[o++],a=this.sections[o++],h=r+l;if(a<0){if(h>e)return s+(e-r);s+=l}else{if(i!=Wi.Simple&&h>=e&&(i==Wi.TrackDel&&r<e&&h>e||i==Wi.TrackBefore&&r<e||i==Wi.TrackAfter&&h>e))return null;if(h>e||h==e&&t<0&&!l)return e==r||t<0?s:s+a;s+=a}r=h}if(e>r)throw new RangeError(`Position ${e} is out of range for changeset of length ${r}`);return s}touchesRange(e,t=e){for(let i=0,r=0;i<this.sections.length&&r<=t;){let s=this.sections[i++],o=this.sections[i++],l=r+s;if(o>=0&&r<=t&&l>=e)return r<e&&l>t?"cover":!0;r=l}return!1}toString(){let e="";for(let t=0;t<this.sections.length;){let i=this.sections[t++],r=this.sections[t++];e+=(e?" ":"")+i+(r>=0?":"+r:"")}return e}toJSON(){return this.sections}static fromJSON(e){if(!Array.isArray(e)||e.length%2||e.some(t=>typeof t!="number"))throw new RangeError("Invalid JSON representation of ChangeDesc");return new Lr(e)}}class Yt extends Lr{constructor(e,t){super(e),this.inserted=t}apply(e){if(this.length!=e.length)throw new RangeError("Applying change set to a document with the wrong length");return t0(this,(t,i,r,s,o)=>e=e.replace(r,r+(i-t),o),!1),e}mapDesc(e,t=!1){return i0(this,e,t,!0)}invert(e){let t=this.sections.slice(),i=[];for(let r=0,s=0;r<t.length;r+=2){let o=t[r],l=t[r+1];if(l>=0){t[r]=l,t[r+1]=o;let a=r>>1;for(;i.length<a;)i.push($e.empty);i.push(o?e.slice(s,s+o):$e.empty)}s+=o}return new Yt(t,i)}compose(e){return this.empty?e:e.empty?this:GA(this,e,!0)}map(e,t=!1){return e.empty?this:i0(this,e,t,!0)}iterChanges(e,t=!1){t0(this,e,t)}get desc(){return new Lr(this.sections)}filter(e){let t=[],i=[],r=[],s=new Ha(this);e:for(let o=0,l=0;;){let a=o==e.length?1e9:e[o++];for(;l<a||l==a&&s.len==0;){if(s.done)break e;let c=Math.min(s.len,a-l);Vi(r,c,-1);let u=s.ins==-1?-1:s.off==0?s.ins:0;Vi(t,c,u),u>0&&po(i,t,s.text),s.forward(c),l+=c}let h=e[o++];for(;l<h;){if(s.done)break e;let c=Math.min(s.len,h-l);Vi(t,c,-1),Vi(r,c,s.ins==-1?-1:s.off==0?s.ins:0),s.forward(c),l+=c}}return{changes:new Yt(t,i),filtered:new Lr(r)}}toJSON(){let e=[];for(let t=0;t<this.sections.length;t+=2){let i=this.sections[t],r=this.sections[t+1];r<0?e.push(i):r==0?e.push([i]):e.push([i].concat(this.inserted[t>>1].toJSON()))}return e}static of(e,t,i){let r=[],s=[],o=0,l=null;function a(c=!1){if(!c&&!r.length)return;o<t&&Vi(r,t-o,-1);let u=new Yt(r,s);l=l?l.compose(u.map(l)):u,r=[],s=[],o=0}function h(c){if(Array.isArray(c))for(let u of c)h(u);else if(c instanceof Yt){if(c.length!=t)throw new RangeError(`Mismatched change set length (got ${c.length}, expected ${t})`);a(),l=l?l.compose(c.map(l)):c}else{let{from:u,to:f=u,insert:d}=c;if(u>f||u<0||f>t)throw new RangeError(`Invalid change range ${u} to ${f} (in doc of length ${t})`);let p=d?typeof d=="string"?$e.of(d.split(i||e0)):d:$e.empty,g=p.length;if(u==f&&g==0)return;u<o&&a(),u>o&&Vi(r,u-o,-1),Vi(r,f-u,g),po(s,r,p),o=f}}return h(e),a(!l),l}static empty(e){return new Yt(e?[e,-1]:[],[])}static fromJSON(e){if(!Array.isArray(e))throw new RangeError("Invalid JSON representation of ChangeSet");let t=[],i=[];for(let r=0;r<e.length;r++){let s=e[r];if(typeof s=="number")t.push(s,-1);else{if(!Array.isArray(s)||typeof s[0]!="number"||s.some((o,l)=>l&&typeof o!="string"))throw new RangeError("Invalid JSON representation of ChangeSet");if(s.length==1)t.push(s[0],0);else{for(;i.length<r;)i.push($e.empty);i[r]=$e.of(s.slice(1)),t.push(s[0],i[r].length)}}}return new Yt(t,i)}}function Vi(n,e,t,i=!1){if(e==0&&t<=0)return;let r=n.length-2;r>=0&&t<=0&&t==n[r+1]?n[r]+=e:e==0&&n[r]==0?n[r+1]+=t:i?(n[r]+=e,n[r+1]+=t):n.push(e,t)}function po(n,e,t){if(t.length==0)return;let i=e.length-2>>1;if(i<n.length)n[n.length-1]=n[n.length-1].append(t);else{for(;n.length<i;)n.push($e.empty);n.push(t)}}function t0(n,e,t){let i=n.inserted;for(let r=0,s=0,o=0;o<n.sections.length;){let l=n.sections[o++],a=n.sections[o++];if(a<0)r+=l,s+=l;else{let h=r,c=s,u=$e.empty;for(;h+=l,c+=a,a&&i&&(u=u.append(i[o-2>>1])),!(t||o==n.sections.length||n.sections[o+1]<0);)l=n.sections[o++],a=n.sections[o++];e(r,h,s,c,u),r=h,s=c}}}function i0(n,e,t,i=!1){let r=[],s=i?[]:null,o=new Ha(n),l=new Ha(e);for(let a=0,h=0;;)if(o.ins==-1)a+=o.len,o.next();else if(l.ins==-1&&h<a){let c=Math.min(l.len,a-h);l.forward(c),Vi(r,c,-1),h+=c}else if(l.ins>=0&&(o.done||h<a||h==a&&(l.len<o.len||l.len==o.len&&!t))){for(Vi(r,l.ins,-1);a>h&&!o.done&&a+o.len<h+l.len;)a+=o.len,o.next();h+=l.len,l.next()}else if(o.ins>=0){let c=0,u=a+o.len;for(;;)if(l.ins>=0&&h>a&&h+l.len<u)c+=l.ins,h+=l.len,l.next();else if(l.ins==-1&&h<u){let f=Math.min(l.len,u-h);c+=f,l.forward(f),h+=f}else break;Vi(r,c,o.ins),s&&po(s,r,o.text),a=u,o.next()}else{if(o.done&&l.done)return s?new Yt(r,s):new Lr(r);throw new Error("Mismatched change set lengths")}}function GA(n,e,t=!1){let i=[],r=t?[]:null,s=new Ha(n),o=new Ha(e);for(let l=!1;;){if(s.done&&o.done)return r?new Yt(i,r):new Lr(i);if(s.ins==0)Vi(i,s.len,0,l),s.next();else if(o.len==0&&!o.done)Vi(i,0,o.ins,l),r&&po(r,i,o.text),o.next();else{if(s.done||o.done)throw new Error("Mismatched change set lengths");{let a=Math.min(s.len2,o.len),h=i.length;if(s.ins==-1){let c=o.ins==-1?-1:o.off?0:o.ins;Vi(i,a,c,l),r&&c&&po(r,i,o.text)}else o.ins==-1?(Vi(i,s.off?0:s.len,a,l),r&&po(r,i,s.textBit(a))):(Vi(i,s.off?0:s.len,o.off?0:o.ins,l),r&&!o.off&&po(r,i,o.text));l=(s.ins>a||o.ins>=0&&o.len>a)&&(l||i.length>h),s.forward2(a),o.forward(a)}}}}class Ha{constructor(e){this.set=e,this.i=0,this.next()}next(){let{sections:e}=this.set;this.i<e.length?(this.len=e[this.i++],this.ins=e[this.i++]):(this.len=0,this.ins=-2),this.off=0}get done(){return this.ins==-2}get len2(){return this.ins<0?this.len:this.ins}get text(){let{inserted:e}=this.set,t=this.i-2>>1;return t>=e.length?$e.empty:e[t]}textBit(e){let{inserted:t}=this.set,i=this.i-2>>1;return i>=t.length&&!e?$e.empty:t[i].slice(this.off,e==null?void 0:this.off+e)}forward(e){e==this.len?this.next():(this.len-=e,this.off+=e)}forward2(e){this.ins==-1?this.forward(e):e==this.ins?this.next():(this.ins-=e,this.off+=e)}}class ul{constructor(e,t,i){this.from=e,this.to=t,this.flags=i}get anchor(){return this.flags&16?this.to:this.from}get head(){return this.flags&16?this.from:this.to}get empty(){return this.from==this.to}get assoc(){return this.flags&4?-1:this.flags&8?1:0}get bidiLevel(){let e=this.flags&3;return e==3?null:e}get goalColumn(){let e=this.flags>>5;return e==33554431?void 0:e}map(e,t=-1){let i,r;return this.empty?i=r=e.mapPos(this.from,t):(i=e.mapPos(this.from,1),r=e.mapPos(this.to,-1)),i==this.from&&r==this.to?this:new ul(i,r,this.flags)}extend(e,t=e){if(e<=this.anchor&&t>=this.anchor)return L.range(e,t);let i=Math.abs(e-this.anchor)>Math.abs(t-this.anchor)?e:t;return L.range(this.anchor,i)}eq(e){return this.anchor==e.anchor&&this.head==e.head}toJSON(){return{anchor:this.anchor,head:this.head}}static fromJSON(e){if(!e||typeof e.anchor!="number"||typeof e.head!="number")throw new RangeError("Invalid JSON representation for SelectionRange");return L.range(e.anchor,e.head)}}class L{constructor(e,t=0){this.ranges=e,this.mainIndex=t}map(e,t=-1){return e.empty?this:L.create(this.ranges.map(i=>i.map(e,t)),this.mainIndex)}eq(e){if(this.ranges.length!=e.ranges.length||this.mainIndex!=e.mainIndex)return!1;for(let t=0;t<this.ranges.length;t++)if(!this.ranges[t].eq(e.ranges[t]))return!1;return!0}get main(){return this.ranges[this.mainIndex]}asSingle(){return this.ranges.length==1?this:new L([this.main])}addRange(e,t=!0){return L.create([e].concat(this.ranges),t?0:this.mainIndex+1)}replaceRange(e,t=this.mainIndex){let i=this.ranges.slice();return i[t]=e,L.create(i,this.mainIndex)}toJSON(){return{ranges:this.ranges.map(e=>e.toJSON()),main:this.mainIndex}}static fromJSON(e){if(!e||!Array.isArray(e.ranges)||typeof e.main!="number"||e.main>=e.ranges.length)throw new RangeError("Invalid JSON representation for EditorSelection");return new L(e.ranges.map(t=>ul.fromJSON(t)),e.main)}static single(e,t=e){return new L([L.range(e,t)],0)}static create(e,t=0){if(e.length==0)throw new RangeError("A selection needs at least one range");for(let i=0,r=0;r<e.length;r++){let s=e[r];if(s.empty?s.from<=i:s.from<i)return BV(e.slice(),t);i=s.to}return new L(e,t)}static cursor(e,t=0,i,r){return new ul(e,e,(t==0?0:t<0?4:8)|(i==null?3:Math.min(2,i))|(r!=null?r:33554431)<<5)}static range(e,t,i){let r=(i!=null?i:33554431)<<5;return t<e?new ul(t,e,16|r|8):new ul(e,t,r|(t>e?4:0))}}function BV(n,e=0){let t=n[e];n.sort((i,r)=>i.from-r.from),e=n.indexOf(t);for(let i=1;i<n.length;i++){let r=n[i],s=n[i-1];if(r.empty?r.from<=s.to:r.from<s.to){let o=s.from,l=Math.max(r.to,s.to);i<=e&&e--,n.splice(--i,2,r.anchor>r.head?L.range(l,o):L.range(o,l))}}return new L(n,e)}function JA(n,e){for(let t of n.ranges)if(t.to>e)throw new RangeError("Selection points outside of document")}let n0=0;class he{constructor(e,t,i,r,s){this.combine=e,this.compareInput=t,this.compare=i,this.isStatic=r,this.extensions=s,this.id=n0++,this.default=e([])}static define(e={}){return new he(e.combine||(t=>t),e.compareInput||((t,i)=>t===i),e.compare||(e.combine?(t,i)=>t===i:r0),!!e.static,e.enables)}of(e){return new ku([],this,0,e)}compute(e,t){if(this.isStatic)throw new Error("Can't compute a static facet");return new ku(e,this,1,t)}computeN(e,t){if(this.isStatic)throw new Error("Can't compute a static facet");return new ku(e,this,2,t)}from(e,t){return t||(t=i=>i),this.compute([e],i=>t(i.field(e)))}}function r0(n,e){return n==e||n.length==e.length&&n.every((t,i)=>t===e[i])}class ku{constructor(e,t,i,r){this.dependencies=e,this.facet=t,this.type=i,this.value=r,this.id=n0++}dynamicSlot(e){var t;let i=this.value,r=this.facet.compareInput,s=this.id,o=e[s]>>1,l=this.type==2,a=!1,h=!1,c=[];for(let u of this.dependencies)u=="doc"?a=!0:u=="selection"?h=!0:(((t=e[u.id])!==null&&t!==void 0?t:1)&1)==0&&c.push(e[u.id]);return{create(u){return u.values[o]=i(u),1},update(u,f){if(a&&f.docChanged||h&&(f.docChanged||f.selection)||s0(u,c)){let d=i(u);if(l?!ZA(d,u.values[o],r):!r(d,u.values[o]))return u.values[o]=d,1}return 0},reconfigure:(u,f)=>{let d=i(u),p=f.config.address[s];if(p!=null){let g=Ou(f,p);if(this.dependencies.every(y=>y instanceof he?f.facet(y)===u.facet(y):y instanceof zt?f.field(y,!1)==u.field(y,!1):!0)||(l?ZA(d,g,r):r(d,g)))return u.values[o]=g,0}return u.values[o]=d,1}}}}function ZA(n,e,t){if(n.length!=e.length)return!1;for(let i=0;i<n.length;i++)if(!t(n[i],e[i]))return!1;return!0}function s0(n,e){let t=!1;for(let i of e)ja(n,i)&1&&(t=!0);return t}function RV(n,e,t){let i=t.map(a=>n[a.id]),r=t.map(a=>a.type),s=i.filter(a=>!(a&1)),o=n[e.id]>>1;function l(a){let h=[];for(let c=0;c<i.length;c++){let u=Ou(a,i[c]);if(r[c]==2)for(let f of u)h.push(f);else h.push(u)}return e.combine(h)}return{create(a){for(let h of i)ja(a,h);return a.values[o]=l(a),1},update(a,h){if(!s0(a,s))return 0;let c=l(a);return e.compare(c,a.values[o])?0:(a.values[o]=c,1)},reconfigure(a,h){let c=s0(a,i),u=h.config.facets[e.id],f=h.facet(e);if(u&&!c&&r0(t,u))return a.values[o]=f,0;let d=l(a);return e.compare(d,f)?(a.values[o]=f,0):(a.values[o]=d,1)}}}const YA=he.define({static:!0});class zt{constructor(e,t,i,r,s){this.id=e,this.createF=t,this.updateF=i,this.compareF=r,this.spec=s,this.provides=void 0}static define(e){let t=new zt(n0++,e.create,e.update,e.compare||((i,r)=>i===r),e);return e.provide&&(t.provides=e.provide(t)),t}create(e){let t=e.facet(YA).find(i=>i.field==this);return((t==null?void 0:t.create)||this.createF)(e)}slot(e){let t=e[this.id]>>1;return{create:i=>(i.values[t]=this.create(i),1),update:(i,r)=>{let s=i.values[t],o=this.updateF(s,r);return this.compareF(s,o)?0:(i.values[t]=o,1)},reconfigure:(i,r)=>r.config.address[this.id]!=null?(i.values[t]=r.field(this),0):(i.values[t]=this.create(i),1)}}init(e){return[this,YA.of({field:this,create:e})]}get extension(){return this}}const fl={lowest:4,low:3,default:2,high:1,highest:0};function za(n){return e=>new XA(e,n)}const dl={highest:za(fl.highest),high:za(fl.high),default:za(fl.default),low:za(fl.low),lowest:za(fl.lowest)};class XA{constructor(e,t){this.inner=e,this.prec=t}}class Cu{of(e){return new o0(this,e)}reconfigure(e){return Cu.reconfigure.of({compartment:this,extension:e})}get(e){return e.config.compartments.get(this)}}class o0{constructor(e,t){this.compartment=e,this.inner=t}}class Au{constructor(e,t,i,r,s,o){for(this.base=e,this.compartments=t,this.dynamicSlots=i,this.address=r,this.staticValues=s,this.facets=o,this.statusTemplate=[];this.statusTemplate.length<i.length;)this.statusTemplate.push(0)}staticFacet(e){let t=this.address[e.id];return t==null?e.default:this.staticValues[t>>1]}static resolve(e,t,i){let r=[],s=Object.create(null),o=new Map;for(let f of LV(e,t,o))f instanceof zt?r.push(f):(s[f.facet.id]||(s[f.facet.id]=[])).push(f);let l=Object.create(null),a=[],h=[];for(let f of r)l[f.id]=h.length<<1,h.push(d=>f.slot(d));let c=i==null?void 0:i.config.facets;for(let f in s){let d=s[f],p=d[0].facet,g=c&&c[f]||[];if(d.every(y=>y.type==0))if(l[p.id]=a.length<<1|1,r0(g,d))a.push(i.facet(p));else{let y=p.combine(d.map(v=>v.value));a.push(i&&p.compare(y,i.facet(p))?i.facet(p):y)}else{for(let y of d)y.type==0?(l[y.id]=a.length<<1|1,a.push(y.value)):(l[y.id]=h.length<<1,h.push(v=>y.dynamicSlot(v)));l[p.id]=h.length<<1,h.push(y=>RV(y,p,d))}}let u=h.map(f=>f(l));return new Au(e,o,u,l,a,s)}}function LV(n,e,t){let i=[[],[],[],[],[]],r=new Map;function s(o,l){let a=r.get(o);if(a!=null){if(a<=l)return;let h=i[a].indexOf(o);h>-1&&i[a].splice(h,1),o instanceof o0&&t.delete(o.compartment)}if(r.set(o,l),Array.isArray(o))for(let h of o)s(h,l);else if(o instanceof o0){if(t.has(o.compartment))throw new RangeError("Duplicate use of compartment in extensions");let h=e.get(o.compartment)||o.inner;t.set(o.compartment,h),s(h,l)}else if(o instanceof XA)s(o.inner,o.prec);else if(o instanceof zt)i[l].push(o),o.provides&&s(o.provides,l);else if(o instanceof ku)i[l].push(o),o.facet.extensions&&s(o.facet.extensions,l);else{let h=o.extension;if(!h)throw new Error(`Unrecognized extension value in extension set (${o}). This sometimes happens because multiple instances of @codemirror/state are loaded, breaking instanceof checks.`);s(h,l)}}return s(n,fl.default),i.reduce((o,l)=>o.concat(l))}function ja(n,e){if(e&1)return 2;let t=e>>1,i=n.status[t];if(i==4)throw new Error("Cyclic dependency between fields and/or facets");if(i&2)return i;n.status[t]=4;let r=n.computeSlot(n,n.config.dynamicSlots[t]);return n.status[t]=2|r}function Ou(n,e){return e&1?n.config.staticValues[e>>1]:n.values[e>>1]}const QA=he.define(),eO=he.define({combine:n=>n.some(e=>e),static:!0}),tO=he.define({combine:n=>n.length?n[0]:void 0,static:!0}),iO=he.define(),nO=he.define(),rO=he.define(),sO=he.define({combine:n=>n.length?n[0]:!1});class Ss{constructor(e,t){this.type=e,this.value=t}static define(){return new FV}}class FV{of(e){return new Ss(this,e)}}class NV{constructor(e){this.map=e}of(e){return new ke(this,e)}}class ke{constructor(e,t){this.type=e,this.value=t}map(e){let t=this.type.map(this.value,e);return t===void 0?void 0:t==this.value?this:new ke(this.type,t)}is(e){return this.type==e}static define(e={}){return new NV(e.map||(t=>t))}static mapEffects(e,t){if(!e.length)return e;let i=[];for(let r of e){let s=r.map(t);s&&i.push(s)}return i}}ke.reconfigure=ke.define(),ke.appendConfig=ke.define();class Xt{constructor(e,t,i,r,s,o){this.startState=e,this.changes=t,this.selection=i,this.effects=r,this.annotations=s,this.scrollIntoView=o,this._doc=null,this._state=null,i&&JA(i,t.newLength),s.some(l=>l.type==Xt.time)||(this.annotations=s.concat(Xt.time.of(Date.now())))}get newDoc(){return this._doc||(this._doc=this.changes.apply(this.startState.doc))}get newSelection(){return this.selection||this.startState.selection.map(this.changes)}get state(){return this._state||this.startState.applyTransaction(this),this._state}annotation(e){for(let t of this.annotations)if(t.type==e)return t.value}get docChanged(){return!this.changes.empty}get reconfigured(){return this.startState.config!=this.state.config}isUserEvent(e){let t=this.annotation(Xt.userEvent);return!!(t&&(t==e||t.length>e.length&&t.slice(0,e.length)==e&&t[e.length]=="."))}}Xt.time=Ss.define(),Xt.userEvent=Ss.define(),Xt.addToHistory=Ss.define(),Xt.remote=Ss.define();function IV(n,e){let t=[];for(let i=0,r=0;;){let s,o;if(i<n.length&&(r==e.length||e[r]>=n[i]))s=n[i++],o=n[i++];else if(r<e.length)s=e[r++],o=e[r++];else return t;!t.length||t[t.length-1]<s?t.push(s,o):t[t.length-1]<o&&(t[t.length-1]=o)}}function oO(n,e,t){var i;let r,s,o;return t?(r=e.changes,s=Yt.empty(e.changes.length),o=n.changes.compose(e.changes)):(r=e.changes.map(n.changes),s=n.changes.mapDesc(e.changes,!0),o=n.changes.compose(r)),{changes:o,selection:e.selection?e.selection.map(s):(i=n.selection)===null||i===void 0?void 0:i.map(r),effects:ke.mapEffects(n.effects,r).concat(ke.mapEffects(e.effects,s)),annotations:n.annotations.length?n.annotations.concat(e.annotations):e.annotations,scrollIntoView:n.scrollIntoView||e.scrollIntoView}}function l0(n,e,t){let i=e.selection,r=pl(e.annotations);return e.userEvent&&(r=r.concat(Xt.userEvent.of(e.userEvent))),{changes:e.changes instanceof Yt?e.changes:Yt.of(e.changes||[],t,n.facet(tO)),selection:i&&(i instanceof L?i:L.single(i.anchor,i.head)),effects:pl(e.effects),annotations:r,scrollIntoView:!!e.scrollIntoView}}function lO(n,e,t){let i=l0(n,e.length?e[0]:{},n.doc.length);e.length&&e[0].filter===!1&&(t=!1);for(let s=1;s<e.length;s++){e[s].filter===!1&&(t=!1);let o=!!e[s].sequential;i=oO(i,l0(n,e[s],o?i.changes.newLength:n.doc.length),o)}let r=new Xt(n,i.changes,i.selection,i.effects,i.annotations,i.scrollIntoView);return VV(t?WV(r):r)}function WV(n){let e=n.startState,t=!0;for(let r of e.facet(iO)){let s=r(n);if(s===!1){t=!1;break}Array.isArray(s)&&(t=t===!0?s:IV(t,s))}if(t!==!0){let r,s;if(t===!1)s=n.changes.invertedDesc,r=Yt.empty(e.doc.length);else{let o=n.changes.filter(t);r=o.changes,s=o.filtered.invertedDesc}n=new Xt(e,r,n.selection&&n.selection.map(s),ke.mapEffects(n.effects,s),n.annotations,n.scrollIntoView)}let i=e.facet(nO);for(let r=i.length-1;r>=0;r--){let s=i[r](n);s instanceof Xt?n=s:Array.isArray(s)&&s.length==1&&s[0]instanceof Xt?n=s[0]:n=lO(e,pl(s),!1)}return n}function VV(n){let e=n.startState,t=e.facet(rO),i=n;for(let r=t.length-1;r>=0;r--){let s=t[r](n);s&&Object.keys(s).length&&(i=oO(n,l0(e,s,n.changes.newLength),!0))}return i==n?n:new Xt(e,n.changes,n.selection,i.effects,i.annotations,i.scrollIntoView)}const HV=[];function pl(n){return n==null?HV:Array.isArray(n)?n:[n]}var Hi=function(n){return n[n.Word=0]="Word",n[n.Space=1]="Space",n[n.Other=2]="Other",n}(Hi||(Hi={}));const zV=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;let a0;try{a0=new RegExp("[\\p{Alphabetic}\\p{Number}_]","u")}catch{}function jV(n){if(a0)return a0.test(n);for(let e=0;e<n.length;e++){let t=n[e];if(/\w/.test(t)||t>"\x80"&&(t.toUpperCase()!=t.toLowerCase()||zV.test(t)))return!0}return!1}function $V(n){return e=>{if(!/\S/.test(e))return Hi.Space;if(jV(e))return Hi.Word;for(let t=0;t<n.length;t++)if(e.indexOf(n[t])>-1)return Hi.Word;return Hi.Other}}class Fe{constructor(e,t,i,r,s,o){this.config=e,this.doc=t,this.selection=i,this.values=r,this.status=e.statusTemplate.slice(),this.computeSlot=s,o&&(o._state=this);for(let l=0;l<this.config.dynamicSlots.length;l++)ja(this,l<<1);this.computeSlot=null}field(e,t=!0){let i=this.config.address[e.id];if(i==null){if(t)throw new RangeError("Field is not present in this state");return}return ja(this,i),Ou(this,i)}update(...e){return lO(this,e,!0)}applyTransaction(e){let t=this.config,{base:i,compartments:r}=t;for(let o of e.effects)o.is(Cu.reconfigure)?(t&&(r=new Map,t.compartments.forEach((l,a)=>r.set(a,l)),t=null),r.set(o.value.compartment,o.value.extension)):o.is(ke.reconfigure)?(t=null,i=o.value):o.is(ke.appendConfig)&&(t=null,i=pl(i).concat(o.value));let s;t?s=e.startState.values.slice():(t=Au.resolve(i,r,this),s=new Fe(t,this.doc,this.selection,t.dynamicSlots.map(()=>null),(l,a)=>a.reconfigure(l,this),null).values),new Fe(t,e.newDoc,e.newSelection,s,(o,l)=>l.update(o,e),e)}replaceSelection(e){return typeof e=="string"&&(e=this.toText(e)),this.changeByRange(t=>({changes:{from:t.from,to:t.to,insert:e},range:L.cursor(t.from+e.length)}))}changeByRange(e){let t=this.selection,i=e(t.ranges[0]),r=this.changes(i.changes),s=[i.range],o=pl(i.effects);for(let l=1;l<t.ranges.length;l++){let a=e(t.ranges[l]),h=this.changes(a.changes),c=h.map(r);for(let f=0;f<l;f++)s[f]=s[f].map(c);let u=r.mapDesc(h,!0);s.push(a.range.map(u)),r=r.compose(c),o=ke.mapEffects(o,c).concat(ke.mapEffects(pl(a.effects),u))}return{changes:r,selection:L.create(s,t.mainIndex),effects:o}}changes(e=[]){return e instanceof Yt?e:Yt.of(e,this.doc.length,this.facet(Fe.lineSeparator))}toText(e){return $e.of(e.split(this.facet(Fe.lineSeparator)||e0))}sliceDoc(e=0,t=this.doc.length){return this.doc.sliceString(e,t,this.lineBreak)}facet(e){let t=this.config.address[e.id];return t==null?e.default:(ja(this,t),Ou(this,t))}toJSON(e){let t={doc:this.sliceDoc(),selection:this.selection.toJSON()};if(e)for(let i in e){let r=e[i];r instanceof zt&&(t[i]=r.spec.toJSON(this.field(e[i]),this))}return t}static fromJSON(e,t={},i){if(!e||typeof e.doc!="string")throw new RangeError("Invalid JSON representation for EditorState");let r=[];if(i)for(let s in i){let o=i[s],l=e[s];r.push(o.init(a=>o.spec.fromJSON(l,a)))}return Fe.create({doc:e.doc,selection:L.fromJSON(e.selection),extensions:t.extensions?r.concat([t.extensions]):r})}static create(e={}){let t=Au.resolve(e.extensions||[],new Map),i=e.doc instanceof $e?e.doc:$e.of((e.doc||"").split(t.staticFacet(Fe.lineSeparator)||e0)),r=e.selection?e.selection instanceof L?e.selection:L.single(e.selection.anchor,e.selection.head):L.single(0);return JA(r,i.length),t.staticFacet(eO)||(r=r.asSingle()),new Fe(t,i,r,t.dynamicSlots.map(()=>null),(s,o)=>o.create(s),null)}get tabSize(){return this.facet(Fe.tabSize)}get lineBreak(){return this.facet(Fe.lineSeparator)||`
`}get readOnly(){return this.facet(sO)}phrase(e){for(let t of this.facet(Fe.phrases))if(Object.prototype.hasOwnProperty.call(t,e))return t[e];return e}languageDataAt(e,t,i=-1){let r=[];for(let s of this.facet(QA))for(let o of s(this,t,i))Object.prototype.hasOwnProperty.call(o,e)&&r.push(o[e]);return r}charCategorizer(e){return $V(this.languageDataAt("wordChars",e).join(""))}wordAt(e){let{text:t,from:i,length:r}=this.doc.lineAt(e),s=this.charCategorizer(e),o=e-i,l=e-i;for(;o>0;){let a=un(t,o,!1);if(s(t.slice(a,o))!=Hi.Word)break;o=a}for(;l<r;){let a=un(t,l);if(s(t.slice(l,a))!=Hi.Word)break;l=a}return o==l?null:L.range(o+i,l+i)}}Fe.allowMultipleSelections=eO,Fe.tabSize=he.define({combine:n=>n.length?n[0]:4}),Fe.lineSeparator=tO,Fe.readOnly=sO,Fe.phrases=he.define({compare(n,e){let t=Object.keys(n),i=Object.keys(e);return t.length==i.length&&t.every(r=>n[r]==e[r])}}),Fe.languageData=QA,Fe.changeFilter=iO,Fe.transactionFilter=nO,Fe.transactionExtender=rO,Cu.reconfigure=ke.define();function nr(n,e,t={}){let i={};for(let r of n)for(let s of Object.keys(r)){let o=r[s],l=i[s];if(l===void 0)i[s]=o;else if(!(l===o||o===void 0))if(Object.hasOwnProperty.call(t,s))i[s]=t[s](l,o);else throw new Error("Config merge conflict for field "+s)}for(let r in e)i[r]===void 0&&(i[r]=e[r]);return i}class mo{eq(e){return this==e}range(e,t=e){return new h0(e,t,this)}}mo.prototype.startSide=mo.prototype.endSide=0,mo.prototype.point=!1,mo.prototype.mapMode=Wi.TrackDel;class h0{constructor(e,t,i){this.from=e,this.to=t,this.value=i}}function c0(n,e){return n.from-e.from||n.value.startSide-e.value.startSide}class u0{constructor(e,t,i,r){this.from=e,this.to=t,this.value=i,this.maxPoint=r}get length(){return this.to[this.to.length-1]}findIndex(e,t,i,r=0){let s=i?this.to:this.from;for(let o=r,l=s.length;;){if(o==l)return o;let a=o+l>>1,h=s[a]-e||(i?this.value[a].endSide:this.value[a].startSide)-t;if(a==o)return h>=0?o:l;h>=0?l=a:o=a+1}}between(e,t,i,r){for(let s=this.findIndex(t,-1e9,!0),o=this.findIndex(i,1e9,!1,s);s<o;s++)if(r(this.from[s]+e,this.to[s]+e,this.value[s])===!1)return!1}map(e,t){let i=[],r=[],s=[],o=-1,l=-1;for(let a=0;a<this.value.length;a++){let h=this.value[a],c=this.from[a]+e,u=this.to[a]+e,f,d;if(c==u){let p=t.mapPos(c,h.startSide,h.mapMode);if(p==null||(f=d=p,h.startSide!=h.endSide&&(d=t.mapPos(c,h.endSide),d<f)))continue}else if(f=t.mapPos(c,h.startSide),d=t.mapPos(u,h.endSide),f>d||f==d&&h.startSide>0&&h.endSide<=0)continue;(d-f||h.endSide-h.startSide)<0||(o<0&&(o=f),h.point&&(l=Math.max(l,d-f)),i.push(h),r.push(f-o),s.push(d-o))}return{mapped:i.length?new u0(r,s,i,l):null,pos:o}}}class We{constructor(e,t,i=We.empty,r){this.chunkPos=e,this.chunk=t,this.nextLayer=i,this.maxPoint=r}get length(){let e=this.chunk.length-1;return e<0?0:Math.max(this.chunkEnd(e),this.nextLayer.length)}get size(){if(this.isEmpty)return 0;let e=this.nextLayer.size;for(let t of this.chunk)e+=t.value.length;return e}chunkEnd(e){return this.chunkPos[e]+this.chunk[e].length}update(e){let{add:t=[],sort:i=!1,filterFrom:r=0,filterTo:s=this.length}=e,o=e.filter;if(t.length==0&&!o)return this;if(i&&(t=t.slice().sort(c0)),this.isEmpty)return t.length?We.of(t):this;let l=new hO(this,null,-1).goto(0),a=0,h=[],c=new ks;for(;l.value||a<t.length;)if(a<t.length&&(l.from-t[a].from||l.startSide-t[a].value.startSide)>=0){let u=t[a++];c.addInner(u.from,u.to,u.value)||h.push(u)}else l.rangeIndex==1&&l.chunkIndex<this.chunk.length&&(a==t.length||this.chunkEnd(l.chunkIndex)<t[a].from)&&(!o||r>this.chunkEnd(l.chunkIndex)||s<this.chunkPos[l.chunkIndex])&&c.addChunk(this.chunkPos[l.chunkIndex],this.chunk[l.chunkIndex])?l.nextChunk():((!o||r>l.to||s<l.from||o(l.from,l.to,l.value))&&(c.addInner(l.from,l.to,l.value)||h.push(new h0(l.from,l.to,l.value))),l.next());return c.finishInner(this.nextLayer.isEmpty&&!h.length?We.empty:this.nextLayer.update({add:h,filter:o,filterFrom:r,filterTo:s}))}map(e){if(e.empty||this.isEmpty)return this;let t=[],i=[],r=-1;for(let o=0;o<this.chunk.length;o++){let l=this.chunkPos[o],a=this.chunk[o],h=e.touchesRange(l,l+a.length);if(h===!1)r=Math.max(r,a.maxPoint),t.push(a),i.push(e.mapPos(l));else if(h===!0){let{mapped:c,pos:u}=a.map(l,e);c&&(r=Math.max(r,c.maxPoint),t.push(c),i.push(u))}}let s=this.nextLayer.map(e);return t.length==0?s:new We(i,t,s,r)}between(e,t,i){if(!this.isEmpty){for(let r=0;r<this.chunk.length;r++){let s=this.chunkPos[r],o=this.chunk[r];if(t>=s&&e<=s+o.length&&o.between(s,e-s,t-s,i)===!1)return}this.nextLayer.between(e,t,i)}}iter(e=0){return $a.from([this]).goto(e)}get isEmpty(){return this.nextLayer==this}static iter(e,t=0){return $a.from(e).goto(t)}static compare(e,t,i,r,s=-1){let o=e.filter(u=>u.maxPoint>0||!u.isEmpty&&u.maxPoint>=s),l=t.filter(u=>u.maxPoint>0||!u.isEmpty&&u.maxPoint>=s),a=aO(o,l,i),h=new Ua(o,a,s),c=new Ua(l,a,s);i.iterGaps((u,f,d)=>cO(h,u,c,f,d,r)),i.empty&&i.length==0&&cO(h,0,c,0,0,r)}static eq(e,t,i=0,r){r==null&&(r=1e9);let s=e.filter(c=>!c.isEmpty&&t.indexOf(c)<0),o=t.filter(c=>!c.isEmpty&&e.indexOf(c)<0);if(s.length!=o.length)return!1;if(!s.length)return!0;let l=aO(s,o),a=new Ua(s,l,0).goto(i),h=new Ua(o,l,0).goto(i);for(;;){if(a.to!=h.to||!d0(a.active,h.active)||a.point&&(!h.point||!a.point.eq(h.point)))return!1;if(a.to>r)return!0;a.next(),h.next()}}static spans(e,t,i,r,s=-1){let o=new Ua(e,null,s).goto(t),l=t,a=o.openStart;for(;;){let h=Math.min(o.to,i);if(o.point?(r.point(l,h,o.point,o.activeForPoint(o.to),a,o.pointRank),a=o.openEnd(h)+(o.to>h?1:0)):h>l&&(r.span(l,h,o.active,a),a=o.openEnd(h)),o.to>i)break;l=o.to,o.next()}return a}static of(e,t=!1){let i=new ks;for(let r of e instanceof h0?[e]:t?UV(e):e)i.add(r.from,r.to,r.value);return i.finish()}}We.empty=new We([],[],null,-1);function UV(n){if(n.length>1)for(let e=n[0],t=1;t<n.length;t++){let i=n[t];if(c0(e,i)>0)return n.slice().sort(c0);e=i}return n}We.empty.nextLayer=We.empty;class ks{constructor(){this.chunks=[],this.chunkPos=[],this.chunkStart=-1,this.last=null,this.lastFrom=-1e9,this.lastTo=-1e9,this.from=[],this.to=[],this.value=[],this.maxPoint=-1,this.setMaxPoint=-1,this.nextLayer=null}finishChunk(e){this.chunks.push(new u0(this.from,this.to,this.value,this.maxPoint)),this.chunkPos.push(this.chunkStart),this.chunkStart=-1,this.setMaxPoint=Math.max(this.setMaxPoint,this.maxPoint),this.maxPoint=-1,e&&(this.from=[],this.to=[],this.value=[])}add(e,t,i){this.addInner(e,t,i)||(this.nextLayer||(this.nextLayer=new ks)).add(e,t,i)}addInner(e,t,i){let r=e-this.lastTo||i.startSide-this.last.endSide;if(r<=0&&(e-this.lastFrom||i.startSide-this.last.startSide)<0)throw new Error("Ranges must be added sorted by `from` position and `startSide`");return r<0?!1:(this.from.length==250&&this.finishChunk(!0),this.chunkStart<0&&(this.chunkStart=e),this.from.push(e-this.chunkStart),this.to.push(t-this.chunkStart),this.last=i,this.lastFrom=e,this.lastTo=t,this.value.push(i),i.point&&(this.maxPoint=Math.max(this.maxPoint,t-e)),!0)}addChunk(e,t){if((e-this.lastTo||t.value[0].startSide-this.last.endSide)<0)return!1;this.from.length&&this.finishChunk(!0),this.setMaxPoint=Math.max(this.setMaxPoint,t.maxPoint),this.chunks.push(t),this.chunkPos.push(e);let i=t.value.length-1;return this.last=t.value[i],this.lastFrom=t.from[i]+e,this.lastTo=t.to[i]+e,!0}finish(){return this.finishInner(We.empty)}finishInner(e){if(this.from.length&&this.finishChunk(!1),this.chunks.length==0)return e;let t=new We(this.chunkPos,this.chunks,this.nextLayer?this.nextLayer.finishInner(e):e,this.setMaxPoint);return this.from=null,t}}function aO(n,e,t){let i=new Map;for(let s of n)for(let o=0;o<s.chunk.length;o++)s.chunk[o].maxPoint<=0&&i.set(s.chunk[o],s.chunkPos[o]);let r=new Set;for(let s of e)for(let o=0;o<s.chunk.length;o++){let l=i.get(s.chunk[o]);l!=null&&(t?t.mapPos(l):l)==s.chunkPos[o]&&!(t!=null&&t.touchesRange(l,l+s.chunk[o].length))&&r.add(s.chunk[o])}return r}class hO{constructor(e,t,i,r=0){this.layer=e,this.skip=t,this.minPoint=i,this.rank=r}get startSide(){return this.value?this.value.startSide:0}get endSide(){return this.value?this.value.endSide:0}goto(e,t=-1e9){return this.chunkIndex=this.rangeIndex=0,this.gotoInner(e,t,!1),this}gotoInner(e,t,i){for(;this.chunkIndex<this.layer.chunk.length;){let r=this.layer.chunk[this.chunkIndex];if(!(this.skip&&this.skip.has(r)||this.layer.chunkEnd(this.chunkIndex)<e||r.maxPoint<this.minPoint))break;this.chunkIndex++,i=!1}if(this.chunkIndex<this.layer.chunk.length){let r=this.layer.chunk[this.chunkIndex].findIndex(e-this.layer.chunkPos[this.chunkIndex],t,!0);(!i||this.rangeIndex<r)&&this.setRangeIndex(r)}this.next()}forward(e,t){(this.to-e||this.endSide-t)<0&&this.gotoInner(e,t,!0)}next(){for(;;)if(this.chunkIndex==this.layer.chunk.length){this.from=this.to=1e9,this.value=null;break}else{let e=this.layer.chunkPos[this.chunkIndex],t=this.layer.chunk[this.chunkIndex],i=e+t.from[this.rangeIndex];if(this.from=i,this.to=e+t.to[this.rangeIndex],this.value=t.value[this.rangeIndex],this.setRangeIndex(this.rangeIndex+1),this.minPoint<0||this.value.point&&this.to-this.from>=this.minPoint)break}}setRangeIndex(e){if(e==this.layer.chunk[this.chunkIndex].value.length){if(this.chunkIndex++,this.skip)for(;this.chunkIndex<this.layer.chunk.length&&this.skip.has(this.layer.chunk[this.chunkIndex]);)this.chunkIndex++;this.rangeIndex=0}else this.rangeIndex=e}nextChunk(){this.chunkIndex++,this.rangeIndex=0,this.next()}compare(e){return this.from-e.from||this.startSide-e.startSide||this.rank-e.rank||this.to-e.to||this.endSide-e.endSide}}class $a{constructor(e){this.heap=e}static from(e,t=null,i=-1){let r=[];for(let s=0;s<e.length;s++)for(let o=e[s];!o.isEmpty;o=o.nextLayer)o.maxPoint>=i&&r.push(new hO(o,t,i,s));return r.length==1?r[0]:new $a(r)}get startSide(){return this.value?this.value.startSide:0}goto(e,t=-1e9){for(let i of this.heap)i.goto(e,t);for(let i=this.heap.length>>1;i>=0;i--)f0(this.heap,i);return this.next(),this}forward(e,t){for(let i of this.heap)i.forward(e,t);for(let i=this.heap.length>>1;i>=0;i--)f0(this.heap,i);(this.to-e||this.value.endSide-t)<0&&this.next()}next(){if(this.heap.length==0)this.from=this.to=1e9,this.value=null,this.rank=-1;else{let e=this.heap[0];this.from=e.from,this.to=e.to,this.value=e.value,this.rank=e.rank,e.value&&e.next(),f0(this.heap,0)}}}function f0(n,e){for(let t=n[e];;){let i=(e<<1)+1;if(i>=n.length)break;let r=n[i];if(i+1<n.length&&r.compare(n[i+1])>=0&&(r=n[i+1],i++),t.compare(r)<0)break;n[i]=t,n[e]=r,e=i}}class Ua{constructor(e,t,i){this.minPoint=i,this.active=[],this.activeTo=[],this.activeRank=[],this.minActive=-1,this.point=null,this.pointFrom=0,this.pointRank=0,this.to=-1e9,this.endSide=0,this.openStart=-1,this.cursor=$a.from(e,t,i)}goto(e,t=-1e9){return this.cursor.goto(e,t),this.active.length=this.activeTo.length=this.activeRank.length=0,this.minActive=-1,this.to=e,this.endSide=t,this.openStart=-1,this.next(),this}forward(e,t){for(;this.minActive>-1&&(this.activeTo[this.minActive]-e||this.active[this.minActive].endSide-t)<0;)this.removeActive(this.minActive);this.cursor.forward(e,t)}removeActive(e){_u(this.active,e),_u(this.activeTo,e),_u(this.activeRank,e),this.minActive=uO(this.active,this.activeTo)}addActive(e){let t=0,{value:i,to:r,rank:s}=this.cursor;for(;t<this.activeRank.length&&this.activeRank[t]<=s;)t++;Du(this.active,t,i),Du(this.activeTo,t,r),Du(this.activeRank,t,s),e&&Du(e,t,this.cursor.from),this.minActive=uO(this.active,this.activeTo)}next(){let e=this.to,t=this.point;this.point=null;let i=this.openStart<0?[]:null,r=0;for(;;){let s=this.minActive;if(s>-1&&(this.activeTo[s]-this.cursor.from||this.active[s].endSide-this.cursor.startSide)<0){if(this.activeTo[s]>e){this.to=this.activeTo[s],this.endSide=this.active[s].endSide;break}this.removeActive(s),i&&_u(i,s)}else if(this.cursor.value)if(this.cursor.from>e){this.to=this.cursor.from,this.endSide=this.cursor.startSide;break}else{let o=this.cursor.value;if(!o.point)this.addActive(i),this.cursor.next();else if(t&&this.cursor.to==this.to&&this.cursor.from<this.cursor.to)this.cursor.next();else{this.point=o,this.pointFrom=this.cursor.from,this.pointRank=this.cursor.rank,this.to=this.cursor.to,this.endSide=o.endSide,this.cursor.from<e&&(r=1),this.cursor.next(),this.forward(this.to,this.endSide);break}}else{this.to=this.endSide=1e9;break}}if(i){let s=0;for(;s<i.length&&i[s]<e;)s++;this.openStart=s+r}}activeForPoint(e){if(!this.active.length)return this.active;let t=[];for(let i=this.active.length-1;i>=0&&!(this.activeRank[i]<this.pointRank);i--)(this.activeTo[i]>e||this.activeTo[i]==e&&this.active[i].endSide>=this.point.endSide)&&t.push(this.active[i]);return t.reverse()}openEnd(e){let t=0;for(let i=this.activeTo.length-1;i>=0&&this.activeTo[i]>e;i--)t++;return t}}function cO(n,e,t,i,r,s){n.goto(e),t.goto(i);let o=i+r,l=i,a=i-e;for(;;){let h=n.to+a-t.to||n.endSide-t.endSide,c=h<0?n.to+a:t.to,u=Math.min(c,o);if(n.point||t.point?n.point&&t.point&&(n.point==t.point||n.point.eq(t.point))&&d0(n.activeForPoint(n.to+a),t.activeForPoint(t.to))||s.comparePoint(l,u,n.point,t.point):u>l&&!d0(n.active,t.active)&&s.compareRange(l,u,n.active,t.active),c>o)break;l=c,h<=0&&n.next(),h>=0&&t.next()}}function d0(n,e){if(n.length!=e.length)return!1;for(let t=0;t<n.length;t++)if(n[t]!=e[t]&&!n[t].eq(e[t]))return!1;return!0}function _u(n,e){for(let t=e,i=n.length-1;t<i;t++)n[t]=n[t+1];n.pop()}function Du(n,e,t){for(let i=n.length-1;i>=e;i--)n[i+1]=n[i];n[e]=t}function uO(n,e){let t=-1,i=1e9;for(let r=0;r<e.length;r++)(e[r]-i||n[r].endSide-n[t].endSide)<0&&(t=r,i=e[r]);return t}function qa(n,e,t=n.length){let i=0;for(let r=0;r<t;)n.charCodeAt(r)==9?(i+=e-i%e,r++):(i++,r=un(n,r));return i}function p0(n,e,t,i){for(let r=0,s=0;;){if(s>=e)return r;if(r==n.length)break;s+=n.charCodeAt(r)==9?t-s%t:1,r=un(n,r)}return i===!0?-1:n.length}function Mu(n){let e;return n.nodeType==11?e=n.getSelection?n:n.ownerDocument:e=n,e.getSelection()}function ml(n,e){return e?n==e||n.contains(e.nodeType!=1?e.parentNode:e):!1}function qV(){let n=document.activeElement;for(;n&&n.shadowRoot;)n=n.shadowRoot.activeElement;return n}function m0(n,e){if(!e.anchorNode)return!1;try{return ml(n,e.anchorNode)}catch{return!1}}function Ka(n){return n.nodeType==3?Ga(n,0,n.nodeValue.length).getClientRects():n.nodeType==1?n.getClientRects():[]}function Eu(n,e,t,i){return t?fO(n,e,t,i,-1)||fO(n,e,t,i,1):!1}function g0(n){for(var e=0;;e++)if(n=n.previousSibling,!n)return e}function fO(n,e,t,i,r){for(;;){if(n==t&&e==i)return!0;if(e==(r<0?0:Tu(n))){if(n.nodeName=="DIV")return!1;let s=n.parentNode;if(!s||s.nodeType!=1)return!1;e=g0(n)+(r<0?0:1),n=s}else if(n.nodeType==1){if(n=n.childNodes[e+(r<0?-1:0)],n.nodeType==1&&n.contentEditable=="false")return!1;e=r<0?Tu(n):0}else return!1}}function Tu(n){return n.nodeType==3?n.nodeValue.length:n.childNodes.length}const dO={left:0,right:0,top:0,bottom:0};function Pu(n,e){let t=e?n.left:n.right;return{left:t,right:t,top:n.top,bottom:n.bottom}}function KV(n){return{left:0,right:n.innerWidth,top:0,bottom:n.innerHeight}}function GV(n,e,t,i,r,s,o,l){let a=n.ownerDocument,h=a.defaultView;for(let c=n;c;)if(c.nodeType==1){let u,f=c==a.body;if(f)u=KV(h);else{if(c.scrollHeight<=c.clientHeight&&c.scrollWidth<=c.clientWidth){c=c.parentNode;continue}let g=c.getBoundingClientRect();u={left:g.left,right:g.left+c.clientWidth,top:g.top,bottom:g.top+c.clientHeight}}let d=0,p=0;if(r=="nearest")e.top<u.top?(p=-(u.top-e.top+o),t>0&&e.bottom>u.bottom+p&&(p=e.bottom-u.bottom+p+o)):e.bottom>u.bottom&&(p=e.bottom-u.bottom+o,t<0&&e.top-p<u.top&&(p=-(u.top+p-e.top+o)));else{let g=e.bottom-e.top,y=u.bottom-u.top;p=(r=="center"&&g<=y?e.top+g/2-y/2:r=="start"||r=="center"&&t<0?e.top-o:e.bottom-y+o)-u.top}if(i=="nearest"?e.left<u.left?(d=-(u.left-e.left+s),t>0&&e.right>u.right+d&&(d=e.right-u.right+d+s)):e.right>u.right&&(d=e.right-u.right+s,t<0&&e.left<u.left+d&&(d=-(u.left+d-e.left+s))):d=(i=="center"?e.left+(e.right-e.left)/2-(u.right-u.left)/2:i=="start"==l?e.left-s:e.right-(u.right-u.left)+s)-u.left,d||p)if(f)h.scrollBy(d,p);else{if(p){let g=c.scrollTop;c.scrollTop+=p,p=c.scrollTop-g}if(d){let g=c.scrollLeft;c.scrollLeft+=d,d=c.scrollLeft-g}e={left:e.left-d,top:e.top-p,right:e.right-d,bottom:e.bottom-p}}if(f)break;c=c.assignedSlot||c.parentNode,i=r="nearest"}else if(c.nodeType==11)c=c.host;else break}class JV{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}eq(e){return this.anchorNode==e.anchorNode&&this.anchorOffset==e.anchorOffset&&this.focusNode==e.focusNode&&this.focusOffset==e.focusOffset}setRange(e){this.set(e.anchorNode,e.anchorOffset,e.focusNode,e.focusOffset)}set(e,t,i,r){this.anchorNode=e,this.anchorOffset=t,this.focusNode=i,this.focusOffset=r}}let gl=null;function pO(n){if(n.setActive)return n.setActive();if(gl)return n.focus(gl);let e=[];for(let t=n;t&&(e.push(t,t.scrollTop,t.scrollLeft),t!=t.ownerDocument);t=t.parentNode);if(n.focus(gl==null?{get preventScroll(){return gl={preventScroll:!0},!0}}:void 0),!gl){gl=!1;for(let t=0;t<e.length;){let i=e[t++],r=e[t++],s=e[t++];i.scrollTop!=r&&(i.scrollTop=r),i.scrollLeft!=s&&(i.scrollLeft=s)}}}let mO;function Ga(n,e,t=e){let i=mO||(mO=document.createRange());return i.setEnd(n,t),i.setStart(n,e),i}function Ja(n,e,t){let i={key:e,code:e,keyCode:t,which:t,cancelable:!0},r=new KeyboardEvent("keydown",i);r.synthetic=!0,n.dispatchEvent(r);let s=new KeyboardEvent("keyup",i);return s.synthetic=!0,n.dispatchEvent(s),r.defaultPrevented||s.defaultPrevented}function ZV(n){for(;n;){if(n&&(n.nodeType==9||n.nodeType==11&&n.host))return n;n=n.assignedSlot||n.parentNode}return null}function gO(n){for(;n.attributes.length;)n.removeAttributeNode(n.attributes[0])}class mi{constructor(e,t,i=!0){this.node=e,this.offset=t,this.precise=i}static before(e,t){return new mi(e.parentNode,g0(e),t)}static after(e,t){return new mi(e.parentNode,g0(e)+1,t)}}const y0=[];class Et{constructor(){this.parent=null,this.dom=null,this.dirty=2}get editorView(){if(!this.parent)throw new Error("Accessing view in orphan content view");return this.parent.editorView}get overrideDOMText(){return null}get posAtStart(){return this.parent?this.parent.posBefore(this):0}get posAtEnd(){return this.posAtStart+this.length}posBefore(e){let t=this.posAtStart;for(let i of this.children){if(i==e)return t;t+=i.length+i.breakAfter}throw new RangeError("Invalid child in posBefore")}posAfter(e){return this.posBefore(e)+e.length}coordsAt(e,t){return null}sync(e){if(this.dirty&2){let t=this.dom,i=null,r;for(let s of this.children){if(s.dirty){if(!s.dom&&(r=i?i.nextSibling:t.firstChild)){let o=Et.get(r);(!o||!o.parent&&o.constructor==s.constructor)&&s.reuseDOM(r)}s.sync(e),s.dirty=0}if(r=i?i.nextSibling:t.firstChild,e&&!e.written&&e.node==t&&r!=s.dom&&(e.written=!0),s.dom.parentNode==t)for(;r&&r!=s.dom;)r=yO(r);else t.insertBefore(s.dom,r);i=s.dom}for(r=i?i.nextSibling:t.firstChild,r&&e&&e.node==t&&(e.written=!0);r;)r=yO(r)}else if(this.dirty&1)for(let t of this.children)t.dirty&&(t.sync(e),t.dirty=0)}reuseDOM(e){}localPosFromDOM(e,t){let i;if(e==this.dom)i=this.dom.childNodes[t];else{let r=Tu(e)==0?0:t==0?-1:1;for(;;){let s=e.parentNode;if(s==this.dom)break;r==0&&s.firstChild!=s.lastChild&&(e==s.firstChild?r=-1:r=1),e=s}r<0?i=e:i=e.nextSibling}if(i==this.dom.firstChild)return 0;for(;i&&!Et.get(i);)i=i.nextSibling;if(!i)return this.length;for(let r=0,s=0;;r++){let o=this.children[r];if(o.dom==i)return s;s+=o.length+o.breakAfter}}domBoundsAround(e,t,i=0){let r=-1,s=-1,o=-1,l=-1;for(let a=0,h=i,c=i;a<this.children.length;a++){let u=this.children[a],f=h+u.length;if(h<e&&f>t)return u.domBoundsAround(e,t,h);if(f>=e&&r==-1&&(r=a,s=h),h>t&&u.dom.parentNode==this.dom){o=a,l=c;break}c=f,h=f+u.breakAfter}return{from:s,to:l<0?i+this.length:l,startDOM:(r?this.children[r-1].dom.nextSibling:null)||this.dom.firstChild,endDOM:o<this.children.length&&o>=0?this.children[o].dom:null}}markDirty(e=!1){this.dirty|=2,this.markParentsDirty(e)}markParentsDirty(e){for(let t=this.parent;t;t=t.parent){if(e&&(t.dirty|=2),t.dirty&1)return;t.dirty|=1,e=!1}}setParent(e){this.parent!=e&&(this.parent=e,this.dirty&&this.markParentsDirty(!0))}setDOM(e){this.dom&&(this.dom.cmView=null),this.dom=e,e.cmView=this}get rootView(){for(let e=this;;){let t=e.parent;if(!t)return e;e=t}}replaceChildren(e,t,i=y0){this.markDirty();for(let r=e;r<t;r++){let s=this.children[r];s.parent==this&&s.destroy()}this.children.splice(e,t-e,...i);for(let r=0;r<i.length;r++)i[r].setParent(this)}ignoreMutation(e){return!1}ignoreEvent(e){return!1}childCursor(e=this.length){return new vO(this.children,e,this.children.length)}childPos(e,t=1){return this.childCursor().findPos(e,t)}toString(){let e=this.constructor.name.replace("View","");return e+(this.children.length?"("+this.children.join()+")":this.length?"["+(e=="Text"?this.text:this.length)+"]":"")+(this.breakAfter?"#":"")}static get(e){return e.cmView}get isEditable(){return!0}merge(e,t,i,r,s,o){return!1}become(e){return!1}getSide(){return 0}destroy(){this.parent=null}}Et.prototype.breakAfter=0;function yO(n){let e=n.nextSibling;return n.parentNode.removeChild(n),e}class vO{constructor(e,t,i){this.children=e,this.pos=t,this.i=i,this.off=0}findPos(e,t=1){for(;;){if(e>this.pos||e==this.pos&&(t>0||this.i==0||this.children[this.i-1].breakAfter))return this.off=e-this.pos,this;let i=this.children[--this.i];this.pos-=i.length+i.breakAfter}}}function wO(n,e,t,i,r,s,o,l,a){let{children:h}=n,c=h.length?h[e]:null,u=s.length?s[s.length-1]:null,f=u?u.breakAfter:o;if(!(e==i&&c&&!o&&!f&&s.length<2&&c.merge(t,r,s.length?u:null,t==0,l,a))){if(i<h.length){let d=h[i];d&&r<d.length?(e==i&&(d=d.split(r),r=0),!f&&u&&d.merge(0,r,u,!0,0,a)?s[s.length-1]=d:(r&&d.merge(0,r,null,!1,0,a),s.push(d))):d!=null&&d.breakAfter&&(u?u.breakAfter=1:o=1),i++}for(c&&(c.breakAfter=o,t>0&&(!o&&s.length&&c.merge(t,c.length,s[0],!1,l,0)?c.breakAfter=s.shift().breakAfter:(t<c.length||c.children.length&&c.children[c.children.length-1].length==0)&&c.merge(t,c.length,null,!1,l,0),e++));e<i&&s.length;)if(h[i-1].become(s[s.length-1]))i--,s.pop(),a=s.length?0:l;else if(h[e].become(s[0]))e++,s.shift(),l=s.length?0:a;else break;!s.length&&e&&i<h.length&&!h[e-1].breakAfter&&h[i].merge(0,0,h[e-1],!1,l,a)&&e--,(e<i||s.length)&&n.replaceChildren(e,i,s)}}function bO(n,e,t,i,r,s){let o=n.childCursor(),{i:l,off:a}=o.findPos(t,1),{i:h,off:c}=o.findPos(e,-1),u=e-t;for(let f of i)u+=f.length;n.length+=u,wO(n,h,c,l,a,i,0,r,s)}let fn=typeof navigator!="undefined"?navigator:{userAgent:"",vendor:"",platform:""},v0=typeof document!="undefined"?document:{documentElement:{style:{}}};const w0=/Edge\/(\d+)/.exec(fn.userAgent),xO=/MSIE \d/.test(fn.userAgent),b0=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(fn.userAgent),Bu=!!(xO||b0||w0),SO=!Bu&&/gecko\/(\d+)/i.test(fn.userAgent),x0=!Bu&&/Chrome\/(\d+)/.exec(fn.userAgent),kO="webkitFontSmoothing"in v0.documentElement.style,CO=!Bu&&/Apple Computer/.test(fn.vendor),AO=CO&&(/Mobile\/\w+/.test(fn.userAgent)||fn.maxTouchPoints>2);var fe={mac:AO||/Mac/.test(fn.platform),windows:/Win/.test(fn.platform),linux:/Linux|X11/.test(fn.platform),ie:Bu,ie_version:xO?v0.documentMode||6:b0?+b0[1]:w0?+w0[1]:0,gecko:SO,gecko_version:SO?+(/Firefox\/(\d+)/.exec(fn.userAgent)||[0,0])[1]:0,chrome:!!x0,chrome_version:x0?+x0[1]:0,ios:AO,android:/Android\b/.test(fn.userAgent),webkit:kO,safari:CO,webkit_version:kO?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0,tabSize:v0.documentElement.style.tabSize!=null?"tab-size":"-moz-tab-size"};const YV=256;class Cs extends Et{constructor(e){super(),this.text=e}get length(){return this.text.length}createDOM(e){this.setDOM(e||document.createTextNode(this.text))}sync(e){this.dom||this.createDOM(),this.dom.nodeValue!=this.text&&(e&&e.node==this.dom&&(e.written=!0),this.dom.nodeValue=this.text)}reuseDOM(e){e.nodeType==3&&this.createDOM(e)}merge(e,t,i){return i&&(!(i instanceof Cs)||this.length-(t-e)+i.length>YV)?!1:(this.text=this.text.slice(0,e)+(i?i.text:"")+this.text.slice(t),this.markDirty(),!0)}split(e){let t=new Cs(this.text.slice(e));return this.text=this.text.slice(0,e),this.markDirty(),t}localPosFromDOM(e,t){return e==this.dom?t:t?this.text.length:0}domAtPos(e){return new mi(this.dom,e)}domBoundsAround(e,t,i){return{from:i,to:i+this.length,startDOM:this.dom,endDOM:this.dom.nextSibling}}coordsAt(e,t){return S0(this.dom,e,t)}}class rr extends Et{constructor(e,t=[],i=0){super(),this.mark=e,this.children=t,this.length=i;for(let r of t)r.setParent(this)}setAttrs(e){if(gO(e),this.mark.class&&(e.className=this.mark.class),this.mark.attrs)for(let t in this.mark.attrs)e.setAttribute(t,this.mark.attrs[t]);return e}reuseDOM(e){e.nodeName==this.mark.tagName.toUpperCase()&&(this.setDOM(e),this.dirty|=6)}sync(e){this.dom?this.dirty&4&&this.setAttrs(this.dom):this.setDOM(this.setAttrs(document.createElement(this.mark.tagName))),super.sync(e)}merge(e,t,i,r,s,o){return i&&(!(i instanceof rr&&i.mark.eq(this.mark))||e&&s<=0||t<this.length&&o<=0)?!1:(bO(this,e,t,i?i.children:[],s-1,o-1),this.markDirty(),!0)}split(e){let t=[],i=0,r=-1,s=0;for(let l of this.children){let a=i+l.length;a>e&&t.push(i<e?l.split(e-i):l),r<0&&i>=e&&(r=s),i=a,s++}let o=this.length-e;return this.length=e,r>-1&&(this.children.length=r,this.markDirty()),new rr(this.mark,t,o)}domAtPos(e){return DO(this.dom,this.children,e)}coordsAt(e,t){return EO(this,e,t)}}function S0(n,e,t){let i=n.nodeValue.length;e>i&&(e=i);let r=e,s=e,o=0;e==0&&t<0||e==i&&t>=0?fe.chrome||fe.gecko||(e?(r--,o=1):(s++,o=-1)):t<0?r--:s++;let l=Ga(n,r,s).getClientRects();if(!l.length)return dO;let a=l[(o?o<0:t>=0)?0:l.length-1];return fe.safari&&!o&&a.width==0&&(a=Array.prototype.find.call(l,h=>h.width)||a),o?Pu(a,o<0):a||null}class As extends Et{constructor(e,t,i){super(),this.widget=e,this.length=t,this.side=i,this.prevWidget=null}static create(e,t,i){return new(e.customView||As)(e,t,i)}split(e){let t=As.create(this.widget,this.length-e,this.side);return this.length-=e,t}sync(){(!this.dom||!this.widget.updateDOM(this.dom))&&(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(this.editorView)),this.dom.contentEditable="false")}getSide(){return this.side}merge(e,t,i,r,s,o){return i&&(!(i instanceof As)||!this.widget.compare(i.widget)||e>0&&s<=0||t<this.length&&o<=0)?!1:(this.length=e+(i?i.length:0)+(this.length-t),!0)}become(e){return e.length==this.length&&e instanceof As&&e.side==this.side&&this.widget.constructor==e.widget.constructor?(this.widget.eq(e.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=e.widget,!0):!1}ignoreMutation(){return!0}ignoreEvent(e){return this.widget.ignoreEvent(e)}get overrideDOMText(){if(this.length==0)return $e.empty;let e=this;for(;e.parent;)e=e.parent;let t=e.editorView,i=t&&t.state.doc,r=this.posAtStart;return i?i.slice(r,r+this.length):$e.empty}domAtPos(e){return e==0?mi.before(this.dom):mi.after(this.dom,e==this.length)}domBoundsAround(){return null}coordsAt(e,t){let i=this.dom.getClientRects(),r=null;if(!i.length)return dO;for(let s=e>0?i.length-1:0;r=i[s],!(e>0?s==0:s==i.length-1||r.top<r.bottom);s+=e>0?-1:1);return e==0&&t>0||e==this.length&&t<=0?r:Pu(r,e==0)}get isEditable(){return!1}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class OO extends As{domAtPos(e){let{topView:t,text:i}=this.widget;return t?k0(e,0,t,i,(r,s)=>r.domAtPos(s),r=>new mi(i,Math.min(r,i.nodeValue.length))):new mi(i,Math.min(e,i.nodeValue.length))}sync(){this.setDOM(this.widget.toDOM())}localPosFromDOM(e,t){let{topView:i,text:r}=this.widget;return i?_O(e,t,i,r):Math.min(t,this.length)}ignoreMutation(){return!1}get overrideDOMText(){return null}coordsAt(e,t){let{topView:i,text:r}=this.widget;return i?k0(e,t,i,r,(s,o,l)=>s.coordsAt(o,l),(s,o)=>S0(r,s,o)):S0(r,e,t)}destroy(){var e;super.destroy(),(e=this.widget.topView)===null||e===void 0||e.destroy()}get isEditable(){return!0}}function k0(n,e,t,i,r,s){if(t instanceof rr){for(let o of t.children){let l=ml(o.dom,i),a=l?i.nodeValue.length:o.length;if(n<a||n==a&&o.getSide()<=0)return l?k0(n,e,o,i,r,s):r(o,n,e);n-=a}return r(t,t.length,-1)}else return t.dom==i?s(n,e):r(t,n,e)}function _O(n,e,t,i){if(t instanceof rr)for(let r of t.children){let s=0,o=ml(r.dom,i);if(ml(r.dom,n))return s+(o?_O(n,e,r,i):r.localPosFromDOM(n,e));s+=o?i.nodeValue.length:r.length}else if(t.dom==i)return Math.min(e,i.nodeValue.length);return t.localPosFromDOM(n,e)}class yl extends Et{constructor(e){super(),this.side=e}get length(){return 0}merge(){return!1}become(e){return e instanceof yl&&e.side==this.side}split(){return new yl(this.side)}sync(){if(!this.dom){let e=document.createElement("img");e.className="cm-widgetBuffer",e.setAttribute("aria-hidden","true"),this.setDOM(e)}}getSide(){return this.side}domAtPos(e){return mi.before(this.dom)}localPosFromDOM(){return 0}domBoundsAround(){return null}coordsAt(e){let t=this.dom.getBoundingClientRect(),i=XV(this,this.side>0?-1:1);return i&&i.top<t.bottom&&i.bottom>t.top?{left:t.left,right:t.right,top:i.top,bottom:i.bottom}:t}get overrideDOMText(){return $e.empty}}Cs.prototype.children=As.prototype.children=yl.prototype.children=y0;function XV(n,e){let t=n.parent,i=t?t.children.indexOf(n):-1;for(;t&&i>=0;)if(e<0?i>0:i<t.children.length){let r=t.children[i+e];if(r instanceof Cs){let s=r.coordsAt(e<0?r.length:0,e);if(s)return s}i+=e}else if(t instanceof rr&&t.parent)i=t.parent.children.indexOf(t)+(e<0?0:1),t=t.parent;else{let r=t.dom.lastChild;if(r&&r.nodeName=="BR")return r.getClientRects()[0];break}}function DO(n,e,t){let i=0;for(let r=0;i<e.length;i++){let s=e[i],o=r+s.length;if(!(o==r&&s.getSide()<=0)){if(t>r&&t<o&&s.dom.parentNode==n)return s.domAtPos(t-r);if(t<=r)break;r=o}}for(;i>0;i--){let r=e[i-1].dom;if(r.parentNode==n)return mi.after(r)}return new mi(n,0)}function MO(n,e,t){let i,{children:r}=n;t>0&&e instanceof rr&&r.length&&(i=r[r.length-1])instanceof rr&&i.mark.eq(e.mark)?MO(i,e.children[0],t-1):(r.push(e),e.setParent(n)),n.length+=e.length}function EO(n,e,t){for(let s=0,o=0;o<n.children.length;o++){let l=n.children[o],a=s+l.length,h;if((t<=0||a==n.length||l.getSide()>0?a>=e:a>e)&&(e<a||o+1==n.children.length||(h=n.children[o+1]).length||h.getSide()>0)){let c=0;if(a==s){if(l.getSide()<=0)continue;c=t=-l.getSide()}let u=l.coordsAt(Math.max(0,e-s),t);return c&&u?Pu(u,t<0):u}s=a}let i=n.dom.lastChild;if(!i)return n.dom.getBoundingClientRect();let r=Ka(i);return r[r.length-1]||null}function C0(n,e){for(let t in n)t=="class"&&e.class?e.class+=" "+n.class:t=="style"&&e.style?e.style+=";"+n.style:e[t]=n[t];return e}function A0(n,e){if(n==e)return!0;if(!n||!e)return!1;let t=Object.keys(n),i=Object.keys(e);if(t.length!=i.length)return!1;for(let r of t)if(i.indexOf(r)==-1||n[r]!==e[r])return!1;return!0}function O0(n,e,t){if(e)for(let i in e)t&&i in t||n.removeAttribute(i);if(t)for(let i in t)e&&e[i]==t[i]||n.setAttribute(i,t[i])}class sr{eq(e){return!1}updateDOM(e){return!1}compare(e){return this==e||this.constructor==e.constructor&&this.eq(e)}get estimatedHeight(){return-1}ignoreEvent(e){return!0}get customView(){return null}destroy(e){}}var nt=function(n){return n[n.Text=0]="Text",n[n.WidgetBefore=1]="WidgetBefore",n[n.WidgetAfter=2]="WidgetAfter",n[n.WidgetRange=3]="WidgetRange",n}(nt||(nt={}));class ue extends mo{constructor(e,t,i,r){super(),this.startSide=e,this.endSide=t,this.widget=i,this.spec=r}get heightRelevant(){return!1}static mark(e){return new Ru(e)}static widget(e){let t=e.side||0,i=!!e.block;return t+=i?t>0?3e8:-4e8:t>0?1e8:-1e8,new go(e,t,t,i,e.widget||null,!1)}static replace(e){let t=!!e.block,i,r;if(e.isBlockGap)i=-5e8,r=4e8;else{let{start:s,end:o}=TO(e,t);i=(s?t?-3e8:-1:5e8)-1,r=(o?t?2e8:1:-6e8)+1}return new go(e,i,r,t,e.widget||null,!0)}static line(e){return new Za(e)}static set(e,t=!1){return We.of(e,t)}hasHeight(){return this.widget?this.widget.estimatedHeight>-1:!1}}ue.none=We.empty;class Ru extends ue{constructor(e){let{start:t,end:i}=TO(e);super(t?-1:5e8,i?1:-6e8,null,e),this.tagName=e.tagName||"span",this.class=e.class||"",this.attrs=e.attributes||null}eq(e){return this==e||e instanceof Ru&&this.tagName==e.tagName&&this.class==e.class&&A0(this.attrs,e.attrs)}range(e,t=e){if(e>=t)throw new RangeError("Mark decorations may not be empty");return super.range(e,t)}}Ru.prototype.point=!1;class Za extends ue{constructor(e){super(-2e8,-2e8,null,e)}eq(e){return e instanceof Za&&A0(this.spec.attributes,e.spec.attributes)}range(e,t=e){if(t!=e)throw new RangeError("Line decoration ranges must be zero-length");return super.range(e,t)}}Za.prototype.mapMode=Wi.TrackBefore,Za.prototype.point=!0;class go extends ue{constructor(e,t,i,r,s,o){super(t,i,s,e),this.block=r,this.isReplace=o,this.mapMode=r?t<=0?Wi.TrackBefore:Wi.TrackAfter:Wi.TrackDel}get type(){return this.startSide<this.endSide?nt.WidgetRange:this.startSide<=0?nt.WidgetBefore:nt.WidgetAfter}get heightRelevant(){return this.block||!!this.widget&&this.widget.estimatedHeight>=5}eq(e){return e instanceof go&&QV(this.widget,e.widget)&&this.block==e.block&&this.startSide==e.startSide&&this.endSide==e.endSide}range(e,t=e){if(this.isReplace&&(e>t||e==t&&this.startSide>0&&this.endSide<=0))throw new RangeError("Invalid range for replacement decoration");if(!this.isReplace&&t!=e)throw new RangeError("Widget decorations can only have zero-length ranges");return super.range(e,t)}}go.prototype.point=!0;function TO(n,e=!1){let{inclusiveStart:t,inclusiveEnd:i}=n;return t==null&&(t=n.inclusive),i==null&&(i=n.inclusive),{start:t!=null?t:e,end:i!=null?i:e}}function QV(n,e){return n==e||!!(n&&e&&n.compare(e))}function _0(n,e,t,i=0){let r=t.length-1;r>=0&&t[r]+i>=n?t[r]=Math.max(t[r],e):t.push(n,e)}class zi extends Et{constructor(){super(...arguments),this.children=[],this.length=0,this.prevAttrs=void 0,this.attrs=null,this.breakAfter=0}merge(e,t,i,r,s,o){if(i){if(!(i instanceof zi))return!1;this.dom||i.transferDOM(this)}return r&&this.setDeco(i?i.attrs:null),bO(this,e,t,i?i.children:[],s,o),!0}split(e){let t=new zi;if(t.breakAfter=this.breakAfter,this.length==0)return t;let{i,off:r}=this.childPos(e);r&&(t.append(this.children[i].split(r),0),this.children[i].merge(r,this.children[i].length,null,!1,0,0),i++);for(let s=i;s<this.children.length;s++)t.append(this.children[s],0);for(;i>0&&this.children[i-1].length==0;)this.children[--i].destroy();return this.children.length=i,this.markDirty(),this.length=e,t}transferDOM(e){!this.dom||(e.setDOM(this.dom),e.prevAttrs=this.prevAttrs===void 0?this.attrs:this.prevAttrs,this.prevAttrs=void 0,this.dom=null)}setDeco(e){A0(this.attrs,e)||(this.dom&&(this.prevAttrs=this.attrs,this.markDirty()),this.attrs=e)}append(e,t){MO(this,e,t)}addLineDeco(e){let t=e.spec.attributes,i=e.spec.class;t&&(this.attrs=C0(t,this.attrs||{})),i&&(this.attrs=C0({class:i},this.attrs||{}))}domAtPos(e){return DO(this.dom,this.children,e)}reuseDOM(e){e.nodeName=="DIV"&&(this.setDOM(e),this.dirty|=6)}sync(e){var t;this.dom?this.dirty&4&&(gO(this.dom),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0):(this.setDOM(document.createElement("div")),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0),this.prevAttrs!==void 0&&(O0(this.dom,this.prevAttrs,this.attrs),this.dom.classList.add("cm-line"),this.prevAttrs=void 0),super.sync(e);let i=this.dom.lastChild;for(;i&&Et.get(i)instanceof rr;)i=i.lastChild;if(!i||!this.length||i.nodeName!="BR"&&((t=Et.get(i))===null||t===void 0?void 0:t.isEditable)==!1&&(!fe.ios||!this.children.some(r=>r instanceof Cs))){let r=document.createElement("BR");r.cmIgnore=!0,this.dom.appendChild(r)}}measureTextSize(){if(this.children.length==0||this.length>20)return null;let e=0;for(let t of this.children){if(!(t instanceof Cs))return null;let i=Ka(t.dom);if(i.length!=1)return null;e+=i[0].width}return{lineHeight:this.dom.getBoundingClientRect().height,charWidth:e/this.length}}coordsAt(e,t){return EO(this,e,t)}become(e){return!1}get type(){return nt.Text}static find(e,t){for(let i=0,r=0;i<e.children.length;i++){let s=e.children[i],o=r+s.length;if(o>=t){if(s instanceof zi)return s;if(o>t)break}r=o+s.breakAfter}return null}}class yo extends Et{constructor(e,t,i){super(),this.widget=e,this.length=t,this.type=i,this.breakAfter=0,this.prevWidget=null}merge(e,t,i,r,s,o){return i&&(!(i instanceof yo)||!this.widget.compare(i.widget)||e>0&&s<=0||t<this.length&&o<=0)?!1:(this.length=e+(i?i.length:0)+(this.length-t),!0)}domAtPos(e){return e==0?mi.before(this.dom):mi.after(this.dom,e==this.length)}split(e){let t=this.length-e;this.length=e;let i=new yo(this.widget,t,this.type);return i.breakAfter=this.breakAfter,i}get children(){return y0}sync(){(!this.dom||!this.widget.updateDOM(this.dom))&&(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(this.editorView)),this.dom.contentEditable="false")}get overrideDOMText(){return this.parent?this.parent.view.state.doc.slice(this.posAtStart,this.posAtEnd):$e.empty}domBoundsAround(){return null}become(e){return e instanceof yo&&e.type==this.type&&e.widget.constructor==this.widget.constructor?(e.widget.eq(this.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=e.widget,this.length=e.length,this.breakAfter=e.breakAfter,!0):!1}ignoreMutation(){return!0}ignoreEvent(e){return this.widget.ignoreEvent(e)}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class D0{constructor(e,t,i,r){this.doc=e,this.pos=t,this.end=i,this.disallowBlockEffectsFor=r,this.content=[],this.curLine=null,this.breakAtStart=0,this.pendingBuffer=0,this.atCursorPos=!0,this.openStart=-1,this.openEnd=-1,this.text="",this.textOff=0,this.cursor=e.iter(),this.skip=t}posCovered(){if(this.content.length==0)return!this.breakAtStart&&this.doc.lineAt(this.pos).from!=this.pos;let e=this.content[this.content.length-1];return!e.breakAfter&&!(e instanceof yo&&e.type==nt.WidgetBefore)}getLine(){return this.curLine||(this.content.push(this.curLine=new zi),this.atCursorPos=!0),this.curLine}flushBuffer(e){this.pendingBuffer&&(this.curLine.append(Lu(new yl(-1),e),e.length),this.pendingBuffer=0)}addBlockWidget(e){this.flushBuffer([]),this.curLine=null,this.content.push(e)}finish(e){e?this.pendingBuffer=0:this.flushBuffer([]),this.posCovered()||this.getLine()}buildText(e,t,i){for(;e>0;){if(this.textOff==this.text.length){let{value:s,lineBreak:o,done:l}=this.cursor.next(this.skip);if(this.skip=0,l)throw new Error("Ran out of text content when drawing inline views");if(o){this.posCovered()||this.getLine(),this.content.length?this.content[this.content.length-1].breakAfter=1:this.breakAtStart=1,this.flushBuffer([]),this.curLine=null,e--;continue}else this.text=s,this.textOff=0}let r=Math.min(this.text.length-this.textOff,e,512);this.flushBuffer(t.slice(0,i)),this.getLine().append(Lu(new Cs(this.text.slice(this.textOff,this.textOff+r)),t),i),this.atCursorPos=!0,this.textOff+=r,e-=r,i=0}}span(e,t,i,r){this.buildText(t-e,i,r),this.pos=t,this.openStart<0&&(this.openStart=r)}point(e,t,i,r,s,o){if(this.disallowBlockEffectsFor[o]&&i instanceof go){if(i.block)throw new RangeError("Block decorations may not be specified via plugins");if(t>this.doc.lineAt(this.pos).to)throw new RangeError("Decorations that replace line breaks may not be specified via plugins")}let l=t-e;if(i instanceof go)if(i.block){let{type:a}=i;a==nt.WidgetAfter&&!this.posCovered()&&this.getLine(),this.addBlockWidget(new yo(i.widget||new PO("div"),l,a))}else{let a=As.create(i.widget||new PO("span"),l,i.startSide),h=this.atCursorPos&&!a.isEditable&&s<=r.length&&(e<t||i.startSide>0),c=!a.isEditable&&(e<t||i.startSide<=0),u=this.getLine();this.pendingBuffer==2&&!h&&(this.pendingBuffer=0),this.flushBuffer(r),h&&(u.append(Lu(new yl(1),r),s),s=r.length+Math.max(0,s-r.length)),u.append(Lu(a,r),s),this.atCursorPos=c,this.pendingBuffer=c?e<t?1:2:0}else this.doc.lineAt(this.pos).from==this.pos&&this.getLine().addLineDeco(i);l&&(this.textOff+l<=this.text.length?this.textOff+=l:(this.skip+=l-(this.text.length-this.textOff),this.text="",this.textOff=0),this.pos=t),this.openStart<0&&(this.openStart=s)}static build(e,t,i,r,s){let o=new D0(e,t,i,s);return o.openEnd=We.spans(r,t,i,o),o.openStart<0&&(o.openStart=o.openEnd),o.finish(o.openEnd),o}}function Lu(n,e){for(let t of e)n=new rr(t,[n],n.length);return n}class PO extends sr{constructor(e){super(),this.tag=e}eq(e){return e.tag==this.tag}toDOM(){return document.createElement(this.tag)}updateDOM(e){return e.nodeName.toLowerCase()==this.tag}}const BO=he.define(),RO=he.define(),LO=he.define(),FO=he.define(),M0=he.define(),NO=he.define(),IO=he.define({combine:n=>n.some(e=>e)});class Fu{constructor(e,t="nearest",i="nearest",r=5,s=5){this.range=e,this.y=t,this.x=i,this.yMargin=r,this.xMargin=s}map(e){return e.empty?this:new Fu(this.range.map(e),this.y,this.x,this.yMargin,this.xMargin)}}const WO=ke.define({map:(n,e)=>n.map(e)});function dn(n,e,t){let i=n.facet(FO);i.length?i[0](e):window.onerror?window.onerror(String(e),t,void 0,void 0,e):t?console.error(t+":",e):console.error(e)}const Ya=he.define({combine:n=>n.length?n[0]:!0});let e3=0;const Xa=he.define();class Nt{constructor(e,t,i,r){this.id=e,this.create=t,this.domEventHandlers=i,this.extension=r(this)}static define(e,t){const{eventHandlers:i,provide:r,decorations:s}=t||{};return new Nt(e3++,e,i,o=>{let l=[Xa.of(o)];return s&&l.push(Qa.of(a=>{let h=a.plugin(o);return h?s(h):ue.none})),r&&l.push(r(o)),l})}static fromClass(e,t){return Nt.define(i=>new e(i),t)}}class E0{constructor(e){this.spec=e,this.mustUpdate=null,this.value=null}update(e){if(this.value){if(this.mustUpdate){let t=this.mustUpdate;if(this.mustUpdate=null,this.value.update)try{this.value.update(t)}catch(i){if(dn(t.state,i,"CodeMirror plugin crashed"),this.value.destroy)try{this.value.destroy()}catch{}this.deactivate()}}}else if(this.spec)try{this.value=this.spec.create(e)}catch(t){dn(e.state,t,"CodeMirror plugin crashed"),this.deactivate()}return this}destroy(e){var t;if(!((t=this.value)===null||t===void 0)&&t.destroy)try{this.value.destroy()}catch(i){dn(e.state,i,"CodeMirror plugin crashed")}}deactivate(){this.spec=this.value=null}}const VO=he.define(),T0=he.define(),Qa=he.define(),HO=he.define(),zO=he.define(),eh=he.define();class or{constructor(e,t,i,r){this.fromA=e,this.toA=t,this.fromB=i,this.toB=r}join(e){return new or(Math.min(this.fromA,e.fromA),Math.max(this.toA,e.toA),Math.min(this.fromB,e.fromB),Math.max(this.toB,e.toB))}addToSet(e){let t=e.length,i=this;for(;t>0;t--){let r=e[t-1];if(!(r.fromA>i.toA)){if(r.toA<i.fromA)break;i=i.join(r),e.splice(t-1,1)}}return e.splice(t,0,i),e}static extendWithRanges(e,t){if(t.length==0)return e;let i=[];for(let r=0,s=0,o=0,l=0;;r++){let a=r==e.length?null:e[r],h=o-l,c=a?a.fromB:1e9;for(;s<t.length&&t[s]<c;){let u=t[s],f=t[s+1],d=Math.max(l,u),p=Math.min(c,f);if(d<=p&&new or(d+h,p+h,d,p).addToSet(i),f>c)break;s+=2}if(!a)return i;new or(a.fromA,a.toA,a.fromB,a.toB).addToSet(i),o=a.toA,l=a.toB}}}class Nu{constructor(e,t,i){this.view=e,this.state=t,this.transactions=i,this.flags=0,this.startState=e.state,this.changes=Yt.empty(this.startState.doc.length);for(let o of i)this.changes=this.changes.compose(o.changes);let r=[];this.changes.iterChangedRanges((o,l,a,h)=>r.push(new or(o,l,a,h))),this.changedRanges=r;let s=e.hasFocus;s!=e.inputState.notifiedFocused&&(e.inputState.notifiedFocused=s,this.flags|=1)}static create(e,t,i){return new Nu(e,t,i)}get viewportChanged(){return(this.flags&4)>0}get heightChanged(){return(this.flags&2)>0}get geometryChanged(){return this.docChanged||(this.flags&10)>0}get focusChanged(){return(this.flags&1)>0}get docChanged(){return!this.changes.empty}get selectionSet(){return this.transactions.some(e=>e.selection)}get empty(){return this.flags==0&&this.transactions.length==0}}var kt=function(n){return n[n.LTR=0]="LTR",n[n.RTL=1]="RTL",n}(kt||(kt={}));const P0=kt.LTR,t3=kt.RTL;function jO(n){let e=[];for(let t=0;t<n.length;t++)e.push(1<<+n[t]);return e}const i3=jO("88888888888888888888888888888888888666888888787833333333337888888000000000000000000000000008888880000000000000000000000000088888888888888888888888888888888888887866668888088888663380888308888800000000000000000000000800000000000000000000000000000008"),n3=jO("4444448826627288999999999992222222222222222222222222222222222222222222222229999999999999999999994444444444644222822222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222999999949999999229989999223333333333"),B0=Object.create(null),lr=[];for(let n of["()","[]","{}"]){let e=n.charCodeAt(0),t=n.charCodeAt(1);B0[e]=t,B0[t]=-e}function r3(n){return n<=247?i3[n]:1424<=n&&n<=1524?2:1536<=n&&n<=1785?n3[n-1536]:1774<=n&&n<=2220?4:8192<=n&&n<=8203||n==8204?256:1}const s3=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;class vl{constructor(e,t,i){this.from=e,this.to=t,this.level=i}get dir(){return this.level%2?t3:P0}side(e,t){return this.dir==t==e?this.to:this.from}static find(e,t,i,r){let s=-1;for(let o=0;o<e.length;o++){let l=e[o];if(l.from<=t&&l.to>=t){if(l.level==i)return o;(s<0||(r!=0?r<0?l.from<t:l.to>t:e[s].level>l.level))&&(s=o)}}if(s<0)throw new RangeError("Index out of range");return s}}const Ct=[];function $O(n,e){let t=n.length,i=e==P0?1:2,r=e==P0?2:1;if(!n||i==1&&!s3.test(n))return UO(t);for(let o=0,l=i,a=i;o<t;o++){let h=r3(n.charCodeAt(o));h==512?h=l:h==8&&a==4&&(h=16),Ct[o]=h==4?2:h,h&7&&(a=h),l=h}for(let o=0,l=i,a=i;o<t;o++){let h=Ct[o];if(h==128)o<t-1&&l==Ct[o+1]&&l&24?h=Ct[o]=l:Ct[o]=256;else if(h==64){let c=o+1;for(;c<t&&Ct[c]==64;)c++;let u=o&&l==8||c<t&&Ct[c]==8?a==1?1:8:256;for(let f=o;f<c;f++)Ct[f]=u;o=c-1}else h==8&&a==1&&(Ct[o]=1);l=h,h&7&&(a=h)}for(let o=0,l=0,a=0,h,c,u;o<t;o++)if(c=B0[h=n.charCodeAt(o)])if(c<0){for(let f=l-3;f>=0;f-=3)if(lr[f+1]==-c){let d=lr[f+2],p=d&2?i:d&4?d&1?r:i:0;p&&(Ct[o]=Ct[lr[f]]=p),l=f;break}}else{if(lr.length==189)break;lr[l++]=o,lr[l++]=h,lr[l++]=a}else if((u=Ct[o])==2||u==1){let f=u==i;a=f?0:1;for(let d=l-3;d>=0;d-=3){let p=lr[d+2];if(p&2)break;if(f)lr[d+2]|=2;else{if(p&4)break;lr[d+2]|=4}}}for(let o=0;o<t;o++)if(Ct[o]==256){let l=o+1;for(;l<t&&Ct[l]==256;)l++;let a=(o?Ct[o-1]:i)==1,h=(l<t?Ct[l]:i)==1,c=a==h?a?1:2:i;for(let u=o;u<l;u++)Ct[u]=c;o=l-1}let s=[];if(i==1)for(let o=0;o<t;){let l=o,a=Ct[o++]!=1;for(;o<t&&a==(Ct[o]!=1);)o++;if(a)for(let h=o;h>l;){let c=h,u=Ct[--h]!=2;for(;h>l&&u==(Ct[h-1]!=2);)h--;s.push(new vl(h,c,u?2:1))}else s.push(new vl(l,o,0))}else for(let o=0;o<t;){let l=o,a=Ct[o++]==2;for(;o<t&&a==(Ct[o]==2);)o++;s.push(new vl(l,o,a?1:2))}return s}function UO(n){return[new vl(0,n,0)]}let qO="";function KO(n,e,t,i,r){var s;let o=i.head-n.from,l=-1;if(o==0){if(!r||!n.length)return null;e[0].level!=t&&(o=e[0].side(!1,t),l=0)}else if(o==n.length){if(r)return null;let f=e[e.length-1];f.level!=t&&(o=f.side(!0,t),l=e.length-1)}l<0&&(l=vl.find(e,o,(s=i.bidiLevel)!==null&&s!==void 0?s:-1,i.assoc));let a=e[l];o==a.side(r,t)&&(a=e[l+=r?1:-1],o=a.side(!r,t));let h=r==(a.dir==t),c=un(n.text,o,h);if(qO=n.text.slice(Math.min(o,c),Math.max(o,c)),c!=a.side(r,t))return L.cursor(c+n.from,h?-1:1,a.level);let u=l==(r?e.length-1:0)?null:e[l+(r?1:-1)];return!u&&a.level!=t?L.cursor(r?n.to:n.from,r?-1:1,t):u&&u.level<a.level?L.cursor(u.side(!r,t)+n.from,r?1:-1,u.level):L.cursor(c+n.from,r?-1:1,a.level)}const Os="\uFFFF";class GO{constructor(e,t){this.points=e,this.text="",this.lineSeparator=t.facet(Fe.lineSeparator)}append(e){this.text+=e}lineBreak(){this.text+=Os}readRange(e,t){if(!e)return this;let i=e.parentNode;for(let r=e;;){this.findPointBefore(i,r),this.readNode(r);let s=r.nextSibling;if(s==t)break;let o=Et.get(r),l=Et.get(s);(o&&l?o.breakAfter:(o?o.breakAfter:JO(r))||JO(s)&&(r.nodeName!="BR"||r.cmIgnore))&&this.lineBreak(),r=s}return this.findPointBefore(i,t),this}readTextNode(e){let t=e.nodeValue;for(let i of this.points)i.node==e&&(i.pos=this.text.length+Math.min(i.offset,t.length));for(let i=0,r=this.lineSeparator?null:/\r\n?|\n/g;;){let s=-1,o=1,l;if(this.lineSeparator?(s=t.indexOf(this.lineSeparator,i),o=this.lineSeparator.length):(l=r.exec(t))&&(s=l.index,o=l[0].length),this.append(t.slice(i,s<0?t.length:s)),s<0)break;if(this.lineBreak(),o>1)for(let a of this.points)a.node==e&&a.pos>this.text.length&&(a.pos-=o-1);i=s+o}}readNode(e){if(e.cmIgnore)return;let t=Et.get(e),i=t&&t.overrideDOMText;if(i!=null){this.findPointInside(e,i.length);for(let r=i.iter();!r.next().done;)r.lineBreak?this.lineBreak():this.append(r.value)}else e.nodeType==3?this.readTextNode(e):e.nodeName=="BR"?e.nextSibling&&this.lineBreak():e.nodeType==1&&this.readRange(e.firstChild,null)}findPointBefore(e,t){for(let i of this.points)i.node==e&&e.childNodes[i.offset]==t&&(i.pos=this.text.length)}findPointInside(e,t){for(let i of this.points)(e.nodeType==3?i.node==e:e.contains(i.node))&&(i.pos=this.text.length+Math.min(t,i.offset))}}function JO(n){return n.nodeType==1&&/^(DIV|P|LI|UL|OL|BLOCKQUOTE|DD|DT|H\d|SECTION|PRE)$/.test(n.nodeName)}class ZO{constructor(e,t){this.node=e,this.offset=t,this.pos=-1}}class YO extends Et{constructor(e){super(),this.view=e,this.compositionDeco=ue.none,this.decorations=[],this.dynamicDecorationMap=[],this.minWidth=0,this.minWidthFrom=0,this.minWidthTo=0,this.impreciseAnchor=null,this.impreciseHead=null,this.forceSelection=!1,this.lastUpdate=Date.now(),this.setDOM(e.contentDOM),this.children=[new zi],this.children[0].setParent(this),this.updateDeco(),this.updateInner([new or(0,0,0,e.state.doc.length)],0)}get root(){return this.view.root}get editorView(){return this.view}get length(){return this.view.state.doc.length}update(e){let t=e.changedRanges;this.minWidth>0&&t.length&&(t.every(({fromA:o,toA:l})=>l<this.minWidthFrom||o>this.minWidthTo)?(this.minWidthFrom=e.changes.mapPos(this.minWidthFrom,1),this.minWidthTo=e.changes.mapPos(this.minWidthTo,1)):this.minWidth=this.minWidthFrom=this.minWidthTo=0),this.view.inputState.composing<0?this.compositionDeco=ue.none:(e.transactions.length||this.dirty)&&(this.compositionDeco=l3(this.view,e.changes)),(fe.ie||fe.chrome)&&!this.compositionDeco.size&&e&&e.state.doc.lines!=e.startState.doc.lines&&(this.forceSelection=!0);let i=this.decorations,r=this.updateDeco(),s=u3(i,r,e.changes);return t=or.extendWithRanges(t,s),this.dirty==0&&t.length==0?!1:(this.updateInner(t,e.startState.doc.length),e.transactions.length&&(this.lastUpdate=Date.now()),!0)}updateInner(e,t){this.view.viewState.mustMeasureContent=!0,this.updateChildren(e,t);let{observer:i}=this.view;i.ignore(()=>{this.dom.style.height=this.view.viewState.contentHeight+"px",this.dom.style.minWidth=this.minWidth?this.minWidth+"px":"";let s=fe.chrome||fe.ios?{node:i.selectionRange.focusNode,written:!1}:void 0;this.sync(s),this.dirty=0,s&&(s.written||i.selectionRange.focusNode!=s.node)&&(this.forceSelection=!0),this.dom.style.height=""});let r=[];if(this.view.viewport.from||this.view.viewport.to<this.view.state.doc.length)for(let s of this.children)s instanceof yo&&s.widget instanceof XO&&r.push(s.dom);i.updateGaps(r)}updateChildren(e,t){let i=this.childCursor(t);for(let r=e.length-1;;r--){let s=r>=0?e[r]:null;if(!s)break;let{fromA:o,toA:l,fromB:a,toB:h}=s,{content:c,breakAtStart:u,openStart:f,openEnd:d}=D0.build(this.view.state.doc,a,h,this.decorations,this.dynamicDecorationMap),{i:p,off:g}=i.findPos(l,1),{i:y,off:v}=i.findPos(o,-1);wO(this,y,v,p,g,c,u,f,d)}}updateSelection(e=!1,t=!1){if(e&&this.view.observer.readSelectionRange(),!(t||this.mayControlSelection())||fe.ios&&this.view.inputState.rapidCompositionStart)return;let i=this.forceSelection;this.forceSelection=!1;let r=this.view.state.selection.main,s=this.domAtPos(r.anchor),o=r.empty?s:this.domAtPos(r.head);if(fe.gecko&&r.empty&&o3(s)){let a=document.createTextNode("");this.view.observer.ignore(()=>s.node.insertBefore(a,s.node.childNodes[s.offset]||null)),s=o=new mi(a,0),i=!0}let l=this.view.observer.selectionRange;(i||!l.focusNode||!Eu(s.node,s.offset,l.anchorNode,l.anchorOffset)||!Eu(o.node,o.offset,l.focusNode,l.focusOffset))&&(this.view.observer.ignore(()=>{fe.android&&fe.chrome&&this.dom.contains(l.focusNode)&&f3(l.focusNode,this.dom)&&(this.dom.blur(),this.dom.focus({preventScroll:!0}));let a=Mu(this.root);if(r.empty){if(fe.gecko){let h=h3(s.node,s.offset);if(h&&h!=3){let c=e2(s.node,s.offset,h==1?1:-1);c&&(s=new mi(c,h==1?0:c.nodeValue.length))}}a.collapse(s.node,s.offset),r.bidiLevel!=null&&l.cursorBidiLevel!=null&&(l.cursorBidiLevel=r.bidiLevel)}else if(a.extend)a.collapse(s.node,s.offset),a.extend(o.node,o.offset);else{let h=document.createRange();r.anchor>r.head&&([s,o]=[o,s]),h.setEnd(o.node,o.offset),h.setStart(s.node,s.offset),a.removeAllRanges(),a.addRange(h)}}),this.view.observer.setSelectionRange(s,o)),this.impreciseAnchor=s.precise?null:new mi(l.anchorNode,l.anchorOffset),this.impreciseHead=o.precise?null:new mi(l.focusNode,l.focusOffset)}enforceCursorAssoc(){if(this.compositionDeco.size)return;let e=this.view.state.selection.main,t=Mu(this.root);if(!e.empty||!e.assoc||!t.modify)return;let i=zi.find(this,e.head);if(!i)return;let r=i.posAtStart;if(e.head==r||e.head==r+i.length)return;let s=this.coordsAt(e.head,-1),o=this.coordsAt(e.head,1);if(!s||!o||s.bottom>o.top)return;let l=this.domAtPos(e.head+e.assoc);t.collapse(l.node,l.offset),t.modify("move",e.assoc<0?"forward":"backward","lineboundary")}mayControlSelection(){return this.view.state.facet(Ya)?this.root.activeElement==this.dom:m0(this.dom,this.view.observer.selectionRange)}nearest(e){for(let t=e;t;){let i=Et.get(t);if(i&&i.rootView==this)return i;t=t.parentNode}return null}posFromDOM(e,t){let i=this.nearest(e);if(!i)throw new RangeError("Trying to find position for a DOM position outside of the document");return i.localPosFromDOM(e,t)+i.posAtStart}domAtPos(e){let{i:t,off:i}=this.childCursor().findPos(e,-1);for(;t<this.children.length-1;){let r=this.children[t];if(i<r.length||r instanceof zi)break;t++,i=0}return this.children[t].domAtPos(i)}coordsAt(e,t){for(let i=this.length,r=this.children.length-1;;r--){let s=this.children[r],o=i-s.breakAfter-s.length;if(e>o||e==o&&s.type!=nt.WidgetBefore&&s.type!=nt.WidgetAfter&&(!r||t==2||this.children[r-1].breakAfter||this.children[r-1].type==nt.WidgetBefore&&t>-2))return s.coordsAt(e-o,t);i=o}}measureVisibleLineHeights(e){let t=[],{from:i,to:r}=e,s=this.view.contentDOM.clientWidth,o=s>Math.max(this.view.scrollDOM.clientWidth,this.minWidth)+1,l=-1,a=this.view.textDirection==kt.LTR;for(let h=0,c=0;c<this.children.length;c++){let u=this.children[c],f=h+u.length;if(f>r)break;if(h>=i){let d=u.dom.getBoundingClientRect();if(t.push(d.height),o){let p=u.dom.lastChild,g=p?Ka(p):[];if(g.length){let y=g[g.length-1],v=a?y.right-d.left:d.right-y.left;v>l&&(l=v,this.minWidth=s,this.minWidthFrom=h,this.minWidthTo=f)}}}h=f+u.breakAfter}return t}textDirectionAt(e){let{i:t}=this.childPos(e,1);return getComputedStyle(this.children[t].dom).direction=="rtl"?kt.RTL:kt.LTR}measureTextSize(){for(let r of this.children)if(r instanceof zi){let s=r.measureTextSize();if(s)return s}let e=document.createElement("div"),t,i;return e.className="cm-line",e.textContent="abc def ghi jkl mno pqr stu",this.view.observer.ignore(()=>{this.dom.appendChild(e);let r=Ka(e.firstChild)[0];t=e.getBoundingClientRect().height,i=r?r.width/27:7,e.remove()}),{lineHeight:t,charWidth:i}}childCursor(e=this.length){let t=this.children.length;return t&&(e-=this.children[--t].length),new vO(this.children,e,t)}computeBlockGapDeco(){let e=[],t=this.view.viewState;for(let i=0,r=0;;r++){let s=r==t.viewports.length?null:t.viewports[r],o=s?s.from-1:this.length;if(o>i){let l=t.lineBlockAt(o).bottom-t.lineBlockAt(i).top;e.push(ue.replace({widget:new XO(l),block:!0,inclusive:!0,isBlockGap:!0}).range(i,o))}if(!s)break;i=s.to+1}return ue.set(e)}updateDeco(){let e=this.view.state.facet(Qa).map((t,i)=>(this.dynamicDecorationMap[i]=typeof t=="function")?t(this.view):t);for(let t=e.length;t<e.length+3;t++)this.dynamicDecorationMap[t]=!1;return this.decorations=[...e,this.compositionDeco,this.computeBlockGapDeco(),this.view.viewState.lineGapDeco]}scrollIntoView(e){let{range:t}=e,i=this.coordsAt(t.head,t.empty?t.assoc:t.head>t.anchor?-1:1),r;if(!i)return;!t.empty&&(r=this.coordsAt(t.anchor,t.anchor>t.head?-1:1))&&(i={left:Math.min(i.left,r.left),top:Math.min(i.top,r.top),right:Math.max(i.right,r.right),bottom:Math.max(i.bottom,r.bottom)});let s=0,o=0,l=0,a=0;for(let c of this.view.state.facet(zO).map(u=>u(this.view)))if(c){let{left:u,right:f,top:d,bottom:p}=c;u!=null&&(s=Math.max(s,u)),f!=null&&(o=Math.max(o,f)),d!=null&&(l=Math.max(l,d)),p!=null&&(a=Math.max(a,p))}let h={left:i.left-s,top:i.top-l,right:i.right+o,bottom:i.bottom+a};GV(this.view.scrollDOM,h,t.head<t.anchor?-1:1,e.x,e.y,e.xMargin,e.yMargin,this.view.textDirection==kt.LTR)}}function o3(n){return n.node.nodeType==1&&n.node.firstChild&&(n.offset==0||n.node.childNodes[n.offset-1].contentEditable=="false")&&(n.offset==n.node.childNodes.length||n.node.childNodes[n.offset].contentEditable=="false")}class XO extends sr{constructor(e){super(),this.height=e}toDOM(){let e=document.createElement("div");return this.updateDOM(e),e}eq(e){return e.height==this.height}updateDOM(e){return e.style.height=this.height+"px",!0}get estimatedHeight(){return this.height}}function QO(n){let e=n.observer.selectionRange,t=e.focusNode&&e2(e.focusNode,e.focusOffset,0);if(!t)return null;let i=n.docView.nearest(t);if(!i)return null;if(i instanceof zi){let r=t;for(;r.parentNode!=i.dom;)r=r.parentNode;let s=r.previousSibling;for(;s&&!Et.get(s);)s=s.previousSibling;let o=s?Et.get(s).posAtEnd:i.posAtStart;return{from:o,to:o,node:r,text:t}}else{for(;;){let{parent:s}=i;if(!s)return null;if(s instanceof zi)break;i=s}let r=i.posAtStart;return{from:r,to:r+i.length,node:i.dom,text:t}}}function l3(n,e){let t=QO(n);if(!t)return ue.none;let{from:i,to:r,node:s,text:o}=t,l=e.mapPos(i,1),a=Math.max(l,e.mapPos(r,-1)),{state:h}=n,c=s.nodeType==3?s.nodeValue:new GO([],h).readRange(s.firstChild,null).text;if(a-l<c.length)if(h.doc.sliceString(l,Math.min(h.doc.length,l+c.length),Os)==c)a=l+c.length;else if(h.doc.sliceString(Math.max(0,a-c.length),a,Os)==c)l=a-c.length;else return ue.none;else if(h.doc.sliceString(l,a,Os)!=c)return ue.none;let u=Et.get(s);return u instanceof OO?u=u.widget.topView:u&&(u.parent=null),ue.set(ue.replace({widget:new a3(s,o,u),inclusive:!0}).range(l,a))}class a3 extends sr{constructor(e,t,i){super(),this.top=e,this.text=t,this.topView=i}eq(e){return this.top==e.top&&this.text==e.text}toDOM(){return this.top}ignoreEvent(){return!1}get customView(){return OO}}function e2(n,e,t){for(;;){if(n.nodeType==3)return n;if(n.nodeType==1&&e>0&&t<=0)n=n.childNodes[e-1],e=Tu(n);else if(n.nodeType==1&&e<n.childNodes.length&&t>=0)n=n.childNodes[e],e=0;else return null}}function h3(n,e){return n.nodeType!=1?0:(e&&n.childNodes[e-1].contentEditable=="false"?1:0)|(e<n.childNodes.length&&n.childNodes[e].contentEditable=="false"?2:0)}class c3{constructor(){this.changes=[]}compareRange(e,t){_0(e,t,this.changes)}comparePoint(e,t){_0(e,t,this.changes)}}function u3(n,e,t){let i=new c3;return We.compare(n,e,t,i),i.changes}function f3(n,e){for(let t=n;t&&t!=e;t=t.assignedSlot||t.parentNode)if(t.nodeType==1&&t.contentEditable=="false")return!0;return!1}function d3(n,e,t=1){let i=n.charCategorizer(e),r=n.doc.lineAt(e),s=e-r.from;if(r.length==0)return L.cursor(e);s==0?t=1:s==r.length&&(t=-1);let o=s,l=s;t<0?o=un(r.text,s,!1):l=un(r.text,s);let a=i(r.text.slice(o,l));for(;o>0;){let h=un(r.text,o,!1);if(i(r.text.slice(h,o))!=a)break;o=h}for(;l<r.length;){let h=un(r.text,l);if(i(r.text.slice(l,h))!=a)break;l=h}return L.range(o+r.from,l+r.from)}function p3(n,e){return e.left>n?e.left-n:Math.max(0,n-e.right)}function m3(n,e){return e.top>n?e.top-n:Math.max(0,n-e.bottom)}function R0(n,e){return n.top<e.bottom-1&&n.bottom>e.top+1}function t2(n,e){return e<n.top?{top:e,left:n.left,right:n.right,bottom:n.bottom}:n}function i2(n,e){return e>n.bottom?{top:n.top,left:n.left,right:n.right,bottom:e}:n}function L0(n,e,t){let i,r,s,o,l,a,h,c;for(let d=n.firstChild;d;d=d.nextSibling){let p=Ka(d);for(let g=0;g<p.length;g++){let y=p[g];r&&R0(r,y)&&(y=t2(i2(y,r.bottom),r.top));let v=p3(e,y),C=m3(t,y);if(v==0&&C==0)return d.nodeType==3?n2(d,e,t):L0(d,e,t);(!i||o>C||o==C&&s>v)&&(i=d,r=y,s=v,o=C),v==0?t>y.bottom&&(!h||h.bottom<y.bottom)?(l=d,h=y):t<y.top&&(!c||c.top>y.top)&&(a=d,c=y):h&&R0(h,y)?h=i2(h,y.bottom):c&&R0(c,y)&&(c=t2(c,y.top))}}if(h&&h.bottom>=t?(i=l,r=h):c&&c.top<=t&&(i=a,r=c),!i)return{node:n,offset:0};let u=Math.max(r.left,Math.min(r.right,e));if(i.nodeType==3)return n2(i,u,t);if(!s&&i.contentEditable=="true")return L0(i,u,t);let f=Array.prototype.indexOf.call(n.childNodes,i)+(e>=(r.left+r.right)/2?1:0);return{node:n,offset:f}}function n2(n,e,t){let i=n.nodeValue.length,r=-1,s=1e9,o=0;for(let l=0;l<i;l++){let a=Ga(n,l,l+1).getClientRects();for(let h=0;h<a.length;h++){let c=a[h];if(c.top==c.bottom)continue;o||(o=e-c.left);let u=(c.top>t?c.top-t:t-c.bottom)-1;if(c.left-1<=e&&c.right+1>=e&&u<s){let f=e>=(c.left+c.right)/2,d=f;if((fe.chrome||fe.gecko)&&Ga(n,l).getBoundingClientRect().left==c.right&&(d=!f),u<=0)return{node:n,offset:l+(d?1:0)};r=l+(d?1:0),s=u}}}return{node:n,offset:r>-1?r:o>0?n.nodeValue.length:0}}function r2(n,{x:e,y:t},i,r=-1){var s;let o=n.contentDOM.getBoundingClientRect(),l=o.top+n.viewState.paddingTop,a,{docHeight:h}=n.viewState,c=t-l;if(c<0)return 0;if(c>h)return n.state.doc.length;for(let v=n.defaultLineHeight/2,C=!1;a=n.elementAtHeight(c),a.type!=nt.Text;)for(;c=r>0?a.bottom+v:a.top-v,!(c>=0&&c<=h);){if(C)return i?null:0;C=!0,r=-r}t=l+c;let u=a.from;if(u<n.viewport.from)return n.viewport.from==0?0:i?null:s2(n,o,a,e,t);if(u>n.viewport.to)return n.viewport.to==n.state.doc.length?n.state.doc.length:i?null:s2(n,o,a,e,t);let f=n.dom.ownerDocument,d=n.root.elementFromPoint?n.root:f,p=d.elementFromPoint(e,t);p&&!n.contentDOM.contains(p)&&(p=null),p||(e=Math.max(o.left+1,Math.min(o.right-1,e)),p=d.elementFromPoint(e,t),p&&!n.contentDOM.contains(p)&&(p=null));let g,y=-1;if(p&&((s=n.docView.nearest(p))===null||s===void 0?void 0:s.isEditable)!=!1){if(f.caretPositionFromPoint){let v=f.caretPositionFromPoint(e,t);v&&({offsetNode:g,offset:y}=v)}else if(f.caretRangeFromPoint){let v=f.caretRangeFromPoint(e,t);v&&({startContainer:g,startOffset:y}=v,fe.safari&&g3(g,y,e)&&(g=void 0))}}if(!g||!n.docView.dom.contains(g)){let v=zi.find(n.docView,u);if(!v)return c>a.top+a.height/2?a.to:a.from;({node:g,offset:y}=L0(v.dom,e,t))}return n.docView.posFromDOM(g,y)}function s2(n,e,t,i,r){let s=Math.round((i-e.left)*n.defaultCharacterWidth);n.lineWrapping&&t.height>n.defaultLineHeight*1.5&&(s+=Math.floor((r-t.top)/n.defaultLineHeight)*n.viewState.heightOracle.lineLength);let o=n.state.sliceDoc(t.from,t.to);return t.from+p0(o,s,n.state.tabSize)}function g3(n,e,t){let i;if(n.nodeType!=3||e!=(i=n.nodeValue.length))return!1;for(let r=n.nextSibling;r;r=r.nextSibling)if(r.nodeType!=1||r.nodeName!="BR")return!1;return Ga(n,i-1,i).getBoundingClientRect().left>t}function y3(n,e,t,i){let r=n.state.doc.lineAt(e.head),s=!i||!n.lineWrapping?null:n.coordsAtPos(e.assoc<0&&e.head>r.from?e.head-1:e.head);if(s){let a=n.dom.getBoundingClientRect(),h=n.textDirectionAt(r.from),c=n.posAtCoords({x:t==(h==kt.LTR)?a.right-1:a.left+1,y:(s.top+s.bottom)/2});if(c!=null)return L.cursor(c,t?-1:1)}let o=zi.find(n.docView,e.head),l=o?t?o.posAtEnd:o.posAtStart:t?r.to:r.from;return L.cursor(l,t?-1:1)}function o2(n,e,t,i){let r=n.state.doc.lineAt(e.head),s=n.bidiSpans(r),o=n.textDirectionAt(r.from);for(let l=e,a=null;;){let h=KO(r,s,o,l,t),c=qO;if(!h){if(r.number==(t?n.state.doc.lines:1))return l;c=`
`,r=n.state.doc.line(r.number+(t?1:-1)),s=n.bidiSpans(r),h=L.cursor(t?r.from:r.to)}if(a){if(!a(c))return l}else{if(!i)return h;a=i(c)}l=h}}function v3(n,e,t){let i=n.state.charCategorizer(e),r=i(t);return s=>{let o=i(s);return r==Hi.Space&&(r=o),r==o}}function w3(n,e,t,i){let r=e.head,s=t?1:-1;if(r==(t?n.state.doc.length:0))return L.cursor(r,e.assoc);let o=e.goalColumn,l,a=n.contentDOM.getBoundingClientRect(),h=n.coordsAtPos(r),c=n.documentTop;if(h)o==null&&(o=h.left-a.left),l=s<0?h.top:h.bottom;else{let d=n.viewState.lineBlockAt(r);o==null&&(o=Math.min(a.right-a.left,n.defaultCharacterWidth*(r-d.from))),l=(s<0?d.top:d.bottom)+c}let u=a.left+o,f=i!=null?i:n.defaultLineHeight>>1;for(let d=0;;d+=10){let p=l+(f+d)*s,g=r2(n,{x:u,y:p},!1,s);if(p<a.top||p>a.bottom||(s<0?g<r:g>r))return L.cursor(g,e.assoc,void 0,o)}}function F0(n,e,t){let i=n.state.facet(HO).map(r=>r(n));for(;;){let r=!1;for(let s of i)s.between(t.from-1,t.from+1,(o,l,a)=>{t.from>o&&t.from<l&&(t=e.from>t.from?L.cursor(o,1):L.cursor(l,-1),r=!0)});if(!r)return t}}class b3{constructor(e){this.lastKeyCode=0,this.lastKeyTime=0,this.pendingIOSKey=void 0,this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastEscPress=0,this.lastContextMenu=0,this.scrollHandlers=[],this.registeredEvents=[],this.customHandlers=[],this.composing=-1,this.compositionFirstChange=null,this.compositionEndedAt=0,this.rapidCompositionStart=!1,this.mouseSelection=null;for(let t in Qt){let i=Qt[t];e.contentDOM.addEventListener(t,r=>{!h2(e,r)||this.ignoreDuringComposition(r)||t=="keydown"&&this.keydown(e,r)||(this.mustFlushObserver(r)&&e.observer.forceFlush(),this.runCustomHandlers(t,e,r)?r.preventDefault():i(e,r))}),this.registeredEvents.push(t)}this.notifiedFocused=e.hasFocus,fe.safari&&e.contentDOM.addEventListener("input",()=>null)}setSelectionOrigin(e){this.lastSelectionOrigin=e,this.lastSelectionTime=Date.now()}ensureHandlers(e,t){var i;let r;for(let s of t)if(r=(i=s.update(e).spec)===null||i===void 0?void 0:i.domEventHandlers){this.customHandlers.push({plugin:s.value,handlers:r});for(let o in r)this.registeredEvents.indexOf(o)<0&&o!="scroll"&&(this.registeredEvents.push(o),e.contentDOM.addEventListener(o,l=>{!h2(e,l)||this.runCustomHandlers(o,e,l)&&l.preventDefault()}))}}runCustomHandlers(e,t,i){for(let r of this.customHandlers){let s=r.handlers[e];if(s)try{if(s.call(r.plugin,i,t)||i.defaultPrevented)return!0}catch(o){dn(t.state,o)}}return!1}runScrollHandlers(e,t){for(let i of this.customHandlers){let r=i.handlers.scroll;if(r)try{r.call(i.plugin,t,e)}catch(s){dn(e.state,s)}}}keydown(e,t){if(this.lastKeyCode=t.keyCode,this.lastKeyTime=Date.now(),t.keyCode==9&&Date.now()<this.lastEscPress+2e3)return!0;if(fe.android&&fe.chrome&&!t.synthetic&&(t.keyCode==13||t.keyCode==8))return e.observer.delayAndroidKey(t.key,t.keyCode),!0;let i;return fe.ios&&(i=l2.find(r=>r.keyCode==t.keyCode))&&!(t.ctrlKey||t.altKey||t.metaKey)&&!t.synthetic?(this.pendingIOSKey=i,setTimeout(()=>this.flushIOSKey(e),250),!0):!1}flushIOSKey(e){let t=this.pendingIOSKey;return t?(this.pendingIOSKey=void 0,Ja(e.contentDOM,t.key,t.keyCode)):!1}ignoreDuringComposition(e){return/^key/.test(e.type)?this.composing>0?!0:fe.safari&&Date.now()-this.compositionEndedAt<100?(this.compositionEndedAt=0,!0):!1:!1}mustFlushObserver(e){return e.type=="keydown"&&e.keyCode!=229||e.type=="compositionend"&&!fe.ios}startMouseSelection(e){this.mouseSelection&&this.mouseSelection.destroy(),this.mouseSelection=e}update(e){this.mouseSelection&&this.mouseSelection.update(e),e.transactions.length&&(this.lastKeyCode=this.lastSelectionTime=0)}destroy(){this.mouseSelection&&this.mouseSelection.destroy()}}const l2=[{key:"Backspace",keyCode:8,inputType:"deleteContentBackward"},{key:"Enter",keyCode:13,inputType:"insertParagraph"},{key:"Delete",keyCode:46,inputType:"deleteContentForward"}],a2=[16,17,18,20,91,92,224,225];class x3{constructor(e,t,i,r){this.view=e,this.style=i,this.mustSelect=r,this.lastEvent=t;let s=e.contentDOM.ownerDocument;s.addEventListener("mousemove",this.move=this.move.bind(this)),s.addEventListener("mouseup",this.up=this.up.bind(this)),this.extend=t.shiftKey,this.multiple=e.state.facet(Fe.allowMultipleSelections)&&S3(e,t),this.dragMove=k3(e,t),this.dragging=C3(e,t)&&N0(t)==1?null:!1,this.dragging===!1&&(t.preventDefault(),this.select(t))}move(e){if(e.buttons==0)return this.destroy();this.dragging===!1&&this.select(this.lastEvent=e)}up(e){this.dragging==null&&this.select(this.lastEvent),this.dragging||e.preventDefault(),this.destroy()}destroy(){let e=this.view.contentDOM.ownerDocument;e.removeEventListener("mousemove",this.move),e.removeEventListener("mouseup",this.up),this.view.inputState.mouseSelection=null}select(e){let t=this.style.get(e,this.extend,this.multiple);(this.mustSelect||!t.eq(this.view.state.selection)||t.main.assoc!=this.view.state.selection.main.assoc)&&this.view.dispatch({selection:t,userEvent:"select.pointer",scrollIntoView:!0}),this.mustSelect=!1}update(e){e.docChanged&&this.dragging&&(this.dragging=this.dragging.map(e.changes)),this.style.update(e)&&setTimeout(()=>this.select(this.lastEvent),20)}}function S3(n,e){let t=n.state.facet(BO);return t.length?t[0](e):fe.mac?e.metaKey:e.ctrlKey}function k3(n,e){let t=n.state.facet(RO);return t.length?t[0](e):fe.mac?!e.altKey:!e.ctrlKey}function C3(n,e){let{main:t}=n.state.selection;if(t.empty)return!1;let i=Mu(n.root);if(i.rangeCount==0)return!0;let r=i.getRangeAt(0).getClientRects();for(let s=0;s<r.length;s++){let o=r[s];if(o.left<=e.clientX&&o.right>=e.clientX&&o.top<=e.clientY&&o.bottom>=e.clientY)return!0}return!1}function h2(n,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let t=e.target,i;t!=n.contentDOM;t=t.parentNode)if(!t||t.nodeType==11||(i=Et.get(t))&&i.ignoreEvent(e))return!1;return!0}const Qt=Object.create(null),c2=fe.ie&&fe.ie_version<15||fe.ios&&fe.webkit_version<604;function A3(n){let e=n.dom.parentNode;if(!e)return;let t=e.appendChild(document.createElement("textarea"));t.style.cssText="position: fixed; left: -10000px; top: 10px",t.focus(),setTimeout(()=>{n.focus(),t.remove(),u2(n,t.value)},50)}function u2(n,e){let{state:t}=n,i,r=1,s=t.toText(e),o=s.lines==t.selection.ranges.length;if(I0!=null&&t.selection.ranges.every(a=>a.empty)&&I0==s.toString()){let a=-1;i=t.changeByRange(h=>{let c=t.doc.lineAt(h.from);if(c.from==a)return{range:h};a=c.from;let u=t.toText((o?s.line(r++).text:e)+t.lineBreak);return{changes:{from:c.from,insert:u},range:L.cursor(h.from+u.length)}})}else o?i=t.changeByRange(a=>{let h=s.line(r++);return{changes:{from:a.from,to:a.to,insert:h.text},range:L.cursor(a.from+h.length)}}):i=t.replaceSelection(s);n.dispatch(i,{userEvent:"input.paste",scrollIntoView:!0})}Qt.keydown=(n,e)=>{n.inputState.setSelectionOrigin("select"),e.keyCode==27?n.inputState.lastEscPress=Date.now():a2.indexOf(e.keyCode)<0&&(n.inputState.lastEscPress=0)};let f2=0;Qt.touchstart=(n,e)=>{f2=Date.now(),n.inputState.setSelectionOrigin("select.pointer")},Qt.touchmove=n=>{n.inputState.setSelectionOrigin("select.pointer")},Qt.mousedown=(n,e)=>{if(n.observer.flush(),f2>Date.now()-2e3&&N0(e)==1)return;let t=null;for(let i of n.state.facet(LO))if(t=i(n,e),t)break;if(!t&&e.button==0&&(t=D3(n,e)),t){let i=n.root.activeElement!=n.contentDOM;i&&n.observer.ignore(()=>pO(n.contentDOM)),n.inputState.startMouseSelection(new x3(n,e,t,i))}};function d2(n,e,t,i){if(i==1)return L.cursor(e,t);if(i==2)return d3(n.state,e,t);{let r=zi.find(n.docView,e),s=n.state.doc.lineAt(r?r.posAtEnd:e),o=r?r.posAtStart:s.from,l=r?r.posAtEnd:s.to;return l<n.state.doc.length&&l==s.to&&l++,L.range(o,l)}}let p2=(n,e)=>n>=e.top&&n<=e.bottom,m2=(n,e,t)=>p2(e,t)&&n>=t.left&&n<=t.right;function O3(n,e,t,i){let r=zi.find(n.docView,e);if(!r)return 1;let s=e-r.posAtStart;if(s==0)return 1;if(s==r.length)return-1;let o=r.coordsAt(s,-1);if(o&&m2(t,i,o))return-1;let l=r.coordsAt(s,1);return l&&m2(t,i,l)?1:o&&p2(i,o)?-1:1}function g2(n,e){let t=n.posAtCoords({x:e.clientX,y:e.clientY},!1);return{pos:t,bias:O3(n,t,e.clientX,e.clientY)}}const _3=fe.ie&&fe.ie_version<=11;let y2=null,v2=0,w2=0;function N0(n){if(!_3)return n.detail;let e=y2,t=w2;return y2=n,w2=Date.now(),v2=!e||t>Date.now()-400&&Math.abs(e.clientX-n.clientX)<2&&Math.abs(e.clientY-n.clientY)<2?(v2+1)%3:1}function D3(n,e){let t=g2(n,e),i=N0(e),r=n.state.selection,s=t,o=e;return{update(l){l.docChanged&&(t&&(t.pos=l.changes.mapPos(t.pos)),r=r.map(l.changes),o=null)},get(l,a,h){let c;if(o&&l.clientX==o.clientX&&l.clientY==o.clientY?c=s:(c=s=g2(n,l),o=l),!c||!t)return r;let u=d2(n,c.pos,c.bias,i);if(t.pos!=c.pos&&!a){let f=d2(n,t.pos,t.bias,i),d=Math.min(f.from,u.from),p=Math.max(f.to,u.to);u=d<u.from?L.range(d,p):L.range(p,d)}return a?r.replaceRange(r.main.extend(u.from,u.to)):h?r.addRange(u):L.create([u])}}}Qt.dragstart=(n,e)=>{let{selection:{main:t}}=n.state,{mouseSelection:i}=n.inputState;i&&(i.dragging=t),e.dataTransfer&&(e.dataTransfer.setData("Text",n.state.sliceDoc(t.from,t.to)),e.dataTransfer.effectAllowed="copyMove")};function b2(n,e,t,i){if(!t)return;let r=n.posAtCoords({x:e.clientX,y:e.clientY},!1);e.preventDefault();let{mouseSelection:s}=n.inputState,o=i&&s&&s.dragging&&s.dragMove?{from:s.dragging.from,to:s.dragging.to}:null,l={from:r,insert:t},a=n.state.changes(o?[o,l]:l);n.focus(),n.dispatch({changes:a,selection:{anchor:a.mapPos(r,-1),head:a.mapPos(r,1)},userEvent:o?"move.drop":"input.drop"})}Qt.drop=(n,e)=>{if(!e.dataTransfer)return;if(n.state.readOnly)return e.preventDefault();let t=e.dataTransfer.files;if(t&&t.length){e.preventDefault();let i=Array(t.length),r=0,s=()=>{++r==t.length&&b2(n,e,i.filter(o=>o!=null).join(n.state.lineBreak),!1)};for(let o=0;o<t.length;o++){let l=new FileReader;l.onerror=s,l.onload=()=>{/[\x00-\x08\x0e-\x1f]{2}/.test(l.result)||(i[o]=l.result),s()},l.readAsText(t[o])}}else b2(n,e,e.dataTransfer.getData("Text"),!0)},Qt.paste=(n,e)=>{if(n.state.readOnly)return e.preventDefault();n.observer.flush();let t=c2?null:e.clipboardData;t?(u2(n,t.getData("text/plain")),e.preventDefault()):A3(n)};function M3(n,e){let t=n.dom.parentNode;if(!t)return;let i=t.appendChild(document.createElement("textarea"));i.style.cssText="position: fixed; left: -10000px; top: 10px",i.value=e,i.focus(),i.selectionEnd=e.length,i.selectionStart=0,setTimeout(()=>{i.remove(),n.focus()},50)}function E3(n){let e=[],t=[],i=!1;for(let r of n.selection.ranges)r.empty||(e.push(n.sliceDoc(r.from,r.to)),t.push(r));if(!e.length){let r=-1;for(let{from:s}of n.selection.ranges){let o=n.doc.lineAt(s);o.number>r&&(e.push(o.text),t.push({from:o.from,to:Math.min(n.doc.length,o.to+1)})),r=o.number}i=!0}return{text:e.join(n.lineBreak),ranges:t,linewise:i}}let I0=null;Qt.copy=Qt.cut=(n,e)=>{let{text:t,ranges:i,linewise:r}=E3(n.state);if(!t&&!r)return;I0=r?t:null;let s=c2?null:e.clipboardData;s?(e.preventDefault(),s.clearData(),s.setData("text/plain",t)):M3(n,t),e.type=="cut"&&!n.state.readOnly&&n.dispatch({changes:i,scrollIntoView:!0,userEvent:"delete.cut"})};function x2(n){setTimeout(()=>{n.hasFocus!=n.inputState.notifiedFocused&&n.update([])},10)}Qt.focus=x2,Qt.blur=n=>{n.observer.clearSelectionRange(),x2(n)};function S2(n,e){if(n.docView.compositionDeco.size){n.inputState.rapidCompositionStart=e;try{n.update([])}finally{n.inputState.rapidCompositionStart=!1}}}Qt.compositionstart=Qt.compositionupdate=n=>{n.inputState.compositionFirstChange==null&&(n.inputState.compositionFirstChange=!0),n.inputState.composing<0&&(n.inputState.composing=0,n.docView.compositionDeco.size&&(n.observer.flush(),S2(n,!0)))},Qt.compositionend=n=>{n.inputState.composing=-1,n.inputState.compositionEndedAt=Date.now(),n.inputState.compositionFirstChange=null,setTimeout(()=>{n.inputState.composing<0&&S2(n,!1)},50)},Qt.contextmenu=n=>{n.inputState.lastContextMenu=Date.now()},Qt.beforeinput=(n,e)=>{var t;let i;if(fe.chrome&&fe.android&&(i=l2.find(r=>r.inputType==e.inputType))&&(n.observer.delayAndroidKey(i.key,i.keyCode),i.key=="Backspace"||i.key=="Delete")){let r=((t=window.visualViewport)===null||t===void 0?void 0:t.height)||0;setTimeout(()=>{var s;(((s=window.visualViewport)===null||s===void 0?void 0:s.height)||0)>r+10&&n.hasFocus&&(n.contentDOM.blur(),n.focus())},100)}};const k2=["pre-wrap","normal","pre-line","break-spaces"];class C2{constructor(){this.doc=$e.empty,this.lineWrapping=!1,this.heightSamples={},this.lineHeight=14,this.charWidth=7,this.lineLength=30,this.heightChanged=!1}heightForGap(e,t){let i=this.doc.lineAt(t).number-this.doc.lineAt(e).number+1;return this.lineWrapping&&(i+=Math.ceil((t-e-i*this.lineLength*.5)/this.lineLength)),this.lineHeight*i}heightForLine(e){return this.lineWrapping?(1+Math.max(0,Math.ceil((e-this.lineLength)/(this.lineLength-5))))*this.lineHeight:this.lineHeight}setDoc(e){return this.doc=e,this}mustRefreshForWrapping(e){return k2.indexOf(e)>-1!=this.lineWrapping}mustRefreshForHeights(e){let t=!1;for(let i=0;i<e.length;i++){let r=e[i];r<0?i++:this.heightSamples[Math.floor(r*10)]||(t=!0,this.heightSamples[Math.floor(r*10)]=!0)}return t}refresh(e,t,i,r,s){let o=k2.indexOf(e)>-1,l=Math.round(t)!=Math.round(this.lineHeight)||this.lineWrapping!=o;if(this.lineWrapping=o,this.lineHeight=t,this.charWidth=i,this.lineLength=r,l){this.heightSamples={};for(let a=0;a<s.length;a++){let h=s[a];h<0?a++:this.heightSamples[Math.floor(h*10)]=!0}}return l}}class A2{constructor(e,t){this.from=e,this.heights=t,this.index=0}get more(){return this.index<this.heights.length}}class _s{constructor(e,t,i,r,s){this.from=e,this.length=t,this.top=i,this.height=r,this.type=s}get to(){return this.from+this.length}get bottom(){return this.top+this.height}join(e){let t=(Array.isArray(this.type)?this.type:[this]).concat(Array.isArray(e.type)?e.type:[e]);return new _s(this.from,this.length+e.length,this.top,this.height+e.height,t)}}var rt=function(n){return n[n.ByPos=0]="ByPos",n[n.ByHeight=1]="ByHeight",n[n.ByPosNoHeight=2]="ByPosNoHeight",n}(rt||(rt={}));const Iu=.001;class ji{constructor(e,t,i=2){this.length=e,this.height=t,this.flags=i}get outdated(){return(this.flags&2)>0}set outdated(e){this.flags=(e?2:0)|this.flags&-3}setHeight(e,t){this.height!=t&&(Math.abs(this.height-t)>Iu&&(e.heightChanged=!0),this.height=t)}replace(e,t,i){return ji.of(i)}decomposeLeft(e,t){t.push(this)}decomposeRight(e,t){t.push(this)}applyChanges(e,t,i,r){let s=this;for(let o=r.length-1;o>=0;o--){let{fromA:l,toA:a,fromB:h,toB:c}=r[o],u=s.lineAt(l,rt.ByPosNoHeight,t,0,0),f=u.to>=a?u:s.lineAt(a,rt.ByPosNoHeight,t,0,0);for(c+=f.to-a,a=f.to;o>0&&u.from<=r[o-1].toA;)l=r[o-1].fromA,h=r[o-1].fromB,o--,l<u.from&&(u=s.lineAt(l,rt.ByPosNoHeight,t,0,0));h+=u.from-l,l=u.from;let d=W0.build(i,e,h,c);s=s.replace(l,a,d)}return s.updateHeight(i,0)}static empty(){return new pn(0,0)}static of(e){if(e.length==1)return e[0];let t=0,i=e.length,r=0,s=0;for(;;)if(t==i)if(r>s*2){let l=e[t-1];l.break?e.splice(--t,1,l.left,null,l.right):e.splice(--t,1,l.left,l.right),i+=1+l.break,r-=l.size}else if(s>r*2){let l=e[i];l.break?e.splice(i,1,l.left,null,l.right):e.splice(i,1,l.left,l.right),i+=2+l.break,s-=l.size}else break;else if(r<s){let l=e[t++];l&&(r+=l.size)}else{let l=e[--i];l&&(s+=l.size)}let o=0;return e[t-1]==null?(o=1,t--):e[t]==null&&(o=1,i++),new T3(ji.of(e.slice(0,t)),o,ji.of(e.slice(i)))}}ji.prototype.size=1;class O2 extends ji{constructor(e,t,i){super(e,t),this.type=i}blockAt(e,t,i,r){return new _s(r,this.length,i,this.height,this.type)}lineAt(e,t,i,r,s){return this.blockAt(0,i,r,s)}forEachLine(e,t,i,r,s,o){e<=s+this.length&&t>=s&&o(this.blockAt(0,i,r,s))}updateHeight(e,t=0,i=!1,r){return r&&r.from<=t&&r.more&&this.setHeight(e,r.heights[r.index++]),this.outdated=!1,this}toString(){return`block(${this.length})`}}class pn extends O2{constructor(e,t){super(e,t,nt.Text),this.collapsed=0,this.widgetHeight=0}replace(e,t,i){let r=i[0];return i.length==1&&(r instanceof pn||r instanceof gi&&r.flags&4)&&Math.abs(this.length-r.length)<10?(r instanceof gi?r=new pn(r.length,this.height):r.height=this.height,this.outdated||(r.outdated=!1),r):ji.of(i)}updateHeight(e,t=0,i=!1,r){return r&&r.from<=t&&r.more?this.setHeight(e,r.heights[r.index++]):(i||this.outdated)&&this.setHeight(e,Math.max(this.widgetHeight,e.heightForLine(this.length-this.collapsed))),this.outdated=!1,this}toString(){return`line(${this.length}${this.collapsed?-this.collapsed:""}${this.widgetHeight?":"+this.widgetHeight:""})`}}class gi extends ji{constructor(e){super(e,0)}lines(e,t){let i=e.lineAt(t).number,r=e.lineAt(t+this.length).number;return{firstLine:i,lastLine:r,lineHeight:this.height/(r-i+1)}}blockAt(e,t,i,r){let{firstLine:s,lastLine:o,lineHeight:l}=this.lines(t,r),a=Math.max(0,Math.min(o-s,Math.floor((e-i)/l))),{from:h,length:c}=t.line(s+a);return new _s(h,c,i+l*a,l,nt.Text)}lineAt(e,t,i,r,s){if(t==rt.ByHeight)return this.blockAt(e,i,r,s);if(t==rt.ByPosNoHeight){let{from:u,to:f}=i.lineAt(e);return new _s(u,f-u,0,0,nt.Text)}let{firstLine:o,lineHeight:l}=this.lines(i,s),{from:a,length:h,number:c}=i.lineAt(e);return new _s(a,h,r+l*(c-o),l,nt.Text)}forEachLine(e,t,i,r,s,o){let{firstLine:l,lineHeight:a}=this.lines(i,s);for(let h=Math.max(e,s),c=Math.min(s+this.length,t);h<=c;){let u=i.lineAt(h);h==e&&(r+=a*(u.number-l)),o(new _s(u.from,u.length,r,a,nt.Text)),r+=a,h=u.to+1}}replace(e,t,i){let r=this.length-t;if(r>0){let s=i[i.length-1];s instanceof gi?i[i.length-1]=new gi(s.length+r):i.push(null,new gi(r-1))}if(e>0){let s=i[0];s instanceof gi?i[0]=new gi(e+s.length):i.unshift(new gi(e-1),null)}return ji.of(i)}decomposeLeft(e,t){t.push(new gi(e-1),null)}decomposeRight(e,t){t.push(null,new gi(this.length-e-1))}updateHeight(e,t=0,i=!1,r){let s=t+this.length;if(r&&r.from<=t+this.length&&r.more){let o=[],l=Math.max(t,r.from),a=-1,h=e.heightChanged;for(r.from>t&&o.push(new gi(r.from-t-1).updateHeight(e,t));l<=s&&r.more;){let u=e.doc.lineAt(l).length;o.length&&o.push(null);let f=r.heights[r.index++];a==-1?a=f:Math.abs(f-a)>=Iu&&(a=-2);let d=new pn(u,f);d.outdated=!1,o.push(d),l+=u+1}l<=s&&o.push(null,new gi(s-l).updateHeight(e,l));let c=ji.of(o);return e.heightChanged=h||a<0||Math.abs(c.height-this.height)>=Iu||Math.abs(a-this.lines(e.doc,t).lineHeight)>=Iu,c}else(i||this.outdated)&&(this.setHeight(e,e.heightForGap(t,t+this.length)),this.outdated=!1);return this}toString(){return`gap(${this.length})`}}class T3 extends ji{constructor(e,t,i){super(e.length+t+i.length,e.height+i.height,t|(e.outdated||i.outdated?2:0)),this.left=e,this.right=i,this.size=e.size+i.size}get break(){return this.flags&1}blockAt(e,t,i,r){let s=i+this.left.height;return e<s?this.left.blockAt(e,t,i,r):this.right.blockAt(e,t,s,r+this.left.length+this.break)}lineAt(e,t,i,r,s){let o=r+this.left.height,l=s+this.left.length+this.break,a=t==rt.ByHeight?e<o:e<l,h=a?this.left.lineAt(e,t,i,r,s):this.right.lineAt(e,t,i,o,l);if(this.break||(a?h.to<l:h.from>l))return h;let c=t==rt.ByPosNoHeight?rt.ByPosNoHeight:rt.ByPos;return a?h.join(this.right.lineAt(l,c,i,o,l)):this.left.lineAt(l,c,i,r,s).join(h)}forEachLine(e,t,i,r,s,o){let l=r+this.left.height,a=s+this.left.length+this.break;if(this.break)e<a&&this.left.forEachLine(e,t,i,r,s,o),t>=a&&this.right.forEachLine(e,t,i,l,a,o);else{let h=this.lineAt(a,rt.ByPos,i,r,s);e<h.from&&this.left.forEachLine(e,h.from-1,i,r,s,o),h.to>=e&&h.from<=t&&o(h),t>h.to&&this.right.forEachLine(h.to+1,t,i,l,a,o)}}replace(e,t,i){let r=this.left.length+this.break;if(t<r)return this.balanced(this.left.replace(e,t,i),this.right);if(e>this.left.length)return this.balanced(this.left,this.right.replace(e-r,t-r,i));let s=[];e>0&&this.decomposeLeft(e,s);let o=s.length;for(let l of i)s.push(l);if(e>0&&_2(s,o-1),t<this.length){let l=s.length;this.decomposeRight(t,s),_2(s,l)}return ji.of(s)}decomposeLeft(e,t){let i=this.left.length;if(e<=i)return this.left.decomposeLeft(e,t);t.push(this.left),this.break&&(i++,e>=i&&t.push(null)),e>i&&this.right.decomposeLeft(e-i,t)}decomposeRight(e,t){let i=this.left.length,r=i+this.break;if(e>=r)return this.right.decomposeRight(e-r,t);e<i&&this.left.decomposeRight(e,t),this.break&&e<r&&t.push(null),t.push(this.right)}balanced(e,t){return e.size>2*t.size||t.size>2*e.size?ji.of(this.break?[e,null,t]:[e,t]):(this.left=e,this.right=t,this.height=e.height+t.height,this.outdated=e.outdated||t.outdated,this.size=e.size+t.size,this.length=e.length+this.break+t.length,this)}updateHeight(e,t=0,i=!1,r){let{left:s,right:o}=this,l=t+s.length+this.break,a=null;return r&&r.from<=t+s.length&&r.more?a=s=s.updateHeight(e,t,i,r):s.updateHeight(e,t,i),r&&r.from<=l+o.length&&r.more?a=o=o.updateHeight(e,l,i,r):o.updateHeight(e,l,i),a?this.balanced(s,o):(this.height=this.left.height+this.right.height,this.outdated=!1,this)}toString(){return this.left+(this.break?" ":"-")+this.right}}function _2(n,e){let t,i;n[e]==null&&(t=n[e-1])instanceof gi&&(i=n[e+1])instanceof gi&&n.splice(e-1,3,new gi(t.length+1+i.length))}const P3=5;class W0{constructor(e,t){this.pos=e,this.oracle=t,this.nodes=[],this.lineStart=-1,this.lineEnd=-1,this.covering=null,this.writtenTo=e}get isCovered(){return this.covering&&this.nodes[this.nodes.length-1]==this.covering}span(e,t){if(this.lineStart>-1){let i=Math.min(t,this.lineEnd),r=this.nodes[this.nodes.length-1];r instanceof pn?r.length+=i-this.pos:(i>this.pos||!this.isCovered)&&this.nodes.push(new pn(i-this.pos,-1)),this.writtenTo=i,t>i&&(this.nodes.push(null),this.writtenTo++,this.lineStart=-1)}this.pos=t}point(e,t,i){if(e<t||i.heightRelevant){let r=i.widget?i.widget.estimatedHeight:0;r<0&&(r=this.oracle.lineHeight);let s=t-e;i.block?this.addBlock(new O2(s,r,i.type)):(s||r>=P3)&&this.addLineDeco(r,s)}else t>e&&this.span(e,t);this.lineEnd>-1&&this.lineEnd<this.pos&&(this.lineEnd=this.oracle.doc.lineAt(this.pos).to)}enterLine(){if(this.lineStart>-1)return;let{from:e,to:t}=this.oracle.doc.lineAt(this.pos);this.lineStart=e,this.lineEnd=t,this.writtenTo<e&&((this.writtenTo<e-1||this.nodes[this.nodes.length-1]==null)&&this.nodes.push(this.blankContent(this.writtenTo,e-1)),this.nodes.push(null)),this.pos>e&&this.nodes.push(new pn(this.pos-e,-1)),this.writtenTo=this.pos}blankContent(e,t){let i=new gi(t-e);return this.oracle.doc.lineAt(e).to==t&&(i.flags|=4),i}ensureLine(){this.enterLine();let e=this.nodes.length?this.nodes[this.nodes.length-1]:null;if(e instanceof pn)return e;let t=new pn(0,-1);return this.nodes.push(t),t}addBlock(e){this.enterLine(),e.type==nt.WidgetAfter&&!this.isCovered&&this.ensureLine(),this.nodes.push(e),this.writtenTo=this.pos=this.pos+e.length,e.type!=nt.WidgetBefore&&(this.covering=e)}addLineDeco(e,t){let i=this.ensureLine();i.length+=t,i.collapsed+=t,i.widgetHeight=Math.max(i.widgetHeight,e),this.writtenTo=this.pos=this.pos+t}finish(e){let t=this.nodes.length==0?null:this.nodes[this.nodes.length-1];this.lineStart>-1&&!(t instanceof pn)&&!this.isCovered?this.nodes.push(new pn(0,-1)):(this.writtenTo<this.pos||t==null)&&this.nodes.push(this.blankContent(this.writtenTo,this.pos));let i=e;for(let r of this.nodes)r instanceof pn&&r.updateHeight(this.oracle,i),i+=r?r.length:1;return this.nodes}static build(e,t,i,r){let s=new W0(i,e);return We.spans(t,i,r,s,0),s.finish(i)}}function B3(n,e,t){let i=new R3;return We.compare(n,e,t,i,0),i.changes}class R3{constructor(){this.changes=[]}compareRange(){}comparePoint(e,t,i,r){(e<t||i&&i.heightRelevant||r&&r.heightRelevant)&&_0(e,t,this.changes,5)}}function L3(n,e){let t=n.getBoundingClientRect(),i=Math.max(0,t.left),r=Math.min(innerWidth,t.right),s=Math.max(0,t.top),o=Math.min(innerHeight,t.bottom),l=n.ownerDocument.body;for(let a=n.parentNode;a&&a!=l;)if(a.nodeType==1){let h=a,c=window.getComputedStyle(h);if((h.scrollHeight>h.clientHeight||h.scrollWidth>h.clientWidth)&&c.overflow!="visible"){let u=h.getBoundingClientRect();i=Math.max(i,u.left),r=Math.min(r,u.right),s=Math.max(s,u.top),o=Math.min(o,u.bottom)}a=c.position=="absolute"||c.position=="fixed"?h.offsetParent:h.parentNode}else if(a.nodeType==11)a=a.host;else break;return{left:i-t.left,right:Math.max(i,r)-t.left,top:s-(t.top+e),bottom:Math.max(s,o)-(t.top+e)}}function F3(n,e){let t=n.getBoundingClientRect();return{left:0,right:t.right-t.left,top:e,bottom:t.bottom-(t.top+e)}}class V0{constructor(e,t,i){this.from=e,this.to=t,this.size=i}static same(e,t){if(e.length!=t.length)return!1;for(let i=0;i<e.length;i++){let r=e[i],s=t[i];if(r.from!=s.from||r.to!=s.to||r.size!=s.size)return!1}return!0}draw(e){return ue.replace({widget:new N3(this.size,e)}).range(this.from,this.to)}}class N3 extends sr{constructor(e,t){super(),this.size=e,this.vertical=t}eq(e){return e.size==this.size&&e.vertical==this.vertical}toDOM(){let e=document.createElement("div");return this.vertical?e.style.height=this.size+"px":(e.style.width=this.size+"px",e.style.height="2px",e.style.display="inline-block"),e}get estimatedHeight(){return this.vertical?this.size:-1}}class D2{constructor(e){this.state=e,this.pixelViewport={left:0,right:window.innerWidth,top:0,bottom:0},this.inView=!0,this.paddingTop=0,this.paddingBottom=0,this.contentDOMWidth=0,this.contentDOMHeight=0,this.editorHeight=0,this.editorWidth=0,this.heightOracle=new C2,this.scaler=T2,this.scrollTarget=null,this.printing=!1,this.mustMeasureContent=!0,this.defaultTextDirection=kt.RTL,this.visibleRanges=[],this.mustEnforceCursorAssoc=!1,this.stateDeco=e.facet(Qa).filter(t=>typeof t!="function"),this.heightMap=ji.empty().applyChanges(this.stateDeco,$e.empty,this.heightOracle.setDoc(e.doc),[new or(0,0,0,e.doc.length)]),this.viewport=this.getViewport(0,null),this.updateViewportLines(),this.updateForViewport(),this.lineGaps=this.ensureLineGaps([]),this.lineGapDeco=ue.set(this.lineGaps.map(t=>t.draw(!1))),this.computeVisibleRanges()}updateForViewport(){let e=[this.viewport],{main:t}=this.state.selection;for(let i=0;i<=1;i++){let r=i?t.head:t.anchor;if(!e.some(({from:s,to:o})=>r>=s&&r<=o)){let{from:s,to:o}=this.lineBlockAt(r);e.push(new Wu(s,o))}}this.viewports=e.sort((i,r)=>i.from-r.from),this.scaler=this.heightMap.height<=7e6?T2:new V3(this.heightOracle.doc,this.heightMap,this.viewports)}updateViewportLines(){this.viewportLines=[],this.heightMap.forEachLine(this.viewport.from,this.viewport.to,this.state.doc,0,0,e=>{this.viewportLines.push(this.scaler.scale==1?e:th(e,this.scaler))})}update(e,t=null){this.state=e.state;let i=this.stateDeco;this.stateDeco=this.state.facet(Qa).filter(h=>typeof h!="function");let r=e.changedRanges,s=or.extendWithRanges(r,B3(i,this.stateDeco,e?e.changes:Yt.empty(this.state.doc.length))),o=this.heightMap.height;this.heightMap=this.heightMap.applyChanges(this.stateDeco,e.startState.doc,this.heightOracle.setDoc(this.state.doc),s),this.heightMap.height!=o&&(e.flags|=2);let l=s.length?this.mapViewport(this.viewport,e.changes):this.viewport;(t&&(t.range.head<l.from||t.range.head>l.to)||!this.viewportIsAppropriate(l))&&(l=this.getViewport(0,t));let a=!e.changes.empty||e.flags&2||l.from!=this.viewport.from||l.to!=this.viewport.to;this.viewport=l,this.updateForViewport(),a&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(this.mapLineGaps(this.lineGaps,e.changes))),e.flags|=this.computeVisibleRanges(),t&&(this.scrollTarget=t),!this.mustEnforceCursorAssoc&&e.selectionSet&&e.view.lineWrapping&&e.state.selection.main.empty&&e.state.selection.main.assoc&&(this.mustEnforceCursorAssoc=!0)}measure(e){let t=e.contentDOM,i=window.getComputedStyle(t),r=this.heightOracle,s=i.whiteSpace;this.defaultTextDirection=i.direction=="rtl"?kt.RTL:kt.LTR;let o=this.heightOracle.mustRefreshForWrapping(s),l=o||this.mustMeasureContent||this.contentDOMHeight!=t.clientHeight,a=0,h=0;if(this.editorWidth!=e.scrollDOM.clientWidth&&(r.lineWrapping&&(l=!0),this.editorWidth=e.scrollDOM.clientWidth,a|=8),l){this.mustMeasureContent=!1,this.contentDOMHeight=t.clientHeight;let y=parseInt(i.paddingTop)||0,v=parseInt(i.paddingBottom)||0;(this.paddingTop!=y||this.paddingBottom!=v)&&(a|=8,this.paddingTop=y,this.paddingBottom=v)}let c=(this.printing?F3:L3)(t,this.paddingTop),u=c.top-this.pixelViewport.top,f=c.bottom-this.pixelViewport.bottom;this.pixelViewport=c;let d=this.pixelViewport.bottom>this.pixelViewport.top&&this.pixelViewport.right>this.pixelViewport.left;if(d!=this.inView&&(this.inView=d,d&&(l=!0)),!this.inView)return 0;let p=t.clientWidth;if((this.contentDOMWidth!=p||this.editorHeight!=e.scrollDOM.clientHeight)&&(this.contentDOMWidth=p,this.editorHeight=e.scrollDOM.clientHeight,a|=8),l){let y=e.docView.measureVisibleLineHeights(this.viewport);if(r.mustRefreshForHeights(y)&&(o=!0),o||r.lineWrapping&&Math.abs(p-this.contentDOMWidth)>r.charWidth){let{lineHeight:v,charWidth:C}=e.docView.measureTextSize();o=r.refresh(s,v,C,p/C,y),o&&(e.docView.minWidth=0,a|=8)}u>0&&f>0?h=Math.max(u,f):u<0&&f<0&&(h=Math.min(u,f)),r.heightChanged=!1;for(let v of this.viewports){let C=v.from==this.viewport.from?y:e.docView.measureVisibleLineHeights(v);this.heightMap=this.heightMap.updateHeight(r,0,o,new A2(v.from,C))}r.heightChanged&&(a|=2)}let g=!this.viewportIsAppropriate(this.viewport,h)||this.scrollTarget&&(this.scrollTarget.range.head<this.viewport.from||this.scrollTarget.range.head>this.viewport.to);return g&&(this.viewport=this.getViewport(h,this.scrollTarget)),this.updateForViewport(),(a&2||g)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(o?[]:this.lineGaps)),a|=this.computeVisibleRanges(),this.mustEnforceCursorAssoc&&(this.mustEnforceCursorAssoc=!1,e.docView.enforceCursorAssoc()),a}get visibleTop(){return this.scaler.fromDOM(this.pixelViewport.top)}get visibleBottom(){return this.scaler.fromDOM(this.pixelViewport.bottom)}getViewport(e,t){let i=.5-Math.max(-.5,Math.min(.5,e/1e3/2)),r=this.heightMap,s=this.state.doc,{visibleTop:o,visibleBottom:l}=this,a=new Wu(r.lineAt(o-i*1e3,rt.ByHeight,s,0,0).from,r.lineAt(l+(1-i)*1e3,rt.ByHeight,s,0,0).to);if(t){let{head:h}=t.range;if(h<a.from||h>a.to){let c=Math.min(this.editorHeight,this.pixelViewport.bottom-this.pixelViewport.top),u=r.lineAt(h,rt.ByPos,s,0,0),f;t.y=="center"?f=(u.top+u.bottom)/2-c/2:t.y=="start"||t.y=="nearest"&&h<a.from?f=u.top:f=u.bottom-c,a=new Wu(r.lineAt(f-1e3/2,rt.ByHeight,s,0,0).from,r.lineAt(f+c+1e3/2,rt.ByHeight,s,0,0).to)}}return a}mapViewport(e,t){let i=t.mapPos(e.from,-1),r=t.mapPos(e.to,1);return new Wu(this.heightMap.lineAt(i,rt.ByPos,this.state.doc,0,0).from,this.heightMap.lineAt(r,rt.ByPos,this.state.doc,0,0).to)}viewportIsAppropriate({from:e,to:t},i=0){if(!this.inView)return!0;let{top:r}=this.heightMap.lineAt(e,rt.ByPos,this.state.doc,0,0),{bottom:s}=this.heightMap.lineAt(t,rt.ByPos,this.state.doc,0,0),{visibleTop:o,visibleBottom:l}=this;return(e==0||r<=o-Math.max(10,Math.min(-i,250)))&&(t==this.state.doc.length||s>=l+Math.max(10,Math.min(i,250)))&&r>o-2*1e3&&s<l+2*1e3}mapLineGaps(e,t){if(!e.length||t.empty)return e;let i=[];for(let r of e)t.touchesRange(r.from,r.to)||i.push(new V0(t.mapPos(r.from),t.mapPos(r.to),r.size));return i}ensureLineGaps(e){let t=[];if(this.defaultTextDirection!=kt.LTR)return t;for(let i of this.viewportLines){if(i.length<4e3)continue;let r=I3(i.from,i.to,this.stateDeco);if(r.total<4e3)continue;let s,o;if(this.heightOracle.lineWrapping){let h=2e3/this.heightOracle.lineLength*this.heightOracle.lineHeight;s=Vu(r,(this.visibleTop-i.top-h)/i.height),o=Vu(r,(this.visibleBottom-i.top+h)/i.height)}else{let h=r.total*this.heightOracle.charWidth,c=2e3*this.heightOracle.charWidth;s=Vu(r,(this.pixelViewport.left-c)/h),o=Vu(r,(this.pixelViewport.right+c)/h)}let l=[];s>i.from&&l.push({from:i.from,to:s}),o<i.to&&l.push({from:o,to:i.to});let a=this.state.selection.main;a.from>=i.from&&a.from<=i.to&&E2(l,a.from-10,a.from+10),!a.empty&&a.to>=i.from&&a.to<=i.to&&E2(l,a.to-10,a.to+10);for(let{from:h,to:c}of l)c-h>1e3&&t.push(W3(e,u=>u.from>=i.from&&u.to<=i.to&&Math.abs(u.from-h)<1e3&&Math.abs(u.to-c)<1e3)||new V0(h,c,this.gapSize(i,h,c,r)))}return t}gapSize(e,t,i,r){let s=M2(r,i)-M2(r,t);return this.heightOracle.lineWrapping?e.height*s:r.total*this.heightOracle.charWidth*s}updateLineGaps(e){V0.same(e,this.lineGaps)||(this.lineGaps=e,this.lineGapDeco=ue.set(e.map(t=>t.draw(this.heightOracle.lineWrapping))))}computeVisibleRanges(){let e=this.stateDeco;this.lineGaps.length&&(e=e.concat(this.lineGapDeco));let t=[];We.spans(e,this.viewport.from,this.viewport.to,{span(r,s){t.push({from:r,to:s})},point(){}},20);let i=t.length!=this.visibleRanges.length||this.visibleRanges.some((r,s)=>r.from!=t[s].from||r.to!=t[s].to);return this.visibleRanges=t,i?4:0}lineBlockAt(e){return e>=this.viewport.from&&e<=this.viewport.to&&this.viewportLines.find(t=>t.from<=e&&t.to>=e)||th(this.heightMap.lineAt(e,rt.ByPos,this.state.doc,0,0),this.scaler)}lineBlockAtHeight(e){return th(this.heightMap.lineAt(this.scaler.fromDOM(e),rt.ByHeight,this.state.doc,0,0),this.scaler)}elementAtHeight(e){return th(this.heightMap.blockAt(this.scaler.fromDOM(e),this.state.doc,0,0),this.scaler)}get docHeight(){return this.scaler.toDOM(this.heightMap.height)}get contentHeight(){return this.docHeight+this.paddingTop+this.paddingBottom}}class Wu{constructor(e,t){this.from=e,this.to=t}}function I3(n,e,t){let i=[],r=n,s=0;return We.spans(t,n,e,{span(){},point(o,l){o>r&&(i.push({from:r,to:o}),s+=o-r),r=l}},20),r<e&&(i.push({from:r,to:e}),s+=e-r),{total:s,ranges:i}}function Vu({total:n,ranges:e},t){if(t<=0)return e[0].from;if(t>=1)return e[e.length-1].to;let i=Math.floor(n*t);for(let r=0;;r++){let{from:s,to:o}=e[r],l=o-s;if(i<=l)return s+i;i-=l}}function M2(n,e){let t=0;for(let{from:i,to:r}of n.ranges){if(e<=r){t+=e-i;break}t+=r-i}return t/n.total}function E2(n,e,t){for(let i=0;i<n.length;i++){let r=n[i];if(r.from<t&&r.to>e){let s=[];r.from<e&&s.push({from:r.from,to:e}),r.to>t&&s.push({from:t,to:r.to}),n.splice(i,1,...s),i+=s.length-1}}}function W3(n,e){for(let t of n)if(e(t))return t}const T2={toDOM(n){return n},fromDOM(n){return n},scale:1};class V3{constructor(e,t,i){let r=0,s=0,o=0;this.viewports=i.map(({from:l,to:a})=>{let h=t.lineAt(l,rt.ByPos,e,0,0).top,c=t.lineAt(a,rt.ByPos,e,0,0).bottom;return r+=c-h,{from:l,to:a,top:h,bottom:c,domTop:0,domBottom:0}}),this.scale=(7e6-r)/(t.height-r);for(let l of this.viewports)l.domTop=o+(l.top-s)*this.scale,o=l.domBottom=l.domTop+(l.bottom-l.top),s=l.bottom}toDOM(e){for(let t=0,i=0,r=0;;t++){let s=t<this.viewports.length?this.viewports[t]:null;if(!s||e<s.top)return r+(e-i)*this.scale;if(e<=s.bottom)return s.domTop+(e-s.top);i=s.bottom,r=s.domBottom}}fromDOM(e){for(let t=0,i=0,r=0;;t++){let s=t<this.viewports.length?this.viewports[t]:null;if(!s||e<s.domTop)return i+(e-r)/this.scale;if(e<=s.domBottom)return s.top+(e-s.domTop);i=s.bottom,r=s.domBottom}}}function th(n,e){if(e.scale==1)return n;let t=e.toDOM(n.top),i=e.toDOM(n.bottom);return new _s(n.from,n.length,t,i-t,Array.isArray(n.type)?n.type.map(r=>th(r,e)):n.type)}const Hu=he.define({combine:n=>n.join(" ")}),H0=he.define({combine:n=>n.indexOf(!0)>-1}),z0=Ue.newName(),P2=Ue.newName(),B2=Ue.newName(),R2={"&light":"."+P2,"&dark":"."+B2};function j0(n,e,t){return new Ue(e,{finish(i){return/&/.test(i)?i.replace(/&\w*/,r=>{if(r=="&")return n;if(!t||!t[r])throw new RangeError(`Unsupported selector: ${r}`);return t[r]}):n+" "+i}})}const H3=j0("."+z0,{"&.cm-editor":{position:"relative !important",boxSizing:"border-box","&.cm-focused":{outline:"1px dotted #212121"},display:"flex !important",flexDirection:"column"},".cm-scroller":{display:"flex !important",alignItems:"flex-start !important",fontFamily:"monospace",lineHeight:1.4,height:"100%",overflowX:"auto",position:"relative",zIndex:0},".cm-content":{margin:0,flexGrow:2,minHeight:"100%",display:"block",whiteSpace:"pre",wordWrap:"normal",boxSizing:"border-box",padding:"4px 0",outline:"none","&[contenteditable=true]":{WebkitUserModify:"read-write-plaintext-only"}},".cm-lineWrapping":{whiteSpace_fallback:"pre-wrap",whiteSpace:"break-spaces",wordBreak:"break-word",overflowWrap:"anywhere"},"&light .cm-content":{caretColor:"black"},"&dark .cm-content":{caretColor:"white"},".cm-line":{display:"block",padding:"0 2px 0 4px"},".cm-selectionLayer":{zIndex:-1,contain:"size style"},".cm-selectionBackground":{position:"absolute"},"&light .cm-selectionBackground":{background:"#d9d9d9"},"&dark .cm-selectionBackground":{background:"#222"},"&light.cm-focused .cm-selectionBackground":{background:"#d7d4f0"},"&dark.cm-focused .cm-selectionBackground":{background:"#233"},".cm-cursorLayer":{zIndex:100,contain:"size style",pointerEvents:"none"},"&.cm-focused .cm-cursorLayer":{animation:"steps(1) cm-blink 1.2s infinite"},"@keyframes cm-blink":{"0%":{},"50%":{visibility:"hidden"},"100%":{}},"@keyframes cm-blink2":{"0%":{},"50%":{visibility:"hidden"},"100%":{}},".cm-cursor, .cm-dropCursor":{position:"absolute",borderLeft:"1.2px solid black",marginLeft:"-0.6px",pointerEvents:"none"},".cm-cursor":{display:"none"},"&dark .cm-cursor":{borderLeftColor:"#444"},"&.cm-focused .cm-cursor":{display:"block"},"&light .cm-activeLine":{backgroundColor:"#f3f9ff"},"&dark .cm-activeLine":{backgroundColor:"#223039"},"&light .cm-specialChar":{color:"red"},"&dark .cm-specialChar":{color:"#f78"},".cm-gutters":{display:"flex",height:"100%",boxSizing:"border-box",left:0,zIndex:200},"&light .cm-gutters":{backgroundColor:"#f5f5f5",color:"#6c6c6c",borderRight:"1px solid #ddd"},"&dark .cm-gutters":{backgroundColor:"#333338",color:"#ccc"},".cm-gutter":{display:"flex !important",flexDirection:"column",flexShrink:0,boxSizing:"border-box",minHeight:"100%",overflow:"hidden"},".cm-gutterElement":{boxSizing:"border-box"},".cm-lineNumbers .cm-gutterElement":{padding:"0 3px 0 5px",minWidth:"20px",textAlign:"right",whiteSpace:"nowrap"},"&light .cm-activeLineGutter":{backgroundColor:"#e2f2ff"},"&dark .cm-activeLineGutter":{backgroundColor:"#222227"},".cm-panels":{boxSizing:"border-box",position:"sticky",left:0,right:0},"&light .cm-panels":{backgroundColor:"#f5f5f5",color:"black"},"&light .cm-panels-top":{borderBottom:"1px solid #ddd"},"&light .cm-panels-bottom":{borderTop:"1px solid #ddd"},"&dark .cm-panels":{backgroundColor:"#333338",color:"white"},".cm-tab":{display:"inline-block",overflow:"hidden",verticalAlign:"bottom"},".cm-widgetBuffer":{verticalAlign:"text-top",height:"1em",display:"inline"},".cm-placeholder":{color:"#888",display:"inline-block",verticalAlign:"top"},".cm-button":{verticalAlign:"middle",color:"inherit",fontSize:"70%",padding:".2em 1em",borderRadius:"1px"},"&light .cm-button":{backgroundImage:"linear-gradient(#eff1f5, #d9d9df)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#b4b4b4, #d0d3d6)"}},"&dark .cm-button":{backgroundImage:"linear-gradient(#393939, #111)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#111, #333)"}},".cm-textfield":{verticalAlign:"middle",color:"inherit",fontSize:"70%",border:"1px solid silver",padding:".2em .5em"},"&light .cm-textfield":{backgroundColor:"white"},"&dark .cm-textfield":{border:"1px solid #555",backgroundColor:"inherit"}},R2),z3={childList:!0,characterData:!0,subtree:!0,attributes:!0,characterDataOldValue:!0},$0=fe.ie&&fe.ie_version<=11;class j3{constructor(e,t,i){this.view=e,this.onChange=t,this.onScrollChanged=i,this.active=!1,this.selectionRange=new JV,this.selectionChanged=!1,this.delayedFlush=-1,this.resizeTimeout=-1,this.queue=[],this.delayedAndroidKey=null,this.scrollTargets=[],this.intersection=null,this.resize=null,this.intersecting=!1,this.gapIntersection=null,this.gaps=[],this.parentCheck=-1,this.dom=e.contentDOM,this.observer=new MutationObserver(r=>{for(let s of r)this.queue.push(s);(fe.ie&&fe.ie_version<=11||fe.ios&&e.composing)&&r.some(s=>s.type=="childList"&&s.removedNodes.length||s.type=="characterData"&&s.oldValue.length>s.target.nodeValue.length)?this.flushSoon():this.flush()}),$0&&(this.onCharData=r=>{this.queue.push({target:r.target,type:"characterData",oldValue:r.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this),window.addEventListener("resize",this.onResize=this.onResize.bind(this)),typeof ResizeObserver=="function"&&(this.resize=new ResizeObserver(()=>{this.view.docView.lastUpdate<Date.now()-75&&this.onResize()}),this.resize.observe(e.scrollDOM)),window.addEventListener("beforeprint",this.onPrint=this.onPrint.bind(this)),this.start(),window.addEventListener("scroll",this.onScroll=this.onScroll.bind(this)),typeof IntersectionObserver=="function"&&(this.intersection=new IntersectionObserver(r=>{this.parentCheck<0&&(this.parentCheck=setTimeout(this.listenForScroll.bind(this),1e3)),r.length>0&&r[r.length-1].intersectionRatio>0!=this.intersecting&&(this.intersecting=!this.intersecting,this.intersecting!=this.view.inView&&this.onScrollChanged(document.createEvent("Event")))},{}),this.intersection.observe(this.dom),this.gapIntersection=new IntersectionObserver(r=>{r.length>0&&r[r.length-1].intersectionRatio>0&&this.onScrollChanged(document.createEvent("Event"))},{})),this.listenForScroll(),this.readSelectionRange(),this.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}onScroll(e){this.intersecting&&this.flush(!1),this.onScrollChanged(e)}onResize(){this.resizeTimeout<0&&(this.resizeTimeout=setTimeout(()=>{this.resizeTimeout=-1,this.view.requestMeasure()},50))}onPrint(){this.view.viewState.printing=!0,this.view.measure(),setTimeout(()=>{this.view.viewState.printing=!1,this.view.requestMeasure()},500)}updateGaps(e){if(this.gapIntersection&&(e.length!=this.gaps.length||this.gaps.some((t,i)=>t!=e[i]))){this.gapIntersection.disconnect();for(let t of e)this.gapIntersection.observe(t);this.gaps=e}}onSelectionChange(e){if(!this.readSelectionRange()||this.delayedAndroidKey)return;let{view:t}=this,i=this.selectionRange;if(t.state.facet(Ya)?t.root.activeElement!=this.dom:!m0(t.dom,i))return;let r=i.anchorNode&&t.docView.nearest(i.anchorNode);r&&r.ignoreEvent(e)||((fe.ie&&fe.ie_version<=11||fe.android&&fe.chrome)&&!t.state.selection.main.empty&&i.focusNode&&Eu(i.focusNode,i.focusOffset,i.anchorNode,i.anchorOffset)?this.flushSoon():this.flush(!1))}readSelectionRange(){let{root:e}=this.view,t=Mu(e),i=fe.safari&&e.nodeType==11&&qV()==this.view.contentDOM&&$3(this.view)||t;return this.selectionRange.eq(i)?!1:(this.selectionRange.setRange(i),this.selectionChanged=!0)}setSelectionRange(e,t){this.selectionRange.set(e.node,e.offset,t.node,t.offset),this.selectionChanged=!1}clearSelectionRange(){this.selectionRange.set(null,0,null,0)}listenForScroll(){this.parentCheck=-1;let e=0,t=null;for(let i=this.dom;i;)if(i.nodeType==1)!t&&e<this.scrollTargets.length&&this.scrollTargets[e]==i?e++:t||(t=this.scrollTargets.slice(0,e)),t&&t.push(i),i=i.assignedSlot||i.parentNode;else if(i.nodeType==11)i=i.host;else break;if(e<this.scrollTargets.length&&!t&&(t=this.scrollTargets.slice(0,e)),t){for(let i of this.scrollTargets)i.removeEventListener("scroll",this.onScroll);for(let i of this.scrollTargets=t)i.addEventListener("scroll",this.onScroll)}}ignore(e){if(!this.active)return e();try{return this.stop(),e()}finally{this.start(),this.clear()}}start(){this.active||(this.observer.observe(this.dom,z3),$0&&this.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.active=!0)}stop(){!this.active||(this.active=!1,this.observer.disconnect(),$0&&this.dom.removeEventListener("DOMCharacterDataModified",this.onCharData))}clear(){this.processRecords(),this.queue.length=0,this.selectionChanged=!1}delayAndroidKey(e,t){this.delayedAndroidKey||requestAnimationFrame(()=>{let i=this.delayedAndroidKey;this.delayedAndroidKey=null;let r=this.view.state;this.readSelectionRange(),Ja(this.view.contentDOM,i.key,i.keyCode)?this.processRecords():this.flush(),this.view.state==r&&this.view.update([])}),(!this.delayedAndroidKey||e=="Enter")&&(this.delayedAndroidKey={key:e,keyCode:t})}flushSoon(){this.delayedFlush<0&&(this.delayedFlush=window.setTimeout(()=>{this.delayedFlush=-1,this.flush()},20))}forceFlush(){this.delayedFlush>=0&&(window.clearTimeout(this.delayedFlush),this.delayedFlush=-1,this.flush())}processRecords(){let e=this.queue;for(let s of this.observer.takeRecords())e.push(s);e.length&&(this.queue=[]);let t=-1,i=-1,r=!1;for(let s of e){let o=this.readMutation(s);!o||(o.typeOver&&(r=!0),t==-1?{from:t,to:i}=o:(t=Math.min(o.from,t),i=Math.max(o.to,i)))}return{from:t,to:i,typeOver:r}}flush(e=!0){if(this.delayedFlush>=0||this.delayedAndroidKey)return;e&&this.readSelectionRange();let{from:t,to:i,typeOver:r}=this.processRecords(),s=this.selectionChanged&&m0(this.dom,this.selectionRange);if(t<0&&!s)return;this.selectionChanged=!1;let o=this.view.state;this.onChange(t,i,r),this.view.state==o&&this.view.update([])}readMutation(e){let t=this.view.docView.nearest(e.target);if(!t||t.ignoreMutation(e))return null;if(t.markDirty(e.type=="attributes"),e.type=="attributes"&&(t.dirty|=4),e.type=="childList"){let i=L2(t,e.previousSibling||e.target.previousSibling,-1),r=L2(t,e.nextSibling||e.target.nextSibling,1);return{from:i?t.posAfter(i):t.posAtStart,to:r?t.posBefore(r):t.posAtEnd,typeOver:!1}}else return e.type=="characterData"?{from:t.posAtStart,to:t.posAtEnd,typeOver:e.target.nodeValue==e.oldValue}:null}destroy(){var e,t,i;this.stop(),(e=this.intersection)===null||e===void 0||e.disconnect(),(t=this.gapIntersection)===null||t===void 0||t.disconnect(),(i=this.resize)===null||i===void 0||i.disconnect();for(let r of this.scrollTargets)r.removeEventListener("scroll",this.onScroll);window.removeEventListener("scroll",this.onScroll),window.removeEventListener("resize",this.onResize),window.removeEventListener("beforeprint",this.onPrint),this.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange),clearTimeout(this.parentCheck),clearTimeout(this.resizeTimeout)}}function L2(n,e,t){for(;e;){let i=Et.get(e);if(i&&i.parent==n)return i;let r=e.parentNode;e=r!=n.dom?r:t>0?e.nextSibling:e.previousSibling}return null}function $3(n){let e=null;function t(a){a.preventDefault(),a.stopImmediatePropagation(),e=a.getTargetRanges()[0]}if(n.contentDOM.addEventListener("beforeinput",t,!0),document.execCommand("indent"),n.contentDOM.removeEventListener("beforeinput",t,!0),!e)return null;let i=e.startContainer,r=e.startOffset,s=e.endContainer,o=e.endOffset,l=n.docView.domAtPos(n.state.selection.main.anchor);return Eu(l.node,l.offset,s,o)&&([i,r,s,o]=[s,o,i,r]),{anchorNode:i,anchorOffset:r,focusNode:s,focusOffset:o}}function U3(n,e,t,i){let r,s,o=n.state.selection.main;if(e>-1){let l=n.docView.domBoundsAround(e,t,0);if(!l||n.state.readOnly)return;let{from:a,to:h}=l,c=n.docView.impreciseHead||n.docView.impreciseAnchor?[]:K3(n),u=new GO(c,n.state);u.readRange(l.startDOM,l.endDOM);let f=o.from,d=null;(n.inputState.lastKeyCode===8&&n.inputState.lastKeyTime>Date.now()-100||fe.android&&u.text.length<h-a)&&(f=o.to,d="end");let p=q3(n.state.doc.sliceString(a,h,Os),u.text,f-a,d);p&&(fe.chrome&&n.inputState.lastKeyCode==13&&p.toB==p.from+2&&u.text.slice(p.from,p.toB)==Os+Os&&p.toB--,r={from:a+p.from,to:a+p.toA,insert:$e.of(u.text.slice(p.from,p.toB).split(Os))}),s=G3(c,a)}else if(n.hasFocus||!n.state.facet(Ya)){let l=n.observer.selectionRange,{impreciseHead:a,impreciseAnchor:h}=n.docView,c=a&&a.node==l.focusNode&&a.offset==l.focusOffset||!ml(n.contentDOM,l.focusNode)?n.state.selection.main.head:n.docView.posFromDOM(l.focusNode,l.focusOffset),u=h&&h.node==l.anchorNode&&h.offset==l.anchorOffset||!ml(n.contentDOM,l.anchorNode)?n.state.selection.main.anchor:n.docView.posFromDOM(l.anchorNode,l.anchorOffset);(c!=o.head||u!=o.anchor)&&(s=L.single(u,c))}if(!(!r&&!s)){if(!r&&i&&!o.empty&&s&&s.main.empty?r={from:o.from,to:o.to,insert:n.state.doc.slice(o.from,o.to)}:r&&r.from>=o.from&&r.to<=o.to&&(r.from!=o.from||r.to!=o.to)&&o.to-o.from-(r.to-r.from)<=4?r={from:o.from,to:o.to,insert:n.state.doc.slice(o.from,r.from).append(r.insert).append(n.state.doc.slice(r.to,o.to))}:fe.mac&&r&&r.from==r.to&&r.from==o.head-1&&r.insert.toString()=="."&&(r={from:o.from,to:o.to,insert:$e.of([" "])}),r){let l=n.state;if(fe.ios&&n.inputState.flushIOSKey(n)||fe.android&&(r.from==o.from&&r.to==o.to&&r.insert.length==1&&r.insert.lines==2&&Ja(n.contentDOM,"Enter",13)||r.from==o.from-1&&r.to==o.to&&r.insert.length==0&&Ja(n.contentDOM,"Backspace",8)||r.from==o.from&&r.to==o.to+1&&r.insert.length==0&&Ja(n.contentDOM,"Delete",46)))return;let a=r.insert.toString();if(n.state.facet(NO).some(u=>u(n,r.from,r.to,a)))return;n.inputState.composing>=0&&n.inputState.composing++;let h;if(r.from>=o.from&&r.to<=o.to&&r.to-r.from>=(o.to-o.from)/3&&(!s||s.main.empty&&s.main.from==r.from+r.insert.length)&&n.inputState.composing<0){let u=o.from<r.from?l.sliceDoc(o.from,r.from):"",f=o.to>r.to?l.sliceDoc(r.to,o.to):"";h=l.replaceSelection(n.state.toText(u+r.insert.sliceString(0,void 0,n.state.lineBreak)+f))}else{let u=l.changes(r),f=s&&!l.selection.main.eq(s.main)&&s.main.to<=u.newLength?s.main:void 0;if(l.selection.ranges.length>1&&n.inputState.composing>=0&&r.to<=o.to&&r.to>=o.to-10){let d=n.state.sliceDoc(r.from,r.to),p=QO(n)||n.state.doc.lineAt(o.head),g=o.to-r.to,y=o.to-o.from;h=l.changeByRange(v=>{if(v.from==o.from&&v.to==o.to)return{changes:u,range:f||v.map(u)};let C=v.to-g,x=C-d.length;if(v.to-v.from!=y||n.state.sliceDoc(x,C)!=d||p&&v.to>=p.from&&v.from<=p.to)return{range:v};let b=l.changes({from:x,to:C,insert:r.insert}),S=v.to-o.to;return{changes:b,range:f?L.range(Math.max(0,f.anchor+S),Math.max(0,f.head+S)):v.map(b)}})}else h={changes:u,selection:f&&l.selection.replaceRange(f)}}let c="input.type";n.composing&&(c+=".compose",n.inputState.compositionFirstChange&&(c+=".start",n.inputState.compositionFirstChange=!1)),n.dispatch(h,{scrollIntoView:!0,userEvent:c})}else if(s&&!s.main.eq(o)){let l=!1,a="select";n.inputState.lastSelectionTime>Date.now()-50&&(n.inputState.lastSelectionOrigin=="select"&&(l=!0),a=n.inputState.lastSelectionOrigin),n.dispatch({selection:s,scrollIntoView:l,userEvent:a})}}}function q3(n,e,t,i){let r=Math.min(n.length,e.length),s=0;for(;s<r&&n.charCodeAt(s)==e.charCodeAt(s);)s++;if(s==r&&n.length==e.length)return null;let o=n.length,l=e.length;for(;o>0&&l>0&&n.charCodeAt(o-1)==e.charCodeAt(l-1);)o--,l--;if(i=="end"){let a=Math.max(0,s-Math.min(o,l));t-=o+a-s}return o<s&&n.length<e.length?(s-=t<=s&&t>=o?s-t:0,l=s+(l-o),o=s):l<s&&(s-=t<=s&&t>=l?s-t:0,o=s+(o-l),l=s),{from:s,toA:o,toB:l}}function K3(n){let e=[];if(n.root.activeElement!=n.contentDOM)return e;let{anchorNode:t,anchorOffset:i,focusNode:r,focusOffset:s}=n.observer.selectionRange;return t&&(e.push(new ZO(t,i)),(r!=t||s!=i)&&e.push(new ZO(r,s))),e}function G3(n,e){if(n.length==0)return null;let t=n[0].pos,i=n.length==2?n[1].pos:t;return t>-1&&i>-1?L.single(t+e,i+e):null}class le{constructor(e={}){this.plugins=[],this.pluginMap=new Map,this.editorAttrs={},this.contentAttrs={},this.bidiCache=[],this.destroyed=!1,this.updateState=2,this.measureScheduled=-1,this.measureRequests=[],this.contentDOM=document.createElement("div"),this.scrollDOM=document.createElement("div"),this.scrollDOM.tabIndex=-1,this.scrollDOM.className="cm-scroller",this.scrollDOM.appendChild(this.contentDOM),this.announceDOM=document.createElement("div"),this.announceDOM.style.cssText="position: absolute; top: -10000px",this.announceDOM.setAttribute("aria-live","polite"),this.dom=document.createElement("div"),this.dom.appendChild(this.announceDOM),this.dom.appendChild(this.scrollDOM),this._dispatch=e.dispatch||(t=>this.update([t])),this.dispatch=this.dispatch.bind(this),this.root=e.root||ZV(e.parent)||document,this.viewState=new D2(e.state||Fe.create()),this.plugins=this.state.facet(Xa).map(t=>new E0(t));for(let t of this.plugins)t.update(this);this.observer=new j3(this,(t,i,r)=>{U3(this,t,i,r)},t=>{this.inputState.runScrollHandlers(this,t),this.observer.intersecting&&this.measure()}),this.inputState=new b3(this),this.inputState.ensureHandlers(this,this.plugins),this.docView=new YO(this),this.mountStyles(),this.updateAttrs(),this.updateState=0,this.requestMeasure(),e.parent&&e.parent.appendChild(this.dom)}get state(){return this.viewState.state}get viewport(){return this.viewState.viewport}get visibleRanges(){return this.viewState.visibleRanges}get inView(){return this.viewState.inView}get composing(){return this.inputState.composing>0}get compositionStarted(){return this.inputState.composing>=0}dispatch(...e){this._dispatch(e.length==1&&e[0]instanceof Xt?e[0]:this.state.update(...e))}update(e){if(this.updateState!=0)throw new Error("Calls to EditorView.update are not allowed while an update is in progress");let t=!1,i,r=this.state;for(let o of e){if(o.startState!=r)throw new RangeError("Trying to update state with a transaction that doesn't start from the previous state.");r=o.state}if(this.destroyed){this.viewState.state=r;return}if(r.facet(Fe.phrases)!=this.state.facet(Fe.phrases))return this.setState(r);i=Nu.create(this,r,e);let s=this.viewState.scrollTarget;try{this.updateState=2;for(let o of e){if(s&&(s=s.map(o.changes)),o.scrollIntoView){let{main:l}=o.state.selection;s=new Fu(l.empty?l:L.cursor(l.head,l.head>l.anchor?-1:1))}for(let l of o.effects)l.is(WO)&&(s=l.value)}this.viewState.update(i,s),this.bidiCache=zu.update(this.bidiCache,i.changes),i.empty||(this.updatePlugins(i),this.inputState.update(i)),t=this.docView.update(i),this.state.facet(eh)!=this.styleModules&&this.mountStyles(),this.updateAttrs(),this.showAnnouncements(e),this.docView.updateSelection(t,e.some(o=>o.isUserEvent("select.pointer")))}finally{this.updateState=0}if(i.startState.facet(Hu)!=i.state.facet(Hu)&&(this.viewState.mustMeasureContent=!0),(t||s||this.viewState.mustEnforceCursorAssoc||this.viewState.mustMeasureContent)&&this.requestMeasure(),!i.empty)for(let o of this.state.facet(M0))o(i)}setState(e){if(this.updateState!=0)throw new Error("Calls to EditorView.setState are not allowed while an update is in progress");if(this.destroyed){this.viewState.state=e;return}this.updateState=2;let t=this.hasFocus;try{for(let i of this.plugins)i.destroy(this);this.viewState=new D2(e),this.plugins=e.facet(Xa).map(i=>new E0(i)),this.pluginMap.clear();for(let i of this.plugins)i.update(this);this.docView=new YO(this),this.inputState.ensureHandlers(this,this.plugins),this.mountStyles(),this.updateAttrs(),this.bidiCache=[]}finally{this.updateState=0}t&&this.focus(),this.requestMeasure()}updatePlugins(e){let t=e.startState.facet(Xa),i=e.state.facet(Xa);if(t!=i){let r=[];for(let s of i){let o=t.indexOf(s);if(o<0)r.push(new E0(s));else{let l=this.plugins[o];l.mustUpdate=e,r.push(l)}}for(let s of this.plugins)s.mustUpdate!=e&&s.destroy(this);this.plugins=r,this.pluginMap.clear(),this.inputState.ensureHandlers(this,this.plugins)}else for(let r of this.plugins)r.mustUpdate=e;for(let r=0;r<this.plugins.length;r++)this.plugins[r].update(this)}measure(e=!0){if(this.destroyed)return;this.measureScheduled>-1&&cancelAnimationFrame(this.measureScheduled),this.measureScheduled=0,e&&this.observer.flush();let t=null;try{for(let i=0;;i++){this.updateState=1;let r=this.viewport,s=this.viewState.measure(this);if(!s&&!this.measureRequests.length&&this.viewState.scrollTarget==null)break;if(i>5){console.warn(this.measureRequests.length?"Measure loop restarted more than 5 times":"Viewport failed to stabilize");break}let o=[];s&4||([this.measureRequests,o]=[o,this.measureRequests]);let l=o.map(u=>{try{return u.read(this)}catch(f){return dn(this.state,f),F2}}),a=Nu.create(this,this.state,[]),h=!1,c=!1;a.flags|=s,t?t.flags|=s:t=a,this.updateState=2,a.empty||(this.updatePlugins(a),this.inputState.update(a),this.updateAttrs(),h=this.docView.update(a));for(let u=0;u<o.length;u++)if(l[u]!=F2)try{let f=o[u];f.write&&f.write(l[u],this)}catch(f){dn(this.state,f)}if(this.viewState.scrollTarget&&(this.docView.scrollIntoView(this.viewState.scrollTarget),this.viewState.scrollTarget=null,c=!0),h&&this.docView.updateSelection(!0),this.viewport.from==r.from&&this.viewport.to==r.to&&!c&&this.measureRequests.length==0)break}}finally{this.updateState=0,this.measureScheduled=-1}if(t&&!t.empty)for(let i of this.state.facet(M0))i(t)}get themeClasses(){return z0+" "+(this.state.facet(H0)?B2:P2)+" "+this.state.facet(Hu)}updateAttrs(){let e=N2(this,VO,{class:"cm-editor"+(this.hasFocus?" cm-focused ":" ")+this.themeClasses}),t={spellcheck:"false",autocorrect:"off",autocapitalize:"off",translate:"no",contenteditable:this.state.facet(Ya)?"true":"false",class:"cm-content",style:`${fe.tabSize}: ${this.state.tabSize}`,role:"textbox","aria-multiline":"true"};this.state.readOnly&&(t["aria-readonly"]="true"),N2(this,T0,t),this.observer.ignore(()=>{O0(this.contentDOM,this.contentAttrs,t),O0(this.dom,this.editorAttrs,e)}),this.editorAttrs=e,this.contentAttrs=t}showAnnouncements(e){let t=!0;for(let i of e)for(let r of i.effects)if(r.is(le.announce)){t&&(this.announceDOM.textContent=""),t=!1;let s=this.announceDOM.appendChild(document.createElement("div"));s.textContent=r.value}}mountStyles(){this.styleModules=this.state.facet(eh),Ue.mount(this.root,this.styleModules.concat(H3).reverse())}readMeasured(){if(this.updateState==2)throw new Error("Reading the editor layout isn't allowed during an update");this.updateState==0&&this.measureScheduled>-1&&this.measure(!1)}requestMeasure(e){if(this.measureScheduled<0&&(this.measureScheduled=requestAnimationFrame(()=>this.measure())),e){if(e.key!=null){for(let t=0;t<this.measureRequests.length;t++)if(this.measureRequests[t].key===e.key){this.measureRequests[t]=e;return}}this.measureRequests.push(e)}}plugin(e){let t=this.pluginMap.get(e);return(t===void 0||t&&t.spec!=e)&&this.pluginMap.set(e,t=this.plugins.find(i=>i.spec==e)||null),t&&t.update(this).value}get documentTop(){return this.contentDOM.getBoundingClientRect().top+this.viewState.paddingTop}get documentPadding(){return{top:this.viewState.paddingTop,bottom:this.viewState.paddingBottom}}elementAtHeight(e){return this.readMeasured(),this.viewState.elementAtHeight(e)}lineBlockAtHeight(e){return this.readMeasured(),this.viewState.lineBlockAtHeight(e)}get viewportLineBlocks(){return this.viewState.viewportLines}lineBlockAt(e){return this.viewState.lineBlockAt(e)}get contentHeight(){return this.viewState.contentHeight}moveByChar(e,t,i){return F0(this,e,o2(this,e,t,i))}moveByGroup(e,t){return F0(this,e,o2(this,e,t,i=>v3(this,e.head,i)))}moveToLineBoundary(e,t,i=!0){return y3(this,e,t,i)}moveVertically(e,t,i){return F0(this,e,w3(this,e,t,i))}domAtPos(e){return this.docView.domAtPos(e)}posAtDOM(e,t=0){return this.docView.posFromDOM(e,t)}posAtCoords(e,t=!0){return this.readMeasured(),r2(this,e,t)}coordsAtPos(e,t=1){this.readMeasured();let i=this.docView.coordsAt(e,t);if(!i||i.left==i.right)return i;let r=this.state.doc.lineAt(e),s=this.bidiSpans(r),o=s[vl.find(s,e-r.from,-1,t)];return Pu(i,o.dir==kt.LTR==t>0)}get defaultCharacterWidth(){return this.viewState.heightOracle.charWidth}get defaultLineHeight(){return this.viewState.heightOracle.lineHeight}get textDirection(){return this.viewState.defaultTextDirection}textDirectionAt(e){return!this.state.facet(IO)||e<this.viewport.from||e>this.viewport.to?this.textDirection:(this.readMeasured(),this.docView.textDirectionAt(e))}get lineWrapping(){return this.viewState.heightOracle.lineWrapping}bidiSpans(e){if(e.length>J3)return UO(e.length);let t=this.textDirectionAt(e.from);for(let r of this.bidiCache)if(r.from==e.from&&r.dir==t)return r.order;let i=$O(e.text,t);return this.bidiCache.push(new zu(e.from,e.to,t,i)),i}get hasFocus(){var e;return(document.hasFocus()||fe.safari&&((e=this.inputState)===null||e===void 0?void 0:e.lastContextMenu)>Date.now()-3e4)&&this.root.activeElement==this.contentDOM}focus(){this.observer.ignore(()=>{pO(this.contentDOM),this.docView.updateSelection()})}destroy(){for(let e of this.plugins)e.destroy(this);this.plugins=[],this.inputState.destroy(),this.dom.remove(),this.observer.destroy(),this.measureScheduled>-1&&cancelAnimationFrame(this.measureScheduled),this.destroyed=!0}static scrollIntoView(e,t={}){return WO.of(new Fu(typeof e=="number"?L.cursor(e):e,t.y,t.x,t.yMargin,t.xMargin))}static domEventHandlers(e){return Nt.define(()=>({}),{eventHandlers:e})}static theme(e,t){let i=Ue.newName(),r=[Hu.of(i),eh.of(j0(`.${i}`,e))];return t&&t.dark&&r.push(H0.of(!0)),r}static baseTheme(e){return dl.lowest(eh.of(j0("."+z0,e,R2)))}}le.styleModule=eh,le.inputHandler=NO,le.perLineTextDirection=IO,le.exceptionSink=FO,le.updateListener=M0,le.editable=Ya,le.mouseSelectionStyle=LO,le.dragMovesSelection=RO,le.clickAddsSelectionRange=BO,le.decorations=Qa,le.atomicRanges=HO,le.scrollMargins=zO,le.darkTheme=H0,le.contentAttributes=T0,le.editorAttributes=VO,le.lineWrapping=le.contentAttributes.of({class:"cm-lineWrapping"}),le.announce=ke.define();const J3=4096,F2={};class zu{constructor(e,t,i,r){this.from=e,this.to=t,this.dir=i,this.order=r}static update(e,t){if(t.empty)return e;let i=[],r=e.length?e[e.length-1].dir:kt.LTR;for(let s=Math.max(0,e.length-10);s<e.length;s++){let o=e[s];o.dir==r&&!t.touchesRange(o.from,o.to)&&i.push(new zu(t.mapPos(o.from,1),t.mapPos(o.to,-1),o.dir,o.order))}return i}}function N2(n,e,t){for(let i=n.state.facet(e),r=i.length-1;r>=0;r--){let s=i[r],o=typeof s=="function"?s(n):s;o&&C0(o,t)}return t}const Z3=fe.mac?"mac":fe.windows?"win":fe.linux?"linux":"key";function Y3(n,e){const t=n.split(/-(?!$)/);let i=t[t.length-1];i=="Space"&&(i=" ");let r,s,o,l;for(let a=0;a<t.length-1;++a){const h=t[a];if(/^(cmd|meta|m)$/i.test(h))l=!0;else if(/^a(lt)?$/i.test(h))r=!0;else if(/^(c|ctrl|control)$/i.test(h))s=!0;else if(/^s(hift)?$/i.test(h))o=!0;else if(/^mod$/i.test(h))e=="mac"?l=!0:s=!0;else throw new Error("Unrecognized modifier name: "+h)}return r&&(i="Alt-"+i),s&&(i="Ctrl-"+i),l&&(i="Meta-"+i),o&&(i="Shift-"+i),i}function U0(n,e,t){return e.altKey&&(n="Alt-"+n),e.ctrlKey&&(n="Ctrl-"+n),e.metaKey&&(n="Meta-"+n),t!==!1&&e.shiftKey&&(n="Shift-"+n),n}const X3=le.domEventHandlers({keydown(n,e){return V2(W2(e.state),n,e,"editor")}}),ih=he.define({enables:X3}),I2=new WeakMap;function W2(n){let e=n.facet(ih),t=I2.get(e);return t||I2.set(e,t=t4(e.reduce((i,r)=>i.concat(r),[]))),t}function Q3(n,e,t){return V2(W2(n.state),e,n,t)}let Ds=null;const e4=4e3;function t4(n,e=Z3){let t=Object.create(null),i=Object.create(null),r=(o,l)=>{let a=i[o];if(a==null)i[o]=l;else if(a!=l)throw new Error("Key binding "+o+" is used both as a regular binding and as a multi-stroke prefix")},s=(o,l,a,h)=>{let c=t[o]||(t[o]=Object.create(null)),u=l.split(/ (?!$)/).map(p=>Y3(p,e));for(let p=1;p<u.length;p++){let g=u.slice(0,p).join(" ");r(g,!0),c[g]||(c[g]={preventDefault:!0,commands:[y=>{let v=Ds={view:y,prefix:g,scope:o};return setTimeout(()=>{Ds==v&&(Ds=null)},e4),!0}]})}let f=u.join(" ");r(f,!1);let d=c[f]||(c[f]={preventDefault:!1,commands:[]});d.commands.push(a),h&&(d.preventDefault=!0)};for(let o of n){let l=o[e]||o.key;if(!!l)for(let a of o.scope?o.scope.split(" "):["editor"])s(a,l,o.run,o.preventDefault),o.shift&&s(a,"Shift-"+l,o.shift,o.preventDefault)}return t}function V2(n,e,t,i){let r=uc(e),s=r.length==1&&r!=" ",o="",l=!1;Ds&&Ds.view==t&&Ds.scope==i&&(o=Ds.prefix+" ",(l=a2.indexOf(e.keyCode)<0)&&(Ds=null));let a=u=>{if(u){for(let f of u.commands)if(f(t))return!0;u.preventDefault&&(l=!0)}return!1},h=n[i],c;if(h){if(a(h[o+U0(r,e,!s)]))return!0;if(s&&(e.shiftKey||e.altKey||e.metaKey)&&(c=Bn[e.keyCode])&&c!=r){if(a(h[o+U0(c,e,!0)]))return!0}else if(s&&e.shiftKey&&a(h[o+U0(r,e,!0)]))return!0}return l}const H2=!fe.ios,nh=he.define({combine(n){return nr(n,{cursorBlinkRate:1200,drawRangeCursor:!0},{cursorBlinkRate:(e,t)=>Math.min(e,t),drawRangeCursor:(e,t)=>e||t})}});function i4(n={}){return[nh.of(n),n4,r4]}class z2{constructor(e,t,i,r,s){this.left=e,this.top=t,this.width=i,this.height=r,this.className=s}draw(){let e=document.createElement("div");return e.className=this.className,this.adjust(e),e}adjust(e){e.style.left=this.left+"px",e.style.top=this.top+"px",this.width>=0&&(e.style.width=this.width+"px"),e.style.height=this.height+"px"}eq(e){return this.left==e.left&&this.top==e.top&&this.width==e.width&&this.height==e.height&&this.className==e.className}}const n4=Nt.fromClass(class{constructor(n){this.view=n,this.rangePieces=[],this.cursors=[],this.measureReq={read:this.readPos.bind(this),write:this.drawSel.bind(this)},this.selectionLayer=n.scrollDOM.appendChild(document.createElement("div")),this.selectionLayer.className="cm-selectionLayer",this.selectionLayer.setAttribute("aria-hidden","true"),this.cursorLayer=n.scrollDOM.appendChild(document.createElement("div")),this.cursorLayer.className="cm-cursorLayer",this.cursorLayer.setAttribute("aria-hidden","true"),n.requestMeasure(this.measureReq),this.setBlinkRate()}setBlinkRate(){this.cursorLayer.style.animationDuration=this.view.state.facet(nh).cursorBlinkRate+"ms"}update(n){let e=n.startState.facet(nh)!=n.state.facet(nh);(e||n.selectionSet||n.geometryChanged||n.viewportChanged)&&this.view.requestMeasure(this.measureReq),n.transactions.some(t=>t.scrollIntoView)&&(this.cursorLayer.style.animationName=this.cursorLayer.style.animationName=="cm-blink"?"cm-blink2":"cm-blink"),e&&this.setBlinkRate()}readPos(){let{state:n}=this.view,e=n.facet(nh),t=n.selection.ranges.map(r=>r.empty?[]:s4(this.view,r)).reduce((r,s)=>r.concat(s)),i=[];for(let r of n.selection.ranges){let s=r==n.selection.main;if(r.empty?!s||H2:e.drawRangeCursor){let o=o4(this.view,r,s);o&&i.push(o)}}return{rangePieces:t,cursors:i}}drawSel({rangePieces:n,cursors:e}){if(n.length!=this.rangePieces.length||n.some((t,i)=>!t.eq(this.rangePieces[i]))){this.selectionLayer.textContent="";for(let t of n)this.selectionLayer.appendChild(t.draw());this.rangePieces=n}if(e.length!=this.cursors.length||e.some((t,i)=>!t.eq(this.cursors[i]))){let t=this.cursorLayer.children;if(t.length!==e.length){this.cursorLayer.textContent="";for(const i of e)this.cursorLayer.appendChild(i.draw())}else e.forEach((i,r)=>i.adjust(t[r]));this.cursors=e}}destroy(){this.selectionLayer.remove(),this.cursorLayer.remove()}}),j2={".cm-line":{"& ::selection":{backgroundColor:"transparent !important"},"&::selection":{backgroundColor:"transparent !important"}}};H2&&(j2[".cm-line"].caretColor="transparent !important");const r4=dl.highest(le.theme(j2));function $2(n){let e=n.scrollDOM.getBoundingClientRect();return{left:(n.textDirection==kt.LTR?e.left:e.right-n.scrollDOM.clientWidth)-n.scrollDOM.scrollLeft,top:e.top-n.scrollDOM.scrollTop}}function U2(n,e,t){let i=L.cursor(e);return{from:Math.max(t.from,n.moveToLineBoundary(i,!1,!0).from),to:Math.min(t.to,n.moveToLineBoundary(i,!0,!0).from),type:nt.Text}}function q2(n,e){let t=n.lineBlockAt(e);if(Array.isArray(t.type)){for(let i of t.type)if(i.to>e||i.to==e&&(i.to==t.to||i.type==nt.Text))return i}return t}function s4(n,e){if(e.to<=n.viewport.from||e.from>=n.viewport.to)return[];let t=Math.max(e.from,n.viewport.from),i=Math.min(e.to,n.viewport.to),r=n.textDirection==kt.LTR,s=n.contentDOM,o=s.getBoundingClientRect(),l=$2(n),a=window.getComputedStyle(s.firstChild),h=o.left+parseInt(a.paddingLeft)+Math.min(0,parseInt(a.textIndent)),c=o.right-parseInt(a.paddingRight),u=q2(n,t),f=q2(n,i),d=u.type==nt.Text?u:null,p=f.type==nt.Text?f:null;if(n.lineWrapping&&(d&&(d=U2(n,t,d)),p&&(p=U2(n,i,p))),d&&p&&d.from==p.from)return y(v(e.from,e.to,d));{let x=d?v(e.from,null,d):C(u,!1),b=p?v(null,e.to,p):C(f,!0),S=[];return(d||u).to<(p||f).from-1?S.push(g(h,x.bottom,c,b.top)):x.bottom<b.top&&n.elementAtHeight((x.bottom+b.top)/2).type==nt.Text&&(x.bottom=b.top=(x.bottom+b.top)/2),y(x).concat(S).concat(y(b))}function g(x,b,S,k){return new z2(x-l.left,b-l.top-.01,S-x,k-b+.01,"cm-selectionBackground")}function y({top:x,bottom:b,horizontal:S}){let k=[];for(let A=0;A<S.length;A+=2)k.push(g(S[A],x,S[A+1],b));return k}function v(x,b,S){let k=1e9,A=-1e9,_=[];function O(B,N,ne,W,J){let re=n.coordsAtPos(B,B==S.to?-2:2),ie=n.coordsAtPos(ne,ne==S.from?2:-2);k=Math.min(re.top,ie.top,k),A=Math.max(re.bottom,ie.bottom,A),J==kt.LTR?_.push(r&&N?h:re.left,r&&W?c:ie.right):_.push(!r&&W?h:ie.left,!r&&N?c:re.right)}let D=x!=null?x:S.from,T=b!=null?b:S.to;for(let B of n.visibleRanges)if(B.to>D&&B.from<T)for(let N=Math.max(B.from,D),ne=Math.min(B.to,T);;){let W=n.state.doc.lineAt(N);for(let J of n.bidiSpans(W)){let re=J.from+W.from,ie=J.to+W.from;if(re>=ne)break;ie>N&&O(Math.max(re,N),x==null&&re<=D,Math.min(ie,ne),b==null&&ie>=T,J.dir)}if(N=W.to+1,N>=ne)break}return _.length==0&&O(D,x==null,T,b==null,n.textDirection),{top:k,bottom:A,horizontal:_}}function C(x,b){let S=o.top+(b?x.top:x.bottom);return{top:S,bottom:S,horizontal:[]}}}function o4(n,e,t){let i=n.coordsAtPos(e.head,e.assoc||1);if(!i)return null;let r=$2(n);return new z2(i.left-r.left,i.top-r.top,-1,i.bottom-i.top,t?"cm-cursor cm-cursor-primary":"cm-cursor cm-cursor-secondary")}const K2=ke.define({map(n,e){return n==null?null:e.mapPos(n)}}),rh=zt.define({create(){return null},update(n,e){return n!=null&&(n=e.changes.mapPos(n)),e.effects.reduce((t,i)=>i.is(K2)?i.value:t,n)}}),l4=Nt.fromClass(class{constructor(n){this.view=n,this.cursor=null,this.measureReq={read:this.readPos.bind(this),write:this.drawCursor.bind(this)}}update(n){var e;let t=n.state.field(rh);t==null?this.cursor!=null&&((e=this.cursor)===null||e===void 0||e.remove(),this.cursor=null):(this.cursor||(this.cursor=this.view.scrollDOM.appendChild(document.createElement("div")),this.cursor.className="cm-dropCursor"),(n.startState.field(rh)!=t||n.docChanged||n.geometryChanged)&&this.view.requestMeasure(this.measureReq))}readPos(){let n=this.view.state.field(rh),e=n!=null&&this.view.coordsAtPos(n);if(!e)return null;let t=this.view.scrollDOM.getBoundingClientRect();return{left:e.left-t.left+this.view.scrollDOM.scrollLeft,top:e.top-t.top+this.view.scrollDOM.scrollTop,height:e.bottom-e.top}}drawCursor(n){this.cursor&&(n?(this.cursor.style.left=n.left+"px",this.cursor.style.top=n.top+"px",this.cursor.style.height=n.height+"px"):this.cursor.style.left="-100000px")}destroy(){this.cursor&&this.cursor.remove()}setDropPos(n){this.view.state.field(rh)!=n&&this.view.dispatch({effects:K2.of(n)})}},{eventHandlers:{dragover(n){this.setDropPos(this.view.posAtCoords({x:n.clientX,y:n.clientY}))},dragleave(n){(n.target==this.view.contentDOM||!this.view.contentDOM.contains(n.relatedTarget))&&this.setDropPos(null)},dragend(){this.setDropPos(null)},drop(){this.setDropPos(null)}}});function a4(){return[rh,l4]}function G2(n,e,t,i,r){e.lastIndex=0;for(let s=n.iterRange(t,i),o=t,l;!s.next().done;o+=s.value.length)if(!s.lineBreak)for(;l=e.exec(s.value);)r(o+l.index,o+l.index+l[0].length,l)}function h4(n,e){let t=n.visibleRanges;if(t.length==1&&t[0].from==n.viewport.from&&t[0].to==n.viewport.to)return t;let i=[];for(let{from:r,to:s}of t)r=Math.max(n.state.doc.lineAt(r).from,r-e),s=Math.min(n.state.doc.lineAt(s).to,s+e),i.length&&i[i.length-1].to>=r?i[i.length-1].to=s:i.push({from:r,to:s});return i}class c4{constructor(e){let{regexp:t,decoration:i,boundary:r,maxLength:s=1e3}=e;if(!t.global)throw new RangeError("The regular expression given to MatchDecorator should have its 'g' flag set");this.regexp=t,this.getDeco=typeof i=="function"?i:()=>i,this.boundary=r,this.maxLength=s}createDeco(e){let t=new ks;for(let{from:i,to:r}of h4(e,this.maxLength))G2(e.state.doc,this.regexp,i,r,(s,o,l)=>t.add(s,o,this.getDeco(l,e,s)));return t.finish()}updateDeco(e,t){let i=1e9,r=-1;return e.docChanged&&e.changes.iterChanges((s,o,l,a)=>{a>e.view.viewport.from&&l<e.view.viewport.to&&(i=Math.min(l,i),r=Math.max(a,r))}),e.viewportChanged||r-i>1e3?this.createDeco(e.view):r>-1?this.updateRange(e.view,t.map(e.changes),i,r):t}updateRange(e,t,i,r){for(let s of e.visibleRanges){let o=Math.max(s.from,i),l=Math.min(s.to,r);if(l>o){let a=e.state.doc.lineAt(o),h=a.to<l?e.state.doc.lineAt(l):a,c=Math.max(s.from,a.from),u=Math.min(s.to,h.to);if(this.boundary){for(;o>a.from;o--)if(this.boundary.test(a.text[o-1-a.from])){c=o;break}for(;l<h.to;l++)if(this.boundary.test(h.text[l-h.from])){u=l;break}}let f=[],d;if(a==h)for(this.regexp.lastIndex=c-a.from;(d=this.regexp.exec(a.text))&&d.index<u-a.from;){let p=d.index+a.from;f.push(this.getDeco(d,e,p).range(p,p+d[0].length))}else G2(e.state.doc,this.regexp,c,u,(p,g,y)=>f.push(this.getDeco(y,e,p).range(p,g)));t=t.update({filterFrom:c,filterTo:u,filter:(p,g)=>p<c||g>u,add:f})}}return t}}const q0=/x/.unicode!=null?"gu":"g",u4=new RegExp(`[\0-\b
-\x7F-\x9F\xAD\u061C\u200B\u200E\u200F\u2028\u2029\u202D\u202E\uFEFF\uFFF9-\uFFFC]`,q0),f4={0:"null",7:"bell",8:"backspace",10:"newline",11:"vertical tab",13:"carriage return",27:"escape",8203:"zero width space",8204:"zero width non-joiner",8205:"zero width joiner",8206:"left-to-right mark",8207:"right-to-left mark",8232:"line separator",8237:"left-to-right override",8238:"right-to-left override",8233:"paragraph separator",65279:"zero width no-break space",65532:"object replacement"};let K0=null;function d4(){var n;if(K0==null&&typeof document!="undefined"&&document.body){let e=document.body.style;K0=((n=e.tabSize)!==null&&n!==void 0?n:e.MozTabSize)!=null}return K0||!1}const ju=he.define({combine(n){let e=nr(n,{render:null,specialChars:u4,addSpecialChars:null});return(e.replaceTabs=!d4())&&(e.specialChars=new RegExp("	|"+e.specialChars.source,q0)),e.addSpecialChars&&(e.specialChars=new RegExp(e.specialChars.source+"|"+e.addSpecialChars.source,q0)),e}});function p4(n={}){return[ju.of(n),m4()]}let J2=null;function m4(){return J2||(J2=Nt.fromClass(class{constructor(n){this.view=n,this.decorations=ue.none,this.decorationCache=Object.create(null),this.decorator=this.makeDecorator(n.state.facet(ju)),this.decorations=this.decorator.createDeco(n)}makeDecorator(n){return new c4({regexp:n.specialChars,decoration:(e,t,i)=>{let{doc:r}=t.state,s=xi(e[0],0);if(s==9){let o=r.lineAt(i),l=t.state.tabSize,a=qa(o.text,l,i-o.from);return ue.replace({widget:new w4((l-a%l)*this.view.defaultCharacterWidth)})}return this.decorationCache[s]||(this.decorationCache[s]=ue.replace({widget:new v4(n,s)}))},boundary:n.replaceTabs?void 0:/[^]/})}update(n){let e=n.state.facet(ju);n.startState.facet(ju)!=e?(this.decorator=this.makeDecorator(e),this.decorations=this.decorator.createDeco(n.view)):this.decorations=this.decorator.updateDeco(n,this.decorations)}},{decorations:n=>n.decorations}))}const g4="\u2022";function y4(n){return n>=32?g4:n==10?"\u2424":String.fromCharCode(9216+n)}class v4 extends sr{constructor(e,t){super(),this.options=e,this.code=t}eq(e){return e.code==this.code}toDOM(e){let t=y4(this.code),i=e.state.phrase("Control character")+" "+(f4[this.code]||"0x"+this.code.toString(16)),r=this.options.render&&this.options.render(this.code,i,t);if(r)return r;let s=document.createElement("span");return s.textContent=t,s.title=i,s.setAttribute("aria-label",i),s.className="cm-specialChar",s}ignoreEvent(){return!1}}class w4 extends sr{constructor(e){super(),this.width=e}eq(e){return e.width==this.width}toDOM(){let e=document.createElement("span");return e.textContent="	",e.className="cm-tab",e.style.width=this.width+"px",e}ignoreEvent(){return!1}}const Z2=null;function N6(){return[Z2,T0.of(n=>{var e;return((e=n.plugin(Z2))===null||e===void 0?void 0:e.attrs)||null})]}function b4(){return S4}const x4=ue.line({class:"cm-activeLine"}),S4=Nt.fromClass(class{constructor(n){this.decorations=this.getDeco(n)}update(n){(n.docChanged||n.selectionSet)&&(this.decorations=this.getDeco(n.view))}getDeco(n){let e=-1,t=[];for(let i of n.state.selection.ranges){if(!i.empty)return ue.none;let r=n.lineBlockAt(i.head);r.from>e&&(t.push(x4.range(r.from)),e=r.from)}return ue.set(t)}},{decorations:n=>n.decorations});class k4 extends sr{constructor(e){super(),this.content=e}toDOM(){let e=document.createElement("span");return e.className="cm-placeholder",e.style.pointerEvents="none",e.appendChild(typeof this.content=="string"?document.createTextNode(this.content):this.content),typeof this.content=="string"?e.setAttribute("aria-label","placeholder "+this.content):e.setAttribute("aria-hidden","true"),e}ignoreEvent(){return!1}}function C4(n){return Nt.fromClass(class{constructor(e){this.view=e,this.placeholder=ue.set([ue.widget({widget:new k4(n),side:1}).range(0)])}get decorations(){return this.view.state.doc.length?ue.none:this.placeholder}},{decorations:e=>e.decorations})}const G0=2e3;function A4(n,e,t){let i=Math.min(e.line,t.line),r=Math.max(e.line,t.line),s=[];if(e.off>G0||t.off>G0||e.col<0||t.col<0){let o=Math.min(e.off,t.off),l=Math.max(e.off,t.off);for(let a=i;a<=r;a++){let h=n.doc.line(a);h.length<=l&&s.push(L.range(h.from+o,h.to+l))}}else{let o=Math.min(e.col,t.col),l=Math.max(e.col,t.col);for(let a=i;a<=r;a++){let h=n.doc.line(a),c=p0(h.text,o,n.tabSize,!0);if(c>-1){let u=p0(h.text,l,n.tabSize);s.push(L.range(h.from+c,h.from+u))}}}return s}function O4(n,e){let t=n.coordsAtPos(n.viewport.from);return t?Math.round(Math.abs((t.left-e)/n.defaultCharacterWidth)):-1}function Y2(n,e){let t=n.posAtCoords({x:e.clientX,y:e.clientY},!1),i=n.state.doc.lineAt(t),r=t-i.from,s=r>G0?-1:r==i.length?O4(n,e.clientX):qa(i.text,n.state.tabSize,t-i.from);return{line:i.number,col:s,off:r}}function _4(n,e){let t=Y2(n,e),i=n.state.selection;return t?{update(r){if(r.docChanged){let s=r.changes.mapPos(r.startState.doc.line(t.line).from),o=r.state.doc.lineAt(s);t={line:o.number,col:t.col,off:Math.min(t.off,o.length)},i=i.map(r.changes)}},get(r,s,o){let l=Y2(n,r);if(!l)return i;let a=A4(n.state,t,l);return a.length?o?L.create(a.concat(i.ranges)):L.create(a):i}}:null}function D4(n){let e=(n==null?void 0:n.eventFilter)||(t=>t.altKey&&t.button==0);return le.mouseSelectionStyle.of((t,i)=>e(i)?_4(t,i):null)}const M4={Alt:[18,n=>n.altKey],Control:[17,n=>n.ctrlKey],Shift:[16,n=>n.shiftKey],Meta:[91,n=>n.metaKey]},E4={style:"cursor: crosshair"};function T4(n={}){let[e,t]=M4[n.key||"Alt"],i=Nt.fromClass(class{constructor(r){this.view=r,this.isDown=!1}set(r){this.isDown!=r&&(this.isDown=r,this.view.update([]))}},{eventHandlers:{keydown(r){this.set(r.keyCode==e||t(r))},keyup(r){(r.keyCode==e||!t(r))&&this.set(!1)}}});return[i,le.contentAttributes.of(r=>{var s;return!((s=r.plugin(i))===null||s===void 0)&&s.isDown?E4:null})]}const J0="-10000px";class X2{constructor(e,t,i){this.facet=t,this.createTooltipView=i,this.input=e.state.facet(t),this.tooltips=this.input.filter(r=>r),this.tooltipViews=this.tooltips.map(i)}update(e){let t=e.state.facet(this.facet),i=t.filter(s=>s);if(t===this.input){for(let s of this.tooltipViews)s.update&&s.update(e);return!1}let r=[];for(let s=0;s<i.length;s++){let o=i[s],l=-1;if(!!o){for(let a=0;a<this.tooltips.length;a++){let h=this.tooltips[a];h&&h.create==o.create&&(l=a)}if(l<0)r[s]=this.createTooltipView(o);else{let a=r[s]=this.tooltipViews[l];a.update&&a.update(e)}}}for(let s of this.tooltipViews)r.indexOf(s)<0&&s.dom.remove();return this.input=t,this.tooltips=i,this.tooltipViews=r,!0}}function I6(n={}){return $u.of(n)}function P4(){return{top:0,left:0,bottom:innerHeight,right:innerWidth}}const $u=he.define({combine:n=>{var e,t,i;return{position:fe.ios?"absolute":((e=n.find(r=>r.position))===null||e===void 0?void 0:e.position)||"fixed",parent:((t=n.find(r=>r.parent))===null||t===void 0?void 0:t.parent)||null,tooltipSpace:((i=n.find(r=>r.tooltipSpace))===null||i===void 0?void 0:i.tooltipSpace)||P4}}}),Z0=Nt.fromClass(class{constructor(n){var e;this.view=n,this.inView=!0,this.lastTransaction=0,this.measureTimeout=-1;let t=n.state.facet($u);this.position=t.position,this.parent=t.parent,this.classes=n.themeClasses,this.createContainer(),this.measureReq={read:this.readMeasure.bind(this),write:this.writeMeasure.bind(this),key:this},this.manager=new X2(n,Uu,i=>this.createTooltip(i)),this.intersectionObserver=typeof IntersectionObserver=="function"?new IntersectionObserver(i=>{Date.now()>this.lastTransaction-50&&i.length>0&&i[i.length-1].intersectionRatio<1&&this.measureSoon()},{threshold:[1]}):null,this.observeIntersection(),(e=n.dom.ownerDocument.defaultView)===null||e===void 0||e.addEventListener("resize",this.measureSoon=this.measureSoon.bind(this)),this.maybeMeasure()}createContainer(){this.parent?(this.container=document.createElement("div"),this.container.style.position="relative",this.container.className=this.view.themeClasses,this.parent.appendChild(this.container)):this.container=this.view.dom}observeIntersection(){if(this.intersectionObserver){this.intersectionObserver.disconnect();for(let n of this.manager.tooltipViews)this.intersectionObserver.observe(n.dom)}}measureSoon(){this.measureTimeout<0&&(this.measureTimeout=setTimeout(()=>{this.measureTimeout=-1,this.maybeMeasure()},50))}update(n){n.transactions.length&&(this.lastTransaction=Date.now());let e=this.manager.update(n);e&&this.observeIntersection();let t=e||n.geometryChanged,i=n.state.facet($u);if(i.position!=this.position){this.position=i.position;for(let r of this.manager.tooltipViews)r.dom.style.position=this.position;t=!0}if(i.parent!=this.parent){this.parent&&this.container.remove(),this.parent=i.parent,this.createContainer();for(let r of this.manager.tooltipViews)this.container.appendChild(r.dom);t=!0}else this.parent&&this.view.themeClasses!=this.classes&&(this.classes=this.container.className=this.view.themeClasses);t&&this.maybeMeasure()}createTooltip(n){let e=n.create(this.view);if(e.dom.classList.add("cm-tooltip"),n.arrow&&!e.dom.querySelector(".cm-tooltip > .cm-tooltip-arrow")){let t=document.createElement("div");t.className="cm-tooltip-arrow",e.dom.appendChild(t)}return e.dom.style.position=this.position,e.dom.style.top=J0,this.container.appendChild(e.dom),e.mount&&e.mount(this.view),e}destroy(){var n,e;(n=this.view.dom.ownerDocument.defaultView)===null||n===void 0||n.removeEventListener("resize",this.measureSoon);for(let{dom:t}of this.manager.tooltipViews)t.remove();(e=this.intersectionObserver)===null||e===void 0||e.disconnect(),clearTimeout(this.measureTimeout)}readMeasure(){let n=this.view.dom.getBoundingClientRect();return{editor:n,parent:this.parent?this.container.getBoundingClientRect():n,pos:this.manager.tooltips.map((e,t)=>{let i=this.manager.tooltipViews[t];return i.getCoords?i.getCoords(e.pos):this.view.coordsAtPos(e.pos)}),size:this.manager.tooltipViews.map(({dom:e})=>e.getBoundingClientRect()),space:this.view.state.facet($u).tooltipSpace(this.view)}}writeMeasure(n){let{editor:e,space:t}=n,i=[];for(let r=0;r<this.manager.tooltips.length;r++){let s=this.manager.tooltips[r],o=this.manager.tooltipViews[r],{dom:l}=o,a=n.pos[r],h=n.size[r];if(!a||a.bottom<=Math.max(e.top,t.top)||a.top>=Math.min(e.bottom,t.bottom)||a.right<Math.max(e.left,t.left)-.1||a.left>Math.min(e.right,t.right)+.1){l.style.top=J0;continue}let c=s.arrow?o.dom.querySelector(".cm-tooltip-arrow"):null,u=c?7:0,f=h.right-h.left,d=h.bottom-h.top,p=o.offset||R4,g=this.view.textDirection==kt.LTR,y=h.width>t.right-t.left?g?t.left:t.right-h.width:g?Math.min(a.left-(c?14:0)+p.x,t.right-f):Math.max(t.left,a.left-f+(c?14:0)-p.x),v=!!s.above;!s.strictSide&&(v?a.top-(h.bottom-h.top)-p.y<t.top:a.bottom+(h.bottom-h.top)+p.y>t.bottom)&&v==t.bottom-a.bottom>a.top-t.top&&(v=!v);let C=v?a.top-d-u-p.y:a.bottom+u+p.y,x=y+f;if(o.overlap!==!0)for(let b of i)b.left<x&&b.right>y&&b.top<C+d&&b.bottom>C&&(C=v?b.top-d-2-u:b.bottom+u+2);this.position=="absolute"?(l.style.top=C-n.parent.top+"px",l.style.left=y-n.parent.left+"px"):(l.style.top=C+"px",l.style.left=y+"px"),c&&(c.style.left=`${a.left+(g?p.x:-p.x)-(y+14-7)}px`),o.overlap!==!0&&i.push({left:y,top:C,right:x,bottom:C+d}),l.classList.toggle("cm-tooltip-above",v),l.classList.toggle("cm-tooltip-below",!v),o.positioned&&o.positioned()}}maybeMeasure(){if(this.manager.tooltips.length&&(this.view.inView&&this.view.requestMeasure(this.measureReq),this.inView!=this.view.inView&&(this.inView=this.view.inView,!this.inView)))for(let n of this.manager.tooltipViews)n.dom.style.top=J0}},{eventHandlers:{scroll(){this.maybeMeasure()}}}),B4=le.baseTheme({".cm-tooltip":{zIndex:100},"&light .cm-tooltip":{border:"1px solid #bbb",backgroundColor:"#f5f5f5"},"&light .cm-tooltip-section:not(:first-child)":{borderTop:"1px solid #bbb"},"&dark .cm-tooltip":{backgroundColor:"#333338",color:"white"},".cm-tooltip-arrow":{height:`${7}px`,width:`${7*2}px`,position:"absolute",zIndex:-1,overflow:"hidden","&:before, &:after":{content:"''",position:"absolute",width:0,height:0,borderLeft:`${7}px solid transparent`,borderRight:`${7}px solid transparent`},".cm-tooltip-above &":{bottom:`-${7}px`,"&:before":{borderTop:`${7}px solid #bbb`},"&:after":{borderTop:`${7}px solid #f5f5f5`,bottom:"1px"}},".cm-tooltip-below &":{top:`-${7}px`,"&:before":{borderBottom:`${7}px solid #bbb`},"&:after":{borderBottom:`${7}px solid #f5f5f5`,top:"1px"}}},"&dark .cm-tooltip .cm-tooltip-arrow":{"&:before":{borderTopColor:"#333338",borderBottomColor:"#333338"},"&:after":{borderTopColor:"transparent",borderBottomColor:"transparent"}}}),R4={x:0,y:0},Uu=he.define({enables:[Z0,B4]}),sh=he.define();class Y0{constructor(e){this.view=e,this.mounted=!1,this.dom=document.createElement("div"),this.dom.classList.add("cm-tooltip-hover"),this.manager=new X2(e,sh,t=>this.createHostedView(t))}static create(e){return new Y0(e)}createHostedView(e){let t=e.create(this.view);return t.dom.classList.add("cm-tooltip-section"),this.dom.appendChild(t.dom),this.mounted&&t.mount&&t.mount(this.view),t}mount(e){for(let t of this.manager.tooltipViews)t.mount&&t.mount(e);this.mounted=!0}positioned(){for(let e of this.manager.tooltipViews)e.positioned&&e.positioned()}update(e){this.manager.update(e)}}const L4=Uu.compute([sh],n=>{let e=n.facet(sh).filter(t=>t);return e.length===0?null:{pos:Math.min(...e.map(t=>t.pos)),end:Math.max(...e.filter(t=>t.end!=null).map(t=>t.end)),create:Y0.create,above:e[0].above,arrow:e.some(t=>t.arrow)}});class F4{constructor(e,t,i,r,s){this.view=e,this.source=t,this.field=i,this.setHover=r,this.hoverTime=s,this.hoverTimeout=-1,this.restartTimeout=-1,this.pending=null,this.lastMove={x:0,y:0,target:e.dom,time:0},this.checkHover=this.checkHover.bind(this),e.dom.addEventListener("mouseleave",this.mouseleave=this.mouseleave.bind(this)),e.dom.addEventListener("mousemove",this.mousemove=this.mousemove.bind(this))}update(){this.pending&&(this.pending=null,clearTimeout(this.restartTimeout),this.restartTimeout=setTimeout(()=>this.startHover(),20))}get active(){return this.view.state.field(this.field)}checkHover(){if(this.hoverTimeout=-1,this.active)return;let e=Date.now()-this.lastMove.time;e<this.hoverTime?this.hoverTimeout=setTimeout(this.checkHover,this.hoverTime-e):this.startHover()}startHover(){var e;clearTimeout(this.restartTimeout);let{lastMove:t}=this,i=this.view.contentDOM.contains(t.target)?this.view.posAtCoords(t):null;if(i==null)return;let r=this.view.coordsAtPos(i);if(r==null||t.y<r.top||t.y>r.bottom||t.x<r.left-this.view.defaultCharacterWidth||t.x>r.right+this.view.defaultCharacterWidth)return;let s=this.view.bidiSpans(this.view.state.doc.lineAt(i)).find(a=>a.from<=i&&a.to>=i),o=s&&s.dir==kt.RTL?-1:1,l=this.source(this.view,i,t.x<r.left?-o:o);if(!((e=l)===null||e===void 0)&&e.then){let a=this.pending={pos:i};l.then(h=>{this.pending==a&&(this.pending=null,h&&this.view.dispatch({effects:this.setHover.of(h)}))},h=>dn(this.view.state,h,"hover tooltip"))}else l&&this.view.dispatch({effects:this.setHover.of(l)})}mousemove(e){var t;this.lastMove={x:e.clientX,y:e.clientY,target:e.target,time:Date.now()},this.hoverTimeout<0&&(this.hoverTimeout=setTimeout(this.checkHover,this.hoverTime));let i=this.active;if(i&&!N4(this.lastMove.target)||this.pending){let{pos:r}=i||this.pending,s=(t=i==null?void 0:i.end)!==null&&t!==void 0?t:r;(r==s?this.view.posAtCoords(this.lastMove)!=r:!I4(this.view,r,s,e.clientX,e.clientY,6))&&(this.view.dispatch({effects:this.setHover.of(null)}),this.pending=null)}}mouseleave(){clearTimeout(this.hoverTimeout),this.hoverTimeout=-1,this.active&&this.view.dispatch({effects:this.setHover.of(null)})}destroy(){clearTimeout(this.hoverTimeout),this.view.dom.removeEventListener("mouseleave",this.mouseleave),this.view.dom.removeEventListener("mousemove",this.mousemove)}}function N4(n){for(let e=n;e;e=e.parentNode)if(e.nodeType==1&&e.classList.contains("cm-tooltip"))return!0;return!1}function I4(n,e,t,i,r,s){let o=document.createRange(),l=n.domAtPos(e),a=n.domAtPos(t);o.setEnd(a.node,a.offset),o.setStart(l.node,l.offset);let h=o.getClientRects();o.detach();for(let c=0;c<h.length;c++){let u=h[c];if(Math.max(u.top-r,r-u.bottom,u.left-i,i-u.right)<=s)return!0}return!1}function W4(n,e={}){let t=ke.define(),i=zt.define({create(){return null},update(r,s){if(r&&(e.hideOnChange&&(s.docChanged||s.selection)||e.hideOn&&e.hideOn(s,r)))return null;if(r&&s.docChanged){let o=s.changes.mapPos(r.pos,-1,Wi.TrackDel);if(o==null)return null;let l=Object.assign(Object.create(null),r);l.pos=o,r.end!=null&&(l.end=s.changes.mapPos(r.end)),r=l}for(let o of s.effects)o.is(t)&&(r=o.value),o.is(H4)&&(r=null);return r},provide:r=>sh.from(r)});return[i,Nt.define(r=>new F4(r,n,i,t,e.hoverTime||300)),L4]}function V4(n,e){let t=n.plugin(Z0);if(!t)return null;let i=t.manager.tooltips.indexOf(e);return i<0?null:t.manager.tooltipViews[i]}function W6(n){return n.facet(sh).some(e=>e)}const H4=ke.define(),V6=null;function H6(n){var e;(e=n.plugin(Z0))===null||e===void 0||e.maybeMeasure()}const X0=he.define({combine(n){let e,t;for(let i of n)e=e||i.topContainer,t=t||i.bottomContainer;return{topContainer:e,bottomContainer:t}}});function z6(n){return n?[X0.of(n)]:[]}function oh(n,e){let t=n.plugin(Q2),i=t?t.specs.indexOf(e):-1;return i>-1?t.panels[i]:null}const Q2=Nt.fromClass(class{constructor(n){this.input=n.state.facet(lh),this.specs=this.input.filter(t=>t),this.panels=this.specs.map(t=>t(n));let e=n.state.facet(X0);this.top=new qu(n,!0,e.topContainer),this.bottom=new qu(n,!1,e.bottomContainer),this.top.sync(this.panels.filter(t=>t.top)),this.bottom.sync(this.panels.filter(t=>!t.top));for(let t of this.panels)t.dom.classList.add("cm-panel"),t.mount&&t.mount()}update(n){let e=n.state.facet(X0);this.top.container!=e.topContainer&&(this.top.sync([]),this.top=new qu(n.view,!0,e.topContainer)),this.bottom.container!=e.bottomContainer&&(this.bottom.sync([]),this.bottom=new qu(n.view,!1,e.bottomContainer)),this.top.syncClasses(),this.bottom.syncClasses();let t=n.state.facet(lh);if(t!=this.input){let i=t.filter(a=>a),r=[],s=[],o=[],l=[];for(let a of i){let h=this.specs.indexOf(a),c;h<0?(c=a(n.view),l.push(c)):(c=this.panels[h],c.update&&c.update(n)),r.push(c),(c.top?s:o).push(c)}this.specs=i,this.panels=r,this.top.sync(s),this.bottom.sync(o);for(let a of l)a.dom.classList.add("cm-panel"),a.mount&&a.mount()}else for(let i of this.panels)i.update&&i.update(n)}destroy(){this.top.sync([]),this.bottom.sync([])}},{provide:n=>le.scrollMargins.of(e=>{let t=e.plugin(n);return t&&{top:t.top.scrollMargin(),bottom:t.bottom.scrollMargin()}})});class qu{constructor(e,t,i){this.view=e,this.top=t,this.container=i,this.dom=void 0,this.classes="",this.panels=[],this.syncClasses()}sync(e){for(let t of this.panels)t.destroy&&e.indexOf(t)<0&&t.destroy();this.panels=e,this.syncDOM()}syncDOM(){if(this.panels.length==0){this.dom&&(this.dom.remove(),this.dom=void 0);return}if(!this.dom){this.dom=document.createElement("div"),this.dom.className=this.top?"cm-panels cm-panels-top":"cm-panels cm-panels-bottom",this.dom.style[this.top?"top":"bottom"]="0";let t=this.container||this.view.dom;t.insertBefore(this.dom,this.top?t.firstChild:null)}let e=this.dom.firstChild;for(let t of this.panels)if(t.dom.parentNode==this.dom){for(;e!=t.dom;)e=e_(e);e=e.nextSibling}else this.dom.insertBefore(t.dom,e);for(;e;)e=e_(e)}scrollMargin(){return!this.dom||this.container?0:Math.max(0,this.top?this.dom.getBoundingClientRect().bottom-Math.max(0,this.view.scrollDOM.getBoundingClientRect().top):Math.min(innerHeight,this.view.scrollDOM.getBoundingClientRect().bottom)-this.dom.getBoundingClientRect().top)}syncClasses(){if(!(!this.container||this.classes==this.view.themeClasses)){for(let e of this.classes.split(" "))e&&this.container.classList.remove(e);for(let e of(this.classes=this.view.themeClasses).split(" "))e&&this.container.classList.add(e)}}}function e_(n){let e=n.nextSibling;return n.remove(),e}const lh=he.define({enables:Q2});class ar extends mo{compare(e){return this==e||this.constructor==e.constructor&&this.eq(e)}eq(e){return!1}destroy(e){}}ar.prototype.elementClass="",ar.prototype.toDOM=void 0,ar.prototype.mapMode=Wi.TrackBefore,ar.prototype.startSide=ar.prototype.endSide=-1,ar.prototype.point=!0;const Ku=he.define(),z4={class:"",renderEmptyElements:!1,elementStyle:"",markers:()=>We.empty,lineMarker:()=>null,lineMarkerChange:null,initialSpacer:null,updateSpacer:null,domEventHandlers:{}},ah=he.define();function t_(n){return[i_(),ah.of(Object.assign(Object.assign({},z4),n))]}const Q0=he.define({combine:n=>n.some(e=>e)});function i_(n){let e=[j4];return n&&n.fixed===!1&&e.push(Q0.of(!0)),e}const j4=Nt.fromClass(class{constructor(n){this.view=n,this.prevViewport=n.viewport,this.dom=document.createElement("div"),this.dom.className="cm-gutters",this.dom.setAttribute("aria-hidden","true"),this.dom.style.minHeight=this.view.contentHeight+"px",this.gutters=n.state.facet(ah).map(e=>new s_(n,e));for(let e of this.gutters)this.dom.appendChild(e.dom);this.fixed=!n.state.facet(Q0),this.fixed&&(this.dom.style.position="sticky"),this.syncGutters(!1),n.scrollDOM.insertBefore(this.dom,n.contentDOM)}update(n){if(this.updateGutters(n)){let e=this.prevViewport,t=n.view.viewport,i=Math.min(e.to,t.to)-Math.max(e.from,t.from);this.syncGutters(i<(t.to-t.from)*.8)}n.geometryChanged&&(this.dom.style.minHeight=this.view.contentHeight+"px"),this.view.state.facet(Q0)!=!this.fixed&&(this.fixed=!this.fixed,this.dom.style.position=this.fixed?"sticky":""),this.prevViewport=n.view.viewport}syncGutters(n){let e=this.dom.nextSibling;n&&this.dom.remove();let t=We.iter(this.view.state.facet(Ku),this.view.viewport.from),i=[],r=this.gutters.map(s=>new $4(s,this.view.viewport,-this.view.documentPadding.top));for(let s of this.view.viewportLineBlocks){let o;if(Array.isArray(s.type)){for(let l of s.type)if(l.type==nt.Text){o=l;break}}else o=s.type==nt.Text?s:void 0;if(!!o){i.length&&(i=[]),r_(t,i,s.from);for(let l of r)l.line(this.view,o,i)}}for(let s of r)s.finish();n&&this.view.scrollDOM.insertBefore(this.dom,e)}updateGutters(n){let e=n.startState.facet(ah),t=n.state.facet(ah),i=n.docChanged||n.heightChanged||n.viewportChanged||!We.eq(n.startState.facet(Ku),n.state.facet(Ku),n.view.viewport.from,n.view.viewport.to);if(e==t)for(let r of this.gutters)r.update(n)&&(i=!0);else{i=!0;let r=[];for(let s of t){let o=e.indexOf(s);o<0?r.push(new s_(this.view,s)):(this.gutters[o].update(n),r.push(this.gutters[o]))}for(let s of this.gutters)s.dom.remove(),r.indexOf(s)<0&&s.destroy();for(let s of r)this.dom.appendChild(s.dom);this.gutters=r}return i}destroy(){for(let n of this.gutters)n.destroy();this.dom.remove()}},{provide:n=>le.scrollMargins.of(e=>{let t=e.plugin(n);return!t||t.gutters.length==0||!t.fixed?null:e.textDirection==kt.LTR?{left:t.dom.offsetWidth}:{right:t.dom.offsetWidth}})});function n_(n){return Array.isArray(n)?n:[n]}function r_(n,e,t){for(;n.value&&n.from<=t;)n.from==t&&e.push(n.value),n.next()}class $4{constructor(e,t,i){this.gutter=e,this.height=i,this.localMarkers=[],this.i=0,this.cursor=We.iter(e.markers,t.from)}line(e,t,i){this.localMarkers.length&&(this.localMarkers=[]),r_(this.cursor,this.localMarkers,t.from);let r=i.length?this.localMarkers.concat(i):this.localMarkers,s=this.gutter.config.lineMarker(e,t,r);s&&r.unshift(s);let o=this.gutter;if(r.length==0&&!o.config.renderEmptyElements)return;let l=t.top-this.height;if(this.i==o.elements.length){let a=new o_(e,t.height,l,r);o.elements.push(a),o.dom.appendChild(a.dom)}else o.elements[this.i].update(e,t.height,l,r);this.height=t.bottom,this.i++}finish(){let e=this.gutter;for(;e.elements.length>this.i;){let t=e.elements.pop();e.dom.removeChild(t.dom),t.destroy()}}}class s_{constructor(e,t){this.view=e,this.config=t,this.elements=[],this.spacer=null,this.dom=document.createElement("div"),this.dom.className="cm-gutter"+(this.config.class?" "+this.config.class:"");for(let i in t.domEventHandlers)this.dom.addEventListener(i,r=>{let s=e.lineBlockAtHeight(r.clientY-e.documentTop);t.domEventHandlers[i](e,s,r)&&r.preventDefault()});this.markers=n_(t.markers(e)),t.initialSpacer&&(this.spacer=new o_(e,0,0,[t.initialSpacer(e)]),this.dom.appendChild(this.spacer.dom),this.spacer.dom.style.cssText+="visibility: hidden; pointer-events: none")}update(e){let t=this.markers;if(this.markers=n_(this.config.markers(e.view)),this.spacer&&this.config.updateSpacer){let r=this.config.updateSpacer(this.spacer.markers[0],e);r!=this.spacer.markers[0]&&this.spacer.update(e.view,0,0,[r])}let i=e.view.viewport;return!We.eq(this.markers,t,i.from,i.to)||(this.config.lineMarkerChange?this.config.lineMarkerChange(e):!1)}destroy(){for(let e of this.elements)e.destroy()}}class o_{constructor(e,t,i,r){this.height=-1,this.above=0,this.markers=[],this.dom=document.createElement("div"),this.update(e,t,i,r)}update(e,t,i,r){this.height!=t&&(this.dom.style.height=(this.height=t)+"px"),this.above!=i&&(this.dom.style.marginTop=(this.above=i)?i+"px":""),U4(this.markers,r)||this.setMarkers(e,r)}setMarkers(e,t){let i="cm-gutterElement",r=this.dom.firstChild;for(let s=0,o=0;;){let l=o,a=s<t.length?t[s++]:null,h=!1;if(a){let c=a.elementClass;c&&(i+=" "+c);for(let u=o;u<this.markers.length;u++)if(this.markers[u].compare(a)){l=u,h=!0;break}}else l=this.markers.length;for(;o<l;){let c=this.markers[o++];if(c.toDOM){c.destroy(r);let u=r.nextSibling;r.remove(),r=u}}if(!a)break;a.toDOM&&(h?r=r.nextSibling:this.dom.insertBefore(a.toDOM(e),r)),h&&o++}this.dom.className=i,this.markers=t}destroy(){this.setMarkers(null,[])}}function U4(n,e){if(n.length!=e.length)return!1;for(let t=0;t<n.length;t++)if(!n[t].compare(e[t]))return!1;return!0}const q4=he.define(),wl=he.define({combine(n){return nr(n,{formatNumber:String,domEventHandlers:{}},{domEventHandlers(e,t){let i=Object.assign({},e);for(let r in t){let s=i[r],o=t[r];i[r]=s?(l,a,h)=>s(l,a,h)||o(l,a,h):o}return i}})}});class ey extends ar{constructor(e){super(),this.number=e}eq(e){return this.number==e.number}toDOM(){return document.createTextNode(this.number)}}function ty(n,e){return n.state.facet(wl).formatNumber(e,n.state)}const K4=ah.compute([wl],n=>({class:"cm-lineNumbers",renderEmptyElements:!1,markers(e){return e.state.facet(q4)},lineMarker(e,t,i){return i.some(r=>r.toDOM)?null:new ey(ty(e,e.state.doc.lineAt(t.from).number))},lineMarkerChange:e=>e.startState.facet(wl)!=e.state.facet(wl),initialSpacer(e){return new ey(ty(e,l_(e.state.doc.lines)))},updateSpacer(e,t){let i=ty(t.view,l_(t.view.state.doc.lines));return i==e.number?e:new ey(i)},domEventHandlers:n.facet(wl).domEventHandlers}));function G4(n={}){return[wl.of(n),i_(),K4]}function l_(n){let e=9;for(;e<n;)e=e*10+9;return e}const J4=new class extends ar{constructor(){super(...arguments),this.elementClass="cm-activeLineGutter"}},Z4=Ku.compute(["selection"],n=>{let e=[],t=-1;for(let i of n.selection.ranges)if(i.empty){let r=n.doc.lineAt(i.head).from;r>t&&(t=r,e.push(J4.range(r)))}return We.of(e)});function Y4(){return Z4}const j6={HeightMap:ji,HeightOracle:C2,MeasuredHeights:A2,QueryType:rt,ChangedRange:or,computeOrder:$O,moveVisually:KO},X4=1024;let Q4=0;class Cn{constructor(e,t){this.from=e,this.to=t}}class Pe{constructor(e={}){this.id=Q4++,this.perNode=!!e.perNode,this.deserialize=e.deserialize||(()=>{throw new Error("This node type doesn't define a deserialize function")})}add(e){if(this.perNode)throw new RangeError("Can't add per-node props to node types");return typeof e!="function"&&(e=Ji.match(e)),t=>{let i=e(t);return i===void 0?null:[this,i]}}}Pe.closedBy=new Pe({deserialize:n=>n.split(" ")}),Pe.openedBy=new Pe({deserialize:n=>n.split(" ")}),Pe.group=new Pe({deserialize:n=>n.split(" ")}),Pe.contextHash=new Pe({perNode:!0}),Pe.lookAhead=new Pe({perNode:!0}),Pe.mounted=new Pe({perNode:!0});class eH{constructor(e,t,i){this.tree=e,this.overlay=t,this.parser=i}}const tH=Object.create(null);class Ji{constructor(e,t,i,r=0){this.name=e,this.props=t,this.id=i,this.flags=r}static define(e){let t=e.props&&e.props.length?Object.create(null):tH,i=(e.top?1:0)|(e.skipped?2:0)|(e.error?4:0)|(e.name==null?8:0),r=new Ji(e.name||"",t,e.id,i);if(e.props){for(let s of e.props)if(Array.isArray(s)||(s=s(r)),s){if(s[0].perNode)throw new RangeError("Can't store a per-node prop on a node type");t[s[0].id]=s[1]}}return r}prop(e){return this.props[e.id]}get isTop(){return(this.flags&1)>0}get isSkipped(){return(this.flags&2)>0}get isError(){return(this.flags&4)>0}get isAnonymous(){return(this.flags&8)>0}is(e){if(typeof e=="string"){if(this.name==e)return!0;let t=this.prop(Pe.group);return t?t.indexOf(e)>-1:!1}return this.id==e}static match(e){let t=Object.create(null);for(let i in e)for(let r of i.split(" "))t[r]=e[i];return i=>{for(let r=i.prop(Pe.group),s=-1;s<(r?r.length:0);s++){let o=t[s<0?i.name:r[s]];if(o)return o}}}}Ji.none=new Ji("",Object.create(null),0,8);class iy{constructor(e){this.types=e;for(let t=0;t<e.length;t++)if(e[t].id!=t)throw new RangeError("Node type ids should correspond to array positions when creating a node set")}extend(...e){let t=[];for(let i of this.types){let r=null;for(let s of e){let o=s(i);o&&(r||(r=Object.assign({},i.props)),r[o[0].id]=o[1])}t.push(r?new Ji(i.name,r,i.id,i.flags):i)}return new iy(t)}}const Gu=new WeakMap,a_=new WeakMap;var Tt;(function(n){n[n.ExcludeBuffers=1]="ExcludeBuffers",n[n.IncludeAnonymous=2]="IncludeAnonymous",n[n.IgnoreMounts=4]="IgnoreMounts",n[n.IgnoreOverlays=8]="IgnoreOverlays"})(Tt||(Tt={}));class Ut{constructor(e,t,i,r,s){if(this.type=e,this.children=t,this.positions=i,this.length=r,this.props=null,s&&s.length){this.props=Object.create(null);for(let[o,l]of s)this.props[typeof o=="number"?o:o.id]=l}}toString(){let e=this.prop(Pe.mounted);if(e&&!e.overlay)return e.tree.toString();let t="";for(let i of this.children){let r=i.toString();r&&(t&&(t+=","),t+=r)}return this.type.name?(/\W/.test(this.type.name)&&!this.type.isError?JSON.stringify(this.type.name):this.type.name)+(t.length?"("+t+")":""):t}cursor(e=0){return new hh(this.topNode,e)}cursorAt(e,t=0,i=0){let r=Gu.get(this)||this.topNode,s=new hh(r);return s.moveTo(e,t),Gu.set(this,s._tree),s}get topNode(){return new An(this,0,0,null)}resolve(e,t=0){let i=bl(Gu.get(this)||this.topNode,e,t,!1);return Gu.set(this,i),i}resolveInner(e,t=0){let i=bl(a_.get(this)||this.topNode,e,t,!0);return a_.set(this,i),i}iterate(e){let{enter:t,leave:i,from:r=0,to:s=this.length}=e;for(let o=this.cursor((e.mode||0)|Tt.IncludeAnonymous);;){let l=!1;if(o.from<=s&&o.to>=r&&(o.type.isAnonymous||t(o)!==!1)){if(o.firstChild())continue;l=!0}for(;l&&i&&!o.type.isAnonymous&&i(o),!o.nextSibling();){if(!o.parent())return;l=!0}}}prop(e){return e.perNode?this.props?this.props[e.id]:void 0:this.type.prop(e)}get propValues(){let e=[];if(this.props)for(let t in this.props)e.push([+t,this.props[t]]);return e}balance(e={}){return this.children.length<=8?this:sy(Ji.none,this.children,this.positions,0,this.children.length,0,this.length,(t,i,r)=>new Ut(this.type,t,i,r,this.propValues),e.makeTree||((t,i,r)=>new Ut(Ji.none,t,i,r)))}static build(e){return nH(e)}}Ut.empty=new Ut(Ji.none,[],[],0);class ny{constructor(e,t){this.buffer=e,this.index=t}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}get pos(){return this.index}next(){this.index-=4}fork(){return new ny(this.buffer,this.index)}}class vo{constructor(e,t,i){this.buffer=e,this.length=t,this.set=i}get type(){return Ji.none}toString(){let e=[];for(let t=0;t<this.buffer.length;)e.push(this.childString(t)),t=this.buffer[t+3];return e.join(",")}childString(e){let t=this.buffer[e],i=this.buffer[e+3],r=this.set.types[t],s=r.name;if(/\W/.test(s)&&!r.isError&&(s=JSON.stringify(s)),e+=4,i==e)return s;let o=[];for(;e<i;)o.push(this.childString(e)),e=this.buffer[e+3];return s+"("+o.join(",")+")"}findChild(e,t,i,r,s){let{buffer:o}=this,l=-1;for(let a=e;a!=t&&!(h_(s,r,o[a+1],o[a+2])&&(l=a,i>0));a=o[a+3]);return l}slice(e,t,i,r){let s=this.buffer,o=new Uint16Array(t-e);for(let l=e,a=0;l<t;)o[a++]=s[l++],o[a++]=s[l++]-i,o[a++]=s[l++]-i,o[a++]=s[l++]-e;return new vo(o,r-i,this.set)}}function h_(n,e,t,i){switch(n){case-2:return t<e;case-1:return i>=e&&t<e;case 0:return t<e&&i>e;case 1:return t<=e&&i>e;case 2:return i>e;case 4:return!0}}function c_(n,e){let t=n.childBefore(e);for(;t;){let i=t.lastChild;if(!i||i.to!=t.to)break;i.type.isError&&i.from==i.to?(n=t,t=i.prevSibling):t=i}return n}function bl(n,e,t,i){for(var r;n.from==n.to||(t<1?n.from>=e:n.from>e)||(t>-1?n.to<=e:n.to<e);){let o=!i&&n instanceof An&&n.index<0?null:n.parent;if(!o)return n;n=o}let s=i?0:Tt.IgnoreOverlays;if(i)for(let o=n,l=o.parent;l;o=l,l=o.parent)o instanceof An&&o.index<0&&((r=l.enter(e,t,s))===null||r===void 0?void 0:r.from)!=o.from&&(n=l);for(;;){let o=n.enter(e,t,s);if(!o)return n;n=o}}class An{constructor(e,t,i,r){this._tree=e,this.from=t,this.index=i,this._parent=r}get type(){return this._tree.type}get name(){return this._tree.type.name}get to(){return this.from+this._tree.length}nextChild(e,t,i,r,s=0){for(let o=this;;){for(let{children:l,positions:a}=o._tree,h=t>0?l.length:-1;e!=h;e+=t){let c=l[e],u=a[e]+o.from;if(!!h_(r,i,u,u+c.length)){if(c instanceof vo){if(s&Tt.ExcludeBuffers)continue;let f=c.findChild(0,c.buffer.length,t,i-u,r);if(f>-1)return new hr(new iH(o,c,e,u),null,f)}else if(s&Tt.IncludeAnonymous||!c.type.isAnonymous||ry(c)){let f;if(!(s&Tt.IgnoreMounts)&&c.props&&(f=c.prop(Pe.mounted))&&!f.overlay)return new An(f.tree,u,e,o);let d=new An(c,u,e,o);return s&Tt.IncludeAnonymous||!d.type.isAnonymous?d:d.nextChild(t<0?c.children.length-1:0,t,i,r)}}}if(s&Tt.IncludeAnonymous||!o.type.isAnonymous||(o.index>=0?e=o.index+t:e=t<0?-1:o._parent._tree.children.length,o=o._parent,!o))return null}}get firstChild(){return this.nextChild(0,1,0,4)}get lastChild(){return this.nextChild(this._tree.children.length-1,-1,0,4)}childAfter(e){return this.nextChild(0,1,e,2)}childBefore(e){return this.nextChild(this._tree.children.length-1,-1,e,-2)}enter(e,t,i=0){let r;if(!(i&Tt.IgnoreOverlays)&&(r=this._tree.prop(Pe.mounted))&&r.overlay){let s=e-this.from;for(let{from:o,to:l}of r.overlay)if((t>0?o<=s:o<s)&&(t<0?l>=s:l>s))return new An(r.tree,r.overlay[0].from+this.from,-1,this)}return this.nextChild(0,1,e,t,i)}nextSignificantParent(){let e=this;for(;e.type.isAnonymous&&e._parent;)e=e._parent;return e}get parent(){return this._parent?this._parent.nextSignificantParent():null}get nextSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index+1,1,0,4):null}get prevSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index-1,-1,0,4):null}cursor(e=0){return new hh(this,e)}get tree(){return this._tree}toTree(){return this._tree}resolve(e,t=0){return bl(this,e,t,!1)}resolveInner(e,t=0){return bl(this,e,t,!0)}enterUnfinishedNodesBefore(e){return c_(this,e)}getChild(e,t=null,i=null){let r=Ju(this,e,t,i);return r.length?r[0]:null}getChildren(e,t=null,i=null){return Ju(this,e,t,i)}toString(){return this._tree.toString()}get node(){return this}matchContext(e){return Zu(this,e)}}function Ju(n,e,t,i){let r=n.cursor(),s=[];if(!r.firstChild())return s;if(t!=null){for(;!r.type.is(t);)if(!r.nextSibling())return s}for(;;){if(i!=null&&r.type.is(i))return s;if(r.type.is(e)&&s.push(r.node),!r.nextSibling())return i==null?s:[]}}function Zu(n,e,t=e.length-1){for(let i=n.parent;t>=0;i=i.parent){if(!i)return!1;if(!i.type.isAnonymous){if(e[t]&&e[t]!=i.name)return!1;t--}}return!0}class iH{constructor(e,t,i,r){this.parent=e,this.buffer=t,this.index=i,this.start=r}}class hr{constructor(e,t,i){this.context=e,this._parent=t,this.index=i,this.type=e.buffer.set.types[e.buffer.buffer[i]]}get name(){return this.type.name}get from(){return this.context.start+this.context.buffer.buffer[this.index+1]}get to(){return this.context.start+this.context.buffer.buffer[this.index+2]}child(e,t,i){let{buffer:r}=this.context,s=r.findChild(this.index+4,r.buffer[this.index+3],e,t-this.context.start,i);return s<0?null:new hr(this.context,this,s)}get firstChild(){return this.child(1,0,4)}get lastChild(){return this.child(-1,0,4)}childAfter(e){return this.child(1,e,2)}childBefore(e){return this.child(-1,e,-2)}enter(e,t,i=0){if(i&Tt.ExcludeBuffers)return null;let{buffer:r}=this.context,s=r.findChild(this.index+4,r.buffer[this.index+3],t>0?1:-1,e-this.context.start,t);return s<0?null:new hr(this.context,this,s)}get parent(){return this._parent||this.context.parent.nextSignificantParent()}externalSibling(e){return this._parent?null:this.context.parent.nextChild(this.context.index+e,e,0,4)}get nextSibling(){let{buffer:e}=this.context,t=e.buffer[this.index+3];return t<(this._parent?e.buffer[this._parent.index+3]:e.buffer.length)?new hr(this.context,this._parent,t):this.externalSibling(1)}get prevSibling(){let{buffer:e}=this.context,t=this._parent?this._parent.index+4:0;return this.index==t?this.externalSibling(-1):new hr(this.context,this._parent,e.findChild(t,this.index,-1,0,4))}cursor(e=0){return new hh(this,e)}get tree(){return null}toTree(){let e=[],t=[],{buffer:i}=this.context,r=this.index+4,s=i.buffer[this.index+3];if(s>r){let o=i.buffer[this.index+1],l=i.buffer[this.index+2];e.push(i.slice(r,s,o,l)),t.push(0)}return new Ut(this.type,e,t,this.to-this.from)}resolve(e,t=0){return bl(this,e,t,!1)}resolveInner(e,t=0){return bl(this,e,t,!0)}enterUnfinishedNodesBefore(e){return c_(this,e)}toString(){return this.context.buffer.childString(this.index)}getChild(e,t=null,i=null){let r=Ju(this,e,t,i);return r.length?r[0]:null}getChildren(e,t=null,i=null){return Ju(this,e,t,i)}get node(){return this}matchContext(e){return Zu(this,e)}}class hh{constructor(e,t=0){if(this.mode=t,this.buffer=null,this.stack=[],this.index=0,this.bufferNode=null,e instanceof An)this.yieldNode(e);else{this._tree=e.context.parent,this.buffer=e.context;for(let i=e._parent;i;i=i._parent)this.stack.unshift(i.index);this.bufferNode=e,this.yieldBuf(e.index)}}get name(){return this.type.name}yieldNode(e){return e?(this._tree=e,this.type=e.type,this.from=e.from,this.to=e.to,!0):!1}yieldBuf(e,t){this.index=e;let{start:i,buffer:r}=this.buffer;return this.type=t||r.set.types[r.buffer[e]],this.from=i+r.buffer[e+1],this.to=i+r.buffer[e+2],!0}yield(e){return e?e instanceof An?(this.buffer=null,this.yieldNode(e)):(this.buffer=e.context,this.yieldBuf(e.index,e.type)):!1}toString(){return this.buffer?this.buffer.buffer.childString(this.index):this._tree.toString()}enterChild(e,t,i){if(!this.buffer)return this.yield(this._tree.nextChild(e<0?this._tree._tree.children.length-1:0,e,t,i,this.mode));let{buffer:r}=this.buffer,s=r.findChild(this.index+4,r.buffer[this.index+3],e,t-this.buffer.start,i);return s<0?!1:(this.stack.push(this.index),this.yieldBuf(s))}firstChild(){return this.enterChild(1,0,4)}lastChild(){return this.enterChild(-1,0,4)}childAfter(e){return this.enterChild(1,e,2)}childBefore(e){return this.enterChild(-1,e,-2)}enter(e,t,i=this.mode){return this.buffer?i&Tt.ExcludeBuffers?!1:this.enterChild(1,e,t):this.yield(this._tree.enter(e,t,i))}parent(){if(!this.buffer)return this.yieldNode(this.mode&Tt.IncludeAnonymous?this._tree._parent:this._tree.parent);if(this.stack.length)return this.yieldBuf(this.stack.pop());let e=this.mode&Tt.IncludeAnonymous?this.buffer.parent:this.buffer.parent.nextSignificantParent();return this.buffer=null,this.yieldNode(e)}sibling(e){if(!this.buffer)return this._tree._parent?this.yield(this._tree.index<0?null:this._tree._parent.nextChild(this._tree.index+e,e,0,4,this.mode)):!1;let{buffer:t}=this.buffer,i=this.stack.length-1;if(e<0){let r=i<0?0:this.stack[i]+4;if(this.index!=r)return this.yieldBuf(t.findChild(r,this.index,-1,0,4))}else{let r=t.buffer[this.index+3];if(r<(i<0?t.buffer.length:t.buffer[this.stack[i]+3]))return this.yieldBuf(r)}return i<0?this.yield(this.buffer.parent.nextChild(this.buffer.index+e,e,0,4,this.mode)):!1}nextSibling(){return this.sibling(1)}prevSibling(){return this.sibling(-1)}atLastNode(e){let t,i,{buffer:r}=this;if(r){if(e>0){if(this.index<r.buffer.buffer.length)return!1}else for(let s=0;s<this.index;s++)if(r.buffer.buffer[s+3]<this.index)return!1;({index:t,parent:i}=r)}else({index:t,_parent:i}=this._tree);for(;i;{index:t,_parent:i}=i)if(t>-1)for(let s=t+e,o=e<0?-1:i._tree.children.length;s!=o;s+=e){let l=i._tree.children[s];if(this.mode&Tt.IncludeAnonymous||l instanceof vo||!l.type.isAnonymous||ry(l))return!1}return!0}move(e,t){if(t&&this.enterChild(e,0,4))return!0;for(;;){if(this.sibling(e))return!0;if(this.atLastNode(e)||!this.parent())return!1}}next(e=!0){return this.move(1,e)}prev(e=!0){return this.move(-1,e)}moveTo(e,t=0){for(;(this.from==this.to||(t<1?this.from>=e:this.from>e)||(t>-1?this.to<=e:this.to<e))&&this.parent(););for(;this.enterChild(1,e,t););return this}get node(){if(!this.buffer)return this._tree;let e=this.bufferNode,t=null,i=0;if(e&&e.context==this.buffer){e:for(let r=this.index,s=this.stack.length;s>=0;){for(let o=e;o;o=o._parent)if(o.index==r){if(r==this.index)return o;t=o,i=s+1;break e}r=this.stack[--s]}}for(let r=i;r<this.stack.length;r++)t=new hr(this.buffer,t,this.stack[r]);return this.bufferNode=new hr(this.buffer,t,this.index)}get tree(){return this.buffer?null:this._tree._tree}iterate(e,t){for(let i=0;;){let r=!1;if(this.type.isAnonymous||e(this)!==!1){if(this.firstChild()){i++;continue}this.type.isAnonymous||(r=!0)}for(;r&&t&&t(this),r=this.type.isAnonymous,!this.nextSibling();){if(!i)return;this.parent(),i--,r=!0}}}matchContext(e){if(!this.buffer)return Zu(this.node,e);let{buffer:t}=this.buffer,{types:i}=t.set;for(let r=e.length-1,s=this.stack.length-1;r>=0;s--){if(s<0)return Zu(this.node,e,r);let o=i[t.buffer[this.stack[s]]];if(!o.isAnonymous){if(e[r]&&e[r]!=o.name)return!1;r--}}return!0}}function ry(n){return n.children.some(e=>e instanceof vo||!e.type.isAnonymous||ry(e))}function nH(n){var e;let{buffer:t,nodeSet:i,maxBufferLength:r=X4,reused:s=[],minRepeatType:o=i.types.length}=n,l=Array.isArray(t)?new ny(t,t.length):t,a=i.types,h=0,c=0;function u(b,S,k,A,_){let{id:O,start:D,end:T,size:B}=l,N=c;for(;B<0;)if(l.next(),B==-1){let ie=s[O];k.push(ie),A.push(D-b);return}else if(B==-3){h=O;return}else if(B==-4){c=O;return}else throw new RangeError(`Unrecognized record size: ${B}`);let ne=a[O],W,J,re=D-b;if(T-D<=r&&(J=g(l.pos-S,_))){let ie=new Uint16Array(J.size-J.skip),Ce=l.pos-J.size,Oe=ie.length;for(;l.pos>Ce;)Oe=y(J.start,ie,Oe);W=new vo(ie,T-J.start,i),re=J.start-b}else{let ie=l.pos-B;l.next();let Ce=[],Oe=[],Ve=O>=o?O:-1,st=0,jt=T;for(;l.pos>ie;)Ve>=0&&l.id==Ve&&l.size>=0?(l.end<=jt-r&&(d(Ce,Oe,D,st,l.end,jt,Ve,N),st=Ce.length,jt=l.end),l.next()):u(D,ie,Ce,Oe,Ve);if(Ve>=0&&st>0&&st<Ce.length&&d(Ce,Oe,D,st,D,jt,Ve,N),Ce.reverse(),Oe.reverse(),Ve>-1&&st>0){let vr=f(ne);W=sy(ne,Ce,Oe,0,Ce.length,0,T-D,vr,vr)}else W=p(ne,Ce,Oe,T-D,N-T)}k.push(W),A.push(re)}function f(b){return(S,k,A)=>{let _=0,O=S.length-1,D,T;if(O>=0&&(D=S[O])instanceof Ut){if(!O&&D.type==b&&D.length==A)return D;(T=D.prop(Pe.lookAhead))&&(_=k[O]+D.length+T)}return p(b,S,k,A,_)}}function d(b,S,k,A,_,O,D,T){let B=[],N=[];for(;b.length>A;)B.push(b.pop()),N.push(S.pop()+k-_);b.push(p(i.types[D],B,N,O-_,T-O)),S.push(_-k)}function p(b,S,k,A,_=0,O){if(h){let D=[Pe.contextHash,h];O=O?[D].concat(O):[D]}if(_>25){let D=[Pe.lookAhead,_];O=O?[D].concat(O):[D]}return new Ut(b,S,k,A,O)}function g(b,S){let k=l.fork(),A=0,_=0,O=0,D=k.end-r,T={size:0,start:0,skip:0};e:for(let B=k.pos-b;k.pos>B;){let N=k.size;if(k.id==S&&N>=0){T.size=A,T.start=_,T.skip=O,O+=4,A+=4,k.next();continue}let ne=k.pos-N;if(N<0||ne<B||k.start<D)break;let W=k.id>=o?4:0,J=k.start;for(k.next();k.pos>ne;){if(k.size<0)if(k.size==-3)W+=4;else break e;else k.id>=o&&(W+=4);k.next()}_=J,A+=N,O+=W}return(S<0||A==b)&&(T.size=A,T.start=_,T.skip=O),T.size>4?T:void 0}function y(b,S,k){let{id:A,start:_,end:O,size:D}=l;if(l.next(),D>=0&&A<o){let T=k;if(D>4){let B=l.pos-(D-4);for(;l.pos>B;)k=y(b,S,k)}S[--k]=T,S[--k]=O-b,S[--k]=_-b,S[--k]=A}else D==-3?h=A:D==-4&&(c=A);return k}let v=[],C=[];for(;l.pos>0;)u(n.start||0,n.bufferStart||0,v,C,-1);let x=(e=n.length)!==null&&e!==void 0?e:v.length?C[0]+v[0].length:0;return new Ut(a[n.topID],v.reverse(),C.reverse(),x)}const u_=new WeakMap;function Yu(n,e){if(!n.isAnonymous||e instanceof vo||e.type!=n)return 1;let t=u_.get(e);if(t==null){t=1;for(let i of e.children){if(i.type!=n||!(i instanceof Ut)){t=1;break}t+=Yu(n,i)}u_.set(e,t)}return t}function sy(n,e,t,i,r,s,o,l,a){let h=0;for(let p=i;p<r;p++)h+=Yu(n,e[p]);let c=Math.ceil(h*1.5/8),u=[],f=[];function d(p,g,y,v,C){for(let x=y;x<v;){let b=x,S=g[x],k=Yu(n,p[x]);for(x++;x<v;x++){let A=Yu(n,p[x]);if(k+A>=c)break;k+=A}if(x==b+1){if(k>c){let A=p[b];d(A.children,A.positions,0,A.children.length,g[b]+C);continue}u.push(p[b])}else{let A=g[x-1]+p[x-1].length-S;u.push(sy(n,p,g,b,x,S,A,null,a))}f.push(S+C-s)}}return d(e,t,i,r,0),(l||a)(u,f,o)}class $6{constructor(){this.map=new WeakMap}setBuffer(e,t,i){let r=this.map.get(e);r||this.map.set(e,r=new Map),r.set(t,i)}getBuffer(e,t){let i=this.map.get(e);return i&&i.get(t)}set(e,t){e instanceof hr?this.setBuffer(e.context.buffer,e.index,t):e instanceof An&&this.map.set(e.tree,t)}get(e){return e instanceof hr?this.getBuffer(e.context.buffer,e.index):e instanceof An?this.map.get(e.tree):void 0}cursorSet(e,t){e.buffer?this.setBuffer(e.buffer.buffer,e.index,t):this.map.set(e.tree,t)}cursorGet(e){return e.buffer?this.getBuffer(e.buffer.buffer,e.index):this.map.get(e.tree)}}class Fr{constructor(e,t,i,r,s=!1,o=!1){this.from=e,this.to=t,this.tree=i,this.offset=r,this.open=(s?1:0)|(o?2:0)}get openStart(){return(this.open&1)>0}get openEnd(){return(this.open&2)>0}static addTree(e,t=[],i=!1){let r=[new Fr(0,e.length,e,0,!1,i)];for(let s of t)s.to>e.length&&r.push(s);return r}static applyChanges(e,t,i=128){if(!t.length)return e;let r=[],s=1,o=e.length?e[0]:null;for(let l=0,a=0,h=0;;l++){let c=l<t.length?t[l]:null,u=c?c.fromA:1e9;if(u-a>=i)for(;o&&o.from<u;){let f=o;if(a>=f.from||u<=f.to||h){let d=Math.max(f.from,a)-h,p=Math.min(f.to,u)-h;f=d>=p?null:new Fr(d,p,f.tree,f.offset+h,l>0,!!c)}if(f&&r.push(f),o.to>u)break;o=s<e.length?e[s++]:null}if(!c)break;a=c.toA,h=c.toA-c.toB}return r}}class rH{startParse(e,t,i){return typeof e=="string"&&(e=new sH(e)),i=i?i.length?i.map(r=>new Cn(r.from,r.to)):[new Cn(0,0)]:[new Cn(0,e.length)],this.createParse(e,t||[],i)}parse(e,t,i){let r=this.startParse(e,t,i);for(;;){let s=r.advance();if(s)return s}}}class sH{constructor(e){this.string=e}get length(){return this.string.length}chunk(e){return this.string.slice(e)}get lineChunks(){return!1}read(e,t){return this.string.slice(e,t)}}function U6(n){return(e,t,i,r)=>new lH(e,n,t,i,r)}class f_{constructor(e,t,i,r,s){this.parser=e,this.parse=t,this.overlay=i,this.target=r,this.ranges=s}}class oH{constructor(e,t,i,r,s,o,l){this.parser=e,this.predicate=t,this.mounts=i,this.index=r,this.start=s,this.target=o,this.prev=l,this.depth=0,this.ranges=[]}}const oy=new Pe({perNode:!0});class lH{constructor(e,t,i,r,s){this.nest=t,this.input=i,this.fragments=r,this.ranges=s,this.inner=[],this.innerDone=0,this.baseTree=null,this.stoppedAt=null,this.baseParse=e}advance(){if(this.baseParse){let i=this.baseParse.advance();if(!i)return null;if(this.baseParse=null,this.baseTree=i,this.startInner(),this.stoppedAt!=null)for(let r of this.inner)r.parse.stopAt(this.stoppedAt)}if(this.innerDone==this.inner.length){let i=this.baseTree;return this.stoppedAt!=null&&(i=new Ut(i.type,i.children,i.positions,i.length,i.propValues.concat([[oy,this.stoppedAt]]))),i}let e=this.inner[this.innerDone],t=e.parse.advance();if(t){this.innerDone++;let i=Object.assign(Object.create(null),e.target.props);i[Pe.mounted.id]=new eH(t,e.overlay,e.parser),e.target.props=i}return null}get parsedPos(){if(this.baseParse)return 0;let e=this.input.length;for(let t=this.innerDone;t<this.inner.length;t++)this.inner[t].ranges[0].from<e&&(e=Math.min(e,this.inner[t].parse.parsedPos));return e}stopAt(e){if(this.stoppedAt=e,this.baseParse)this.baseParse.stopAt(e);else for(let t=this.innerDone;t<this.inner.length;t++)this.inner[t].parse.stopAt(e)}startInner(){let e=new cH(this.fragments),t=null,i=null,r=new hh(new An(this.baseTree,this.ranges[0].from,0,null),Tt.IncludeAnonymous|Tt.IgnoreMounts);e:for(let s,o;this.stoppedAt==null||r.from<this.stoppedAt;){let l=!0,a;if(e.hasNode(r)){if(t){let h=t.mounts.find(c=>c.frag.from<=r.from&&c.frag.to>=r.to&&c.mount.overlay);if(h)for(let c of h.mount.overlay){let u=c.from+h.pos,f=c.to+h.pos;u>=r.from&&f<=r.to&&!t.ranges.some(d=>d.from<f&&d.to>u)&&t.ranges.push({from:u,to:f})}}l=!1}else if(i&&(o=aH(i.ranges,r.from,r.to)))l=o!=2;else if(!r.type.isAnonymous&&r.from<r.to&&(s=this.nest(r,this.input))){r.tree||hH(r);let h=e.findMounts(r.from,s.parser);if(typeof s.overlay=="function")t=new oH(s.parser,s.overlay,h,this.inner.length,r.from,r.tree,t);else{let c=m_(this.ranges,s.overlay||[new Cn(r.from,r.to)]);c.length&&this.inner.push(new f_(s.parser,s.parser.startParse(this.input,g_(h,c),c),s.overlay?s.overlay.map(u=>new Cn(u.from-r.from,u.to-r.from)):null,r.tree,c)),s.overlay?c.length&&(i={ranges:c,depth:0,prev:i}):l=!1}}else t&&(a=t.predicate(r))&&(a===!0&&(a=new Cn(r.from,r.to)),a.from<a.to&&t.ranges.push(a));if(l&&r.firstChild())t&&t.depth++,i&&i.depth++;else for(;!r.nextSibling();){if(!r.parent())break e;if(t&&!--t.depth){let h=m_(this.ranges,t.ranges);h.length&&this.inner.splice(t.index,0,new f_(t.parser,t.parser.startParse(this.input,g_(t.mounts,h),h),t.ranges.map(c=>new Cn(c.from-t.start,c.to-t.start)),t.target,h)),t=t.prev}i&&!--i.depth&&(i=i.prev)}}}}function aH(n,e,t){for(let i of n){if(i.from>=t)break;if(i.to>e)return i.from<=e&&i.to>=t?2:1}return 0}function d_(n,e,t,i,r,s){if(e<t){let o=n.buffer[e+1],l=n.buffer[t-2];i.push(n.slice(e,t,o,l)),r.push(o-s)}}function hH(n){let{node:e}=n,t=0;do n.parent(),t++;while(!n.tree);let i=0,r=n.tree,s=0;for(;s=r.positions[i]+n.from,!(s<=e.from&&s+r.children[i].length>=e.to);i++);let o=r.children[i],l=o.buffer;function a(h,c,u,f,d){let p=h;for(;l[p+2]+s<=e.from;)p=l[p+3];let g=[],y=[];d_(o,h,p,g,y,f);let v=l[p+1],C=l[p+2],x=v+s==e.from&&C+s==e.to&&l[p]==e.type.id;return g.push(x?e.toTree():a(p+4,l[p+3],o.set.types[l[p]],v,C-v)),y.push(v-f),d_(o,l[p+3],c,g,y,f),new Ut(u,g,y,d)}r.children[i]=a(0,l.length,Ji.none,0,o.length);for(let h=0;h<=t;h++)n.childAfter(e.from)}class p_{constructor(e,t){this.offset=t,this.done=!1,this.cursor=e.cursor(Tt.IncludeAnonymous|Tt.IgnoreMounts)}moveTo(e){let{cursor:t}=this,i=e-this.offset;for(;!this.done&&t.from<i;)t.to>=e&&t.enter(i,1,Tt.IgnoreOverlays|Tt.ExcludeBuffers)||t.next(!1)||(this.done=!0)}hasNode(e){if(this.moveTo(e.from),!this.done&&this.cursor.from+this.offset==e.from&&this.cursor.tree)for(let t=this.cursor.tree;;){if(t==e.tree)return!0;if(t.children.length&&t.positions[0]==0&&t.children[0]instanceof Ut)t=t.children[0];else break}return!1}}class cH{constructor(e){var t;if(this.fragments=e,this.curTo=0,this.fragI=0,e.length){let i=this.curFrag=e[0];this.curTo=(t=i.tree.prop(oy))!==null&&t!==void 0?t:i.to,this.inner=new p_(i.tree,-i.offset)}else this.curFrag=this.inner=null}hasNode(e){for(;this.curFrag&&e.from>=this.curTo;)this.nextFrag();return this.curFrag&&this.curFrag.from<=e.from&&this.curTo>=e.to&&this.inner.hasNode(e)}nextFrag(){var e;if(this.fragI++,this.fragI==this.fragments.length)this.curFrag=this.inner=null;else{let t=this.curFrag=this.fragments[this.fragI];this.curTo=(e=t.tree.prop(oy))!==null&&e!==void 0?e:t.to,this.inner=new p_(t.tree,-t.offset)}}findMounts(e,t){var i;let r=[];if(this.inner){this.inner.cursor.moveTo(e,1);for(let s=this.inner.cursor.node;s;s=s.parent){let o=(i=s.tree)===null||i===void 0?void 0:i.prop(Pe.mounted);if(o&&o.parser==t)for(let l=this.fragI;l<this.fragments.length;l++){let a=this.fragments[l];if(a.from>=s.to)break;a.tree==this.curFrag.tree&&r.push({frag:a,pos:s.from-a.offset,mount:o})}}}return r}}function m_(n,e){let t=null,i=e;for(let r=1,s=0;r<n.length;r++){let o=n[r-1].to,l=n[r].from;for(;s<i.length;s++){let a=i[s];if(a.from>=l)break;a.to<=o||(t||(i=t=e.slice()),a.from<o?(t[s]=new Cn(a.from,o),a.to>l&&t.splice(s+1,0,new Cn(l,a.to))):a.to>l?t[s--]=new Cn(l,a.to):t.splice(s--,1))}}return i}function uH(n,e,t,i){let r=0,s=0,o=!1,l=!1,a=-1e9,h=[];for(;;){let c=r==n.length?1e9:o?n[r].to:n[r].from,u=s==e.length?1e9:l?e[s].to:e[s].from;if(o!=l){let f=Math.max(a,t),d=Math.min(c,u,i);f<d&&h.push(new Cn(f,d))}if(a=Math.min(c,u),a==1e9)break;c==a&&(o?(o=!1,r++):o=!0),u==a&&(l?(l=!1,s++):l=!0)}return h}function g_(n,e){let t=[];for(let{pos:i,mount:r,frag:s}of n){let o=i+(r.overlay?r.overlay[0].from:0),l=o+r.tree.length,a=Math.max(s.from,o),h=Math.min(s.to,l);if(r.overlay){let c=r.overlay.map(f=>new Cn(f.from+i,f.to+i)),u=uH(e,c,a,h);for(let f=0,d=a;;f++){let p=f==u.length,g=p?h:u[f].from;if(g>d&&t.push(new Fr(d,g,r.tree,-o,s.from>=d,s.to<=g)),p)break;d=u[f].to}}else t.push(new Fr(a,h,r.tree,-o,s.from>=o,s.to<=l))}return t}let fH=0;class cr{constructor(e,t,i){this.set=e,this.base=t,this.modified=i,this.id=fH++}static define(e){if(e!=null&&e.base)throw new Error("Can not derive from a modified tag");let t=new cr([],null,[]);if(t.set.push(t),e)for(let i of e.set)t.set.push(i);return t}static defineModifier(){let e=new Xu;return t=>t.modified.indexOf(e)>-1?t:Xu.get(t.base||t,t.modified.concat(e).sort((i,r)=>i.id-r.id))}}let dH=0;class Xu{constructor(){this.instances=[],this.id=dH++}static get(e,t){if(!t.length)return e;let i=t[0].instances.find(l=>l.base==e&&pH(t,l.modified));if(i)return i;let r=[],s=new cr(r,e,t);for(let l of t)l.instances.push(s);let o=y_(t);for(let l of e.set)for(let a of o)r.push(Xu.get(l,a));return s}}function pH(n,e){return n.length==e.length&&n.every((t,i)=>t==e[i])}function y_(n){let e=[n];for(let t=0;t<n.length;t++)for(let i of y_(n.slice(0,t).concat(n.slice(t+1))))e.push(i);return e}function mH(n){let e=Object.create(null);for(let t in n){let i=n[t];Array.isArray(i)||(i=[i]);for(let r of t.split(" "))if(r){let s=[],o=2,l=r;for(let u=0;;){if(l=="..."&&u>0&&u+3==r.length){o=1;break}let f=/^"(?:[^"\\]|\\.)*?"|[^\/!]+/.exec(l);if(!f)throw new RangeError("Invalid path: "+r);if(s.push(f[0]=="*"?"":f[0][0]=='"'?JSON.parse(f[0]):f[0]),u+=f[0].length,u==r.length)break;let d=r[u++];if(u==r.length&&d=="!"){o=0;break}if(d!="/")throw new RangeError("Invalid path: "+r);l=r.slice(u)}let a=s.length-1,h=s[a];if(!h)throw new RangeError("Invalid path: "+r);let c=new gH(i,o,a>0?s.slice(0,a):null);e[h]=c.sort(e[h])}}return v_.add(e)}const v_=new Pe;class gH{constructor(e,t,i,r){this.tags=e,this.mode=t,this.context=i,this.next=r}sort(e){return!e||e.depth<this.depth?(this.next=e,this):(e.next=this.sort(e.next),e)}get depth(){return this.context?this.context.length:0}}function w_(n,e){let t=Object.create(null);for(let s of n)if(!Array.isArray(s.tag))t[s.tag.id]=s.class;else for(let o of s.tag)t[o.id]=s.class;let{scope:i,all:r=null}=e||{};return{style:s=>{let o=r;for(let l of s)for(let a of l.set){let h=t[a.id];if(h){o=o?o+" "+h:h;break}}return o},scope:i}}function yH(n,e){let t=null;for(let i of n){let r=i.style(e);r&&(t=t?t+" "+r:r)}return t}function vH(n,e,t,i=0,r=n.length){let s=new wH(i,Array.isArray(e)?e:[e],t);s.highlightRange(n.cursor(),i,r,"",s.highlighters),s.flush(r)}class wH{constructor(e,t,i){this.at=e,this.highlighters=t,this.span=i,this.class=""}startSpan(e,t){t!=this.class&&(this.flush(e),e>this.at&&(this.at=e),this.class=t)}flush(e){e>this.at&&this.class&&this.span(this.at,e,this.class)}highlightRange(e,t,i,r,s){let{type:o,from:l,to:a}=e;if(l>=i||a<=t)return;o.isTop&&(s=this.highlighters.filter(d=>!d.scope||d.scope(o)));let h=r,c=o.prop(v_),u=!1;for(;c;){if(!c.context||e.matchContext(c.context)){let d=yH(s,c.tags);d&&(h&&(h+=" "),h+=d,c.mode==1?r+=(r?" ":"")+d:c.mode==0&&(u=!0));break}c=c.next}if(this.startSpan(e.from,h),u)return;let f=e.tree&&e.tree.prop(Pe.mounted);if(f&&f.overlay){let d=e.node.enter(f.overlay[0].from+l,1),p=this.highlighters.filter(y=>!y.scope||y.scope(f.tree.type)),g=e.firstChild();for(let y=0,v=l;;y++){let C=y<f.overlay.length?f.overlay[y]:null,x=C?C.from+l:a,b=Math.max(t,v),S=Math.min(i,x);if(b<S&&g)for(;e.from<S&&(this.highlightRange(e,b,S,r,s),this.startSpan(Math.min(i,e.to),h),!(e.to>=x||!e.nextSibling())););if(!C||x>i)break;v=C.to+l,v>t&&(this.highlightRange(d.cursor(),Math.max(t,C.from+l),Math.min(i,v),r,p),this.startSpan(v,h))}g&&e.parent()}else if(e.firstChild()){do if(!(e.to<=t)){if(e.from>=i)break;this.highlightRange(e,t,i,r,s),this.startSpan(Math.min(i,e.to),h)}while(e.nextSibling());e.parent()}}}const q=cr.define,Qu=q(),Ms=q(),b_=q(Ms),x_=q(Ms),Es=q(),ef=q(Es),ly=q(Es),ur=q(),wo=q(ur),fr=q(),dr=q(),ay=q(),ch=q(ay),tf=q(),P={comment:Qu,lineComment:q(Qu),blockComment:q(Qu),docComment:q(Qu),name:Ms,variableName:q(Ms),typeName:b_,tagName:q(b_),propertyName:x_,attributeName:q(x_),className:q(Ms),labelName:q(Ms),namespace:q(Ms),macroName:q(Ms),literal:Es,string:ef,docString:q(ef),character:q(ef),attributeValue:q(ef),number:ly,integer:q(ly),float:q(ly),bool:q(Es),regexp:q(Es),escape:q(Es),color:q(Es),url:q(Es),keyword:fr,self:q(fr),null:q(fr),atom:q(fr),unit:q(fr),modifier:q(fr),operatorKeyword:q(fr),controlKeyword:q(fr),definitionKeyword:q(fr),moduleKeyword:q(fr),operator:dr,derefOperator:q(dr),arithmeticOperator:q(dr),logicOperator:q(dr),bitwiseOperator:q(dr),compareOperator:q(dr),updateOperator:q(dr),definitionOperator:q(dr),typeOperator:q(dr),controlOperator:q(dr),punctuation:ay,separator:q(ay),bracket:ch,angleBracket:q(ch),squareBracket:q(ch),paren:q(ch),brace:q(ch),content:ur,heading:wo,heading1:q(wo),heading2:q(wo),heading3:q(wo),heading4:q(wo),heading5:q(wo),heading6:q(wo),contentSeparator:q(ur),list:q(ur),quote:q(ur),emphasis:q(ur),strong:q(ur),link:q(ur),monospace:q(ur),strikethrough:q(ur),inserted:q(),deleted:q(),changed:q(),invalid:q(),meta:tf,documentMeta:q(tf),annotation:q(tf),processingInstruction:q(tf),definition:cr.defineModifier(),constant:cr.defineModifier(),function:cr.defineModifier(),standard:cr.defineModifier(),local:cr.defineModifier(),special:cr.defineModifier()},q6=w_([{tag:P.link,class:"tok-link"},{tag:P.heading,class:"tok-heading"},{tag:P.emphasis,class:"tok-emphasis"},{tag:P.strong,class:"tok-strong"},{tag:P.keyword,class:"tok-keyword"},{tag:P.atom,class:"tok-atom"},{tag:P.bool,class:"tok-bool"},{tag:P.url,class:"tok-url"},{tag:P.labelName,class:"tok-labelName"},{tag:P.inserted,class:"tok-inserted"},{tag:P.deleted,class:"tok-deleted"},{tag:P.literal,class:"tok-literal"},{tag:P.string,class:"tok-string"},{tag:P.number,class:"tok-number"},{tag:[P.regexp,P.escape,P.special(P.string)],class:"tok-string2"},{tag:P.variableName,class:"tok-variableName"},{tag:P.local(P.variableName),class:"tok-variableName tok-local"},{tag:P.definition(P.variableName),class:"tok-variableName tok-definition"},{tag:P.special(P.variableName),class:"tok-variableName2"},{tag:P.definition(P.propertyName),class:"tok-propertyName tok-definition"},{tag:P.typeName,class:"tok-typeName"},{tag:P.namespace,class:"tok-namespace"},{tag:P.className,class:"tok-className"},{tag:P.macroName,class:"tok-macroName"},{tag:P.propertyName,class:"tok-propertyName"},{tag:P.operator,class:"tok-operator"},{tag:P.comment,class:"tok-comment"},{tag:P.meta,class:"tok-meta"},{tag:P.invalid,class:"tok-invalid"},{tag:P.punctuation,class:"tok-punctuation"}]);var hy;const xl=new Pe;function S_(n){return Facet.define({combine:n?e=>e.concat(n):void 0})}class On{constructor(e,t,i=[]){this.data=e,Fe.prototype.hasOwnProperty("tree")||Object.defineProperty(Fe.prototype,"tree",{get(){return ei(this)}}),this.parser=t,this.extension=[Ts.of(this),Fe.languageData.of((r,s,o)=>r.facet(k_(r,s,o)))].concat(i)}isActiveAt(e,t,i=-1){return k_(e,t,i)==this.data}findRegions(e){let t=e.facet(Ts);if((t==null?void 0:t.data)==this.data)return[{from:0,to:e.doc.length}];if(!t||!t.allowsNesting)return[];let i=[],r=(s,o)=>{if(s.prop(xl)==this.data){i.push({from:o,to:o+s.length});return}let l=s.prop(Pe.mounted);if(l){if(l.tree.prop(xl)==this.data){if(l.overlay)for(let a of l.overlay)i.push({from:a.from+o,to:a.to+o});else i.push({from:o,to:o+s.length});return}else if(l.overlay){let a=i.length;if(r(l.tree,l.overlay[0].from+o),i.length>a)return}}for(let a=0;a<s.children.length;a++){let h=s.children[a];h instanceof Ut&&r(h,s.positions[a]+o)}};return r(ei(e),0),i}get allowsNesting(){return!0}}On.setState=ke.define();function k_(n,e,t){let i=n.facet(Ts);if(!i)return null;let r=i.data;if(i.allowsNesting)for(let s=ei(n).topNode;s;s=s.enter(e,t,Tt.ExcludeBuffers))r=s.type.prop(xl)||r;return r}class cy extends null{constructor(e,t){super(e,t),this.parser=t}static define(e){let t=S_(e.languageData);return new cy(t,e.parser.configure({props:[xl.add(i=>i.isTop?t:void 0)]}))}configure(e){return new cy(this.data,this.parser.configure(e))}get allowsNesting(){return this.parser.hasWrappers()}}function ei(n){let e=n.field(On.state,!1);return e?e.tree:Ut.empty}function bH(n,e,t=50){var i;let r=(i=n.field(On.state,!1))===null||i===void 0?void 0:i.context;return r&&(r.isDone(e)||r.work(t,e))?r.tree:null}function K6(n,e=n.doc.length){var t;return((t=n.field(On.state,!1))===null||t===void 0?void 0:t.context.isDone(e))||!1}function G6(n,e=n.viewport.to,t=100){let i=bH(n.state,e,t);return i!=ei(n.state)&&n.dispatch({}),!!i}function J6(n){var e;return((e=n.plugin(O_))===null||e===void 0?void 0:e.isWorking())||!1}class xH{constructor(e,t=e.length){this.doc=e,this.length=t,this.cursorPos=0,this.string="",this.cursor=e.iter()}syncTo(e){return this.string=this.cursor.next(e-this.cursorPos).value,this.cursorPos=e+this.string.length,this.cursorPos-this.string.length}chunk(e){return this.syncTo(e),this.string}get lineChunks(){return!0}read(e,t){let i=this.cursorPos-this.string.length;return e<i||t>=this.cursorPos?this.doc.sliceString(e,t):this.string.slice(e-i,t-i)}}let uh=null;class fh{constructor(e,t,i=[],r,s,o,l,a){this.parser=e,this.state=t,this.fragments=i,this.tree=r,this.treeLen=s,this.viewport=o,this.skipped=l,this.scheduleOn=a,this.parse=null,this.tempSkipped=[]}startParse(){return this.parser.startParse(new xH(this.state.doc),this.fragments)}work(e,t){return t!=null&&t>=this.state.doc.length&&(t=void 0),this.tree!=Ut.empty&&this.isDone(t!=null?t:this.state.doc.length)?(this.takeTree(),!0):this.withContext(()=>{var i;if(typeof e=="number"){let r=Date.now()+e;e=()=>Date.now()>r}for(this.parse||(this.parse=this.startParse()),t!=null&&(this.parse.stoppedAt==null||this.parse.stoppedAt>t)&&t<this.state.doc.length&&this.parse.stopAt(t);;){let r=this.parse.advance();if(r)if(this.fragments=this.withoutTempSkipped(Fr.addTree(r,this.fragments,this.parse.stoppedAt!=null)),this.treeLen=(i=this.parse.stoppedAt)!==null&&i!==void 0?i:this.state.doc.length,this.tree=r,this.parse=null,this.treeLen<(t!=null?t:this.state.doc.length))this.parse=this.startParse();else return!0;if(e())return!1}})}takeTree(){let e,t;this.parse&&(e=this.parse.parsedPos)>=this.treeLen&&((this.parse.stoppedAt==null||this.parse.stoppedAt>e)&&this.parse.stopAt(e),this.withContext(()=>{for(;!(t=this.parse.advance()););}),this.treeLen=e,this.tree=t,this.fragments=this.withoutTempSkipped(Fr.addTree(this.tree,this.fragments,!0)),this.parse=null)}withContext(e){let t=uh;uh=this;try{return e()}finally{uh=t}}withoutTempSkipped(e){for(let t;t=this.tempSkipped.pop();)e=C_(e,t.from,t.to);return e}changes(e,t){let{fragments:i,tree:r,treeLen:s,viewport:o,skipped:l}=this;if(this.takeTree(),!e.empty){let a=[];if(e.iterChangedRanges((h,c,u,f)=>a.push({fromA:h,toA:c,fromB:u,toB:f})),i=Fr.applyChanges(i,a),r=Ut.empty,s=0,o={from:e.mapPos(o.from,-1),to:e.mapPos(o.to,1)},this.skipped.length){l=[];for(let h of this.skipped){let c=e.mapPos(h.from,1),u=e.mapPos(h.to,-1);c<u&&l.push({from:c,to:u})}}}return new fh(this.parser,t,i,r,s,o,l,this.scheduleOn)}updateViewport(e){if(this.viewport.from==e.from&&this.viewport.to==e.to)return!1;this.viewport=e;let t=this.skipped.length;for(let i=0;i<this.skipped.length;i++){let{from:r,to:s}=this.skipped[i];r<e.to&&s>e.from&&(this.fragments=C_(this.fragments,r,s),this.skipped.splice(i--,1))}return this.skipped.length>=t?!1:(this.reset(),!0)}reset(){this.parse&&(this.takeTree(),this.parse=null)}skipUntilInView(e,t){this.skipped.push({from:e,to:t})}static getSkippingParser(e){return new class extends rH{createParse(t,i,r){let s=r[0].from,o=r[r.length-1].to;return{parsedPos:s,advance(){let a=uh;if(a){for(let h of r)a.tempSkipped.push(h);e&&(a.scheduleOn=a.scheduleOn?Promise.all([a.scheduleOn,e]):e)}return this.parsedPos=o,new Ut(Ji.none,[],[],o-s)},stoppedAt:null,stopAt(){}}}}}isDone(e){e=Math.min(e,this.state.doc.length);let t=this.fragments;return this.treeLen>=e&&t.length&&t[0].from==0&&t[0].to>=e}static get(){return uh}}function C_(n,e,t){return Fr.applyChanges(n,[{fromA:e,toA:t,fromB:e,toB:t}])}class Sl{constructor(e){this.context=e,this.tree=e.tree}apply(e){if(!e.docChanged&&this.tree==this.context.tree)return this;let t=this.context.changes(e.changes,e.state),i=this.context.treeLen==e.startState.doc.length?void 0:Math.max(e.changes.mapPos(this.context.treeLen),t.viewport.to);return t.work(20,i)||t.takeTree(),new Sl(t)}static init(e){let t=Math.min(3e3,e.doc.length),i=new fh(e.facet(Ts).parser,e,[],Ut.empty,0,{from:0,to:t},[],null);return i.work(20,t)||i.takeTree(),new Sl(i)}}On.state=zt.define({create:Sl.init,update(n,e){for(let t of e.effects)if(t.is(On.setState))return t.value;return e.startState.facet(Ts)!=e.state.facet(Ts)?Sl.init(e.state):n.apply(e)}});let A_=n=>{let e=setTimeout(()=>n(),500);return()=>clearTimeout(e)};typeof requestIdleCallback!="undefined"&&(A_=n=>{let e=-1,t=setTimeout(()=>{e=requestIdleCallback(n,{timeout:500-100})},100);return()=>e<0?clearTimeout(t):cancelIdleCallback(e)});const uy=typeof navigator!="undefined"&&((hy=navigator.scheduling)===null||hy===void 0?void 0:hy.isInputPending)?()=>navigator.scheduling.isInputPending():null,O_=Nt.fromClass(class{constructor(e){this.view=e,this.working=null,this.workScheduled=0,this.chunkEnd=-1,this.chunkBudget=-1,this.work=this.work.bind(this),this.scheduleWork()}update(e){let t=this.view.state.field(On.state).context;(t.updateViewport(e.view.viewport)||this.view.viewport.to>t.treeLen)&&this.scheduleWork(),e.docChanged&&(this.view.hasFocus&&(this.chunkBudget+=50),this.scheduleWork()),this.checkAsyncSchedule(t)}scheduleWork(){if(this.working)return;let{state:e}=this.view,t=e.field(On.state);(t.tree!=t.context.tree||!t.context.isDone(e.doc.length))&&(this.working=A_(this.work))}work(e){this.working=null;let t=Date.now();if(this.chunkEnd<t&&(this.chunkEnd<0||this.view.hasFocus)&&(this.chunkEnd=t+3e4,this.chunkBudget=3e3),this.chunkBudget<=0)return;let{state:i,viewport:{to:r}}=this.view,s=i.field(On.state);if(s.tree==s.context.tree&&s.context.isDone(r+1e5))return;let o=Date.now()+Math.min(this.chunkBudget,100,e&&!uy?Math.max(25,e.timeRemaining()-5):1e9),l=s.context.treeLen<r&&i.doc.length>r+1e3,a=s.context.work(()=>uy&&uy()||Date.now()>o,r+(l?0:1e5));this.chunkBudget-=Date.now()-t,(a||this.chunkBudget<=0)&&(s.context.takeTree(),this.view.dispatch({effects:On.setState.of(new Sl(s.context))})),this.chunkBudget>0&&!(a&&!l)&&this.scheduleWork(),this.checkAsyncSchedule(s.context)}checkAsyncSchedule(e){e.scheduleOn&&(this.workScheduled++,e.scheduleOn.then(()=>this.scheduleWork()).catch(t=>dn(this.view.state,t)).then(()=>this.workScheduled--),e.scheduleOn=null)}destroy(){this.working&&this.working()}isWorking(){return!!(this.working||this.workScheduled>0)}},{eventHandlers:{focus(){this.scheduleWork()}}}),Ts=he.define({combine(n){return n.length?n[0]:null},enables:[On.state,O_]});class Z6{constructor(e,t=[]){this.language=e,this.support=t,this.extension=[e,t]}}class __{constructor(e,t,i,r,s,o=void 0){this.name=e,this.alias=t,this.extensions=i,this.filename=r,this.loadFunc=s,this.support=o,this.loading=null}load(){return this.loading||(this.loading=this.loadFunc().then(e=>this.support=e,e=>{throw this.loading=null,e}))}static of(e){let{load:t,support:i}=e;if(!t){if(!i)throw new RangeError("Must pass either 'load' or 'support' to LanguageDescription.of");t=()=>Promise.resolve(i)}return new __(e.name,(e.alias||[]).concat(e.name).map(r=>r.toLowerCase()),e.extensions||[],e.filename,t,i)}static matchFilename(e,t){for(let r of e)if(r.filename&&r.filename.test(t))return r;let i=/\.([^.]+)$/.exec(t);if(i){for(let r of e)if(r.extensions.indexOf(i[1])>-1)return r}return null}static matchLanguageName(e,t,i=!0){t=t.toLowerCase();for(let r of e)if(r.alias.some(s=>s==t))return r;if(i)for(let r of e)for(let s of r.alias){let o=t.indexOf(s);if(o>-1&&(s.length>2||!/\w/.test(t[o-1])&&!/\w/.test(t[o+s.length])))return r}return null}}const D_=he.define(),fy=he.define({combine:n=>{if(!n.length)return"  ";if(!/^(?: +|\t+)$/.test(n[0]))throw new Error("Invalid indent unit: "+JSON.stringify(n[0]));return n[0]}});function bo(n){let e=n.facet(fy);return e.charCodeAt(0)==9?n.tabSize*e.length:e.length}function dh(n,e){let t="",i=n.tabSize;if(n.facet(fy).charCodeAt(0)==9)for(;e>=i;)t+="	",e-=i;for(let r=0;r<e;r++)t+=" ";return t}function dy(n,e){n instanceof Fe&&(n=new nf(n));for(let i of n.state.facet(D_)){let r=i(n,e);if(r!=null)return r}let t=ei(n.state);return t?kH(n,t,e):null}class nf{constructor(e,t={}){this.state=e,this.options=t,this.unit=bo(e)}lineAt(e,t=1){let i=this.state.doc.lineAt(e),{simulateBreak:r,simulateDoubleBreak:s}=this.options;return r!=null&&r>=i.from&&r<=i.to?s&&r==e?{text:"",from:e}:(t<0?r<e:r<=e)?{text:i.text.slice(r-i.from),from:r}:{text:i.text.slice(0,r-i.from),from:i.from}:i}textAfterPos(e,t=1){if(this.options.simulateDoubleBreak&&e==this.options.simulateBreak)return"";let{text:i,from:r}=this.lineAt(e,t);return i.slice(e-r,Math.min(i.length,e+100-r))}column(e,t=1){let{text:i,from:r}=this.lineAt(e,t),s=this.countColumn(i,e-r),o=this.options.overrideIndentation?this.options.overrideIndentation(r):-1;return o>-1&&(s+=o-this.countColumn(i,i.search(/\S|$/))),s}countColumn(e,t=e.length){return qa(e,this.state.tabSize,t)}lineIndent(e,t=1){let{text:i,from:r}=this.lineAt(e,t),s=this.options.overrideIndentation;if(s){let o=s(r);if(o>-1)return o}return this.countColumn(i,i.search(/\S|$/))}get simulatedBreak(){return this.options.simulateBreak||null}}const SH=new Pe;function kH(n,e,t){return M_(e.resolveInner(t).enterUnfinishedNodesBefore(t),t,n)}function CH(n){return n.pos==n.options.simulateBreak&&n.options.simulateDoubleBreak}function AH(n){let e=n.type.prop(SH);if(e)return e;let t=n.firstChild,i;if(t&&(i=t.type.prop(Pe.closedBy))){let r=n.lastChild,s=r&&i.indexOf(r.name)>-1;return o=>E_(o,!0,1,void 0,s&&!CH(o)?r.from:void 0)}return n.parent==null?OH:null}function M_(n,e,t){for(;n;n=n.parent){let i=AH(n);if(i)return i(new _H(t,e,n))}return null}function OH(){return 0}class _H extends nf{constructor(e,t,i){super(e.state,e.options),this.base=e,this.pos=t,this.node=i}get textAfter(){return this.textAfterPos(this.pos)}get baseIndent(){let e=this.state.doc.lineAt(this.node.from);for(;;){let t=this.node.resolve(e.from);for(;t.parent&&t.parent.from==t.from;)t=t.parent;if(DH(t,this.node))break;e=this.state.doc.lineAt(t.from)}return this.lineIndent(e.from)}continue(){let e=this.node.parent;return e?M_(e,this.pos,this.base):0}}function DH(n,e){for(let t=e;t;t=t.parent)if(n==t)return!0;return!1}function MH(n){let e=n.node,t=e.childAfter(e.from),i=e.lastChild;if(!t)return null;let r=n.options.simulateBreak,s=n.state.doc.lineAt(t.from),o=r==null||r<=s.from?s.to:Math.min(s.to,r);for(let l=t.to;;){let a=e.childAfter(l);if(!a||a==i)return null;if(!a.type.isSkipped)return a.from<o?t:null;l=a.to}}function Y6({closing:n,align:e=!0,units:t=1}){return i=>E_(i,e,t,n)}function E_(n,e,t,i,r){let s=n.textAfter,o=s.match(/^\s*/)[0].length,l=i&&s.slice(o,o+i.length)==i||r==n.pos+o,a=e?MH(n):null;return a?l?n.column(a.from):n.column(a.to):n.baseIndent+(l?0:n.unit*t)}const X6=n=>n.baseIndent;function Q6({except:n,units:e=1}={}){return t=>{let i=n&&n.test(t.textAfter);return t.baseIndent+(i?0:e*t.unit)}}const EH=200;function TH(){return Fe.transactionFilter.of(n=>{if(!n.docChanged||!n.isUserEvent("input.type")&&!n.isUserEvent("input.complete"))return n;let e=n.startState.languageDataAt("indentOnInput",n.startState.selection.main.head);if(!e.length)return n;let t=n.newDoc,{head:i}=n.newSelection.main,r=t.lineAt(i);if(i>r.from+EH)return n;let s=t.sliceString(r.from,i);if(!e.some(h=>h.test(s)))return n;let{state:o}=n,l=-1,a=[];for(let{head:h}of o.selection.ranges){let c=o.doc.lineAt(h);if(c.from==l)continue;l=c.from;let u=dy(o,c.from);if(u==null)continue;let f=/^\s*/.exec(c.text)[0],d=dh(o,u);f!=d&&a.push({from:c.from,to:c.from+f.length,insert:d})}return a.length?[n,{changes:a,sequential:!0}]:n})}const PH=he.define(),BH=new Pe;function e$(n){let e=n.firstChild,t=n.lastChild;return e&&e.to<t.from?{from:e.to,to:t.type.isError?n.to:t.from}:null}function RH(n,e,t){let i=ei(n);if(i.length<t)return null;let r=i.resolveInner(t),s=null;for(let o=r;o;o=o.parent){if(o.to<=t||o.from>t)continue;if(s&&o.from<e)break;let l=o.type.prop(BH);if(l&&(o.to<i.length-50||i.length==n.doc.length||!LH(o))){let a=l(o,n);a&&a.from<=t&&a.from>=e&&a.to>t&&(s=a)}}return s}function LH(n){let e=n.lastChild;return e&&e.to==n.to&&e.type.isError}function rf(n,e,t){for(let i of n.facet(PH)){let r=i(n,e,t);if(r)return r}return RH(n,e,t)}function T_(n,e){let t=e.mapPos(n.from,1),i=e.mapPos(n.to,-1);return t>=i?void 0:{from:t,to:i}}const sf=ke.define({map:T_}),ph=ke.define({map:T_});function P_(n){let e=[];for(let{head:t}of n.state.selection.ranges)e.some(i=>i.from<=t&&i.to>=t)||e.push(n.lineBlockAt(t));return e}const Ps=zt.define({create(){return ue.none},update(n,e){n=n.map(e.changes);for(let t of e.effects)t.is(sf)&&!FH(n,t.value.from,t.value.to)?n=n.update({add:[HH.range(t.value.from,t.value.to)]}):t.is(ph)&&(n=n.update({filter:(i,r)=>t.value.from!=i||t.value.to!=r,filterFrom:t.value.from,filterTo:t.value.to}));if(e.selection){let t=!1,{head:i}=e.selection.main;n.between(i,i,(r,s)=>{r<i&&s>i&&(t=!0)}),t&&(n=n.update({filterFrom:i,filterTo:i,filter:(r,s)=>s<=i||r>=i}))}return n},provide:n=>le.decorations.from(n)});function t$(n){return n.field(Ps,!1)||RangeSet.empty}function of(n,e,t){var i;let r=null;return(i=n.field(Ps,!1))===null||i===void 0||i.between(e,t,(s,o)=>{(!r||r.from>s)&&(r={from:s,to:o})}),r}function FH(n,e,t){let i=!1;return n.between(e,e,(r,s)=>{r==e&&s==t&&(i=!0)}),i}function B_(n,e){return n.field(Ps,!1)?e:e.concat(ke.appendConfig.of(F_()))}const NH=n=>{for(let e of P_(n)){let t=rf(n.state,e.from,e.to);if(t)return n.dispatch({effects:B_(n.state,[sf.of(t),R_(n,t)])}),!0}return!1},IH=n=>{if(!n.state.field(Ps,!1))return!1;let e=[];for(let t of P_(n)){let i=of(n.state,t.from,t.to);i&&e.push(ph.of(i),R_(n,i,!1))}return e.length&&n.dispatch({effects:e}),e.length>0};function R_(n,e,t=!0){let i=n.state.doc.lineAt(e.from).number,r=n.state.doc.lineAt(e.to).number;return le.announce.of(`${n.state.phrase(t?"Folded lines":"Unfolded lines")} ${i} ${n.state.phrase("to")} ${r}.`)}const WH=[{key:"Ctrl-Shift-[",mac:"Cmd-Alt-[",run:NH},{key:"Ctrl-Shift-]",mac:"Cmd-Alt-]",run:IH},{key:"Ctrl-Alt-[",run:n=>{let{state:e}=n,t=[];for(let i=0;i<e.doc.length;){let r=n.lineBlockAt(i),s=rf(e,r.from,r.to);s&&t.push(sf.of(s)),i=(s?n.lineBlockAt(s.to):r).to+1}return t.length&&n.dispatch({effects:B_(n.state,t)}),!!t.length}},{key:"Ctrl-Alt-]",run:n=>{let e=n.state.field(Ps,!1);if(!e||!e.size)return!1;let t=[];return e.between(0,n.state.doc.length,(i,r)=>{t.push(ph.of({from:i,to:r}))}),n.dispatch({effects:t}),!0}}],VH={placeholderDOM:null,placeholderText:"\u2026"},L_=he.define({combine(n){return nr(n,VH)}});function F_(n){let e=[Ps,$H];return n&&e.push(L_.of(n)),e}const HH=ue.replace({widget:new class extends sr{toDOM(n){let{state:e}=n,t=e.facet(L_),i=s=>{let o=n.lineBlockAt(n.posAtDOM(s.target)),l=of(n.state,o.from,o.to);l&&n.dispatch({effects:ph.of(l)}),s.preventDefault()};if(t.placeholderDOM)return t.placeholderDOM(n,i);let r=document.createElement("span");return r.textContent=t.placeholderText,r.setAttribute("aria-label",e.phrase("folded code")),r.title=e.phrase("unfold"),r.className="cm-foldPlaceholder",r.onclick=i,r}}}),zH={openText:"\u2304",closedText:"\u203A",markerDOM:null,domEventHandlers:{}};class py extends ar{constructor(e,t){super(),this.config=e,this.open=t}eq(e){return this.config==e.config&&this.open==e.open}toDOM(e){if(this.config.markerDOM)return this.config.markerDOM(this.open);let t=document.createElement("span");return t.textContent=this.open?this.config.openText:this.config.closedText,t.title=e.state.phrase(this.open?"Fold line":"Unfold line"),t}}function jH(n={}){let e=Object.assign(Object.assign({},zH),n),t=new py(e,!0),i=new py(e,!1),r=Nt.fromClass(class{constructor(o){this.from=o.viewport.from,this.markers=this.buildMarkers(o)}update(o){(o.docChanged||o.viewportChanged||o.startState.facet(Ts)!=o.state.facet(Ts)||o.startState.field(Ps,!1)!=o.state.field(Ps,!1)||ei(o.startState)!=ei(o.state))&&(this.markers=this.buildMarkers(o.view))}buildMarkers(o){let l=new ks;for(let a of o.viewportLineBlocks){let h=of(o.state,a.from,a.to)?i:rf(o.state,a.from,a.to)?t:null;h&&l.add(a.from,a.from,h)}return l.finish()}}),{domEventHandlers:s}=e;return[r,t_({class:"cm-foldGutter",markers(o){var l;return((l=o.plugin(r))===null||l===void 0?void 0:l.markers)||We.empty},initialSpacer(){return new py(e,!1)},domEventHandlers:Object.assign(Object.assign({},s),{click:(o,l,a)=>{if(s.click&&s.click(o,l,a))return!0;let h=of(o.state,l.from,l.to);if(h)return o.dispatch({effects:ph.of(h)}),!0;let c=rf(o.state,l.from,l.to);return c?(o.dispatch({effects:sf.of(c)}),!0):!1}})}),F_()]}const $H=le.baseTheme({".cm-foldPlaceholder":{backgroundColor:"#eee",border:"1px solid #ddd",color:"#888",borderRadius:".2em",margin:"0 1px",padding:"0 1px",cursor:"pointer"},".cm-foldGutter span":{padding:"0 1px",cursor:"pointer"}});class mh{constructor(e,t){let i;function r(o){let l=Ue.newName();return(i||(i=Object.create(null)))["."+l]=o,l}const s=t.scope;this.scope=s instanceof On?o=>o.prop(xl)==s.data:s?o=>o==s:void 0,this.style=w_(e.map(o=>({tag:o.tag,class:o.class||r(Object.assign({},o,{tag:null}))})),{all:typeof t.all=="string"?t.all:t.all?r(t.all):void 0}).style,this.module=i?new Ue(i):null,this.themeType=t.themeType}static define(e,t){return new mh(e,t||{})}}const my=he.define(),N_=he.define({combine(n){return n.length?[n[0]]:null}});function lf(n){let e=n.facet(my);return e.length?e:n.facet(N_)}function I_(n,e){let t=[qH],i;return n instanceof mh&&(n.module&&t.push(le.styleModule.of(n.module)),i=n.themeType),e!=null&&e.fallback?t.push(N_.of(n)):i?t.push(my.computeN([le.darkTheme],r=>r.facet(le.darkTheme)==(i=="dark")?[n]:[])):t.push(my.of(n)),t}function r$(n,e,t){let i=lf(n),r=null;if(i){for(let s of i)if(!s.scope||t&&s.scope(t)){let o=s.style(e);o&&(r=r?r+" "+o:o)}}return r}class UH{constructor(e){this.markCache=Object.create(null),this.tree=ei(e.state),this.decorations=this.buildDeco(e,lf(e.state))}update(e){let t=ei(e.state),i=lf(e.state),r=i!=lf(e.startState);t.length<e.view.viewport.to&&!r&&t.type==this.tree.type?this.decorations=this.decorations.map(e.changes):(t!=this.tree||e.viewportChanged||r)&&(this.tree=t,this.decorations=this.buildDeco(e.view,i))}buildDeco(e,t){if(!t||!this.tree.length)return ue.none;let i=new ks;for(let{from:r,to:s}of e.visibleRanges)vH(this.tree,t,(o,l,a)=>{i.add(o,l,this.markCache[a]||(this.markCache[a]=ue.mark({class:a})))},r,s);return i.finish()}}const qH=dl.high(Nt.fromClass(UH,{decorations:n=>n.decorations})),KH=mh.define([{tag:P.meta,color:"#7a757a"},{tag:P.link,textDecoration:"underline"},{tag:P.heading,textDecoration:"underline",fontWeight:"bold"},{tag:P.emphasis,fontStyle:"italic"},{tag:P.strong,fontWeight:"bold"},{tag:P.strikethrough,textDecoration:"line-through"},{tag:P.keyword,color:"#708"},{tag:[P.atom,P.bool,P.url,P.contentSeparator,P.labelName],color:"#219"},{tag:[P.literal,P.inserted],color:"#164"},{tag:[P.string,P.deleted],color:"#a11"},{tag:[P.regexp,P.escape,P.special(P.string)],color:"#e40"},{tag:P.definition(P.variableName),color:"#00f"},{tag:P.local(P.variableName),color:"#30a"},{tag:[P.typeName,P.namespace],color:"#085"},{tag:P.className,color:"#167"},{tag:[P.special(P.variableName),P.macroName],color:"#256"},{tag:P.definition(P.propertyName),color:"#00c"},{tag:P.comment,color:"#940"},{tag:P.invalid,color:"#f00"}]),GH=le.baseTheme({"&.cm-focused .cm-matchingBracket":{backgroundColor:"#328c8252"},"&.cm-focused .cm-nonmatchingBracket":{backgroundColor:"#bb555544"}}),W_=1e4,V_="()[]{}",H_=he.define({combine(n){return nr(n,{afterCursor:!0,brackets:V_,maxScanDistance:W_,renderMatch:YH})}}),JH=ue.mark({class:"cm-matchingBracket"}),ZH=ue.mark({class:"cm-nonmatchingBracket"});function YH(n){let e=[],t=n.matched?JH:ZH;return e.push(t.range(n.start.from,n.start.to)),n.end&&e.push(t.range(n.end.from,n.end.to)),e}const XH=[zt.define({create(){return ue.none},update(n,e){if(!e.docChanged&&!e.selection)return n;let t=[],i=e.state.facet(H_);for(let r of e.state.selection.ranges){if(!r.empty)continue;let s=pr(e.state,r.head,-1,i)||r.head>0&&pr(e.state,r.head-1,1,i)||i.afterCursor&&(pr(e.state,r.head,1,i)||r.head<e.state.doc.length&&pr(e.state,r.head+1,-1,i));s&&(t=t.concat(i.renderMatch(s,e.state)))}return ue.set(t,!0)},provide:n=>le.decorations.from(n)}),GH];function QH(n={}){return[H_.of(n),XH]}function gy(n,e,t){let i=n.prop(e<0?Pe.openedBy:Pe.closedBy);if(i)return i;if(n.name.length==1){let r=t.indexOf(n.name);if(r>-1&&r%2==(e<0?1:0))return[t[r+e]]}return null}function pr(n,e,t,i={}){let r=i.maxScanDistance||W_,s=i.brackets||V_,o=ei(n),l=o.resolveInner(e,t);for(let a=l;a;a=a.parent){let h=gy(a.type,t,s);if(h&&a.from<a.to)return e5(n,e,t,a,h,s)}return t5(n,e,t,o,l.type,r,s)}function e5(n,e,t,i,r,s){let o=i.parent,l={from:i.from,to:i.to},a=0,h=o==null?void 0:o.cursor();if(h&&(t<0?h.childBefore(i.from):h.childAfter(i.to)))do if(t<0?h.to<=i.from:h.from>=i.to){if(a==0&&r.indexOf(h.type.name)>-1&&h.from<h.to)return{start:l,end:{from:h.from,to:h.to},matched:!0};if(gy(h.type,t,s))a++;else if(gy(h.type,-t,s)&&(a--,a==0))return{start:l,end:h.from==h.to?void 0:{from:h.from,to:h.to},matched:!1}}while(t<0?h.prevSibling():h.nextSibling());return{start:l,matched:!1}}function t5(n,e,t,i,r,s,o){let l=t<0?n.sliceDoc(e-1,e):n.sliceDoc(e,e+1),a=o.indexOf(l);if(a<0||a%2==0!=t>0)return null;let h={from:t<0?e-1:e,to:t>0?e+1:e},c=n.doc.iterRange(e,t>0?n.doc.length:0),u=0;for(let f=0;!c.next().done&&f<=s;){let d=c.value;t<0&&(f+=d.length);let p=e+f*t;for(let g=t>0?0:d.length-1,y=t>0?d.length:-1;g!=y;g+=t){let v=o.indexOf(d[g]);if(!(v<0||i.resolve(p+g,1).type!=r))if(v%2==0==t>0)u++;else{if(u==1)return{start:h,end:{from:p+g,to:p+g+1},matched:v>>1==a>>1};u--}}t>0&&(f+=d.length)}return c.done?{start:h,matched:!1}:null}function z_(n,e,t,i=0,r=0){e==null&&(e=n.search(/[^\s\u00a0]/),e==-1&&(e=n.length));let s=r;for(let o=i;o<e;o++)n.charCodeAt(o)==9?s+=t-s%t:s++;return s}class j_{constructor(e,t,i){this.string=e,this.tabSize=t,this.indentUnit=i,this.pos=0,this.start=0,this.lastColumnPos=0,this.lastColumnValue=0}eol(){return this.pos>=this.string.length}sol(){return this.pos==0}peek(){return this.string.charAt(this.pos)||void 0}next(){if(this.pos<this.string.length)return this.string.charAt(this.pos++)}eat(e){let t=this.string.charAt(this.pos),i;if(typeof e=="string"?i=t==e:i=t&&(e instanceof RegExp?e.test(t):e(t)),i)return++this.pos,t}eatWhile(e){let t=this.pos;for(;this.eat(e););return this.pos>t}eatSpace(){let e=this.pos;for(;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++this.pos;return this.pos>e}skipToEnd(){this.pos=this.string.length}skipTo(e){let t=this.string.indexOf(e,this.pos);if(t>-1)return this.pos=t,!0}backUp(e){this.pos-=e}column(){return this.lastColumnPos<this.start&&(this.lastColumnValue=z_(this.string,this.start,this.tabSize,this.lastColumnPos,this.lastColumnValue),this.lastColumnPos=this.start),this.lastColumnValue}indentation(){return z_(this.string,null,this.tabSize)}match(e,t,i){if(typeof e=="string"){let r=o=>i?o.toLowerCase():o,s=this.string.substr(this.pos,e.length);return r(s)==r(e)?(t!==!1&&(this.pos+=e.length),!0):null}else{let r=this.string.slice(this.pos).match(e);return r&&r.index>0?null:(r&&t!==!1&&(this.pos+=r[0].length),r)}}current(){return this.string.slice(this.start,this.pos)}}function i5(n){return{token:n.token,blankLine:n.blankLine||(()=>{}),startState:n.startState||(()=>!0),copyState:n.copyState||n5,indent:n.indent||(()=>null),languageData:n.languageData||{},tokenTable:n.tokenTable||vy}}function n5(n){if(typeof n!="object")return n;let e={};for(let t in n){let i=n[t];e[t]=i instanceof Array?i.slice():i}return e}class $_ extends null{constructor(e){let t=S_(e.languageData),i=i5(e),r,s=new class extends Parser{createParse(o,l,a){return new s5(r,o,l,a)}};super(t,s,[D_.of((o,l)=>this.getIndent(o,l))]),this.topNode=a5(t),r=this,this.streamParser=i,this.stateAfter=new NodeProp({perNode:!0}),this.tokenTable=e.tokenTable?new J_(i.tokenTable):l5}static define(e){return new $_(e)}getIndent(e,t){let i=ei(e.state),r=i.resolve(t);for(;r&&r.type!=this.topNode;)r=r.parent;if(!r)return null;let s=yy(this,i,0,r.from,t),o,l;if(s?(l=s.state,o=s.pos+1):(l=this.streamParser.startState(e.unit),o=0),t-o>1e4)return null;for(;o<t;){let h=e.state.doc.lineAt(o),c=Math.min(t,h.to);if(h.length){let u=new j_(h.text,e.state.tabSize,e.unit);for(;u.pos<c-h.from;)q_(this.streamParser.token,u,l)}else this.streamParser.blankLine(l,e.unit);if(c==t)break;o=h.to+1}let{text:a}=e.lineAt(t);return this.streamParser.indent(l,/^\s*(.*)/.exec(a)[1],e)}get allowsNesting(){return!1}}function yy(n,e,t,i,r){let s=t>=i&&t+e.length<=r&&e.prop(n.stateAfter);if(s)return{state:n.streamParser.copyState(s),pos:t+e.length};for(let o=e.children.length-1;o>=0;o--){let l=e.children[o],a=t+e.positions[o],h=l instanceof Tree&&a<r&&yy(n,l,a,i,r);if(h)return h}return null}function U_(n,e,t,i,r){if(r&&t<=0&&i>=e.length)return e;!r&&e.type==n.topNode&&(r=!0);for(let s=e.children.length-1;s>=0;s--){let o=e.positions[s],l=e.children[s],a;if(o<i&&l instanceof Tree){if(!(a=U_(n,l,t-o,i-o,r)))break;return r?new Tree(e.type,e.children.slice(0,s).concat(a),e.positions.slice(0,s+1),o+a.length):a}}return null}function r5(n,e,t,i){for(let r of e){let s=r.from+(r.openStart?25:0),o=r.to-(r.openEnd?25:0),l=s<=t&&o>t&&yy(n,r.tree,0-r.offset,t,o),a;if(l&&(a=U_(n,r.tree,t+r.offset,l.pos+r.offset,!1)))return{state:l.state,tree:a}}return{state:n.streamParser.startState(i?bo(i):4),tree:Tree.empty}}class s5{constructor(e,t,i,r){this.lang=e,this.input=t,this.fragments=i,this.ranges=r,this.stoppedAt=null,this.chunks=[],this.chunkPos=[],this.chunk=[],this.chunkReused=void 0,this.rangeIndex=0,this.to=r[r.length-1].to;let s=fh.get(),o=r[0].from,{state:l,tree:a}=r5(e,i,o,s==null?void 0:s.state);this.state=l,this.parsedPos=this.chunkStart=o+a.length;for(let h=0;h<a.children.length;h++)this.chunks.push(a.children[h]),this.chunkPos.push(a.positions[h]);s&&this.parsedPos<s.viewport.from-1e5&&(this.state=this.lang.streamParser.startState(bo(s.state)),s.skipUntilInView(this.parsedPos,s.viewport.from),this.parsedPos=s.viewport.from),this.moveRangeIndex()}advance(){let e=fh.get(),t=this.stoppedAt==null?this.to:Math.min(this.to,this.stoppedAt),i=Math.min(t,this.chunkStart+2048);for(e&&(i=Math.min(i,e.viewport.to));this.parsedPos<i;)this.parseLine(e);return this.chunkStart<this.parsedPos&&this.finishChunk(),this.parsedPos>=t?this.finish():e&&this.parsedPos>=e.viewport.to?(e.skipUntilInView(this.parsedPos,t),this.finish()):null}stopAt(e){this.stoppedAt=e}lineAfter(e){let t=this.input.chunk(e);if(this.input.lineChunks)t==`
`&&(t="");else{let i=t.indexOf(`
`);i>-1&&(t=t.slice(0,i))}return e+t.length<=this.to?t:t.slice(0,this.to-e)}nextLine(){let e=this.parsedPos,t=this.lineAfter(e),i=e+t.length;for(let r=this.rangeIndex;;){let s=this.ranges[r].to;if(s>=i||(t=t.slice(0,s-(i-t.length)),r++,r==this.ranges.length))break;let o=this.ranges[r].from,l=this.lineAfter(o);t+=l,i=o+l.length}return{line:t,end:i}}skipGapsTo(e,t,i){for(;;){let r=this.ranges[this.rangeIndex].to,s=e+t;if(i>0?r>s:r>=s)break;t+=this.ranges[++this.rangeIndex].from-r}return t}moveRangeIndex(){for(;this.ranges[this.rangeIndex].to<this.parsedPos;)this.rangeIndex++}emitToken(e,t,i,r,s){if(this.ranges.length>1){s=this.skipGapsTo(t,s,1),t+=s;let o=this.chunk.length;s=this.skipGapsTo(i,s,-1),i+=s,r+=this.chunk.length-o}return this.chunk.push(e,t,i,r),s}parseLine(e){let{line:t,end:i}=this.nextLine(),r=0,{streamParser:s}=this.lang,o=new j_(t,e?e.state.tabSize:4,e?bo(e.state):2);if(o.eol())s.blankLine(this.state,o.indentUnit);else for(;!o.eol();){let l=q_(s.token,o,this.state);if(l&&(r=this.emitToken(this.lang.tokenTable.resolve(l),this.parsedPos+o.start,this.parsedPos+o.pos,4,r)),o.start>1e4)break}this.parsedPos=i,this.moveRangeIndex(),this.parsedPos<this.to&&this.parsedPos++}finishChunk(){let e=Tree.build({buffer:this.chunk,start:this.chunkStart,length:this.parsedPos-this.chunkStart,nodeSet:o5,topID:0,maxBufferLength:2048,reused:this.chunkReused});e=new Tree(e.type,e.children,e.positions,e.length,[[this.lang.stateAfter,this.lang.streamParser.copyState(this.state)]]),this.chunks.push(e),this.chunkPos.push(this.chunkStart-this.ranges[0].from),this.chunk=[],this.chunkReused=void 0,this.chunkStart=this.parsedPos}finish(){return new Tree(this.lang.topNode,this.chunks,this.chunkPos,this.parsedPos-this.ranges[0].from).balance()}}function q_(n,e,t){e.start=e.pos;for(let i=0;i<10;i++){let r=n(e,t);if(e.pos>e.start)return r}throw new Error("Stream parser failed to advance stream.")}const vy=Object.create(null),gh=[Ji.none],o5=new iy(gh),K_=[],G_=Object.create(null);for(let[n,e]of[["variable","variableName"],["variable-2","variableName.special"],["string-2","string.special"],["def","variableName.definition"],["tag","typeName"],["attribute","propertyName"],["type","typeName"],["builtin","variableName.standard"],["qualifier","modifier"],["error","invalid"],["header","heading"],["property","propertyName"]])G_[n]=Z_(vy,e);class J_{constructor(e){this.extra=e,this.table=Object.assign(Object.create(null),G_)}resolve(e){return e?this.table[e]||(this.table[e]=Z_(this.extra,e)):0}}const l5=new J_(vy);function wy(n,e){K_.indexOf(n)>-1||(K_.push(n),console.warn(e))}function Z_(n,e){let t=null;for(let s of e.split(".")){let o=n[s]||P[s];o?typeof o=="function"?t?t=o(t):wy(s,`Modifier ${s} used at start of tag`):t?wy(s,`Tag ${s} used as modifier`):t=o:wy(s,`Unknown highlighting tag ${s}`)}if(!t)return 0;let i=e.replace(/ /g,"_"),r=Ji.define({id:gh.length,name:i,props:[mH({[i]:t})]});return gh.push(r),r.id}function a5(n){let e=NodeType.define({id:gh.length,name:"Document",props:[xl.add(()=>n)]});return gh.push(e),e}const h5=n=>{let e=xy(n.state);return e.line?c5(n):e.block?f5(n):!1};function by(n,e){return({state:t,dispatch:i})=>{if(t.readOnly)return!1;let r=n(e,t);return r?(i(t.update(r)),!0):!1}}const c5=by(m5,0),o$=null,l$=null,u5=by(Y_,0),a$=null,h$=null,f5=by((n,e)=>Y_(n,e,p5(e)),0);function xy(n,e=n.selection.main.head){let t=n.languageDataAt("commentTokens",e);return t.length?t[0]:{}}const yh=50;function d5(n,{open:e,close:t},i,r){let s=n.sliceDoc(i-yh,i),o=n.sliceDoc(r,r+yh),l=/\s*$/.exec(s)[0].length,a=/^\s*/.exec(o)[0].length,h=s.length-l;if(s.slice(h-e.length,h)==e&&o.slice(a,a+t.length)==t)return{open:{pos:i-l,margin:l&&1},close:{pos:r+a,margin:a&&1}};let c,u;r-i<=2*yh?c=u=n.sliceDoc(i,r):(c=n.sliceDoc(i,i+yh),u=n.sliceDoc(r-yh,r));let f=/^\s*/.exec(c)[0].length,d=/\s*$/.exec(u)[0].length,p=u.length-d-t.length;return c.slice(f,f+e.length)==e&&u.slice(p,p+t.length)==t?{open:{pos:i+f+e.length,margin:/\s/.test(c.charAt(f+e.length))?1:0},close:{pos:r-d-t.length,margin:/\s/.test(u.charAt(p-1))?1:0}}:null}function p5(n){let e=[];for(let t of n.selection.ranges){let i=n.doc.lineAt(t.from),r=t.to<=i.to?i:n.doc.lineAt(t.to),s=e.length-1;s>=0&&e[s].to>i.from?e[s].to=r.to:e.push({from:i.from,to:r.to})}return e}function Y_(n,e,t=e.selection.ranges){let i=t.map(s=>xy(e,s.from).block);if(!i.every(s=>s))return null;let r=t.map((s,o)=>d5(e,i[o],s.from,s.to));if(n!=2&&!r.every(s=>s))return{changes:e.changes(t.map((s,o)=>r[o]?[]:[{from:s.from,insert:i[o].open+" "},{from:s.to,insert:" "+i[o].close}]))};if(n!=1&&r.some(s=>s)){let s=[];for(let o=0,l;o<r.length;o++)if(l=r[o]){let a=i[o],{open:h,close:c}=l;s.push({from:h.pos-a.open.length,to:h.pos+h.margin},{from:c.pos-c.margin,to:c.pos+a.close.length})}return{changes:s}}return null}function m5(n,e,t=e.selection.ranges){let i=[],r=-1;for(let{from:s,to:o}of t){let l=i.length,a=1e9;for(let h=s;h<=o;){let c=e.doc.lineAt(h);if(c.from>r&&(s==o||o>c.from)){r=c.from;let u=xy(e,h).line;if(!u)continue;let f=/^\s*/.exec(c.text)[0].length,d=f==c.length,p=c.text.slice(f,f+u.length)==u?f:-1;f<c.text.length&&f<a&&(a=f),i.push({line:c,comment:p,token:u,indent:f,empty:d,single:!1})}h=c.to+1}if(a<1e9)for(let h=l;h<i.length;h++)i[h].indent<i[h].line.text.length&&(i[h].indent=a);i.length==l+1&&(i[l].single=!0)}if(n!=2&&i.some(s=>s.comment<0&&(!s.empty||s.single))){let s=[];for(let{line:l,token:a,indent:h,empty:c,single:u}of i)(u||!c)&&s.push({from:l.from+h,insert:a+" "});let o=e.changes(s);return{changes:o,selection:e.selection.map(o,1)}}else if(n!=1&&i.some(s=>s.comment>=0)){let s=[];for(let{line:o,comment:l,token:a}of i)if(l>=0){let h=o.from+l,c=h+a.length;o.text[c-o.from]==" "&&c++,s.push({from:h,to:c})}return{changes:s}}return null}const Sy=Ss.define(),g5=Ss.define(),y5=he.define(),X_=he.define({combine(n){return nr(n,{minDepth:100,newGroupDelay:500},{minDepth:Math.max,newGroupDelay:Math.min})}});function v5(n){let e=0;return n.iterChangedRanges((t,i)=>e=i),e}const ky=zt.define({create(){return mr.empty},update(n,e){let t=e.state.facet(X_),i=e.annotation(Sy);if(i){let a=e.docChanged?L.single(v5(e.changes)):void 0,h=Zi.fromTransaction(e,a),c=i.side,u=c==0?n.undone:n.done;return h?u=hf(u,u.length,t.minDepth,h):u=iD(u,e.startState.selection),new mr(c==0?i.rest:u,c==0?u:i.rest)}let r=e.annotation(g5);if((r=="full"||r=="before")&&(n=n.isolate()),e.annotation(Xt.addToHistory)===!1)return e.changes.empty?n:n.addMapping(e.changes.desc);let s=Zi.fromTransaction(e),o=e.annotation(Xt.time),l=e.annotation(Xt.userEvent);return s?n=n.addChanges(s,o,l,t.newGroupDelay,t.minDepth):e.selection&&(n=n.addSelection(e.startState.selection,o,l,t.newGroupDelay)),(r=="full"||r=="after")&&(n=n.isolate()),n},toJSON(n){return{done:n.done.map(e=>e.toJSON()),undone:n.undone.map(e=>e.toJSON())}},fromJSON(n){return new mr(n.done.map(Zi.fromJSON),n.undone.map(Zi.fromJSON))}});function w5(n={}){return[ky,X_.of(n),le.domEventHandlers({beforeinput(e,t){let i=e.inputType=="historyUndo"?Q_:e.inputType=="historyRedo"?eD:null;return i?(e.preventDefault(),i(t)):!1}})]}const c$=null;function af(n,e){return function({state:t,dispatch:i}){if(!e&&t.readOnly)return!1;let r=t.field(ky,!1);if(!r)return!1;let s=r.pop(n,t,e);return s?(i(s),!0):!1}}const Q_=af(0,!1),eD=af(1,!1),b5=af(0,!0),x5=af(1,!0);function u$(n){return function(e){let t=e.field(ky,!1);if(!t)return 0;let i=n==0?t.done:t.undone;return i.length-(i.length&&!i[0].changes?1:0)}}const f$=null,d$=null;class Zi{constructor(e,t,i,r,s){this.changes=e,this.effects=t,this.mapped=i,this.startSelection=r,this.selectionsAfter=s}setSelAfter(e){return new Zi(this.changes,this.effects,this.mapped,this.startSelection,e)}toJSON(){var e,t,i;return{changes:(e=this.changes)===null||e===void 0?void 0:e.toJSON(),mapped:(t=this.mapped)===null||t===void 0?void 0:t.toJSON(),startSelection:(i=this.startSelection)===null||i===void 0?void 0:i.toJSON(),selectionsAfter:this.selectionsAfter.map(r=>r.toJSON())}}static fromJSON(e){return new Zi(e.changes&&Yt.fromJSON(e.changes),[],e.mapped&&Lr.fromJSON(e.mapped),e.startSelection&&L.fromJSON(e.startSelection),e.selectionsAfter.map(L.fromJSON))}static fromTransaction(e,t){let i=_n;for(let r of e.startState.facet(y5)){let s=r(e);s.length&&(i=i.concat(s))}return!i.length&&e.changes.empty?null:new Zi(e.changes.invert(e.startState.doc),i,void 0,t||e.startState.selection,_n)}static selection(e){return new Zi(void 0,_n,void 0,void 0,e)}}function hf(n,e,t,i){let r=e+1>t+20?e-t-1:0,s=n.slice(r,e);return s.push(i),s}function S5(n,e){let t=[],i=!1;return n.iterChangedRanges((r,s)=>t.push(r,s)),e.iterChangedRanges((r,s,o,l)=>{for(let a=0;a<t.length;){let h=t[a++],c=t[a++];l>=h&&o<=c&&(i=!0)}}),i}function k5(n,e){return n.ranges.length==e.ranges.length&&n.ranges.filter((t,i)=>t.empty!=e.ranges[i].empty).length===0}function tD(n,e){return n.length?e.length?n.concat(e):n:e}const _n=[],C5=200;function iD(n,e){if(n.length){let t=n[n.length-1],i=t.selectionsAfter.slice(Math.max(0,t.selectionsAfter.length-C5));return i.length&&i[i.length-1].eq(e)?n:(i.push(e),hf(n,n.length-1,1e9,t.setSelAfter(i)))}else return[Zi.selection([e])]}function A5(n){let e=n[n.length-1],t=n.slice();return t[n.length-1]=e.setSelAfter(e.selectionsAfter.slice(0,e.selectionsAfter.length-1)),t}function Cy(n,e){if(!n.length)return n;let t=n.length,i=_n;for(;t;){let r=O5(n[t-1],e,i);if(r.changes&&!r.changes.empty||r.effects.length){let s=n.slice(0,t);return s[t-1]=r,s}else e=r.mapped,t--,i=r.selectionsAfter}return i.length?[Zi.selection(i)]:_n}function O5(n,e,t){let i=tD(n.selectionsAfter.length?n.selectionsAfter.map(l=>l.map(e)):_n,t);if(!n.changes)return Zi.selection(i);let r=n.changes.map(e),s=e.mapDesc(n.changes,!0),o=n.mapped?n.mapped.composeDesc(s):s;return new Zi(r,ke.mapEffects(n.effects,e),o,n.startSelection.map(s),i)}const _5=/^(input\.type|delete)($|\.)/;class mr{constructor(e,t,i=0,r=void 0){this.done=e,this.undone=t,this.prevTime=i,this.prevUserEvent=r}isolate(){return this.prevTime?new mr(this.done,this.undone):this}addChanges(e,t,i,r,s){let o=this.done,l=o[o.length-1];return l&&l.changes&&!l.changes.empty&&e.changes&&(!i||_5.test(i))&&(!l.selectionsAfter.length&&t-this.prevTime<r&&S5(l.changes,e.changes)||i=="input.type.compose")?o=hf(o,o.length-1,s,new Zi(e.changes.compose(l.changes),tD(e.effects,l.effects),l.mapped,l.startSelection,_n)):o=hf(o,o.length,s,e),new mr(o,_n,t,i)}addSelection(e,t,i,r){let s=this.done.length?this.done[this.done.length-1].selectionsAfter:_n;return s.length>0&&t-this.prevTime<r&&i==this.prevUserEvent&&i&&/^select($|\.)/.test(i)&&k5(s[s.length-1],e)?this:new mr(iD(this.done,e),this.undone,t,i)}addMapping(e){return new mr(Cy(this.done,e),Cy(this.undone,e),this.prevTime,this.prevUserEvent)}pop(e,t,i){let r=e==0?this.done:this.undone;if(r.length==0)return null;let s=r[r.length-1];if(i&&s.selectionsAfter.length)return t.update({selection:s.selectionsAfter[s.selectionsAfter.length-1],annotations:Sy.of({side:e,rest:A5(r)}),userEvent:e==0?"select.undo":"select.redo",scrollIntoView:!0});if(s.changes){let o=r.length==1?_n:r.slice(0,r.length-1);return s.mapped&&(o=Cy(o,s.mapped)),t.update({changes:s.changes,selection:s.startSelection,effects:s.effects,annotations:Sy.of({side:e,rest:o}),filter:!1,userEvent:e==0?"undo":"redo",scrollIntoView:!0})}else return null}}mr.empty=new mr(_n,_n);const D5=[{key:"Mod-z",run:Q_,preventDefault:!0},{key:"Mod-y",mac:"Mod-Shift-z",run:eD,preventDefault:!0},{key:"Mod-u",run:b5,preventDefault:!0},{key:"Alt-u",mac:"Mod-Shift-u",run:x5,preventDefault:!0}];function kl(n,e){return L.create(n.ranges.map(e),n.mainIndex)}function gr(n,e){return n.update({selection:e,scrollIntoView:!0,userEvent:"select"})}function yr({state:n,dispatch:e},t){let i=kl(n.selection,t);return i.eq(n.selection)?!1:(e(gr(n,i)),!0)}function vh(n,e){return L.cursor(e?n.to:n.from)}function cf(n,e){return yr(n,t=>t.empty?n.moveByChar(t,e):vh(t,e))}function Dn(n){return n.textDirectionAt(n.state.selection.main.head)==kt.LTR}const nD=n=>cf(n,!Dn(n)),rD=n=>cf(n,Dn(n)),p$=n=>cf(n,!0),m$=n=>cf(n,!1);function uf(n,e){return yr(n,t=>t.empty?n.moveByGroup(t,e):vh(t,e))}const M5=n=>uf(n,!Dn(n)),E5=n=>uf(n,Dn(n)),g$=n=>uf(n,!0),y$=n=>uf(n,!1);function sD(n,e,t){let i=n.state.charCategorizer(e.from);return n.moveByChar(e,t,r=>{let s=CharCategory.Space,o=e.from,l=!1,a=!1,h=!1,c=u=>{if(l)return!1;o+=t?u.length:-u.length;let f=i(u),d;if(s==CharCategory.Space&&(s=f),s!=f)return!1;if(s==CharCategory.Word)if(u.toLowerCase()==u){if(!t&&a)return!1;h=!0}else if(h){if(t)return!1;l=!0}else{if(a&&t&&i(d=n.state.sliceDoc(o,o+1))==CharCategory.Word&&d.toLowerCase()==d)return!1;a=!0}return!0};return c(r),c})}function oD(n,e){return yr(n,t=>t.empty?sD(n,t,e):vh(t,e))}const v$=n=>oD(n,!0),w$=n=>oD(n,!1);function T5(n,e,t){if(e.type.prop(t))return!0;let i=e.to-e.from;return i&&(i>2||/[^\s,.;:]/.test(n.sliceDoc(e.from,e.to)))||e.firstChild}function ff(n,e,t){let i=ei(n).resolveInner(e.head),r=t?Pe.closedBy:Pe.openedBy;for(let a=e.head;;){let h=t?i.childAfter(a):i.childBefore(a);if(!h)break;T5(n,h,r)?i=h:a=t?h.to:h.from}let s=i.type.prop(r),o,l;return s&&(o=t?pr(n,i.from,1):pr(n,i.to,-1))&&o.matched?l=t?o.end.to:o.end.from:l=t?i.to:i.from,L.cursor(l,t?-1:1)}const P5=n=>yr(n,e=>ff(n.state,e,!Dn(n))),B5=n=>yr(n,e=>ff(n.state,e,Dn(n)));function lD(n,e){return yr(n,t=>{if(!t.empty)return vh(t,e);let i=n.moveVertically(t,e);return i.head!=t.head?i:n.moveToLineBoundary(t,e)})}const aD=n=>lD(n,!1),hD=n=>lD(n,!0);function cD(n,e){let{state:t}=n,i=kl(t.selection,l=>l.empty?n.moveVertically(l,e,Math.min(n.dom.clientHeight,innerHeight)):vh(l,e));if(i.eq(t.selection))return!1;let r=n.coordsAtPos(t.selection.main.head),s=n.scrollDOM.getBoundingClientRect(),o;return r&&r.top>s.top&&r.bottom<s.bottom&&r.top-s.top<=n.scrollDOM.scrollHeight-n.scrollDOM.scrollTop-n.scrollDOM.clientHeight&&(o=le.scrollIntoView(i.main.head,{y:"start",yMargin:r.top-s.top})),n.dispatch(gr(t,i),{effects:o}),!0}const uD=n=>cD(n,!1),Ay=n=>cD(n,!0);function df(n,e,t){let i=n.lineBlockAt(e.head),r=n.moveToLineBoundary(e,t);if(r.head==e.head&&r.head!=(t?i.to:i.from)&&(r=n.moveToLineBoundary(e,t,!1)),!t&&r.head==i.from&&i.length){let s=/^\s*/.exec(n.state.sliceDoc(i.from,Math.min(i.from+100,i.to)))[0].length;s&&e.head!=i.from+s&&(r=L.cursor(i.from+s))}return r}const fD=n=>yr(n,e=>df(n,e,!0)),dD=n=>yr(n,e=>df(n,e,!1)),R5=n=>yr(n,e=>L.cursor(n.lineBlockAt(e.head).from,1)),L5=n=>yr(n,e=>L.cursor(n.lineBlockAt(e.head).to,-1));function pD(n,e,t){let i=!1,r=kl(n.selection,s=>{let o=pr(n,s.head,-1)||pr(n,s.head,1)||s.head>0&&pr(n,s.head-1,1)||s.head<n.doc.length&&pr(n,s.head+1,-1);if(!o||!o.end)return s;i=!0;let l=o.start.from==s.head?o.end.to:o.end.from;return t?L.range(s.anchor,l):L.cursor(l)});return i?(e(gr(n,r)),!0):!1}const F5=({state:n,dispatch:e})=>pD(n,e,!1),b$=({state:n,dispatch:e})=>pD(n,e,!0);function Nn(n,e){let t=kl(n.state.selection,i=>{let r=e(i);return L.range(i.anchor,r.head,r.goalColumn)});return t.eq(n.state.selection)?!1:(n.dispatch(gr(n.state,t)),!0)}function pf(n,e){return Nn(n,t=>n.moveByChar(t,e))}const mD=n=>pf(n,!Dn(n)),gD=n=>pf(n,Dn(n)),x$=n=>pf(n,!0),S$=n=>pf(n,!1);function mf(n,e){return Nn(n,t=>n.moveByGroup(t,e))}const N5=n=>mf(n,!Dn(n)),I5=n=>mf(n,Dn(n)),k$=n=>mf(n,!0),C$=n=>mf(n,!1);function yD(n,e){return Nn(n,t=>sD(n,t,e))}const A$=n=>yD(n,!0),O$=n=>yD(n,!1),W5=n=>Nn(n,e=>ff(n.state,e,!Dn(n))),V5=n=>Nn(n,e=>ff(n.state,e,Dn(n)));function vD(n,e){return Nn(n,t=>n.moveVertically(t,e))}const wD=n=>vD(n,!1),bD=n=>vD(n,!0);function xD(n,e){return Nn(n,t=>n.moveVertically(t,e,Math.min(n.dom.clientHeight,innerHeight)))}const SD=n=>xD(n,!1),kD=n=>xD(n,!0),CD=n=>Nn(n,e=>df(n,e,!0)),AD=n=>Nn(n,e=>df(n,e,!1)),H5=n=>Nn(n,e=>L.cursor(n.lineBlockAt(e.head).from)),z5=n=>Nn(n,e=>L.cursor(n.lineBlockAt(e.head).to)),OD=({state:n,dispatch:e})=>(e(gr(n,{anchor:0})),!0),_D=({state:n,dispatch:e})=>(e(gr(n,{anchor:n.doc.length})),!0),DD=({state:n,dispatch:e})=>(e(gr(n,{anchor:n.selection.main.anchor,head:0})),!0),MD=({state:n,dispatch:e})=>(e(gr(n,{anchor:n.selection.main.anchor,head:n.doc.length})),!0),j5=({state:n,dispatch:e})=>(e(n.update({selection:{anchor:0,head:n.doc.length},userEvent:"select"})),!0),$5=({state:n,dispatch:e})=>{let t=vf(n).map(({from:i,to:r})=>L.range(i,Math.min(r+1,n.doc.length)));return e(n.update({selection:L.create(t),userEvent:"select"})),!0},U5=({state:n,dispatch:e})=>{let t=kl(n.selection,i=>{var r;let s=ei(n).resolveInner(i.head,1);for(;!(s.from<i.from&&s.to>=i.to||s.to>i.to&&s.from<=i.from||!(!((r=s.parent)===null||r===void 0)&&r.parent));)s=s.parent;return L.range(s.to,s.from)});return e(gr(n,t)),!0},q5=({state:n,dispatch:e})=>{let t=n.selection,i=null;return t.ranges.length>1?i=L.create([t.main]):t.main.empty||(i=L.create([L.cursor(t.main.head)])),i?(e(gr(n,i)),!0):!1};function gf({state:n,dispatch:e},t){if(n.readOnly)return!1;let i="delete.selection",r=n.changeByRange(s=>{let{from:o,to:l}=s;if(o==l){let a=t(o);a<o?i="delete.backward":a>o&&(i="delete.forward"),o=Math.min(o,a),l=Math.max(l,a)}return o==l?{range:s}:{changes:{from:o,to:l},range:L.cursor(o)}});return r.changes.empty?!1:(e(n.update(r,{scrollIntoView:!0,userEvent:i})),!0)}function yf(n,e,t){if(n instanceof le)for(let i of n.state.facet(le.atomicRanges).map(r=>r(n)))i.between(e,e,(r,s)=>{r<e&&s>e&&(e=t?s:r)});return e}const ED=(n,e)=>gf(n,t=>{let{state:i}=n,r=i.doc.lineAt(t),s,o;if(!e&&t>r.from&&t<r.from+200&&!/[^ \t]/.test(s=r.text.slice(0,t-r.from))){if(s[s.length-1]=="	")return t-1;let l=qa(s,i.tabSize),a=l%bo(i)||bo(i);for(let h=0;h<a&&s[s.length-1-h]==" ";h++)t--;o=t}else o=un(r.text,t-r.from,e,e)+r.from,o==t&&r.number!=(e?i.doc.lines:1)&&(o+=e?1:-1);return yf(n,o,e)}),Oy=n=>ED(n,!1),TD=n=>ED(n,!0),PD=(n,e)=>gf(n,t=>{let i=t,{state:r}=n,s=r.doc.lineAt(i),o=r.charCategorizer(i);for(let l=null;;){if(i==(e?s.to:s.from)){i==t&&s.number!=(e?r.doc.lines:1)&&(i+=e?1:-1);break}let a=un(s.text,i-s.from,e)+s.from,h=s.text.slice(Math.min(i,a)-s.from,Math.max(i,a)-s.from),c=o(h);if(l!=null&&c!=l)break;(h!=" "||i!=t)&&(l=c),i=a}return yf(n,i,e)}),BD=n=>PD(n,!1),K5=n=>PD(n,!0),RD=n=>gf(n,e=>{let t=n.lineBlockAt(e).to;return yf(n,e<t?t:Math.min(n.state.doc.length,e+1),!0)}),G5=n=>gf(n,e=>{let t=n.lineBlockAt(e).from;return yf(n,e>t?t:Math.max(0,e-1),!1)}),_$=({state:n,dispatch:e})=>{if(n.readOnly)return!1;let t=[];for(let i=0,r="",s=n.doc.iter();;){if(s.next(),s.lineBreak||s.done){let o=r.search(/\s+$/);if(o>-1&&t.push({from:i-(r.length-o),to:i}),s.done)break;r=""}else r=s.value;i+=s.value.length}return t.length?(e(n.update({changes:t,userEvent:"delete"})),!0):!1},J5=({state:n,dispatch:e})=>{if(n.readOnly)return!1;let t=n.changeByRange(i=>({changes:{from:i.from,to:i.to,insert:$e.of(["",""])},range:L.cursor(i.from)}));return e(n.update(t,{scrollIntoView:!0,userEvent:"input"})),!0},Z5=({state:n,dispatch:e})=>{if(n.readOnly)return!1;let t=n.changeByRange(i=>{if(!i.empty||i.from==0||i.from==n.doc.length)return{range:i};let r=i.from,s=n.doc.lineAt(r),o=r==s.from?r-1:un(s.text,r-s.from,!1)+s.from,l=r==s.to?r+1:un(s.text,r-s.from,!0)+s.from;return{changes:{from:o,to:l,insert:n.doc.slice(r,l).append(n.doc.slice(o,r))},range:L.cursor(l)}});return t.changes.empty?!1:(e(n.update(t,{scrollIntoView:!0,userEvent:"move.character"})),!0)};function vf(n){let e=[],t=-1;for(let i of n.selection.ranges){let r=n.doc.lineAt(i.from),s=n.doc.lineAt(i.to);if(!i.empty&&i.to==s.from&&(s=n.doc.lineAt(i.to-1)),t>=r.number){let o=e[e.length-1];o.to=s.to,o.ranges.push(i)}else e.push({from:r.from,to:s.to,ranges:[i]});t=s.number+1}return e}function LD(n,e,t){if(n.readOnly)return!1;let i=[],r=[];for(let s of vf(n)){if(t?s.to==n.doc.length:s.from==0)continue;let o=n.doc.lineAt(t?s.to+1:s.from-1),l=o.length+1;if(t){i.push({from:s.to,to:o.to},{from:s.from,insert:o.text+n.lineBreak});for(let a of s.ranges)r.push(L.range(Math.min(n.doc.length,a.anchor+l),Math.min(n.doc.length,a.head+l)))}else{i.push({from:o.from,to:s.from},{from:s.to,insert:n.lineBreak+o.text});for(let a of s.ranges)r.push(L.range(a.anchor-l,a.head-l))}}return i.length?(e(n.update({changes:i,scrollIntoView:!0,selection:L.create(r,n.selection.mainIndex),userEvent:"move.line"})),!0):!1}const Y5=({state:n,dispatch:e})=>LD(n,e,!1),X5=({state:n,dispatch:e})=>LD(n,e,!0);function FD(n,e,t){if(n.readOnly)return!1;let i=[];for(let r of vf(n))t?i.push({from:r.from,insert:n.doc.slice(r.from,r.to)+n.lineBreak}):i.push({from:r.to,insert:n.lineBreak+n.doc.slice(r.from,r.to)});return e(n.update({changes:i,scrollIntoView:!0,userEvent:"input.copyline"})),!0}const Q5=({state:n,dispatch:e})=>FD(n,e,!1),e9=({state:n,dispatch:e})=>FD(n,e,!0),t9=n=>{if(n.state.readOnly)return!1;let{state:e}=n,t=e.changes(vf(e).map(({from:r,to:s})=>(r>0?r--:s<e.doc.length&&s++,{from:r,to:s}))),i=kl(e.selection,r=>n.moveVertically(r,!0)).map(t);return n.dispatch({changes:t,selection:i,scrollIntoView:!0,userEvent:"delete.line"}),!0},D$=({state:n,dispatch:e})=>(e(n.update(n.replaceSelection(n.lineBreak),{scrollIntoView:!0,userEvent:"input"})),!0);function i9(n,e){if(/\(\)|\[\]|\{\}/.test(n.sliceDoc(e-1,e+1)))return{from:e,to:e};let t=ei(n).resolveInner(e),i=t.childBefore(e),r=t.childAfter(e),s;return i&&r&&i.to<=e&&r.from>=e&&(s=i.type.prop(Pe.closedBy))&&s.indexOf(r.name)>-1&&n.doc.lineAt(i.to).from==n.doc.lineAt(r.from).from?{from:i.to,to:r.from}:null}const n9=ND(!1),r9=ND(!0);function ND(n){return({state:e,dispatch:t})=>{if(e.readOnly)return!1;let i=e.changeByRange(r=>{let{from:s,to:o}=r,l=e.doc.lineAt(s),a=!n&&s==o&&i9(e,s);n&&(s=o=(o<=l.to?l:e.doc.lineAt(o)).to);let h=new nf(e,{simulateBreak:s,simulateDoubleBreak:!!a}),c=dy(h,s);for(c==null&&(c=/^\s*/.exec(e.doc.lineAt(s).text)[0].length);o<l.to&&/\s/.test(l.text[o-l.from]);)o++;a?{from:s,to:o}=a:s>l.from&&s<l.from+100&&!/\S/.test(l.text.slice(0,s))&&(s=l.from);let u=["",dh(e,c)];return a&&u.push(dh(e,h.lineIndent(l.from,-1))),{changes:{from:s,to:o,insert:$e.of(u)},range:L.cursor(s+1+u[1].length)}});return t(e.update(i,{scrollIntoView:!0,userEvent:"input"})),!0}}function _y(n,e){let t=-1;return n.changeByRange(i=>{let r=[];for(let o=i.from;o<=i.to;){let l=n.doc.lineAt(o);l.number>t&&(i.empty||i.to>l.from)&&(e(l,r,i),t=l.number),o=l.to+1}let s=n.changes(r);return{changes:r,range:L.range(s.mapPos(i.anchor,1),s.mapPos(i.head,1))}})}const s9=({state:n,dispatch:e})=>{if(n.readOnly)return!1;let t=Object.create(null),i=new nf(n,{overrideIndentation:s=>{let o=t[s];return o==null?-1:o}}),r=_y(n,(s,o,l)=>{let a=dy(i,s.from);if(a==null)return;/\S/.test(s.text)||(a=0);let h=/^\s*/.exec(s.text)[0],c=dh(n,a);(h!=c||l.from<s.from+h.length)&&(t[s.from]=a,o.push({from:s.from,to:s.from+h.length,insert:c}))});return r.changes.empty||e(n.update(r,{userEvent:"indent"})),!0},Dy=({state:n,dispatch:e})=>n.readOnly?!1:(e(n.update(_y(n,(t,i)=>{i.push({from:t.from,insert:n.facet(fy)})}),{userEvent:"input.indent"})),!0),ID=({state:n,dispatch:e})=>n.readOnly?!1:(e(n.update(_y(n,(t,i)=>{let r=/^\s*/.exec(t.text)[0];if(!r)return;let s=qa(r,n.tabSize),o=0,l=dh(n,Math.max(0,s-bo(n)));for(;o<r.length&&o<l.length&&r.charCodeAt(o)==l.charCodeAt(o);)o++;i.push({from:t.from+o,to:t.from+r.length,insert:l.slice(o)})}),{userEvent:"delete.dedent"})),!0),M$=({state:n,dispatch:e})=>n.selection.ranges.some(t=>!t.empty)?Dy({state:n,dispatch:e}):(e(n.update(n.replaceSelection("	"),{scrollIntoView:!0,userEvent:"input"})),!0),o9=[{key:"Ctrl-b",run:nD,shift:mD,preventDefault:!0},{key:"Ctrl-f",run:rD,shift:gD},{key:"Ctrl-p",run:aD,shift:wD},{key:"Ctrl-n",run:hD,shift:bD},{key:"Ctrl-a",run:R5,shift:H5},{key:"Ctrl-e",run:L5,shift:z5},{key:"Ctrl-d",run:TD},{key:"Ctrl-h",run:Oy},{key:"Ctrl-k",run:RD},{key:"Ctrl-Alt-h",run:BD},{key:"Ctrl-o",run:J5},{key:"Ctrl-t",run:Z5},{key:"Ctrl-v",run:Ay}],l9=[{key:"ArrowLeft",run:nD,shift:mD,preventDefault:!0},{key:"Mod-ArrowLeft",mac:"Alt-ArrowLeft",run:M5,shift:N5},{mac:"Cmd-ArrowLeft",run:dD,shift:AD},{key:"ArrowRight",run:rD,shift:gD,preventDefault:!0},{key:"Mod-ArrowRight",mac:"Alt-ArrowRight",run:E5,shift:I5},{mac:"Cmd-ArrowRight",run:fD,shift:CD},{key:"ArrowUp",run:aD,shift:wD,preventDefault:!0},{mac:"Cmd-ArrowUp",run:OD,shift:DD},{mac:"Ctrl-ArrowUp",run:uD,shift:SD},{key:"ArrowDown",run:hD,shift:bD,preventDefault:!0},{mac:"Cmd-ArrowDown",run:_D,shift:MD},{mac:"Ctrl-ArrowDown",run:Ay,shift:kD},{key:"PageUp",run:uD,shift:SD},{key:"PageDown",run:Ay,shift:kD},{key:"Home",run:dD,shift:AD,preventDefault:!0},{key:"Mod-Home",run:OD,shift:DD},{key:"End",run:fD,shift:CD,preventDefault:!0},{key:"Mod-End",run:_D,shift:MD},{key:"Enter",run:n9},{key:"Mod-a",run:j5},{key:"Backspace",run:Oy,shift:Oy},{key:"Delete",run:TD},{key:"Mod-Backspace",mac:"Alt-Backspace",run:BD},{key:"Mod-Delete",mac:"Alt-Delete",run:K5},{mac:"Mod-Backspace",run:G5},{mac:"Mod-Delete",run:RD}].concat(o9.map(n=>({mac:n.key,run:n.run,shift:n.shift}))),a9=[{key:"Alt-ArrowLeft",mac:"Ctrl-ArrowLeft",run:P5,shift:W5},{key:"Alt-ArrowRight",mac:"Ctrl-ArrowRight",run:B5,shift:V5},{key:"Alt-ArrowUp",run:Y5},{key:"Shift-Alt-ArrowUp",run:Q5},{key:"Alt-ArrowDown",run:X5},{key:"Shift-Alt-ArrowDown",run:e9},{key:"Escape",run:q5},{key:"Mod-Enter",run:r9},{key:"Alt-l",mac:"Ctrl-l",run:$5},{key:"Mod-i",run:U5,preventDefault:!0},{key:"Mod-[",run:ID},{key:"Mod-]",run:Dy},{key:"Mod-Alt-\\",run:s9},{key:"Shift-Mod-k",run:t9},{key:"Shift-Mod-\\",run:F5},{key:"Mod-/",run:h5},{key:"Alt-A",run:u5}].concat(l9),h9={key:"Tab",run:Dy,shift:ID};function mt(){var n=arguments[0];typeof n=="string"&&(n=document.createElement(n));var e=1,t=arguments[1];if(t&&typeof t=="object"&&t.nodeType==null&&!Array.isArray(t)){for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var r=t[i];typeof r=="string"?n.setAttribute(i,r):r!=null&&(n[i]=r)}e++}for(;e<arguments.length;e++)WD(n,arguments[e]);return n}function WD(n,e){if(typeof e=="string")n.appendChild(document.createTextNode(e));else if(e!=null)if(e.nodeType!=null)n.appendChild(e);else if(Array.isArray(e))for(var t=0;t<e.length;t++)WD(n,e[t]);else throw new RangeError("Unsupported child node: "+e)}const VD=typeof String.prototype.normalize=="function"?n=>n.normalize("NFKD"):n=>n;class Cl{constructor(e,t,i=0,r=e.length,s){this.value={from:0,to:0},this.done=!1,this.matches=[],this.buffer="",this.bufferPos=0,this.iter=e.iterRange(i,r),this.bufferStart=i,this.normalize=s?o=>s(VD(o)):VD,this.query=this.normalize(t)}peek(){if(this.bufferPos==this.buffer.length){if(this.bufferStart+=this.buffer.length,this.iter.next(),this.iter.done)return-1;this.bufferPos=0,this.buffer=this.iter.value}return xi(this.buffer,this.bufferPos)}next(){for(;this.matches.length;)this.matches.pop();return this.nextOverlapping()}nextOverlapping(){for(;;){let e=this.peek();if(e<0)return this.done=!0,this;let t=Qg(e),i=this.bufferStart+this.bufferPos;this.bufferPos+=kn(e);let r=this.normalize(t);for(let s=0,o=i;;s++){let l=r.charCodeAt(s),a=this.match(l,o);if(a)return this.value=a,this;if(s==r.length-1)break;o==i&&s<t.length&&t.charCodeAt(s)==l&&o++}}}match(e,t){let i=null;for(let r=0;r<this.matches.length;r+=2){let s=this.matches[r],o=!1;this.query.charCodeAt(s)==e&&(s==this.query.length-1?i={from:this.matches[r+1],to:t+1}:(this.matches[r]++,o=!0)),o||(this.matches.splice(r,2),r-=2)}return this.query.charCodeAt(0)==e&&(this.query.length==1?i={from:t,to:t+1}:this.matches.push(1,t)),i}}typeof Symbol!="undefined"&&(Cl.prototype[Symbol.iterator]=function(){return this});const HD={from:-1,to:-1,match:/.*/.exec("")},My="gm"+(/x/.unicode==null?"":"u");class zD{constructor(e,t,i,r=0,s=e.length){if(this.to=s,this.curLine="",this.done=!1,this.value=HD,/\\[sWDnr]|\n|\r|\[\^/.test(t))return new jD(e,t,i,r,s);this.re=new RegExp(t,My+(i!=null&&i.ignoreCase?"i":"")),this.iter=e.iter();let o=e.lineAt(r);this.curLineStart=o.from,this.matchPos=r,this.getLine(this.curLineStart)}getLine(e){this.iter.next(e),this.iter.lineBreak?this.curLine="":(this.curLine=this.iter.value,this.curLineStart+this.curLine.length>this.to&&(this.curLine=this.curLine.slice(0,this.to-this.curLineStart)),this.iter.next())}nextLine(){this.curLineStart=this.curLineStart+this.curLine.length+1,this.curLineStart>this.to?this.curLine="":this.getLine(0)}next(){for(let e=this.matchPos-this.curLineStart;;){this.re.lastIndex=e;let t=this.matchPos<=this.to&&this.re.exec(this.curLine);if(t){let i=this.curLineStart+t.index,r=i+t[0].length;if(this.matchPos=r+(i==r?1:0),i==this.curLine.length&&this.nextLine(),i<r||i>this.value.to)return this.value={from:i,to:r,match:t},this;e=this.matchPos-this.curLineStart}else if(this.curLineStart+this.curLine.length<this.to)this.nextLine(),e=0;else return this.done=!0,this}}}const Ey=new WeakMap;class Al{constructor(e,t){this.from=e,this.text=t}get to(){return this.from+this.text.length}static get(e,t,i){let r=Ey.get(e);if(!r||r.from>=i||r.to<=t){let l=new Al(t,e.sliceString(t,i));return Ey.set(e,l),l}if(r.from==t&&r.to==i)return r;let{text:s,from:o}=r;return o>t&&(s=e.sliceString(t,o)+s,o=t),r.to<i&&(s+=e.sliceString(r.to,i)),Ey.set(e,new Al(o,s)),new Al(t,s.slice(t-o,i-o))}}class jD{constructor(e,t,i,r,s){this.text=e,this.to=s,this.done=!1,this.value=HD,this.matchPos=r,this.re=new RegExp(t,My+(i!=null&&i.ignoreCase?"i":"")),this.flat=Al.get(e,r,this.chunkEnd(r+5e3))}chunkEnd(e){return e>=this.to?this.to:this.text.lineAt(e).to}next(){for(;;){let e=this.re.lastIndex=this.matchPos-this.flat.from,t=this.re.exec(this.flat.text);if(t&&!t[0]&&t.index==e&&(this.re.lastIndex=e+1,t=this.re.exec(this.flat.text)),t&&this.flat.to<this.to&&t.index+t[0].length>this.flat.text.length-10&&(t=null),t){let i=this.flat.from+t.index,r=i+t[0].length;return this.value={from:i,to:r,match:t},this.matchPos=r+(i==r?1:0),this}else{if(this.flat.to==this.to)return this.done=!0,this;this.flat=Al.get(this.text,this.flat.from,this.chunkEnd(this.flat.from+this.flat.text.length*2))}}}}typeof Symbol!="undefined"&&(zD.prototype[Symbol.iterator]=jD.prototype[Symbol.iterator]=function(){return this});function c9(n){try{return new RegExp(n,My),!0}catch{return!1}}function Ty(n){let e=mt("input",{class:"cm-textfield",name:"line"}),t=mt("form",{class:"cm-gotoLine",onkeydown:r=>{r.keyCode==27?(r.preventDefault(),n.dispatch({effects:wf.of(!1)}),n.focus()):r.keyCode==13&&(r.preventDefault(),i())},onsubmit:r=>{r.preventDefault(),i()}},mt("label",n.state.phrase("Go to line"),": ",e)," ",mt("button",{class:"cm-button",type:"submit"},n.state.phrase("go")));function i(){let r=/^([+-])?(\d+)?(:\d+)?(%)?$/.exec(e.value);if(!r)return;let{state:s}=n,o=s.doc.lineAt(s.selection.main.head),[,l,a,h,c]=r,u=h?+h.slice(1):0,f=a?+a:o.number;if(a&&c){let p=f/100;l&&(p=p*(l=="-"?-1:1)+o.number/s.doc.lines),f=Math.round(s.doc.lines*p)}else a&&l&&(f=f*(l=="-"?-1:1)+o.number);let d=s.doc.line(Math.max(1,Math.min(s.doc.lines,f)));n.dispatch({effects:wf.of(!1),selection:L.cursor(d.from+Math.max(0,Math.min(u,d.length))),scrollIntoView:!0}),n.focus()}return{dom:t}}const wf=ke.define(),$D=zt.define({create(){return!0},update(n,e){for(let t of e.effects)t.is(wf)&&(n=t.value);return n},provide:n=>lh.from(n,e=>e?Ty:null)}),u9=n=>{let e=oh(n,Ty);if(!e){let t=[wf.of(!0)];n.state.field($D,!1)==null&&t.push(ke.appendConfig.of([$D,f9])),n.dispatch({effects:t}),e=oh(n,Ty)}return e&&e.dom.querySelector("input").focus(),!0},f9=le.baseTheme({".cm-panel.cm-gotoLine":{padding:"2px 6px 4px","& label":{fontSize:"80%"}}}),d9={highlightWordAroundCursor:!1,minSelectionLength:1,maxMatches:100,wholeWords:!1},UD=he.define({combine(n){return nr(n,d9,{highlightWordAroundCursor:(e,t)=>e||t,minSelectionLength:Math.min,maxMatches:Math.min})}});function p9(n){let e=[w9,v9];return n&&e.push(UD.of(n)),e}const m9=ue.mark({class:"cm-selectionMatch"}),g9=ue.mark({class:"cm-selectionMatch cm-selectionMatch-main"});function qD(n,e,t,i){return(t==0||n(e.sliceDoc(t-1,t))!=Hi.Word)&&(i==e.doc.length||n(e.sliceDoc(i,i+1))!=Hi.Word)}function y9(n,e,t,i){return n(e.sliceDoc(t,t+1))==Hi.Word&&n(e.sliceDoc(i-1,i))==Hi.Word}const v9=Nt.fromClass(class{constructor(n){this.decorations=this.getDeco(n)}update(n){(n.selectionSet||n.docChanged||n.viewportChanged)&&(this.decorations=this.getDeco(n.view))}getDeco(n){let e=n.state.facet(UD),{state:t}=n,i=t.selection;if(i.ranges.length>1)return ue.none;let r=i.main,s,o=null;if(r.empty){if(!e.highlightWordAroundCursor)return ue.none;let a=t.wordAt(r.head);if(!a)return ue.none;o=t.charCategorizer(r.head),s=t.sliceDoc(a.from,a.to)}else{let a=r.to-r.from;if(a<e.minSelectionLength||a>200)return ue.none;if(e.wholeWords){if(s=t.sliceDoc(r.from,r.to),o=t.charCategorizer(r.head),!(qD(o,t,r.from,r.to)&&y9(o,t,r.from,r.to)))return ue.none}else if(s=t.sliceDoc(r.from,r.to).trim(),!s)return ue.none}let l=[];for(let a of n.visibleRanges){let h=new Cl(t.doc,s,a.from,a.to);for(;!h.next().done;){let{from:c,to:u}=h.value;if((!o||qD(o,t,c,u))&&(r.empty&&c<=r.from&&u>=r.to?l.push(g9.range(c,u)):(c>=r.to||u<=r.from)&&l.push(m9.range(c,u)),l.length>e.maxMatches))return ue.none}}return ue.set(l)}},{decorations:n=>n.decorations}),w9=le.baseTheme({".cm-selectionMatch":{backgroundColor:"#99ff7780"},".cm-searchMatch .cm-selectionMatch":{backgroundColor:"transparent"}}),b9=({state:n,dispatch:e})=>{let{selection:t}=n,i=L.create(t.ranges.map(r=>n.wordAt(r.head)||L.cursor(r.head)),t.mainIndex);return i.eq(t)?!1:(e(n.update({selection:i})),!0)};function x9(n,e){let{main:t,ranges:i}=n.selection,r=n.wordAt(t.head),s=r&&r.from==t.from&&r.to==t.to;for(let o=!1,l=new Cl(n.doc,e,i[i.length-1].to);;)if(l.next(),l.done){if(o)return null;l=new Cl(n.doc,e,0,Math.max(0,i[i.length-1].from-1)),o=!0}else{if(o&&i.some(a=>a.from==l.value.from))continue;if(s){let a=n.wordAt(l.value.from);if(!a||a.from!=l.value.from||a.to!=l.value.to)continue}return l.value}}const S9=({state:n,dispatch:e})=>{let{ranges:t}=n.selection;if(t.some(s=>s.from===s.to))return b9({state:n,dispatch:e});let i=n.sliceDoc(t[0].from,t[0].to);if(n.selection.ranges.some(s=>n.sliceDoc(s.from,s.to)!=i))return!1;let r=x9(n,i);return r?(e(n.update({selection:n.selection.addRange(L.range(r.from,r.to),!1),effects:le.scrollIntoView(r.to)})),!0):!1},bf=he.define({combine(n){var e;return{top:n.reduce((t,i)=>t!=null?t:i.top,void 0)||!1,caseSensitive:n.reduce((t,i)=>t!=null?t:i.caseSensitive,void 0)||!1,createPanel:((e=n.find(t=>t.createPanel))===null||e===void 0?void 0:e.createPanel)||(t=>new P9(t))}}});function E$(n){return n?[bf.of(n),Fy]:Fy}class KD{constructor(e){this.search=e.search,this.caseSensitive=!!e.caseSensitive,this.regexp=!!e.regexp,this.replace=e.replace||"",this.valid=!!this.search&&(!this.regexp||c9(this.search)),this.unquoted=e.literal?this.search:this.search.replace(/\\([nrt\\])/g,(t,i)=>i=="n"?`
`:i=="r"?"\r":i=="t"?"	":"\\")}eq(e){return this.search==e.search&&this.replace==e.replace&&this.caseSensitive==e.caseSensitive&&this.regexp==e.regexp}create(){return this.regexp?new C9(this):new k9(this)}getCursor(e,t=0,i=e.length){return this.regexp?_l(this,e,t,i):Ol(this,e,t,i)}}class GD{constructor(e){this.spec=e}}function Ol(n,e,t,i){return new Cl(e,n.unquoted,t,i,n.caseSensitive?void 0:r=>r.toLowerCase())}class k9 extends GD{constructor(e){super(e)}nextMatch(e,t,i){let r=Ol(this.spec,e,i,e.length).nextOverlapping();return r.done&&(r=Ol(this.spec,e,0,t).nextOverlapping()),r.done?null:r.value}prevMatchInRange(e,t,i){for(let r=i;;){let s=Math.max(t,r-1e4-this.spec.unquoted.length),o=Ol(this.spec,e,s,r),l=null;for(;!o.nextOverlapping().done;)l=o.value;if(l)return l;if(s==t)return null;r-=1e4}}prevMatch(e,t,i){return this.prevMatchInRange(e,0,t)||this.prevMatchInRange(e,i,e.length)}getReplacement(e){return this.spec.replace}matchAll(e,t){let i=Ol(this.spec,e,0,e.length),r=[];for(;!i.next().done;){if(r.length>=t)return null;r.push(i.value)}return r}highlight(e,t,i,r){let s=Ol(this.spec,e,Math.max(0,t-this.spec.unquoted.length),Math.min(i+this.spec.unquoted.length,e.length));for(;!s.next().done;)r(s.value.from,s.value.to)}}function _l(n,e,t,i){return new zD(e,n.search,n.caseSensitive?void 0:{ignoreCase:!0},t,i)}class C9 extends GD{nextMatch(e,t,i){let r=_l(this.spec,e,i,e.length).next();return r.done&&(r=_l(this.spec,e,0,t).next()),r.done?null:r.value}prevMatchInRange(e,t,i){for(let r=1;;r++){let s=Math.max(t,i-r*1e4),o=_l(this.spec,e,s,i),l=null;for(;!o.next().done;)l=o.value;if(l&&(s==t||l.from>s+10))return l;if(s==t)return null}}prevMatch(e,t,i){return this.prevMatchInRange(e,0,t)||this.prevMatchInRange(e,i,e.length)}getReplacement(e){return this.spec.replace.replace(/\$([$&\d+])/g,(t,i)=>i=="$"?"$":i=="&"?e.match[0]:i!="0"&&+i<e.match.length?e.match[i]:t)}matchAll(e,t){let i=_l(this.spec,e,0,e.length),r=[];for(;!i.next().done;){if(r.length>=t)return null;r.push(i.value)}return r}highlight(e,t,i,r){let s=_l(this.spec,e,Math.max(0,t-250),Math.min(i+250,e.length));for(;!s.next().done;)r(s.value.from,s.value.to)}}const wh=ke.define(),Py=ke.define(),Nr=zt.define({create(n){return new By(kf(n).create(),null)},update(n,e){for(let t of e.effects)t.is(wh)?n=new By(t.value.create(),n.panel):t.is(Py)&&(n=new By(n.query,t.value?Ry:null));return n},provide:n=>lh.from(n,e=>e.panel)});function T$(n){let e=n.field(Nr,!1);return e?e.query.spec:kf(n)}class By{constructor(e,t){this.query=e,this.panel=t}}const A9=ue.mark({class:"cm-searchMatch"}),O9=ue.mark({class:"cm-searchMatch cm-searchMatch-selected"}),_9=Nt.fromClass(class{constructor(n){this.view=n,this.decorations=this.highlight(n.state.field(Nr))}update(n){let e=n.state.field(Nr);(e!=n.startState.field(Nr)||n.docChanged||n.selectionSet||n.viewportChanged)&&(this.decorations=this.highlight(e))}highlight({query:n,panel:e}){if(!e||!n.spec.valid)return ue.none;let{view:t}=this,i=new ks;for(let r=0,s=t.visibleRanges,o=s.length;r<o;r++){let{from:l,to:a}=s[r];for(;r<o-1&&a>s[r+1].from-2*250;)a=s[++r].to;n.highlight(t.state.doc,l,a,(h,c)=>{let u=t.state.selection.ranges.some(f=>f.from==h&&f.to==c);i.add(h,c,u?O9:A9)})}return i.finish()}},{decorations:n=>n.decorations});function bh(n){return e=>{let t=e.state.field(Nr,!1);return t&&t.query.spec.valid?n(e,t):ZD(e)}}const xf=bh((n,{query:e})=>{let{from:t,to:i}=n.state.selection.main,r=e.nextMatch(n.state.doc,t,i);return!r||r.from==t&&r.to==i?!1:(n.dispatch({selection:{anchor:r.from,head:r.to},scrollIntoView:!0,effects:Ly(n,r),userEvent:"select.search"}),!0)}),Sf=bh((n,{query:e})=>{let{state:t}=n,{from:i,to:r}=t.selection.main,s=e.prevMatch(t.doc,i,r);return s?(n.dispatch({selection:{anchor:s.from,head:s.to},scrollIntoView:!0,effects:Ly(n,s),userEvent:"select.search"}),!0):!1}),D9=bh((n,{query:e})=>{let t=e.matchAll(n.state.doc,1e3);return!t||!t.length?!1:(n.dispatch({selection:L.create(t.map(i=>L.range(i.from,i.to))),userEvent:"select.search.matches"}),!0)}),M9=({state:n,dispatch:e})=>{let t=n.selection;if(t.ranges.length>1||t.main.empty)return!1;let{from:i,to:r}=t.main,s=[],o=0;for(let l=new Cl(n.doc,n.sliceDoc(i,r));!l.next().done;){if(s.length>1e3)return!1;l.value.from==i&&(o=s.length),s.push(L.range(l.value.from,l.value.to))}return e(n.update({selection:L.create(s,o),userEvent:"select.search.matches"})),!0},JD=bh((n,{query:e})=>{let{state:t}=n,{from:i,to:r}=t.selection.main;if(t.readOnly)return!1;let s=e.nextMatch(t.doc,i,i);if(!s)return!1;let o=[],l,a;if(s.from==i&&s.to==r&&(a=t.toText(e.getReplacement(s)),o.push({from:s.from,to:s.to,insert:a}),s=e.nextMatch(t.doc,s.from,s.to)),s){let h=o.length==0||o[0].from>=s.to?0:s.to-s.from-a.length;l={anchor:s.from-h,head:s.to-h}}return n.dispatch({changes:o,selection:l,scrollIntoView:!!l,effects:s?Ly(n,s):void 0,userEvent:"input.replace"}),!0}),E9=bh((n,{query:e})=>{if(n.state.readOnly)return!1;let t=e.matchAll(n.state.doc,1e9).map(i=>{let{from:r,to:s}=i;return{from:r,to:s,insert:e.getReplacement(i)}});return t.length?(n.dispatch({changes:t,userEvent:"input.replace.all"}),!0):!1});function Ry(n){return n.state.facet(bf).createPanel(n)}function kf(n,e){var t;let i=n.selection.main,r=i.empty||i.to>i.from+100?"":n.sliceDoc(i.from,i.to),s=(t=e==null?void 0:e.caseSensitive)!==null&&t!==void 0?t:n.facet(bf).caseSensitive;return e&&!r?e:new KD({search:r.replace(/\n/g,"\\n"),caseSensitive:s})}const ZD=n=>{let e=n.state.field(Nr,!1);if(e&&e.panel){let t=oh(n,Ry);if(!t)return!1;let i=t.dom.querySelector("[name=search]");if(i!=n.root.activeElement){let r=kf(n.state,e.query.spec);r.valid&&n.dispatch({effects:wh.of(r)}),i.focus(),i.select()}}else n.dispatch({effects:[Py.of(!0),e?wh.of(kf(n.state,e.query.spec)):ke.appendConfig.of(Fy)]});return!0},YD=n=>{let e=n.state.field(Nr,!1);if(!e||!e.panel)return!1;let t=oh(n,Ry);return t&&t.dom.contains(n.root.activeElement)&&n.focus(),n.dispatch({effects:Py.of(!1)}),!0},T9=[{key:"Mod-f",run:ZD,scope:"editor search-panel"},{key:"F3",run:xf,shift:Sf,scope:"editor search-panel",preventDefault:!0},{key:"Mod-g",run:xf,shift:Sf,scope:"editor search-panel",preventDefault:!0},{key:"Escape",run:YD,scope:"editor search-panel"},{key:"Mod-Shift-l",run:M9},{key:"Alt-g",run:u9},{key:"Mod-d",run:S9,preventDefault:!0}];class P9{constructor(e){this.view=e;let t=this.query=e.state.field(Nr).query.spec;this.commit=this.commit.bind(this),this.searchField=mt("input",{value:t.search,placeholder:Mn(e,"Find"),"aria-label":Mn(e,"Find"),class:"cm-textfield",name:"search",onchange:this.commit,onkeyup:this.commit}),this.replaceField=mt("input",{value:t.replace,placeholder:Mn(e,"Replace"),"aria-label":Mn(e,"Replace"),class:"cm-textfield",name:"replace",onchange:this.commit,onkeyup:this.commit}),this.caseField=mt("input",{type:"checkbox",name:"case",checked:t.caseSensitive,onchange:this.commit}),this.reField=mt("input",{type:"checkbox",name:"re",checked:t.regexp,onchange:this.commit});function i(r,s,o){return mt("button",{class:"cm-button",name:r,onclick:s,type:"button"},o)}this.dom=mt("div",{onkeydown:r=>this.keydown(r),class:"cm-search"},[this.searchField,i("next",()=>xf(e),[Mn(e,"next")]),i("prev",()=>Sf(e),[Mn(e,"previous")]),i("select",()=>D9(e),[Mn(e,"all")]),mt("label",null,[this.caseField,Mn(e,"match case")]),mt("label",null,[this.reField,Mn(e,"regexp")]),...e.state.readOnly?[]:[mt("br"),this.replaceField,i("replace",()=>JD(e),[Mn(e,"replace")]),i("replaceAll",()=>E9(e),[Mn(e,"replace all")]),mt("button",{name:"close",onclick:()=>YD(e),"aria-label":Mn(e,"close"),type:"button"},["\xD7"])]])}commit(){let e=new KD({search:this.searchField.value,caseSensitive:this.caseField.checked,regexp:this.reField.checked,replace:this.replaceField.value});e.eq(this.query)||(this.query=e,this.view.dispatch({effects:wh.of(e)}))}keydown(e){Q3(this.view,e,"search-panel")?e.preventDefault():e.keyCode==13&&e.target==this.searchField?(e.preventDefault(),(e.shiftKey?Sf:xf)(this.view)):e.keyCode==13&&e.target==this.replaceField&&(e.preventDefault(),JD(this.view))}update(e){for(let t of e.transactions)for(let i of t.effects)i.is(wh)&&!i.value.eq(this.query)&&this.setQuery(i.value)}setQuery(e){this.query=e,this.searchField.value=e.search,this.replaceField.value=e.replace,this.caseField.checked=e.caseSensitive,this.reField.checked=e.regexp}mount(){this.searchField.select()}get pos(){return 80}get top(){return this.view.state.facet(bf).top}}function Mn(n,e){return n.state.phrase(e)}const Cf=30,Af=/[\s\.,:;?!]/;function Ly(n,{from:e,to:t}){let i=n.state.doc.lineAt(e).from,r=n.state.doc.lineAt(t).to,s=Math.max(i,e-Cf),o=Math.min(r,t+Cf),l=n.state.sliceDoc(s,o);if(s!=i){for(let a=0;a<Cf;a++)if(!Af.test(l[a+1])&&Af.test(l[a])){l=l.slice(a);break}}if(o!=r){for(let a=l.length-1;a>l.length-Cf;a--)if(!Af.test(l[a-1])&&Af.test(l[a])){l=l.slice(0,a);break}}return le.announce.of(`${n.state.phrase("current match")}. ${l} ${n.state.phrase("on line")} ${n.state.doc.lineAt(e).number}`)}const B9=le.baseTheme({".cm-panel.cm-search":{padding:"2px 6px 4px",position:"relative","& [name=close]":{position:"absolute",top:"0",right:"4px",backgroundColor:"inherit",border:"none",font:"inherit",padding:0,margin:0},"& input, & button, & label":{margin:".2em .6em .2em 0"},"& input[type=checkbox]":{marginRight:".2em"},"& label":{fontSize:"80%",whiteSpace:"pre"}},"&light .cm-searchMatch":{backgroundColor:"#ffff0054"},"&dark .cm-searchMatch":{backgroundColor:"#00ffff8a"},"&light .cm-searchMatch-selected":{backgroundColor:"#ff6a0054"},"&dark .cm-searchMatch-selected":{backgroundColor:"#ff00ff8a"}}),Fy=[Nr,dl.lowest(_9),B9];class XD{constructor(e,t,i){this.state=e,this.pos=t,this.explicit=i,this.abortListeners=[]}tokenBefore(e){let t=ei(this.state).resolveInner(this.pos,-1);for(;t&&e.indexOf(t.name)<0;)t=t.parent;return t?{from:t.from,to:this.pos,text:this.state.sliceDoc(t.from,this.pos),type:t.type}:null}matchBefore(e){let t=this.state.doc.lineAt(this.pos),i=Math.max(t.from,this.pos-250),r=t.text.slice(i-t.from,this.pos-t.from),s=r.search(tM(e,!1));return s<0?null:{from:i+s,to:this.pos,text:r.slice(s)}}get aborted(){return this.abortListeners==null}addEventListener(e,t){e=="abort"&&this.abortListeners&&this.abortListeners.push(t)}}function QD(n){let e=Object.keys(n).join(""),t=/\w/.test(e);return t&&(e=e.replace(/\w/g,"")),`[${t?"\\w":""}${e.replace(/[^\w\s]/g,"\\$&")}]`}function R9(n){let e=Object.create(null),t=Object.create(null);for(let{label:r}of n){e[r[0]]=!0;for(let s=1;s<r.length;s++)t[r[s]]=!0}let i=QD(e)+QD(t)+"*$";return[new RegExp("^"+i),new RegExp(i)]}function L9(n){let e=n.map(r=>typeof r=="string"?{label:r}:r),[t,i]=e.every(r=>/^\w+$/.test(r.label))?[/\w*$/,/\w+$/]:R9(e);return r=>{let s=r.matchBefore(i);return s||r.explicit?{from:s?s.from:r.pos,options:e,validFor:t}:null}}function P$(n,e){return t=>{for(let i=syntaxTree(t.state).resolveInner(t.pos,-1);i;i=i.parent)if(n.indexOf(i.name)>-1)return e(t);return null}}function B$(n,e){return t=>{for(let i=syntaxTree(t.state).resolveInner(t.pos,-1);i;i=i.parent)if(n.indexOf(i.name)>-1)return null;return e(t)}}class eM{constructor(e,t,i){this.completion=e,this.source=t,this.match=i}}function Bs(n){return n.selection.main.head}function tM(n,e){var t;let{source:i}=n,r=e&&i[0]!="^",s=i[i.length-1]!="$";return!r&&!s?n:new RegExp(`${r?"^":""}(?:${i})${s?"$":""}`,(t=n.flags)!==null&&t!==void 0?t:n.ignoreCase?"i":"")}const F9=Ss.define();function iM(n,e){const t=e.completion.apply||e.completion.label;let i=e.source;typeof t=="string"?n.dispatch(n.state.changeByRange(r=>{if(r==n.state.selection.main)return{changes:{from:i.from,to:i.to,insert:t},range:L.cursor(i.from+t.length)};let s=i.to-i.from;return!r.empty||s&&n.state.sliceDoc(r.from-s,r.from)!=n.state.sliceDoc(i.from,i.to)?{range:r}:{changes:{from:r.from-s,to:r.from,insert:t},range:L.cursor(r.from-s+t.length)}}),{userEvent:"input.complete",annotations:F9.of(e.completion)}):t(n,e.completion,i.from,i.to)}const nM=new WeakMap;function N9(n){if(!Array.isArray(n))return n;let e=nM.get(n);return e||nM.set(n,e=L9(n)),e}class I9{constructor(e){this.pattern=e,this.chars=[],this.folded=[],this.any=[],this.precise=[],this.byWord=[];for(let t=0;t<e.length;){let i=xi(e,t),r=kn(i);this.chars.push(i);let s=e.slice(t,t+r),o=s.toUpperCase();this.folded.push(xi(o==s?s.toLowerCase():o,0)),t+=r}this.astral=e.length!=this.chars.length}match(e){if(this.pattern.length==0)return[0];if(e.length<this.pattern.length)return null;let{chars:t,folded:i,any:r,precise:s,byWord:o}=this;if(t.length==1){let C=xi(e,0);return C==t[0]?[0,0,kn(C)]:C==i[0]?[-200,0,kn(C)]:null}let l=e.indexOf(this.pattern);if(l==0)return[0,0,this.pattern.length];let a=t.length,h=0;if(l<0){for(let C=0,x=Math.min(e.length,200);C<x&&h<a;){let b=xi(e,C);(b==t[h]||b==i[h])&&(r[h++]=C),C+=kn(b)}if(h<a)return null}let c=0,u=0,f=!1,d=0,p=-1,g=-1,y=/[a-z]/.test(e),v=!0;for(let C=0,x=Math.min(e.length,200),b=0;C<x&&u<a;){let S=xi(e,C);l<0&&(c<a&&S==t[c]&&(s[c++]=C),d<a&&(S==t[d]||S==i[d]?(d==0&&(p=C),g=C+1,d++):d=0));let k,A=S<255?S>=48&&S<=57||S>=97&&S<=122?2:S>=65&&S<=90?1:0:(k=Qg(S))!=k.toLowerCase()?1:k!=k.toUpperCase()?2:0;(!C||A==1&&y||b==0&&A!=0)&&(t[u]==S||i[u]==S&&(f=!0)?o[u++]=C:o.length&&(v=!1)),b=A,C+=kn(S)}return u==a&&o[0]==0&&v?this.result(-100+(f?-200:0),o,e):d==a&&p==0?[-200-e.length,0,g]:l>-1?[-700-e.length,l,l+this.pattern.length]:d==a?[-200+-700-e.length,p,g]:u==a?this.result(-100+(f?-200:0)+-700+(v?0:-1100),o,e):t.length==2?null:this.result((r[0]?-700:0)+-200+-1100,r,e)}result(e,t,i){let r=[e-i.length],s=1;for(let o of t){let l=o+(this.astral?kn(xi(i,o)):1);s>1&&r[s-1]==o?r[s-1]=l:(r[s++]=o,r[s++]=l)}return r}}const xo=he.define({combine(n){return nr(n,{activateOnTyping:!0,override:null,maxRenderedOptions:100,defaultKeymap:!0,optionClass:()=>"",aboveCursor:!1,icons:!0,addToOptions:[]},{defaultKeymap:(e,t)=>e&&t,icons:(e,t)=>e&&t,optionClass:(e,t)=>i=>W9(e(i),t(i)),addToOptions:(e,t)=>e.concat(t)})}});function W9(n,e){return n?e?n+" "+e:n:e}function V9(n){let e=n.addToOptions.slice();return n.icons&&e.push({render(t){let i=document.createElement("div");return i.classList.add("cm-completionIcon"),t.type&&i.classList.add(...t.type.split(/\s+/g).map(r=>"cm-completionIcon-"+r)),i.setAttribute("aria-hidden","true"),i},position:20}),e.push({render(t,i,r){let s=document.createElement("span");s.className="cm-completionLabel";let{label:o}=t,l=0;for(let a=1;a<r.length;){let h=r[a++],c=r[a++];h>l&&s.appendChild(document.createTextNode(o.slice(l,h)));let u=s.appendChild(document.createElement("span"));u.appendChild(document.createTextNode(o.slice(h,c))),u.className="cm-completionMatchedText",l=c}return l<o.length&&s.appendChild(document.createTextNode(o.slice(l))),s},position:50},{render(t){if(!t.detail)return null;let i=document.createElement("span");return i.className="cm-completionDetail",i.textContent=t.detail,i},position:80}),e.sort((t,i)=>t.position-i.position).map(t=>t.render)}function rM(n,e,t){if(n<=t)return{from:0,to:n};if(e<=n>>1){let r=Math.floor(e/t);return{from:r*t,to:(r+1)*t}}let i=Math.floor((n-e)/t);return{from:n-(i+1)*t,to:n-i*t}}class H9{constructor(e,t){this.view=e,this.stateField=t,this.info=null,this.placeInfo={read:()=>this.measureInfo(),write:l=>this.positionInfo(l),key:this};let i=e.state.field(t),{options:r,selected:s}=i.open,o=e.state.facet(xo);this.optionContent=V9(o),this.optionClass=o.optionClass,this.range=rM(r.length,s,o.maxRenderedOptions),this.dom=document.createElement("div"),this.dom.className="cm-tooltip-autocomplete",this.dom.addEventListener("mousedown",l=>{for(let a=l.target,h;a&&a!=this.dom;a=a.parentNode)if(a.nodeName=="LI"&&(h=/-(\d+)$/.exec(a.id))&&+h[1]<r.length){iM(e,r[+h[1]]),l.preventDefault();return}}),this.list=this.dom.appendChild(this.createListBox(r,i.id,this.range)),this.list.addEventListener("scroll",()=>{this.info&&this.view.requestMeasure(this.placeInfo)})}mount(){this.updateSel()}update(e){e.state.field(this.stateField)!=e.startState.field(this.stateField)&&this.updateSel()}positioned(){this.info&&this.view.requestMeasure(this.placeInfo)}updateSel(){let e=this.view.state.field(this.stateField),t=e.open;if((t.selected<this.range.from||t.selected>=this.range.to)&&(this.range=rM(t.options.length,t.selected,this.view.state.facet(xo).maxRenderedOptions),this.list.remove(),this.list=this.dom.appendChild(this.createListBox(t.options,e.id,this.range)),this.list.addEventListener("scroll",()=>{this.info&&this.view.requestMeasure(this.placeInfo)})),this.updateSelectedOption(t.selected)){this.info&&(this.info.remove(),this.info=null);let{completion:i}=t.options[t.selected],{info:r}=i;if(!r)return;let s=typeof r=="string"?document.createTextNode(r):r(i);if(!s)return;"then"in s?s.then(o=>{o&&this.view.state.field(this.stateField,!1)==e&&this.addInfoPane(o)}).catch(o=>dn(this.view.state,o,"completion info")):this.addInfoPane(s)}}addInfoPane(e){let t=this.info=document.createElement("div");t.className="cm-tooltip cm-completionInfo",t.appendChild(e),this.dom.appendChild(t),this.view.requestMeasure(this.placeInfo)}updateSelectedOption(e){let t=null;for(let i=this.list.firstChild,r=this.range.from;i;i=i.nextSibling,r++)r==e?i.hasAttribute("aria-selected")||(i.setAttribute("aria-selected","true"),t=i):i.hasAttribute("aria-selected")&&i.removeAttribute("aria-selected");return t&&j9(this.list,t),t}measureInfo(){let e=this.dom.querySelector("[aria-selected]");if(!e||!this.info)return null;let t=this.dom.getBoundingClientRect(),i=this.info.getBoundingClientRect(),r=e.getBoundingClientRect();if(r.top>Math.min(innerHeight,t.bottom)-10||r.bottom<Math.max(0,t.top)+10)return null;let s=Math.max(0,Math.min(r.top,innerHeight-i.height))-t.top,o=this.view.textDirection==kt.RTL,l=t.left,a=innerWidth-t.right;return o&&l<Math.min(i.width,a)?o=!1:!o&&a<Math.min(i.width,l)&&(o=!0),{top:s,left:o}}positionInfo(e){this.info&&(this.info.style.top=(e?e.top:-1e6)+"px",e&&(this.info.classList.toggle("cm-completionInfo-left",e.left),this.info.classList.toggle("cm-completionInfo-right",!e.left)))}createListBox(e,t,i){const r=document.createElement("ul");r.id=t,r.setAttribute("role","listbox"),r.setAttribute("aria-expanded","true");for(let s=i.from;s<i.to;s++){let{completion:o,match:l}=e[s];const a=r.appendChild(document.createElement("li"));a.id=t+"-"+s,a.setAttribute("role","option");let h=this.optionClass(o);h&&(a.className=h);for(let c of this.optionContent){let u=c(o,this.view.state,l);u&&a.appendChild(u)}}return i.from&&r.classList.add("cm-completionListIncompleteTop"),i.to<e.length&&r.classList.add("cm-completionListIncompleteBottom"),r}}function z9(n){return e=>new H9(e,n)}function j9(n,e){let t=n.getBoundingClientRect(),i=e.getBoundingClientRect();i.top<t.top?n.scrollTop-=t.top-i.top:i.bottom>t.bottom&&(n.scrollTop+=i.bottom-t.bottom)}function sM(n){return(n.boost||0)*100+(n.apply?10:0)+(n.info?5:0)+(n.type?1:0)}function $9(n,e){let t=[],i=0;for(let o of n)if(o.hasResult())if(o.result.filter===!1)for(let l of o.result.options)t.push(new eM(l,o,[1e9-i++]));else{let l=new I9(e.sliceDoc(o.from,o.to)),a;for(let h of o.result.options)(a=l.match(h.label))&&(h.boost!=null&&(a[0]+=h.boost),t.push(new eM(h,o,a)))}let r=[],s=null;for(let o of t.sort(G9))!s||s.label!=o.completion.label||s.detail!=o.completion.detail||s.type!=null&&o.completion.type!=null&&s.type!=o.completion.type||s.apply!=o.completion.apply?r.push(o):sM(o.completion)>sM(s)&&(r[r.length-1]=o),s=o.completion;return r}class xh{constructor(e,t,i,r,s){this.options=e,this.attrs=t,this.tooltip=i,this.timestamp=r,this.selected=s}setSelected(e,t){return e==this.selected||e>=this.options.length?this:new xh(this.options,oM(t,e),this.tooltip,this.timestamp,e)}static build(e,t,i,r,s){let o=$9(e,t);if(!o.length)return null;let l=0;if(r&&r.selected){let a=r.options[r.selected].completion;for(let h=0;h<o.length;h++)if(o[h].completion==a){l=h;break}}return new xh(o,oM(i,l),{pos:e.reduce((a,h)=>h.hasResult()?Math.min(a,h.from):a,1e8),create:z9($i),above:s.aboveCursor},r?r.timestamp:Date.now(),l)}map(e){return new xh(this.options,this.attrs,Object.assign(Object.assign({},this.tooltip),{pos:e.mapPos(this.tooltip.pos)}),this.timestamp,this.selected)}}class Of{constructor(e,t,i){this.active=e,this.id=t,this.open=i}static start(){return new Of(K9,"cm-ac-"+Math.floor(Math.random()*2e6).toString(36),null)}update(e){let{state:t}=e,i=t.facet(xo),s=(i.override||t.languageDataAt("autocomplete",Bs(t)).map(N9)).map(l=>(this.active.find(h=>h.source==l)||new Yi(l,this.active.some(h=>h.state!=0)?1:0)).update(e,i));s.length==this.active.length&&s.every((l,a)=>l==this.active[a])&&(s=this.active);let o=e.selection||s.some(l=>l.hasResult()&&e.changes.touchesRange(l.from,l.to))||!U9(s,this.active)?xh.build(s,t,this.id,this.open,i):this.open&&e.docChanged?this.open.map(e.changes):this.open;!o&&s.every(l=>l.state!=1)&&s.some(l=>l.hasResult())&&(s=s.map(l=>l.hasResult()?new Yi(l.source,0):l));for(let l of e.effects)l.is(Vy)&&(o=o&&o.setSelected(l.value,this.id));return s==this.active&&o==this.open?this:new Of(s,this.id,o)}get tooltip(){return this.open?this.open.tooltip:null}get attrs(){return this.open?this.open.attrs:q9}}function U9(n,e){if(n==e)return!0;for(let t=0,i=0;;){for(;t<n.length&&!n[t].hasResult;)t++;for(;i<e.length&&!e[i].hasResult;)i++;let r=t==n.length,s=i==e.length;if(r||s)return r==s;if(n[t++].result!=e[i++].result)return!1}}const q9={"aria-autocomplete":"list"};function oM(n,e){return{"aria-autocomplete":"list","aria-haspopup":"listbox","aria-activedescendant":n+"-"+e,"aria-controls":n}}const K9=[];function G9(n,e){let t=e.match[0]-n.match[0];return t||n.completion.label.localeCompare(e.completion.label)}function Ny(n){return n.isUserEvent("input.type")?"input":n.isUserEvent("delete.backward")?"delete":null}class Yi{constructor(e,t,i=-1){this.source=e,this.state=t,this.explicitPos=i}hasResult(){return!1}update(e,t){let i=Ny(e),r=this;i?r=r.handleUserEvent(e,i,t):e.docChanged?r=r.handleChange(e):e.selection&&r.state!=0&&(r=new Yi(r.source,0));for(let s of e.effects)if(s.is(Iy))r=new Yi(r.source,1,s.value?Bs(e.state):-1);else if(s.is(Wy))r=new Yi(r.source,0);else if(s.is(lM))for(let o of s.value)o.source==r.source&&(r=o);return r}handleUserEvent(e,t,i){return t=="delete"||!i.activateOnTyping?this.map(e.changes):new Yi(this.source,1)}handleChange(e){return e.changes.touchesRange(Bs(e.startState))?new Yi(this.source,0):this.map(e.changes)}map(e){return e.empty||this.explicitPos<0?this:new Yi(this.source,this.state,e.mapPos(this.explicitPos))}}class Sh extends Yi{constructor(e,t,i,r,s){super(e,2,t),this.result=i,this.from=r,this.to=s}hasResult(){return!0}handleUserEvent(e,t,i){var r;let s=e.changes.mapPos(this.from),o=e.changes.mapPos(this.to,1),l=Bs(e.state);if((this.explicitPos<0?l<=s:l<this.from)||l>o||t=="delete"&&Bs(e.startState)==this.from)return new Yi(this.source,t=="input"&&i.activateOnTyping?1:0);let a=this.explicitPos<0?-1:e.changes.mapPos(this.explicitPos),h;return J9(this.result.validFor,e.state,s,o)?new Sh(this.source,a,this.result,s,o):this.result.update&&(h=this.result.update(this.result,s,o,new XD(e.state,l,a>=0)))?new Sh(this.source,a,h,h.from,(r=h.to)!==null&&r!==void 0?r:Bs(e.state)):new Yi(this.source,1,a)}handleChange(e){return e.changes.touchesRange(this.from,this.to)?new Yi(this.source,0):this.map(e.changes)}map(e){return e.empty?this:new Sh(this.source,this.explicitPos<0?-1:e.mapPos(this.explicitPos),this.result,e.mapPos(this.from),e.mapPos(this.to,1))}}function J9(n,e,t,i){if(!n)return!1;let r=e.sliceDoc(t,i);return typeof n=="function"?n(r,t,i,e):tM(n,!0).test(r)}const Iy=ke.define(),Wy=ke.define(),lM=ke.define({map(n,e){return n.map(t=>t.map(e))}}),Vy=ke.define(),$i=zt.define({create(){return Of.start()},update(n,e){return n.update(e)},provide:n=>[Uu.from(n,e=>e.tooltip),le.contentAttributes.from(n,e=>e.attrs)]}),aM=75;function _f(n,e="option"){return t=>{let i=t.state.field($i,!1);if(!i||!i.open||Date.now()-i.open.timestamp<aM)return!1;let r=1,s;e=="page"&&(s=V4(t,i.open.tooltip))&&(r=Math.max(2,Math.floor(s.dom.offsetHeight/s.dom.querySelector("li").offsetHeight)-1));let o=i.open.selected+r*(n?1:-1),{length:l}=i.open.options;return o<0?o=e=="page"?0:l-1:o>=l&&(o=e=="page"?l-1:0),t.dispatch({effects:Vy.of(o)}),!0}}const Z9=n=>{let e=n.state.field($i,!1);return n.state.readOnly||!e||!e.open||Date.now()-e.open.timestamp<aM?!1:(iM(n,e.open.options[e.open.selected]),!0)},Y9=n=>n.state.field($i,!1)?(n.dispatch({effects:Iy.of(!0)}),!0):!1,X9=n=>{let e=n.state.field($i,!1);return!e||!e.active.some(t=>t.state!=0)?!1:(n.dispatch({effects:Wy.of(null)}),!0)};class Q9{constructor(e,t){this.active=e,this.context=t,this.time=Date.now(),this.updates=[],this.done=void 0}}const hM=50,ez=50,tz=1e3,iz=Nt.fromClass(class{constructor(n){this.view=n,this.debounceUpdate=-1,this.running=[],this.debounceAccept=-1,this.composing=0;for(let e of n.state.field($i).active)e.state==1&&this.startQuery(e)}update(n){let e=n.state.field($i);if(!n.selectionSet&&!n.docChanged&&n.startState.field($i)==e)return;let t=n.transactions.some(i=>(i.selection||i.docChanged)&&!Ny(i));for(let i=0;i<this.running.length;i++){let r=this.running[i];if(t||r.updates.length+n.transactions.length>ez&&Date.now()-r.time>tz){for(let s of r.context.abortListeners)try{s()}catch(o){dn(this.view.state,o)}r.context.abortListeners=null,this.running.splice(i--,1)}else r.updates.push(...n.transactions)}if(this.debounceUpdate>-1&&clearTimeout(this.debounceUpdate),this.debounceUpdate=e.active.some(i=>i.state==1&&!this.running.some(r=>r.active.source==i.source))?setTimeout(()=>this.startUpdate(),hM):-1,this.composing!=0)for(let i of n.transactions)Ny(i)=="input"?this.composing=2:this.composing==2&&i.selection&&(this.composing=3)}startUpdate(){this.debounceUpdate=-1;let{state:n}=this.view,e=n.field($i);for(let t of e.active)t.state==1&&!this.running.some(i=>i.active.source==t.source)&&this.startQuery(t)}startQuery(n){let{state:e}=this.view,t=Bs(e),i=new XD(e,t,n.explicitPos==t),r=new Q9(n,i);this.running.push(r),Promise.resolve(n.source(i)).then(s=>{r.context.aborted||(r.done=s||null,this.scheduleAccept())},s=>{this.view.dispatch({effects:Wy.of(null)}),dn(this.view.state,s)})}scheduleAccept(){this.running.every(n=>n.done!==void 0)?this.accept():this.debounceAccept<0&&(this.debounceAccept=setTimeout(()=>this.accept(),hM))}accept(){var n;this.debounceAccept>-1&&clearTimeout(this.debounceAccept),this.debounceAccept=-1;let e=[],t=this.view.state.facet(xo);for(let i=0;i<this.running.length;i++){let r=this.running[i];if(r.done===void 0)continue;if(this.running.splice(i--,1),r.done){let o=new Sh(r.active.source,r.active.explicitPos,r.done,r.done.from,(n=r.done.to)!==null&&n!==void 0?n:Bs(r.updates.length?r.updates[0].startState:this.view.state));for(let l of r.updates)o=o.update(l,t);if(o.hasResult()){e.push(o);continue}}let s=this.view.state.field($i).active.find(o=>o.source==r.active.source);if(s&&s.state==1)if(r.done==null){let o=new Yi(r.active.source,0);for(let l of r.updates)o=o.update(l,t);o.state!=1&&e.push(o)}else this.startQuery(s)}e.length&&this.view.dispatch({effects:lM.of(e)})}},{eventHandlers:{compositionstart(){this.composing=1},compositionend(){this.composing==3&&setTimeout(()=>this.view.dispatch({effects:Iy.of(!1)}),20),this.composing=0}}}),cM=le.baseTheme({".cm-tooltip.cm-tooltip-autocomplete":{"& > ul":{fontFamily:"monospace",whiteSpace:"nowrap",overflow:"hidden auto",maxWidth_fallback:"700px",maxWidth:"min(700px, 95vw)",minWidth:"250px",maxHeight:"10em",listStyle:"none",margin:0,padding:0,"& > li":{overflowX:"hidden",textOverflow:"ellipsis",cursor:"pointer",padding:"1px 3px",lineHeight:1.2}}},"&light .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#17c",color:"white"},"&dark .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#347",color:"white"},".cm-completionListIncompleteTop:before, .cm-completionListIncompleteBottom:after":{content:'"\xB7\xB7\xB7"',opacity:.5,display:"block",textAlign:"center"},".cm-tooltip.cm-completionInfo":{position:"absolute",padding:"3px 9px",width:"max-content",maxWidth:"300px"},".cm-completionInfo.cm-completionInfo-left":{right:"100%"},".cm-completionInfo.cm-completionInfo-right":{left:"100%"},"&light .cm-snippetField":{backgroundColor:"#00000022"},"&dark .cm-snippetField":{backgroundColor:"#ffffff22"},".cm-snippetFieldPosition":{verticalAlign:"text-top",width:0,height:"1.15em",margin:"0 -0.7px -.7em",borderLeft:"1.4px dotted #888"},".cm-completionMatchedText":{textDecoration:"underline"},".cm-completionDetail":{marginLeft:"0.5em",fontStyle:"italic"},".cm-completionIcon":{fontSize:"90%",width:".8em",display:"inline-block",textAlign:"center",paddingRight:".6em",opacity:"0.6"},".cm-completionIcon-function, .cm-completionIcon-method":{"&:after":{content:"'\u0192'"}},".cm-completionIcon-class":{"&:after":{content:"'\u25CB'"}},".cm-completionIcon-interface":{"&:after":{content:"'\u25CC'"}},".cm-completionIcon-variable":{"&:after":{content:"'\u{1D465}'"}},".cm-completionIcon-constant":{"&:after":{content:"'\u{1D436}'"}},".cm-completionIcon-type":{"&:after":{content:"'\u{1D461}'"}},".cm-completionIcon-enum":{"&:after":{content:"'\u222A'"}},".cm-completionIcon-property":{"&:after":{content:"'\u25A1'"}},".cm-completionIcon-keyword":{"&:after":{content:"'\u{1F511}\uFE0E'"}},".cm-completionIcon-namespace":{"&:after":{content:"'\u25A2'"}},".cm-completionIcon-text":{"&:after":{content:"'abc'",fontSize:"50%",verticalAlign:"middle"}}});class nz{constructor(e,t,i,r){this.field=e,this.line=t,this.from=i,this.to=r}}class Hy{constructor(e,t,i){this.field=e,this.from=t,this.to=i}map(e){let t=e.mapPos(this.from,-1,MapMode.TrackDel),i=e.mapPos(this.to,1,MapMode.TrackDel);return t==null||i==null?null:new Hy(this.field,t,i)}}class zy{constructor(e,t){this.lines=e,this.fieldPositions=t}instantiate(e,t){let i=[],r=[t],s=e.doc.lineAt(t),o=/^\s*/.exec(s.text)[0];for(let a of this.lines){if(i.length){let h=o,c=/^\t*/.exec(a)[0].length;for(let u=0;u<c;u++)h+=e.facet(indentUnit);r.push(t+h.length-c),a=h+a.slice(c)}i.push(a),t+=a.length+1}let l=this.fieldPositions.map(a=>new Hy(a.field,r[a.line]+a.from,r[a.line]+a.to));return{text:i,ranges:l}}static parse(e){let t=[],i=[],r=[],s;for(let o of e.split(/\r\n?|\n/)){for(;s=/[#$]\{(?:(\d+)(?::([^}]*))?|([^}]*))\}/.exec(o);){let l=s[1]?+s[1]:null,a=s[2]||s[3]||"",h=-1;for(let c=0;c<t.length;c++)(l!=null?t[c].seq==l:a?t[c].name==a:!1)&&(h=c);if(h<0){let c=0;for(;c<t.length&&(l==null||t[c].seq!=null&&t[c].seq<l);)c++;t.splice(c,0,{seq:l,name:a}),h=c;for(let u of r)u.field>=h&&u.field++}r.push(new nz(h,i.length,s.index,s.index+a.length)),o=o.slice(0,s.index)+a+o.slice(s.index+s[0].length)}i.push(o)}return new zy(i,r)}}let rz=ue.widget({widget:new class extends sr{toDOM(){let n=document.createElement("span");return n.className="cm-snippetFieldPosition",n}ignoreEvent(){return!1}}}),sz=ue.mark({class:"cm-snippetField"});class Dl{constructor(e,t){this.ranges=e,this.active=t,this.deco=ue.set(e.map(i=>(i.from==i.to?rz:sz).range(i.from,i.to)))}map(e){let t=[];for(let i of this.ranges){let r=i.map(e);if(!r)return null;t.push(r)}return new Dl(t,this.active)}selectionInsideField(e){return e.ranges.every(t=>this.ranges.some(i=>i.field==this.active&&i.from<=t.from&&i.to>=t.to))}}const kh=ke.define({map(n,e){return n&&n.map(e)}}),oz=ke.define(),Ch=zt.define({create(){return null},update(n,e){for(let t of e.effects){if(t.is(kh))return t.value;if(t.is(oz)&&n)return new Dl(n.ranges,t.value)}return n&&e.docChanged&&(n=n.map(e.changes)),n&&e.selection&&!n.selectionInsideField(e.selection)&&(n=null),n},provide:n=>le.decorations.from(n,e=>e?e.deco:ue.none)});function jy(n,e){return L.create(n.filter(t=>t.field==e).map(t=>L.range(t.from,t.to)))}function lz(n){let e=zy.parse(n);return(t,i,r,s)=>{let{text:o,ranges:l}=e.instantiate(t.state,r),a={changes:{from:r,to:s,insert:Text.of(o)}};if(l.length&&(a.selection=jy(l,0)),l.length>1){let h=new Dl(l,0),c=a.effects=[kh.of(h)];t.state.field(Ch,!1)===void 0&&c.push(StateEffect.appendConfig.of([Ch,hz,cz,cM]))}t.dispatch(t.state.update(a))}}function uM(n){return({state:e,dispatch:t})=>{let i=e.field(Ch,!1);if(!i||n<0&&i.active==0)return!1;let r=i.active+n,s=n>0&&!i.ranges.some(o=>o.field==r+n);return t(e.update({selection:jy(i.ranges,r),effects:kh.of(s?null:new Dl(i.ranges,r))})),!0}}const az=[{key:"Tab",run:uM(1),shift:uM(-1)},{key:"Escape",run:({state:n,dispatch:e})=>n.field(Ch,!1)?(e(n.update({effects:kh.of(null)})),!0):!1}],fM=he.define({combine(n){return n.length?n[0]:az}}),hz=dl.highest(ih.compute([fM],n=>n.facet(fM)));function N$(n,e){return Object.assign(Object.assign({},e),{apply:lz(n)})}const cz=le.domEventHandlers({mousedown(n,e){let t=e.state.field(Ch,!1),i;if(!t||(i=e.posAtCoords({x:n.clientX,y:n.clientY}))==null)return!1;let r=t.ranges.find(s=>s.from<=i&&s.to>=i);return!r||r.field==t.active?!1:(e.dispatch({selection:jy(t.ranges,r.field),effects:kh.of(t.ranges.some(s=>s.field>r.field)?new Dl(t.ranges,r.field):null)}),!0)}});function uz(n){let e=n.replace(/[\\[.+*?(){|^$]/g,"\\$&");try{return new RegExp(`[\\p{Alphabetic}\\p{Number}_${e}]+`,"ug")}catch{return new RegExp(`[w${e}]`,"g")}}function dM(n,e){return new RegExp(e(n.source),n.unicode?"u":"")}const pM=null;function fz(n){return pM[n]||(pM[n]=new WeakMap)}function mM(n,e,t,i,r){for(let s=n.iterLines(),o=0;!s.next().done;){let{value:l}=s,a;for(e.lastIndex=0;a=e.exec(l);)if(!i[a[0]]&&o+a.index!=r&&(t.push({type:"text",label:a[0]}),i[a[0]]=!0,t.length>=2e3))return;o+=l.length+1}}function gM(n,e,t,i,r){let s=n.length>=1e3,o=s&&e.get(n);if(o)return o;let l=[],a=Object.create(null);if(n.children){let h=0;for(let c of n.children){if(c.length>=1e3)for(let u of gM(c,e,t,i-h,r-h))a[u.label]||(a[u.label]=!0,l.push(u));else mM(c,t,l,a,r-h);h+=c.length+1}}else mM(n,t,l,a,r);return s&&l.length<2e3&&e.set(n,l),l}const I$=n=>{let e=n.state.languageDataAt("wordChars",n.pos).join(""),t=uz(e),i=n.matchBefore(dM(t,o=>o+"$"));if(!i&&!n.explicit)return null;let r=i?i.from:n.pos,s=gM(n.state.doc,fz(e),t,5e4,r);return{from:r,options:s,validFor:dM(t,o=>"^"+o)}},Df={brackets:["(","[","{","'",'"'],before:")]}:;>"},So=ke.define({map(n,e){let t=e.mapPos(n,-1,Wi.TrackAfter);return t==null?void 0:t}}),$y=ke.define({map(n,e){return e.mapPos(n)}}),Uy=new class extends mo{};Uy.startSide=1,Uy.endSide=-1;const yM=zt.define({create(){return We.empty},update(n,e){if(e.selection){let t=e.state.doc.lineAt(e.selection.main.head).from,i=e.startState.doc.lineAt(e.startState.selection.main.head).from;t!=e.changes.mapPos(i,-1)&&(n=We.empty)}n=n.map(e.changes);for(let t of e.effects)t.is(So)?n=n.update({add:[Uy.range(t.value,t.value+1)]}):t.is($y)&&(n=n.update({filter:i=>i!=t.value}));return n}});function dz(){return[mz,yM]}const qy="()[]{}<>";function vM(n){for(let e=0;e<qy.length;e+=2)if(qy.charCodeAt(e)==n)return qy.charAt(e+1);return Qg(n<128?n:n+1)}function wM(n,e){return n.languageDataAt("closeBrackets",e)[0]||Df}const pz=typeof navigator=="object"&&/Android\b/.test(navigator.userAgent),mz=le.inputHandler.of((n,e,t,i)=>{if((pz?n.composing:n.compositionStarted)||n.state.readOnly)return!1;let r=n.state.selection.main;if(i.length>2||i.length==2&&kn(xi(i,0))==1||e!=r.from||t!=r.to)return!1;let s=yz(n.state,i);return s?(n.dispatch(s),!0):!1}),gz=[{key:"Backspace",run:({state:n,dispatch:e})=>{if(n.readOnly)return!1;let i=wM(n,n.selection.main.head).brackets||Df.brackets,r=null,s=n.changeByRange(o=>{if(o.empty){let l=vz(n.doc,o.head);for(let a of i)if(a==l&&Mf(n.doc,o.head)==vM(xi(a,0)))return{changes:{from:o.head-a.length,to:o.head+a.length},range:L.cursor(o.head-a.length),userEvent:"delete.backward"}}return{range:r=o}});return r||e(n.update(s,{scrollIntoView:!0})),!r}}];function yz(n,e){let t=wM(n,n.selection.main.head),i=t.brackets||Df.brackets;for(let r of i){let s=vM(xi(r,0));if(e==r)return s==r?xz(n,r,i.indexOf(r+r+r)>-1):wz(n,r,s,t.before||Df.before);if(e==s&&bM(n,n.selection.main.from))return bz(n,r,s)}return null}function bM(n,e){let t=!1;return n.field(yM).between(0,n.doc.length,i=>{i==e&&(t=!0)}),t}function Mf(n,e){let t=n.sliceString(e,e+2);return t.slice(0,kn(xi(t,0)))}function vz(n,e){let t=n.sliceString(e-2,e);return kn(xi(t,0))==t.length?t:t.slice(1)}function wz(n,e,t,i){let r=null,s=n.changeByRange(o=>{if(!o.empty)return{changes:[{insert:e,from:o.from},{insert:t,from:o.to}],effects:So.of(o.to+e.length),range:L.range(o.anchor+e.length,o.head+e.length)};let l=Mf(n.doc,o.head);return!l||/\s/.test(l)||i.indexOf(l)>-1?{changes:{insert:e+t,from:o.head},effects:So.of(o.head+e.length),range:L.cursor(o.head+e.length)}:{range:r=o}});return r?null:n.update(s,{scrollIntoView:!0,userEvent:"input.type"})}function bz(n,e,t){let i=null,r=n.selection.ranges.map(s=>s.empty&&Mf(n.doc,s.head)==t?L.cursor(s.head+t.length):i=s);return i?null:n.update({selection:L.create(r,n.selection.mainIndex),scrollIntoView:!0,effects:n.selection.ranges.map(({from:s})=>$y.of(s))})}function xz(n,e,t){let i=null,r=n.changeByRange(s=>{if(!s.empty)return{changes:[{insert:e,from:s.from},{insert:e,from:s.to}],effects:So.of(s.to+e.length),range:L.range(s.anchor+e.length,s.head+e.length)};let o=s.head,l=Mf(n.doc,o);if(l==e){if(xM(n,o))return{changes:{insert:e+e,from:o},effects:So.of(o+e.length),range:L.cursor(o+e.length)};if(bM(n,o)){let a=t&&n.sliceDoc(o,o+e.length*3)==e+e+e;return{range:L.cursor(o+e.length*(a?3:1)),effects:$y.of(o)}}}else{if(t&&n.sliceDoc(o-2*e.length,o)==e+e&&xM(n,o-2*e.length))return{changes:{insert:e+e+e+e,from:o},effects:So.of(o+e.length),range:L.cursor(o+e.length)};if(n.charCategorizer(o)(l)!=Hi.Word){let a=n.sliceDoc(o-1,o);if(a!=e&&n.charCategorizer(o)(a)!=Hi.Word&&!Sz(n,o,e))return{changes:{insert:e+e,from:o},effects:So.of(o+e.length),range:L.cursor(o+e.length)}}}return{range:i=s}});return i?null:n.update(r,{scrollIntoView:!0,userEvent:"input.type"})}function xM(n,e){let t=ei(n).resolveInner(e+1);return t.parent&&t.from==e}function Sz(n,e,t){let i=ei(n).resolveInner(e,-1);for(let r=0;r<5;r++){if(n.sliceDoc(i.from,i.from+t.length)==t)return!0;let s=i.to==e&&i.parent;if(!s)break;i=s}return!1}function kz(n={}){return[$i,xo.of(n),iz,Cz,cM]}const SM=[{key:"Ctrl-Space",run:Y9},{key:"Escape",run:X9},{key:"ArrowDown",run:_f(!0)},{key:"ArrowUp",run:_f(!1)},{key:"PageDown",run:_f(!0,"page")},{key:"PageUp",run:_f(!1,"page")},{key:"Enter",run:Z9}],Cz=dl.highest(ih.computeN([xo],n=>n.facet(xo).defaultKeymap?[SM]:[]));function V$(n){let e=n.field($i,!1);return e&&e.active.some(t=>t.state==1)?"pending":e&&e.active.some(t=>t.state!=0)?"active":null}const kM=new WeakMap;function H$(n){var e;let t=(e=n.field($i,!1))===null||e===void 0?void 0:e.open;if(!t)return[];let i=kM.get(t.options);return i||kM.set(t.options,i=t.options.map(r=>r.completion)),i}function z$(n){var e;let t=(e=n.field($i,!1))===null||e===void 0?void 0:e.open;return t?t.options[t.selected].completion:null}function j$(n){var e;let t=(e=n.field($i,!1))===null||e===void 0?void 0:e.open;return t?t.selected:null}function $$(n){return Vy.of(n)}class Az{constructor(e,t,i){this.from=e,this.to=t,this.diagnostic=i}}class ko{constructor(e,t,i){this.diagnostics=e,this.panel=t,this.selected=i}static init(e,t,i){let r=e,s=i.facet(Co).markerFilter;s&&(r=s(r));let o=ue.set(r.map(l=>l.from==l.to||l.from==l.to-1&&i.doc.lineAt(l.from).to==l.from?ue.widget({widget:new Tz(l),diagnostic:l}).range(l.from):ue.mark({attributes:{class:"cm-lintRange cm-lintRange-"+l.severity},diagnostic:l}).range(l.from,l.to)),!0);return new ko(o,t,Ml(o))}}function Ml(n,e=null,t=0){let i=null;return n.between(t,1e9,(r,s,{spec:o})=>{if(!(e&&o.diagnostic!=e))return i=new Az(r,s,o.diagnostic),!1}),i}function CM(n,e){return!!(n.effects.some(t=>t.is(Ef))||n.changes.touchesRange(e.pos))}function AM(n,e){return n.field(Xi,!1)?e:e.concat(ke.appendConfig.of([Xi,le.decorations.compute([Xi],t=>{let{selected:i,panel:r}=t.field(Xi);return!i||!r||i.from==i.to?ue.none:ue.set([_z.range(i.from,i.to)])}),W4(Dz,{hideOn:CM}),Pz]))}function Oz(n,e){return{effects:AM(n,[Ef.of(e)])}}const Ef=ke.define(),Ky=ke.define(),OM=ke.define(),Xi=zt.define({create(){return new ko(ue.none,null,null)},update(n,e){if(e.docChanged){let t=n.diagnostics.map(e.changes),i=null;if(n.selected){let r=e.changes.mapPos(n.selected.from,1);i=Ml(t,n.selected.diagnostic,r)||Ml(t,null,r)}n=new ko(t,n.panel,i)}for(let t of e.effects)t.is(Ef)?n=ko.init(t.value,n.panel,e.state):t.is(Ky)?n=new ko(n.diagnostics,t.value?Tf.open:null,n.selected):t.is(OM)&&(n=new ko(n.diagnostics,n.panel,t.value));return n},provide:n=>[lh.from(n,e=>e.panel),le.decorations.from(n,e=>e.diagnostics)]});function U$(n){let e=n.field(Xi,!1);return e?e.diagnostics.size:0}const _z=ue.mark({class:"cm-lintRange cm-lintRange-active"});function Dz(n,e,t){let{diagnostics:i}=n.state.field(Xi),r=[],s=2e8,o=0;i.between(e-(t<0?1:0),e+(t>0?1:0),(a,h,{spec:c})=>{e>=a&&e<=h&&(a==h||(e>a||t>0)&&(e<h||t<0))&&(r.push(c.diagnostic),s=Math.min(a,s),o=Math.max(h,o))});let l=n.state.facet(Co).tooltipFilter;return l&&(r=l(r)),r.length?{pos:s,end:o,above:n.state.doc.lineAt(s).to<o,create(){return{dom:_M(n,r)}}}:null}function _M(n,e){return mt("ul",{class:"cm-tooltip-lint"},e.map(t=>TM(n,t,!1)))}const Mz=n=>{let e=n.state.field(Xi,!1);(!e||!e.panel)&&n.dispatch({effects:AM(n.state,[Ky.of(!0)])});let t=oh(n,Tf.open);return t&&t.dom.querySelector(".cm-panel-lint ul").focus(),!0},DM=n=>{let e=n.state.field(Xi,!1);return!e||!e.panel?!1:(n.dispatch({effects:Ky.of(!1)}),!0)},Ez=[{key:"Mod-Shift-m",run:Mz},{key:"F8",run:n=>{let e=n.state.field(Xi,!1);if(!e)return!1;let t=n.state.selection.main,i=e.diagnostics.iter(t.to+1);return!i.value&&(i=e.diagnostics.iter(0),!i.value||i.from==t.from&&i.to==t.to)?!1:(n.dispatch({selection:{anchor:i.from,head:i.to},scrollIntoView:!0}),!0)}}],MM=Nt.fromClass(class{constructor(n){this.view=n,this.timeout=-1,this.set=!0;let{delay:e}=n.state.facet(Co);this.lintTime=Date.now()+e,this.run=this.run.bind(this),this.timeout=setTimeout(this.run,e)}run(){let n=Date.now();if(n<this.lintTime-10)setTimeout(this.run,this.lintTime-n);else{this.set=!1;let{state:e}=this.view,{sources:t}=e.facet(Co);Promise.all(t.map(i=>Promise.resolve(i(this.view)))).then(i=>{let r=i.reduce((s,o)=>s.concat(o));this.view.state.doc==e.doc&&this.view.dispatch(Oz(this.view.state,r))},i=>{dn(this.view.state,i)})}}update(n){let e=n.state.facet(Co);(n.docChanged||e!=n.startState.facet(Co))&&(this.lintTime=Date.now()+e.delay,this.set||(this.set=!0,this.timeout=setTimeout(this.run,e.delay)))}force(){this.set&&(this.lintTime=Date.now(),this.run())}destroy(){clearTimeout(this.timeout)}}),Co=he.define({combine(n){return Object.assign({sources:n.map(e=>e.source)},nr(n.map(e=>e.config),{delay:750,markerFilter:null,tooltipFilter:null}))},enables:MM});function K$(n,e={}){return Co.of({source:n,config:e})}function G$(n){let e=n.plugin(MM);e&&e.force()}function EM(n){let e=[];if(n)e:for(let{name:t}of n){for(let i=0;i<t.length;i++){let r=t[i];if(/[a-zA-Z]/.test(r)&&!e.some(s=>s.toLowerCase()==r.toLowerCase())){e.push(r);continue e}}e.push("")}return e}function TM(n,e,t){var i;let r=t?EM(e.actions):[];return mt("li",{class:"cm-diagnostic cm-diagnostic-"+e.severity},mt("span",{class:"cm-diagnosticText"},e.message),(i=e.actions)===null||i===void 0?void 0:i.map((s,o)=>{let l=u=>{u.preventDefault();let f=Ml(n.state.field(Xi).diagnostics,e);f&&s.apply(n,f.from,f.to)},{name:a}=s,h=r[o]?a.indexOf(r[o]):-1,c=h<0?a:[a.slice(0,h),mt("u",a.slice(h,h+1)),a.slice(h+1)];return mt("button",{type:"button",class:"cm-diagnosticAction",onclick:l,onmousedown:l,"aria-label":` Action: ${a}${h<0?"":` (access key "${r[o]})"`}.`},c)}),e.source&&mt("div",{class:"cm-diagnosticSource"},e.source))}class Tz extends sr{constructor(e){super(),this.diagnostic=e}eq(e){return e.diagnostic==this.diagnostic}toDOM(){return mt("span",{class:"cm-lintPoint cm-lintPoint-"+this.diagnostic.severity})}}class PM{constructor(e,t){this.diagnostic=t,this.id="item_"+Math.floor(Math.random()*4294967295).toString(16),this.dom=TM(e,t,!0),this.dom.id=this.id,this.dom.setAttribute("role","option")}}class Tf{constructor(e){this.view=e,this.items=[];let t=r=>{if(r.keyCode==27)DM(this.view),this.view.focus();else if(r.keyCode==38||r.keyCode==33)this.moveSelection((this.selectedIndex-1+this.items.length)%this.items.length);else if(r.keyCode==40||r.keyCode==34)this.moveSelection((this.selectedIndex+1)%this.items.length);else if(r.keyCode==36)this.moveSelection(0);else if(r.keyCode==35)this.moveSelection(this.items.length-1);else if(r.keyCode==13)this.view.focus();else if(r.keyCode>=65&&r.keyCode<=90&&this.selectedIndex>=0){let{diagnostic:s}=this.items[this.selectedIndex],o=EM(s.actions);for(let l=0;l<o.length;l++)if(o[l].toUpperCase().charCodeAt(0)==r.keyCode){let a=Ml(this.view.state.field(Xi).diagnostics,s);a&&s.actions[l].apply(e,a.from,a.to)}}else return;r.preventDefault()},i=r=>{for(let s=0;s<this.items.length;s++)this.items[s].dom.contains(r.target)&&this.moveSelection(s)};this.list=mt("ul",{tabIndex:0,role:"listbox","aria-label":this.view.state.phrase("Diagnostics"),onkeydown:t,onclick:i}),this.dom=mt("div",{class:"cm-panel-lint"},this.list,mt("button",{type:"button",name:"close","aria-label":this.view.state.phrase("close"),onclick:()=>DM(this.view)},"\xD7")),this.update()}get selectedIndex(){let e=this.view.state.field(Xi).selected;if(!e)return-1;for(let t=0;t<this.items.length;t++)if(this.items[t].diagnostic==e.diagnostic)return t;return-1}update(){let{diagnostics:e,selected:t}=this.view.state.field(Xi),i=0,r=!1,s=null;for(e.between(0,this.view.state.doc.length,(o,l,{spec:a})=>{let h=-1,c;for(let u=i;u<this.items.length;u++)if(this.items[u].diagnostic==a.diagnostic){h=u;break}h<0?(c=new PM(this.view,a.diagnostic),this.items.splice(i,0,c),r=!0):(c=this.items[h],h>i&&(this.items.splice(i,h-i),r=!0)),t&&c.diagnostic==t.diagnostic?c.dom.hasAttribute("aria-selected")||(c.dom.setAttribute("aria-selected","true"),s=c):c.dom.hasAttribute("aria-selected")&&c.dom.removeAttribute("aria-selected"),i++});i<this.items.length&&!(this.items.length==1&&this.items[0].diagnostic.from<0);)r=!0,this.items.pop();this.items.length==0&&(this.items.push(new PM(this.view,{from:-1,to:-1,severity:"info",message:this.view.state.phrase("No diagnostics")})),r=!0),s?(this.list.setAttribute("aria-activedescendant",s.id),this.view.requestMeasure({key:this,read:()=>({sel:s.dom.getBoundingClientRect(),panel:this.list.getBoundingClientRect()}),write:({sel:o,panel:l})=>{o.top<l.top?this.list.scrollTop-=l.top-o.top:o.bottom>l.bottom&&(this.list.scrollTop+=o.bottom-l.bottom)}})):this.selectedIndex<0&&this.list.removeAttribute("aria-activedescendant"),r&&this.sync()}sync(){let e=this.list.firstChild;function t(){let i=e;e=i.nextSibling,i.remove()}for(let i of this.items)if(i.dom.parentNode==this.list){for(;e!=i.dom;)t();e=i.dom.nextSibling}else this.list.insertBefore(i.dom,e);for(;e;)t()}moveSelection(e){if(this.selectedIndex<0)return;let t=this.view.state.field(Xi),i=Ml(t.diagnostics,this.items[e].diagnostic);!i||this.view.dispatch({selection:{anchor:i.from,head:i.to},scrollIntoView:!0,effects:OM.of(i)})}static open(e){return new Tf(e)}}function Pf(n,e='viewBox="0 0 40 40"'){return`url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" ${e}>${encodeURIComponent(n)}</svg>')`}function Gy(n){return Pf(`<path d="m0 2.5 l2 -1.5 l1 0 l2 1.5 l1 0" stroke="${n}" fill="none" stroke-width=".7"/>`,'width="6" height="3"')}const Pz=le.baseTheme({".cm-diagnostic":{padding:"3px 6px 3px 8px",marginLeft:"-1px",display:"block",whiteSpace:"pre-wrap"},".cm-diagnostic-error":{borderLeft:"5px solid #d11"},".cm-diagnostic-warning":{borderLeft:"5px solid orange"},".cm-diagnostic-info":{borderLeft:"5px solid #999"},".cm-diagnosticAction":{font:"inherit",border:"none",padding:"2px 4px",backgroundColor:"#444",color:"white",borderRadius:"3px",marginLeft:"8px"},".cm-diagnosticSource":{fontSize:"70%",opacity:.7},".cm-lintRange":{backgroundPosition:"left bottom",backgroundRepeat:"repeat-x",paddingBottom:"0.7px"},".cm-lintRange-error":{backgroundImage:Gy("#d11")},".cm-lintRange-warning":{backgroundImage:Gy("orange")},".cm-lintRange-info":{backgroundImage:Gy("#999")},".cm-lintRange-active":{backgroundColor:"#ffdd9980"},".cm-tooltip-lint":{padding:0,margin:0},".cm-lintPoint":{position:"relative","&:after":{content:'""',position:"absolute",bottom:0,left:"-2px",borderLeft:"3px solid transparent",borderRight:"3px solid transparent",borderBottom:"4px solid #d11"}},".cm-lintPoint-warning":{"&:after":{borderBottomColor:"orange"}},".cm-lintPoint-info":{"&:after":{borderBottomColor:"#999"}},".cm-panel.cm-panel-lint":{position:"relative","& ul":{maxHeight:"100px",overflowY:"auto","& [aria-selected]":{backgroundColor:"#ddd","& u":{textDecoration:"underline"}},"&:focus [aria-selected]":{background_fallback:"#bdf",backgroundColor:"Highlight",color_fallback:"white",color:"HighlightText"},"& u":{textDecoration:"none"},padding:0,margin:0},"& [name=close]":{position:"absolute",top:"0",right:"2px",background:"inherit",border:"none",font:"inherit",padding:0,margin:0}}});class Bz extends ar{constructor(e){super(),this.diagnostics=e,this.severity=e.reduce((t,i)=>{let r=i.severity;return r=="error"||r=="warning"&&t=="info"?r:t},"info")}toDOM(e){let t=document.createElement("div");t.className="cm-lint-marker cm-lint-marker-"+this.severity;let i=this.diagnostics,r=e.state.facet(Bf).tooltipFilter;return r&&(i=r(i)),i.length&&(t.onmouseover=()=>Lz(e,t,i)),t}}function Rz(n,e){let t=i=>{let r=e.getBoundingClientRect();if(!(i.clientX>r.left-10&&i.clientX<r.right+10&&i.clientY>r.top-10&&i.clientY<r.bottom+10)){for(let s=i.target;s;s=s.parentNode)if(s.nodeType==1&&s.classList.contains("cm-tooltip-lint"))return;window.removeEventListener("mousemove",t),n.state.field(RM)&&n.dispatch({effects:Jy.of(null)})}};window.addEventListener("mousemove",t)}function Lz(n,e,t){function i(){let o=n.elementAtHeight(e.getBoundingClientRect().top+5-n.documentTop);n.coordsAtPos(o.from)&&n.dispatch({effects:Jy.of({pos:o.from,above:!1,create(){return{dom:_M(n,t),getCoords:()=>e.getBoundingClientRect()}}})}),e.onmouseout=e.onmousemove=null,Rz(n,e)}let{hoverTime:r}=n.state.facet(Bf),s=setTimeout(i,r);e.onmouseout=()=>{clearTimeout(s),e.onmouseout=e.onmousemove=null},e.onmousemove=()=>{clearTimeout(s),s=setTimeout(i,r)}}function Fz(n,e){let t=Object.create(null);for(let r of e){let s=n.lineAt(r.from);(t[s.from]||(t[s.from]=[])).push(r)}let i=[];for(let r in t)i.push(new Bz(t[r]).range(+r));return We.of(i,!0)}const Nz=t_({class:"cm-gutter-lint",markers:n=>n.state.field(BM)}),BM=zt.define({create(){return We.empty},update(n,e){n=n.map(e.changes);let t=e.state.facet(Bf).markerFilter;for(let i of e.effects)if(i.is(Ef)){let r=i.value;t&&(r=t(r||[])),n=Fz(e.state.doc,r.slice(0))}return n}}),Jy=ke.define(),RM=zt.define({create(){return null},update(n,e){return n&&e.docChanged&&(n=CM(e,n)?null:Object.assign(Object.assign({},n),{pos:e.changes.mapPos(n.pos)})),e.effects.reduce((t,i)=>i.is(Jy)?i.value:t,n)},provide:n=>Uu.from(n)}),Iz=le.baseTheme({".cm-gutter-lint":{width:"1.4em","& .cm-gutterElement":{padding:".2em"}},".cm-lint-marker":{width:"1em",height:"1em"},".cm-lint-marker-info":{content:Pf('<path fill="#aaf" stroke="#77e" stroke-width="6" stroke-linejoin="round" d="M5 5L35 5L35 35L5 35Z"/>')},".cm-lint-marker-warning":{content:Pf('<path fill="#fe8" stroke="#fd7" stroke-width="6" stroke-linejoin="round" d="M20 6L37 35L3 35Z"/>')},".cm-lint-marker-error:before":{content:Pf('<circle cx="20" cy="20" r="15" fill="#f87" stroke="#f43" stroke-width="6"/>')}}),Bf=he.define({combine(n){return nr(n,{hoverTime:300,markerFilter:null,tooltipFilter:null})}});function J$(n={}){return[Bf.of(n),BM,Nz,Iz,RM]}const Wz=[G4(),Y4(),p4(),w5(),jH(),i4(),a4(),Fe.allowMultipleSelections.of(!0),TH(),I_(KH,{fallback:!0}),QH(),dz(),kz(),D4(),T4(),b4(),p9(),ih.of([...gz,...a9,...T9,...D5,...WH,...SM,...Ez])],Vz="#e5c07b",LM="#e06c75",Hz="#56b6c2",zz="#ffffff",Rf="#abb2bf",Zy="#7d8799",jz="#61afef",$z="#98c379",FM="#d19a66",Uz="#c678dd",qz="#21252b",Yy="#2c313a",NM="#282c34",Xy="#353a42",Kz="#3E4451",IM="#528bff",Gz=le.theme({"&":{color:Rf,backgroundColor:NM},".cm-content":{caretColor:IM},".cm-cursor, .cm-dropCursor":{borderLeftColor:IM},"&.cm-focused .cm-selectionBackground, .cm-selectionBackground, .cm-content ::selection":{backgroundColor:Kz},".cm-panels":{backgroundColor:qz,color:Rf},".cm-panels.cm-panels-top":{borderBottom:"2px solid black"},".cm-panels.cm-panels-bottom":{borderTop:"2px solid black"},".cm-searchMatch":{backgroundColor:"#72a1ff59",outline:"1px solid #457dff"},".cm-searchMatch.cm-searchMatch-selected":{backgroundColor:"#6199ff2f"},".cm-activeLine":{backgroundColor:Yy},".cm-selectionMatch":{backgroundColor:"#aafe661a"},"&.cm-focused .cm-matchingBracket, &.cm-focused .cm-nonmatchingBracket":{backgroundColor:"#bad0f847",outline:"1px solid #515a6b"},".cm-gutters":{backgroundColor:NM,color:Zy,border:"none"},".cm-activeLineGutter":{backgroundColor:Yy},".cm-foldPlaceholder":{backgroundColor:"transparent",border:"none",color:"#ddd"},".cm-tooltip":{border:"none",backgroundColor:Xy},".cm-tooltip .cm-tooltip-arrow:before":{borderTopColor:"transparent",borderBottomColor:"transparent"},".cm-tooltip .cm-tooltip-arrow:after":{borderTopColor:Xy,borderBottomColor:Xy},".cm-tooltip-autocomplete":{"& > ul > li[aria-selected]":{backgroundColor:Yy,color:Rf}}},{dark:!0}),Jz=mh.define([{tag:P.keyword,color:Uz},{tag:[P.name,P.deleted,P.character,P.propertyName,P.macroName],color:LM},{tag:[P.function(P.variableName),P.labelName],color:jz},{tag:[P.color,P.constant(P.name),P.standard(P.name)],color:FM},{tag:[P.definition(P.name),P.separator],color:Rf},{tag:[P.typeName,P.className,P.number,P.changed,P.annotation,P.modifier,P.self,P.namespace],color:Vz},{tag:[P.operator,P.operatorKeyword,P.url,P.escape,P.regexp,P.link,P.special(P.string)],color:Hz},{tag:[P.meta,P.comment],color:Zy},{tag:P.strong,fontWeight:"bold"},{tag:P.emphasis,fontStyle:"italic"},{tag:P.strikethrough,textDecoration:"line-through"},{tag:P.link,color:Zy,textDecoration:"underline"},{tag:P.heading,fontWeight:"bold",color:LM},{tag:[P.atom,P.bool,P.special(P.variableName)],color:FM},{tag:[P.processingInstruction,P.string,P.inserted],color:$z},{tag:P.invalid,color:zz}]),Zz=[Gz,I_(Jz)];var Yz=le.theme({"&":{backgroundColor:"#fff"}},{dark:!1});function Xz(n){var{value:e,selection:t,onChange:i,onUpdate:r,extensions:s=[],autoFocus:o,theme:l="light",height:a="",minHeight:h="",maxHeight:c="",placeholder:u="",width:f="",minWidth:d="",maxWidth:p="",editable:g=!0,readOnly:y=!1,indentWithTab:v=!0,basicSetup:C=!0,root:x}=n,[b,S]=(0,m.useState)(n.container),[k,A]=(0,m.useState)(),[_,O]=(0,m.useState)(),D=le.theme({"&":{height:a,minHeight:h,maxHeight:c,width:f,minWidth:d,maxWidth:p}}),T=le.updateListener.of(N=>{if(N.docChanged&&typeof i=="function"){var ne=N.state.doc,W=ne.toString();i(W,N)}}),B=[T,D];switch(v&&B.unshift(ih.of([h9])),C&&B.unshift(Wz),u&&B.unshift(C4(u)),l){case"light":B.push(Yz);break;case"dark":B.push(Zz);break;default:B.push(l);break}return g===!1&&B.push(le.editable.of(!1)),y&&B.push(Fe.readOnly.of(!0)),r&&typeof r=="function"&&B.push(le.updateListener.of(r)),B=B.concat(s),(0,m.useEffect)(()=>{if(b&&!_){var N=Fe.create({doc:e,selection:t,extensions:B});if(O(N),!k){var ne=new le({state:N,parent:b,root:x});A(ne)}}return()=>{k&&A(void 0)}},[b,_]),(0,m.useEffect)(()=>()=>{k&&(k.destroy(),A(void 0))},[k]),(0,m.useEffect)(()=>{o&&k&&k.focus()},[o,k]),(0,m.useEffect)(()=>{var N=k?k.state.doc.toString():"";k&&e!==N&&k.dispatch({changes:{from:0,to:N.length,insert:e||""}})},[e,k]),(0,m.useEffect)(()=>{k&&k.dispatch({effects:ke.reconfigure.of(B)})},[l,s,a,h,c,f,u,d,p,g,v,C]),{state:_,setState:O,view:k,setView:A,container:b,setContainer:S}}var Qz=w(52322),ej=["className","value","selection","extensions","onChange","onUpdate","autoFocus","theme","height","minHeight","maxHeight","width","minWidth","maxWidth","basicSetup","placeholder","indentWithTab","editable","readOnly","root"],WM=m.forwardRef((n,e)=>{var{className:t,value:i="",selection:r,extensions:s=[],onChange:o,onUpdate:l,autoFocus:a,theme:h="light",height:c,minHeight:u,maxHeight:f,width:d,minWidth:p,maxWidth:g,basicSetup:y,placeholder:v,indentWithTab:C,editable:x,readOnly:b,root:S}=n,k=(0,DV.Z)(n,ej),A=(0,m.useRef)(null),{state:_,view:O,container:D,setContainer:T}=Xz({container:A.current,root:S,value:i,autoFocus:a,theme:h,height:c,minHeight:u,maxHeight:f,width:d,minWidth:p,maxWidth:g,basicSetup:y,placeholder:v,indentWithTab:C,editable:x,readOnly:b,selection:r,onChange:o,onUpdate:l,extensions:s});if((0,m.useImperativeHandle)(e,()=>({editor:D,state:_,view:O}),[D,_,O]),(0,m.useEffect)(()=>{T(A.current)},[]),typeof i!="string")throw new Error("value must be typeof string but got "+typeof i);var B=typeof h=="string"?"cm-theme-"+h:"cm-theme";return(0,Qz.jsx)("div",(0,_V.Z)({ref:A,className:""+B+(t?" "+t:"")},k))});WM.displayName="CodeMirror";var tj=WM,ij=w(60155),VM=w.n(ij),nj=w(70923),Z$=w(32272),Y$=w(82394),X$=w(82108);const rj=(0,X.Z)(n=>({cardHeader:{position:"relative"},title:{backgroundImage:({backgroundImage:e})=>e},box:{overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box","-webkit-line-clamp":10,"-webkit-box-orient":"vertical",paddingBottom:"0.8em"},label:{color:n.palette.text.secondary,textTransform:"uppercase",fontSize:"0.65rem",fontWeight:"bold",letterSpacing:.5,lineHeight:1,paddingBottom:"0.2rem"},leftButton:{marginRight:"auto"},starButton:{position:"absolute",top:n.spacing(.5),right:n.spacing(.5),padding:"0.25rem",color:"#fff"}})),sj=(0,X.Z)(n=>({deprecationIcon:{position:"absolute",top:n.spacing(.5),right:n.spacing(3.5),padding:"0.25rem"},link:{color:n.palette.warning.light}})),oj=n=>{var e,t,i,r,s;return{key:n.metadata.uid,name:n.metadata.name,title:`${(e=n.metadata.title||n.metadata.name)!=null?e:""}`,type:(t=n.spec.type)!=null?t:"",description:(i=n.metadata.description)!=null?i:"-",tags:(s=(r=n.metadata)==null?void 0:r.tags)!=null?s:[]}},lj=()=>{const n=sj(),e=m.createElement(M.Z,{style:{padding:10,maxWidth:300}},"This template uses a syntax that has been deprecated, and should be migrated to a newer syntax. Click for more info.");return m.createElement("div",{className:n.deprecationIcon},m.createElement(F.ZP,{title:e},m.createElement(V.Z,{href:"https://backstage.io/docs/features/software-templates/migrating-from-v1beta2-to-v1beta3",className:n.link},m.createElement(Oo.Z,null))))},aj=({template:n,deprecated:e})=>{var t;const i=(0,Q.Z)(),r=(0,I.tg)(Y.s),s=oj(n),o=(0,$.hF)(n,de.S4),l=i.getPageTheme({themeId:s.type})?s.type:"other",a=i.getPageTheme({themeId:l}),h=rj({backgroundImage:a.backgroundImage}),c=r({templateName:s.name}),u=(0,I.h_)(Wr.q3),f=(0,$.CV)(n,u);return m.createElement(ee.Z,null,m.createElement(ye.Z,{className:h.cardHeader},m.createElement($.LH,{className:h.starButton,entity:n}),e&&m.createElement(lj,null),m.createElement(R.hu,{title:s.title,subtitle:s.type,classes:{root:h.title}})),m.createElement(ae.Z,{style:{display:"grid"}},m.createElement(_e.Z,{className:h.box},m.createElement(M.Z,{variant:"body2",className:h.label},"Description"),m.createElement(R.SA,{content:s.description})),m.createElement(_e.Z,{className:h.box},m.createElement(M.Z,{variant:"body2",className:h.label},"Owner"),m.createElement($.rI,{entityRefs:o,defaultKind:"Group"})),m.createElement(_e.Z,null,m.createElement(M.Z,{variant:"body2",className:h.label},"Tags"),(t=s.tags)==null?void 0:t.map(d=>m.createElement(At.Z,{size:"small",label:d,key:d})))),m.createElement(qt.Z,null,f&&m.createElement(He.Z,{className:h.leftButton,href:f.locationTargetUrl},m.createElement(Wr.nW,{type:f.integrationType})),m.createElement(R.zx,{color:"primary",to:c,"aria-label":`Choose ${s.title}`},"Choose")))},HM=({TemplateCardComponent:n,group:e})=>{const{loading:t,error:i,entities:r}=(0,$.wp)(),s=n||aj,o=e?r.filter(a=>e.filter(a)):r,l=(()=>e&&e.title?typeof e.title=="string"?m.createElement(R.yW,{title:e.title}):e.title:m.createElement(R.yW,{title:"Other Templates"}))();return e&&o.length===0?null:m.createElement(m.Fragment,null,t&&m.createElement(R.Ex,null),i&&m.createElement(R.GB,{title:"Oops! Something went wrong loading the templates"},i.message),!i&&!t&&!r.length&&m.createElement(M.Z,{variant:"body2"},"No templates found that match your filter. Learn more about"," ",m.createElement(R.rU,{to:"https://backstage.io/docs/features/software-templates/adding-templates"},"adding templates"),"."),m.createElement(R.VY,null,l,m.createElement(R.Oh,null,o&&(o==null?void 0:o.length)>0&&o.map(a=>m.createElement(s,{key:(0,de.eE)(a),template:a,deprecated:a.apiVersion==="backstage.io/v1beta2"})))))},hj=(0,X.Z)({button:{color:"white"}});function cj(n){const e=hj(),[t,i]=(0,m.useState)(),r=(0,I.tg)(Y.r),s=(0,z.s0)(),o=n.editor!==!1,l=n.actions!==!1;if(!o&&!l)return null;const a=c=>{i(c.currentTarget)},h=()=>{i(void 0)};return m.createElement(m.Fragment,null,m.createElement(He.Z,{"aria-label":"more","aria-controls":"long-menu","aria-haspopup":"true",onClick:a,"data-testid":"menu-button",color:"inherit",className:e.button},m.createElement(Pl.Z,null)),m.createElement(Nf.ZP,{open:Boolean(t),onClose:h,anchorEl:t,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"}},m.createElement(Ah.Z,null,o&&m.createElement(ni.Z,{onClick:()=>s(`${r()}/edit`)},m.createElement(Ls.Z,null,m.createElement(Oh.Z,{fontSize:"small"})),m.createElement(El.Z,{primary:"Template Editor"})),l&&m.createElement(ni.Z,{onClick:()=>s(`${r()}/actions`)},m.createElement(Ls.Z,null,m.createElement(Tl.Z,{fontSize:"small"})),m.createElement(El.Z,{primary:"Installed Actions"})))))}const uj=({TemplateCardComponent:n,groups:e,contextMenu:t})=>{const i=(0,I.tg)(Y.a),r={title:e?"Other Templates":"Templates",filter:o=>!(e!=null?e:[]).map(a=>a.filter(o)).some(a=>a===!0)},{allowed:s}=(0,wr.gI)({permission:Ff.x7});return m.createElement(R.T3,{themeId:"home"},m.createElement(R.h4,{pageTitleOverride:"Create a New Component",title:"Create a New Component",subtitle:"Create new software components using standard templates"},m.createElement(cj,{...t})),m.createElement(R.VY,null,m.createElement(R.yW,{title:"Available Templates"},s&&m.createElement(R.XF,{title:"Register Existing Component",to:i&&i()}),m.createElement(R.qt,null,"Create new software components using standard templates. Different templates create different kinds of components (services, websites, documentation, ...).")),m.createElement($._i,null,m.createElement($._i.Filters,null,m.createElement($.nN,null),m.createElement($.tW,{initialFilter:"template",hidden:!0}),m.createElement($.EW,{initialFilter:"all",availableFilters:["all","starred"]}),m.createElement(Y.T,null),m.createElement($.xE,null)),m.createElement($._i.Content,null,e&&e.map((o,l)=>m.createElement(HM,{key:l,TemplateCardComponent:n,group:o})),m.createElement(HM,{key:"other",TemplateCardComponent:n,group:r})))))},fj=({TemplateCardComponent:n,groups:e})=>m.createElement($.UO,null,m.createElement(uj,{TemplateCardComponent:n,groups:e}));function Ir(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)}function Ao(n,e){if(!Ir(n))return;const{properties:t,items:i,anyOf:r,oneOf:s,allOf:o,dependencies:l}=n;for(const a in n)!n.hasOwnProperty(a)||a.startsWith("ui:")&&(e[a]=n[a],delete n[a]);if(Ir(t))for(const a in t){if(!t.hasOwnProperty(a))continue;const h=t[a];if(!Ir(h))continue;const c={};e[a]=c,Ao(h,c)}if(Ir(i)){const a={};e.items=a,Ao(i,a)}if(Array.isArray(r))for(const a of r)!Ir(a)||Ao(a,e);if(Array.isArray(s))for(const a of s)!Ir(a)||Ao(a,e);if(Array.isArray(o))for(const a of o)!Ir(a)||Ao(a,e);if(Ir(l))for(const a of Object.keys(l)){const h=l[a];!Ir(h)||Ao(h,e)}}function dj(n){n.type=n.type||"object";const e=JSON.parse(JSON.stringify(n));delete e.title;const t={};return Ao(e,t),{schema:e,uiSchema:t}}var pj=Object.freeze({__proto__:null,DescriptionField:({description:n})=>n&&m.createElement(R.SA,{content:n,linkTarget:"_blank"})});const mj=XP(eR);function gj(n){const e=[];return n.forEach(t=>{const i=t.schema.properties;for(const r in i)if(i.hasOwnProperty(r)){const s=i[r];s.name=r,e.push(s)}}),e}function yj(n,e){const t=gj(e),i={};for(const r in n)if(n.hasOwnProperty(r)){const s=t.find(l=>l.name===r);if(!s){i[r]=n[r];continue}if(s["ui:widget"]==="password"){i[r]="******";continue}if(!s["ui:backstage"]||!s["ui:backstage"].review){i[r]=n[r];continue}const o=s["ui:backstage"].review;if(!o.show)continue;if(o.mask){i[r]=o.mask;continue}i[r]=n[r]}return i}const zM=n=>{const{formData:e,onChange:t,onReset:i,onFinish:r,fields:s,widgets:o}=n,[l,a]=(0,m.useState)(0),[h,c]=(0,m.useState)(!1),u=(0,I.h_)(I.VE),f=(0,I.h_)(I.W0),d="backstage:featureFlag",p=b=>{var S;const k=iR()(b),A=[];return k.schema.properties&&(k.schema.properties=Object.fromEntries(Object.entries(k.schema.properties).filter(([_,O])=>O[d]?f.isActive(O[d])?!0:(A.push(_),!1):!0)),k.schema.required=Array.isArray(k.schema.required)?(S=k.schema.required)==null?void 0:S.filter(_=>!A.includes(_)):k.schema.required),k},g=n.steps.filter(b=>{const S=b.schema[d];return typeof S!="string"||f.isActive(S)}).map(p),y=()=>{a(0),i()},v=()=>{a(Math.min(l+1,g.length))},C=()=>a(Math.max(l-1,0)),x=async()=>{if(!!r){c(!0);try{await r()}catch(b){c(!1),u.post(b)}}};return m.createElement(m.Fragment,null,m.createElement(De.Z,{activeStep:l,orientation:"vertical"},g.map(({title:b,schema:S,...k},A)=>m.createElement(ti.Z,{key:b},m.createElement(K.Z,{"aria-label":`Step ${A+1} ${b}`,"aria-disabled":"false",tabIndex:0},m.createElement(M.Z,{variant:"h6",component:"h3"},b)),m.createElement(Kt.Z,{key:b},m.createElement(mj,{showErrorList:!1,fields:{...pj,...s},widgets:o,noHtml5Validate:!0,formData:e,onChange:t,onSubmit:_=>{_.errors.length===0&&v()},...k,...dj(S)},m.createElement(yi.Z,{disabled:l===0,onClick:C},"Back"),m.createElement(yi.Z,{variant:"contained",color:"primary",type:"submit"},"Next step")))))),l===g.length&&m.createElement(R.VY,null,m.createElement(Ui.Z,{square:!0,elevation:0},m.createElement(M.Z,{variant:"h6"},"Review and create"),m.createElement(R.xT,{dense:!0,metadata:yj(e,g)}),m.createElement(_e.Z,{mb:4}),m.createElement(yi.Z,{onClick:C,disabled:h},"Back"),m.createElement(yi.Z,{onClick:y,disabled:h},"Reset"),m.createElement(yi.Z,{variant:"contained",color:"primary",onClick:x,disabled:!r||h},"Create"))))},vj=n=>{const e=(0,I.h_)(Y.b),{value:t,loading:i,error:r}=(0,Bl.default)(()=>e.getTemplateParameterSchema(n),[e,n]);return{schema:t,loading:i,error:r}};function Lf(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)}const jM=(n,e,t)=>{function i(r,s,o){const l=r.properties;if(!!Lf(l))for(const[a,h]of Object.entries(s)){const c=o[a];if(Lf(h)){const u=l[a];Lf(u)&&i(u,h,c)}else{const u=l[a],f=Lf(u)&&u["ui:field"];f&&typeof e[f]=="function"&&e[f](h,c,t)}}}return(r,s)=>(i(n,r,s),s)},wj=({customFieldExtensions:n=[]})=>{const e=(0,I.I_)(),t=(0,m.useContext)(Y.S),i=(0,I.h_)(I.VE),r=(0,I.h_)(Y.b),{templateName:s}=(0,z.UO)(),o=(0,z.s0)(),l=(0,I.tg)(Y.c),a=(0,I.tg)(Y.r),{schema:h,loading:c,error:u}=vj(s),[f,d]=(0,m.useState)(()=>{var x;const b=_h().parse(window.location.search,{ignoreQueryPrefix:!0});try{return JSON.parse(b.formData)}catch{return(x=b.formData)!=null?x:{}}}),p=()=>d({}),g=(0,m.useCallback)(x=>d(x.formData),[d]),y=async()=>{var x;const{taskId:b}=await r.scaffold({templateRef:(0,de.eE)({name:s,kind:"template",namespace:"default"}),values:f,secrets:t==null?void 0:t.secrets}),S=_h().stringify({formData:f},{addQueryPrefix:!0}),k=`${window.location.pathname}${S}`;(x=window.history)==null||x.replaceState(null,document.title,k),o(l({taskId:b}))};if(u)return i.post(new Error(`Failed to load template, ${u}`)),m.createElement(z.Fg,{to:a()});if(!c&&!h)return i.post(new Error("Template was not found.")),m.createElement(z.Fg,{to:a()});const v=Object.fromEntries(n.map(({name:x,component:b})=>[x,b])),C=Object.fromEntries(n.map(({name:x,validation:b})=>[x,b]));return m.createElement(R.T3,{themeId:"home"},m.createElement(R.h4,{pageTitleOverride:"Create a New Component",title:"Create a New Component",subtitle:"Create new software components using standard templates"}),m.createElement(R.VY,null,c&&m.createElement(Rs.Z,{"data-testid":"loading-progress"}),h&&m.createElement(R.rJ,{title:h.title,noPadding:!0,titleTypographyProps:{component:"h2"}},m.createElement(zM,{formData:f,fields:v,onChange:g,onReset:p,onFinish:y,steps:h.steps.map(x=>({...x,validate:jM(x.schema,C,{apiHolder:e})}))}))))},bj=(0,X.Z)(n=>({code:{fontFamily:"Menlo, monospace",padding:n.spacing(1),backgroundColor:n.palette.type==="dark"?n.palette.grey[700]:n.palette.grey[300],display:"inline-block",borderRadius:5,border:`1px solid ${n.palette.grey[500]}`,position:"relative"},codeRequired:{"&::after":{position:"absolute",content:'"*"',top:0,right:n.spacing(.5),fontWeight:"bolder",color:n.palette.error.light}}})),xj=()=>{const n=(0,I.h_)(Y.b),e=bj(),{loading:t,value:i,error:r}=(0,Bl.default)(async()=>n.listActions());if(t)return m.createElement(R.Ex,null);if(r)return m.createElement(R.mf,{statusMessage:"Failed to load installed actions",status:"500"});const s=h=>{const c=h.properties;if(!!c)return Object.entries(c).map(u=>{var f;const[d]=u,p=u[1],g=rR()(e.code,{[e.codeRequired]:(f=h.required)==null?void 0:f.includes(d)});return m.createElement(mn.Z,{key:d},m.createElement(qi.Z,null,m.createElement("div",{className:g},d)),m.createElement(qi.Z,null,p.title),m.createElement(qi.Z,null,p.description),m.createElement(qi.Z,null,m.createElement("span",{className:e.code},p.type)))})},o=h=>{if(!!h.properties)return m.createElement(gn.Z,{component:Ui.Z},m.createElement(H.Z,{size:"small"},m.createElement(ce.Z,null,m.createElement(mn.Z,null,m.createElement(qi.Z,null,"Name"),m.createElement(qi.Z,null,"Title"),m.createElement(qi.Z,null,"Description"),m.createElement(qi.Z,null,"Type"))),m.createElement(gt.Z,null,s(h))))},l=(h,c)=>{if(!!c)return m.createElement(m.Fragment,null,m.createElement(M.Z,{variant:"h6"},h),c.map((u,f)=>m.createElement("div",{key:f},o(u))))},a=i==null?void 0:i.map(h=>{var c,u,f,d;if(h.id.startsWith("legacy:"))return;const p=l("oneOf",(u=(c=h.schema)==null?void 0:c.input)==null?void 0:u.oneOf);return m.createElement(_e.Z,{pb:4,key:h.id},m.createElement(M.Z,{variant:"h4",className:e.code},h.id),m.createElement(M.Z,null,h.description),((f=h.schema)==null?void 0:f.input)&&m.createElement(_e.Z,{pb:2},m.createElement(M.Z,{variant:"h5"},"Input"),o(h.schema.input),p),((d=h.schema)==null?void 0:d.output)&&m.createElement(_e.Z,{pb:2},m.createElement(M.Z,{variant:"h5"},"Output"),o(h.schema.output)))});return m.createElement(R.T3,{themeId:"home"},m.createElement(R.h4,{pageTitleOverride:"Create a New Component",title:"Installed actions",subtitle:"This is the collection of all installed actions"}),m.createElement(R.VY,null,a))},Sj=`# Edit the template parameters below to see how they will render in the scaffolder form UI
parameters:
  - title: Fill in some steps
    required:
      - name
    properties:
      name:
        title: Name
        type: string
        description: Unique name of the component
      owner:
        title: Owner
        type: string
        description: Owner of the component
        ui:field: OwnerPicker
        ui:options:
          allowedKinds:
            - Group
  - title: Choose a location
    required:
      - repoUrl
    properties:
      repoUrl:
        title: Repository Location
        type: string
        ui:field: RepoUrlPicker
        ui:options:
          allowedHosts:
            - github.com
`,kj=(0,X.Z)({templateSelect:{marginBottom:"10px"},grid:{height:"100%"},codeMirror:{height:"95%"}}),Cj=({defaultPreviewTemplate:n=Sj,customFieldExtensions:e=[]})=>{const t=kj(),i=(0,I.h_)(I.$v),r=(0,I.h_)($.Ah),s=(0,I.I_)(),[o,l]=(0,m.useState)(""),[a,h]=(0,m.useState)({title:"",steps:[]}),[c,u]=(0,m.useState)([]),[f,d]=(0,m.useState)(n),[p,g]=(0,m.useState)({}),{loading:y}=(0,Bl.default)(()=>r.getEntities({filter:{kind:"template"},fields:["kind","metadata.namespace","metadata.name","metadata.title","spec.parameters"]}).then(({items:_})=>u(_.map(O=>{var D;return{label:(D=O.metadata.title)!=null?D:(0,$.$3)(O,{defaultKind:"template"}),value:O}}))).catch(_=>i.post({message:`Error loading exisiting templates: ${_.message}`,severity:"error"})),[r]),v=document.createElement("div");v.style.color="red",(0,sR.Z)(()=>{try{const _=VM().parse(f);h({title:"Preview",steps:_.parameters.map(O=>({title:O.title,schema:O}))}),g({})}catch(_){v.textContent=_.message}},250,[g,h,f]);const C=(0,m.useCallback)(_=>{l(_),d(VM().stringify(_.spec))},[d]),x=()=>g({}),b=(0,m.useCallback)(_=>g(_.formData),[g]),S=(0,m.useCallback)(_=>{d(_)},[d]),k=Object.fromEntries(e.map(({name:_,component:O})=>[_,O])),A=Object.fromEntries(e.map(({name:_,validation:O})=>[_,O]));return m.createElement(R.T3,{themeId:"home"},m.createElement(R.h4,{title:"Template Editor",subtitle:"Preview your template parameter UI"}),m.createElement(R.VY,null,y&&m.createElement(Rs.Z,null),m.createElement(Ee.Z,{container:!0,className:t.grid},m.createElement(Ee.Z,{item:!0,xs:6},m.createElement(Qi.Z,{className:t.templateSelect,variant:"outlined",fullWidth:!0},m.createElement(Je.Z,{id:"select-template-label"},"Load Existing Template"),m.createElement(ii.Z,{value:o,label:"Load Existing Template",labelId:"select-template-label",onChange:_=>C(_.target.value)},c.map((_,O)=>m.createElement(ni.Z,{key:O,value:_.value},_.label)))),m.createElement(tj,{className:t.codeMirror,value:f,theme:"dark",height:"100%",extensions:[Jg.define(aR),Yp.of(()=>({dom:v,top:!0}))],onChange:S})),m.createElement(Ee.Z,{item:!0,xs:6},a&&m.createElement(R.rJ,{key:JSON.stringify(a)},m.createElement(zM,{formData:p,fields:k,onChange:b,onReset:x,steps:a.steps.map(_=>({..._,validate:jM(_.schema,A,{apiHolder:s})}))}))))))},Aj=n=>{const{groups:e,components:t={},defaultPreviewTemplate:i}=n,{TemplateCardComponent:r,TaskPageComponent:s}=t,o=(0,z.pC)(),l=s!=null?s:Y.h,a=(0,I.vJ)(o,c=>c.selectByComponentData({key:Y.F}).findComponentData({key:Y.d})),h=[...a,...nj.D.filter(({name:c})=>!a.some(u=>u.name===c))];return m.createElement(z.Z5,null,m.createElement(z.AW,{element:m.createElement(fj,{groups:e,TemplateCardComponent:r,contextMenu:n.contextMenu})}),m.createElement(z.AW,{path:Y.s.path,element:m.createElement(Y.e,null,m.createElement(wj,{customFieldExtensions:h}))}),m.createElement(z.AW,{path:Y.c.path,element:m.createElement(l,null)}),m.createElement(z.AW,{path:Y.f.path,element:m.createElement(xj,null)}),m.createElement(z.AW,{path:Y.g.path,element:m.createElement(Y.e,null,m.createElement(Cj,{defaultPreviewTemplate:i,customFieldExtensions:h}))}),m.createElement(z.AW,{path:"preview",element:m.createElement(z.Fg,{to:"../edit"})}))}},70923:function(Z,oe,w){"use strict";w.d(oe,{D:function(){return z}});var m=w(73409);const z=[{component:m.E,name:"EntityPicker"},{component:m.i,name:"EntityNamePicker",validation:m.j},{component:m.k,name:"EntityTagsPicker"},{component:m.R,name:"RepoUrlPicker",validation:m.l},{component:m.O,name:"OwnerPicker"},{component:m.m,name:"OwnedEntityPicker"}]},65549:function(Z,oe,w){"use strict";var m,z=w(14859),R=w(93291);m={value:!0},oe.Z=void 0;var I=R(w(2784)),$=z(w(50175)),Y=(0,$.default)(I.createElement("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"}),"Add");oe.Z=Y},70595:function(Z,oe,w){"use strict";var m,z=w(14859),R=w(93291);m={value:!0},oe.Z=void 0;var I=R(w(2784)),$=z(w(50175)),Y=(0,$.default)(I.createElement("path",{d:"M20 12l-1.41-1.41L13 16.17V4h-2v12.17l-5.58-5.59L4 12l8 8 8-8z"}),"ArrowDownward");oe.Z=Y},16715:function(Z,oe,w){"use strict";var m,z=w(14859),R=w(93291);m={value:!0},oe.Z=void 0;var I=R(w(2784)),$=z(w(50175)),Y=(0,$.default)(I.createElement("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"}),"Error");oe.Z=Y},76485:function(Z,oe,w){var m=w(9850),z=w(93503),R=w(73198),I=w(19003),$=w(35676),Y=w(68632),de=w(30898),X=w(74186),M=w(18149),F=w(97030),V=w(78911),Q=w(829),ee=w(59756),ye=w(75652),ae=w(49599),_e=w(67304),At=(E,...G)=>_e.apply(null,[E].concat($(G))),qt=E=>De(Dh,E),He=E=>De(Mh,E),De=(E,G)=>E.indexOf(G)!==-1,ti=E=>!wr(E).length&&E!==!1&&E!==!0,K=E=>F(E)||E===!0||E===!1,Kt=E=>E===!1,yi=E=>E===!0,Ui=(E,G,se)=>se(E),Rs=E=>Q(ye(Y(E))),mn=E=>E!==void 0,qi=E=>ye(Y(E.map(wr))),gn=E=>E[0],H=E=>Rs(E),ce=E=>Math.max.apply(Math,E),gt=E=>Math.min.apply(Math,E),Ee=E=>E.some(yi),Qi=E=>ae($(E),M);function Je(E){return function(G,se){return z({[E]:G},{[E]:se})}}function ii(E){if(Array.isArray(E.allOf)){var G=E.allOf;return delete E.allOf,[E].concat(G.map(function(se){return ii(se)}))}else return[E]}function ni(E,G){return E.map(function(se){return se&&se[G]})}function Wr(E,G){return E.map(function(se){if(!!se)if(Array.isArray(se.items)){var Se=se.items[G];if(K(Se))return Se;if(se.hasOwnProperty("additionalItems"))return se.additionalItems}else return se.items})}function Oo(E,G){return E.map(function(se,Se){try{return G(se,Se)}catch{return}}).filter(mn)}function Ff(E){return E.map(function(G){if(!!G)return Array.isArray(G.items)?G.additionalItems:G.items})}function wr(E){return F(E)||Array.isArray(E)?Object.keys(E):[]}function Ls(E,G){if(G=G||[],!E.length)return G;var se=E.slice(0).shift(),Se=E.slice(1);return G.length?Ls(Se,$(G.map(Me=>se.map(ve=>[ve].concat(Me))))):Ls(Se,se.map(Me=>Me))}function El(E,G){return Array.isArray(E)?(E.splice.apply(E,[0,0].concat(G)),E):G}function Ah(E,G){var se;try{se=E.map(function(Se){return JSON.stringify(Se,null,2)}).join(`
`)}catch{se=E.join(", ")}throw new Error('Could not resolve values for path:"'+G.join(".")+`". They are probably incompatible. Values: 
`+se)}function Nf(E){for(var G in E)E.hasOwnProperty(G)&&ti(E[G])&&delete E[G];return E}function Tl(E,G,se){return function(Se,Me){if(Me===void 0)throw new Error("You need to call merger with a key for the property name or index if array.");return Me=String(Me),E(Se,null,se.concat(G,Me))}}function Oh(E,G,se,Se,Me,ve){if(E.length){var Be=Me.resolvers[G];if(!Be)throw new Error("No resolver found for "+G);var ot=ae(se.map(function(Ot){return E.reduce(function(ri,En){return Ot[En]!==void 0&&(ri[En]=Ot[En]),ri},{})}).filter(mn),z),Ze=G==="properties"?Dh:Mh,yt=Ze.reduce(function(Ot,ri){return De(Rl,ri)?Ot[ri]=Tl(Se,ri,ve):Ot[ri]=function(En){return Se(En,null,ve.concat(ri))},Ot},{});G==="items"&&(yt.itemsArray=Tl(Se,"items",ve),yt.items=function(Ot){return Se(Ot,null,ve.concat("items"))});var vt=Be(ot,ve.concat(G),yt,Me);return F(vt)||Ah(ot,ve.concat(G)),Nf(vt)}}function Pl(E,G,se){var Se=qi(se||E),Me=se?Wr:ni;return Se.reduce(function(ve,Be){var ot=Me(E,Be),Ze=ae(ot.filter(mn),z);return ve[Be]=G(Ze,Be),ve},se?[]:{})}function If(E){ee(E,function(G,se){G===!1&&delete E[se]})}function _h(E){ee(E,function(G,se){G===!1&&E.splice(se,1)})}function Bl(E){return{required:E}}var Dh=["properties","patternProperties","additionalProperties"],Mh=["items","additionalItems"],Rl=["properties","patternProperties","definitions","dependencies"],Eh=["anyOf","oneOf"],Wf=["additionalProperties","additionalItems","contains","propertyNames","not","items"],Ne={type(E){if(E.some(Array.isArray)){var G=E.map(function(Se){return Array.isArray(Se)?Se:[Se]}),se=de.apply(null,G);if(se.length===1)return se[0];if(se.length>1)return ye(se)}},properties(E,G,se,Se){Se.ignoreAdditionalProperties||(E.forEach(function(ve){var Be=E.filter(vt=>vt!==ve),ot=wr(ve.properties),Ze=wr(ve.patternProperties),yt=Ze.map(vt=>new RegExp(vt));Be.forEach(function(vt){var Ot=wr(vt.properties),ri=Ot.filter(ze=>yt.some(Fl=>Fl.test(ze))),En=At(Ot,ot,ri);En.forEach(function(ze){vt.properties[ze]=se.properties([vt.properties[ze],ve.additionalProperties],ze)})})}),E.forEach(function(ve){var Be=E.filter(Ze=>Ze!==ve),ot=wr(ve.patternProperties);ve.additionalProperties===!1&&Be.forEach(function(Ze){var yt=wr(Ze.patternProperties),vt=At(yt,ot);vt.forEach(Ot=>delete Ze.patternProperties[Ot])})}));var Me={additionalProperties:se.additionalProperties(E.map(ve=>ve.additionalProperties)),patternProperties:Pl(E.map(ve=>ve.patternProperties),se.patternProperties),properties:Pl(E.map(ve=>ve.properties),se.properties)};return Me.additionalProperties===!1&&If(Me.properties),Me},dependencies(E,G,se){var Se=qi(E);return Se.reduce(function(Me,ve){var Be=ni(E,ve),ot=ae(Be.filter(mn),M),Ze=ot.filter(Array.isArray);if(Ze.length){if(Ze.length===ot.length)Me[ve]=Rs(ot);else{var yt=ot.filter(K),vt=Ze.map(Bl);Me[ve]=se(yt.concat(vt),ve)}return Me}return ot=ae(ot,z),Me[ve]=se(ot,ve),Me},{})},items(E,G,se){var Se=E.map(ot=>ot.items),Me=Se.filter(mn),ve={};Me.every(K)?ve.items=se.items(Se):ve.items=Pl(E,se.itemsArray,Se);var Be;return Me.every(Array.isArray)?Be=E.map(ot=>ot.additionalItems):Me.some(Array.isArray)&&(Be=Ff(E)),Be&&(ve.additionalItems=se.additionalItems(Be)),ve.additionalItems===!1&&Array.isArray(ve.items)&&_h(ve.items),ve},oneOf(E,G,se){var Se=Ls(m(E)),Me=Oo(Se,se),ve=ae(Me,z);if(ve.length)return ve},not(E){return{anyOf:E}},pattern(E,G,se,Se,Me){var ve=G.pop();Me(E.map(function(Be){return{[ve]:Be}}))},multipleOf(E){for(var G=E.slice(0),se=1;G.some(Se=>!Number.isInteger(Se));)G=G.map(Se=>Se*10),se=se*10;return R(G)/se},enum(E){var G=X.apply(null,E.concat(M));if(G.length)return Q(G)}};Ne.$id=gn,Ne.$ref=gn,Ne.$schema=gn,Ne.additionalItems=Ui,Ne.additionalProperties=Ui,Ne.anyOf=Ne.oneOf,Ne.contains=Ui,Ne.default=gn,Ne.definitions=Ne.dependencies,Ne.description=gn,Ne.examples=Qi,Ne.exclusiveMaximum=gt,Ne.exclusiveMinimum=ce,Ne.maximum=gt,Ne.maxItems=gt,Ne.maxLength=gt,Ne.maxProperties=gt,Ne.minimum=ce,Ne.minItems=ce,Ne.minLength=ce,Ne.minProperties=ce,Ne.propertyNames=Ui,Ne.required=H,Ne.title=gn,Ne.uniqueItems=Ee;function Ll(E,G,se){se=se||[],G=I(G,{ignoreAdditionalProperties:!1,resolvers:Ne});function Se(Be,ot,Ze){Be=m(Be.filter(mn)),Ze=Ze||[];var yt=F(ot)?ot:{};if(!Be.length)return;if(Be.some(Kt))return!1;if(Be.every(yi))return!0;Be=Be.filter(F);var vt=qi(Be);if(De(vt,"allOf"))return Ll({allOf:Be},G,se);var Ot=vt.filter(qt);V(vt,Ot);var ri=vt.filter(He);V(vt,ri),vt.forEach(function(ze){var Fl=ni(Be,ze),Ae=ae(Fl.filter(mn),Je(ze));if(Ae.length===1&&De(Eh,ze))yt[ze]=Ae[0].map(function(br){return Se([br],br)});else if(Ae.length===1&&!De(Rl,ze)&&!De(Wf,ze))yt[ze]=Ae[0];else{var Th=G.resolvers[ze]||G.resolvers.defaultResolver;if(!Th)throw new Error("No resolver found for key "+ze+". You can provide a resolver for this keyword in the options, or provide a default resolver.");var Ph;De(Rl,ze)||De(Eh,ze)?Ph=Tl(Se,ze,Ze):Ph=function(br){return Se(br,null,Ze.concat(ze))};var Bh=!1;yt[ze]=Th(Ae,Ze.concat(ze),Ph,G,function(br){return Bh=Array.isArray(br),En(br)}),yt[ze]===void 0&&!Bh?Ah(Ae,Ze.concat(ze)):yt[ze]===void 0&&delete yt[ze]}}),Object.assign(yt,Oh(Ot,"properties",Be,Se,G,Ze)),Object.assign(yt,Oh(ri,"items",Be,Se,G,Ze));function En(ze){yt.allOf=El(yt.allOf,ze)}return yt}var Me=Y(ii(E)),ve=Se(Me,E);return ve}Ll.options={resolvers:Ne},Z.exports=Ll},69914:function(Z,oe){"use strict";var w;/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var m=typeof Symbol=="function"&&Symbol.for,z=m?Symbol.for("react.element"):60103,R=m?Symbol.for("react.portal"):60106,I=m?Symbol.for("react.fragment"):60107,$=m?Symbol.for("react.strict_mode"):60108,Y=m?Symbol.for("react.profiler"):60114,de=m?Symbol.for("react.provider"):60109,X=m?Symbol.for("react.context"):60110,M=m?Symbol.for("react.async_mode"):60111,F=m?Symbol.for("react.concurrent_mode"):60111,V=m?Symbol.for("react.forward_ref"):60112,Q=m?Symbol.for("react.suspense"):60113,ee=m?Symbol.for("react.suspense_list"):60120,ye=m?Symbol.for("react.memo"):60115,ae=m?Symbol.for("react.lazy"):60116,_e=m?Symbol.for("react.block"):60121,At=m?Symbol.for("react.fundamental"):60117,qt=m?Symbol.for("react.responder"):60118,He=m?Symbol.for("react.scope"):60119;function De(K){if(typeof K=="object"&&K!==null){var Kt=K.$$typeof;switch(Kt){case z:switch(K=K.type,K){case M:case F:case I:case Y:case $:case Q:return K;default:switch(K=K&&K.$$typeof,K){case X:case V:case ae:case ye:case de:return K;default:return Kt}}case R:return Kt}}}function ti(K){return De(K)===F}w=M,w=F,w=X,w=de,w=z,w=V,w=I,w=ae,w=ye,w=R,w=Y,w=$,w=Q,w=function(K){return ti(K)||De(K)===M},w=ti,w=function(K){return De(K)===X},w=function(K){return De(K)===de},w=function(K){return typeof K=="object"&&K!==null&&K.$$typeof===z},oe.isForwardRef=function(K){return De(K)===V},w=function(K){return De(K)===I},w=function(K){return De(K)===ae},oe.isMemo=function(K){return De(K)===ye},w=function(K){return De(K)===R},w=function(K){return De(K)===Y},w=function(K){return De(K)===$},w=function(K){return De(K)===Q},w=function(K){return typeof K=="string"||typeof K=="function"||K===I||K===F||K===Y||K===$||K===Q||K===ee||typeof K=="object"&&K!==null&&(K.$$typeof===ae||K.$$typeof===ye||K.$$typeof===de||K.$$typeof===X||K.$$typeof===V||K.$$typeof===At||K.$$typeof===qt||K.$$typeof===He||K.$$typeof===_e)},w=De},38294:function(Z,oe,w){"use strict";Z.exports=w(69914)},93948:function(Z,oe,w){"use strict";var m=w(87245),z=w(63772),R=w(8615),I=Math.pow(2,31)-1;function $(X,M){var F=1,V;if(X===0)return M;if(M===0)return X;for(;X%2===0&&M%2===0;)X=X/2,M=M/2,F=F*2;for(;X%2===0;)X=X/2;for(;M;){for(;M%2===0;)M=M/2;X>M&&(V=M,M=X,X=V),M=M-X}return F*X}function Y(X,M){var F=0,V;if(X===0)return M;if(M===0)return X;for(;(X&1)===0&&(M&1)===0;)X>>>=1,M>>>=1,F++;for(;(X&1)===0;)X>>>=1;for(;M;){for(;(M&1)===0;)M>>>=1;X>M&&(V=M,M=X,X=V),M=M-X}return X<<F}function de(){var X=arguments.length,M,F,V,Q,ee,ye,ae;for(M=new Array(X),ae=0;ae<X;ae++)M[ae]=arguments[ae];if(z(M)){if(X===2)return ee=M[0],ye=M[1],ee<0&&(ee=-ee),ye<0&&(ye=-ye),ee<=I&&ye<=I?Y(ee,ye):$(ee,ye);V=M}else if(m(M[0]))if(X>1){if(V=M[0],F=M[1],!R(F))throw new TypeError("gcd()::invalid input argument. Accessor must be a function. Value: `"+F+"`.")}else V=M[0];else throw new TypeError("gcd()::invalid input argument. Must provide an array of integers. Value: `"+M[0]+"`.");if(Q=V.length,Q<2)return null;if(F){for(ee=new Array(Q),ae=0;ae<Q;ae++)ee[ae]=F(V[ae],ae);V=ee}if(X<3&&!z(V))throw new TypeError("gcd()::invalid input argument. Accessed array values must be integers. Value: `"+V+"`.");for(ae=0;ae<Q;ae++)ee=V[ae],ee<0&&(V[ae]=-ee);for(ee=V[0],ae=1;ae<Q;ae++)ye=V[ae],ye<=I&&ee<=I?ee=Y(ee,ye):ee=$(ee,ye);return ee}Z.exports=de},73198:function(Z,oe,w){"use strict";var m=w(93948),z=w(87245),R=w(63772),I=w(8615);function $(){var Y=arguments.length,de,X,M,F,V,Q,ee;for(de=new Array(Y),ee=0;ee<Y;ee++)de[ee]=arguments[ee];if(R(de)){if(Y===2)return V=de[0],Q=de[1],V<0&&(V=-V),Q<0&&(Q=-Q),V===0||Q===0?0:V/m(V,Q)*Q;M=de}else if(z(de[0]))if(Y>1){if(M=de[0],X=de[1],!I(X))throw new TypeError("lcm()::invalid input argument. Accessor must be a function. Value: `"+X+"`.")}else M=de[0];else throw new TypeError("lcm()::invalid input argument. Must provide an array of integers. Value: `"+de[0]+"`.");if(F=M.length,F<2)return null;if(X){for(V=new Array(F),ee=0;ee<F;ee++)V[ee]=X(M[ee],ee);M=V}if(Y<3&&!R(M))throw new TypeError("lcm()::invalid input argument. Accessed array values must be integers. Value: `"+M+"`.");for(ee=0;ee<F;ee++)V=M[ee],V<0&&(M[ee]=-V);for(V=M[0],ee=1;ee<F;ee++){if(Q=M[ee],V===0||Q===0)return 0;V=V/m(V,Q)*Q}return V}Z.exports=$},16455:function(Z,oe,w){var m=w(6200);Z.exports=m},35558:function(Z,oe,w){w(21710);var m=w(47923);Z.exports=m("Array","fill")},5594:function(Z,oe,w){w(70024);var m=w(47923);Z.exports=m("Array","includes")},67553:function(Z,oe,w){Z.exports=w(29320)},29320:function(Z,oe,w){var m=w(16455);Z.exports=m},47923:function(Z,oe,w){var m=w(10150);Z.exports=m},6200:function(Z,oe,w){var m=w(35558);Z.exports=m},93503:function(Z,oe,w){var m=w(18149),z=w(829),R=w(75652),I=w(49599),$=w(84573),Y=w(74186),de=w(97030),X=w(4335),M=H=>Array.isArray(H)?H:[H],F=H=>H===void 0,V=H=>de(H)||Array.isArray(H)?Object.keys(H):[],Q=(H,ce)=>H.hasOwnProperty(ce),ee=H=>z(R(H)),ye=H=>F(H)||Array.isArray(H)&&H.length===0,ae=(H,ce,gt,Ee)=>ce&&Q(ce,gt)&&H&&Q(H,gt)&&Ee(H[gt],ce[gt]),_e=(H,ce)=>F(H)&&ce===0||F(ce)&&H===0||m(H,ce),At=(H,ce)=>F(H)&&ce===!1||F(ce)&&H===!1||m(H,ce),qt=H=>F(H)||m(H,{})||H===!0,He=H=>F(H)||m(H,{}),De=H=>F(H)||de(H)||H===!0||H===!1;function ti(H,ce){return ye(H)&&ye(ce)?!0:m(ee(H),ee(ce))}function K(H,ce){return H=M(H),ce=M(ce),m(ee(H),ee(ce))}function Kt(H,ce,gt,Ee){var Qi=R(V(H).concat(V(ce)));return He(H)&&He(ce)?!0:He(H)&&V(ce).length||He(ce)&&V(H).length?!1:Qi.every(function(Je){var ii=H[Je],ni=ce[Je];return Array.isArray(ii)&&Array.isArray(ni)?m(ee(H),ee(ce)):Array.isArray(ii)&&!Array.isArray(ni)||Array.isArray(ni)&&!Array.isArray(ii)?!1:ae(H,ce,Je,Ee)})}function yi(H,ce,gt,Ee){return de(H)&&de(ce)?Ee(H,ce):Array.isArray(H)&&Array.isArray(ce)?Kt(H,ce,gt,Ee):m(H,ce)}function Ui(H,ce,gt,Ee){var Qi=I(H,Ee),Je=I(ce,Ee),ii=Y(Qi,Je,Ee);return ii.length===Math.max(Qi.length,Je.length)}var Rs={title:m,uniqueItems:At,minLength:_e,minItems:_e,minProperties:_e,required:ti,enum:ti,type:K,items:yi,anyOf:Ui,allOf:Ui,oneOf:Ui,properties:Kt,patternProperties:Kt,dependencies:Kt},mn=["properties","patternProperties","dependencies","uniqueItems","minLength","minItems","minProperties","required"],qi=["additionalProperties","additionalItems","contains","propertyNames","not"];function gn(H,ce,gt){if(gt=$(gt,{ignore:[]}),qt(H)&&qt(ce))return!0;if(!De(H)||!De(ce))throw new Error("Either of the values are not a JSON schema.");if(H===ce)return!0;if(X(H)&&X(ce))return H===ce;if(H===void 0&&ce===!1||ce===void 0&&H===!1||F(H)&&!F(ce)||!F(H)&&F(ce))return!1;var Ee=R(Object.keys(H).concat(Object.keys(ce)));if(gt.ignore.length&&(Ee=Ee.filter(Je=>gt.ignore.indexOf(Je)===-1)),!Ee.length)return!0;function Qi(Je,ii){return gn(Je,ii,gt)}return Ee.every(function(Je){var ii=H[Je],ni=ce[Je];if(qi.indexOf(Je)!==-1)return gn(ii,ni,gt);var Wr=Rs[Je];if(Wr||(Wr=m),m(ii,ni))return!0;if(mn.indexOf(Je)===-1&&(!Q(H,Je)&&Q(ce,Je)||Q(H,Je)&&!Q(ce,Je)))return ii===ni;var Oo=Wr(ii,ni,Je,Qi);if(!X(Oo))throw new Error("Comparer must return true or false");return Oo})}Z.exports=gn},404:function(Z,oe){var w=/~/,m=/~[01]/g;function z(M){switch(M){case"~1":return"/";case"~0":return"~"}throw new Error("Invalid tilde escape: "+M)}function R(M){return w.test(M)?M.replace(m,z):M}function I(M,F,V){for(var Q,ee,ye=1,ae=F.length;ye<ae;){if(F[ye]==="constructor"||F[ye]==="prototype"||F[ye]==="__proto__")return M;if(Q=R(F[ye++]),ee=ae>ye,typeof M[Q]=="undefined"&&(Array.isArray(M)&&Q==="-"&&(Q=M.length),ee&&(F[ye]!==""&&F[ye]<1/0||F[ye]==="-"?M[Q]=[]:M[Q]={})),!ee)break;M=M[Q]}var _e=M[Q];return V===void 0?delete M[Q]:M[Q]=V,_e}function $(M){if(typeof M=="string"){if(M=M.split("/"),M[0]==="")return M;throw new Error("Invalid JSON pointer.")}else if(Array.isArray(M)){for(const F of M)if(typeof F!="string"&&typeof F!="number")throw new Error("Invalid JSON pointer. Must be of type string or number.");return M}throw new Error("Invalid JSON pointer.")}function Y(M,F){if(typeof M!="object")throw new Error("Invalid input object.");F=$(F);var V=F.length;if(V===1)return M;for(var Q=1;Q<V;){if(M=M[R(F[Q++])],V===Q)return M;if(typeof M!="object")return}}function de(M,F,V){if(typeof M!="object")throw new Error("Invalid input object.");if(F=$(F),F.length===0)throw new Error("Invalid JSON pointer for set.");return I(M,F,V)}function X(M){var F=$(M);return{get:function(V){return Y(V,F)},set:function(V,Q){return de(V,F,Q)}}}oe.get=Y,oe.set=de,oe.compile=X},85246:function(Z,oe,w){var m=w(45386),z=w(38333),R=w(34893),I=w(50343),$=w(47826),Y=w(59950),de=200;function X(M,F,V,Q){var ee=-1,ye=z,ae=!0,_e=M.length,At=[],qt=F.length;if(!_e)return At;V&&(F=I(F,$(V))),Q?(ye=R,ae=!1):F.length>=de&&(ye=Y,ae=!1,F=new m(F));e:for(;++ee<_e;){var He=M[ee],De=V==null?He:V(He);if(He=Q||He!==0?He:0,ae&&De===De){for(var ti=qt;ti--;)if(F[ti]===De)continue e;At.push(He)}else ye(F,De,Q)||At.push(He)}return At}Z.exports=X},84190:function(Z){function oe(w,m,z,R){for(var I=z-1,$=w.length;++I<$;)if(R(w[I],m))return I;return-1}Z.exports=oe},88390:function(Z,oe,w){var m=w(45386),z=w(38333),R=w(34893),I=w(50343),$=w(47826),Y=w(59950),de=Math.min;function X(M,F,V){for(var Q=V?R:z,ee=M[0].length,ye=M.length,ae=ye,_e=Array(ye),At=1/0,qt=[];ae--;){var He=M[ae];ae&&F&&(He=I(He,$(F))),At=de(He.length,At),_e[ae]=!V&&(F||ee>=120&&He.length>=120)?new m(ae&&He):void 0}He=M[0];var De=-1,ti=_e[0];e:for(;++De<ee&&qt.length<At;){var K=He[De],Kt=F?F(K):K;if(K=V||K!==0?K:0,!(ti?Y(ti,Kt):Q(qt,Kt,V))){for(ae=ye;--ae;){var yi=_e[ae];if(!(yi?Y(yi,Kt):Q(M[ae],Kt,V)))continue e}ti&&ti.push(Kt),qt.push(K)}}return qt}Z.exports=X},45169:function(Z,oe,w){var m=w(50343),z=w(77832),R=w(84190),I=w(47826),$=w(51522),Y=Array.prototype,de=Y.splice;function X(M,F,V,Q){var ee=Q?R:z,ye=-1,ae=F.length,_e=M;for(M===F&&(F=$(F)),V&&(_e=m(M,I(V)));++ye<ae;)for(var At=0,qt=F[ye],He=V?V(qt):qt;(At=ee(_e,He,At,Q))>-1;)_e!==M&&de.call(_e,At,1),de.call(M,At,1);return M}Z.exports=X},5642:function(Z,oe,w){var m=w(93746);function z(R){return m(R)?R:[]}Z.exports=z},88302:function(Z,oe,w){var m=w(84565),z=w(29259);function R(I,$,Y,de,X,M){return z(I)&&z($)&&(M.set($,I),m(I,$,void 0,R,M),M.delete($)),I}Z.exports=R},19003:function(Z,oe,w){var m=w(49432),z=w(36060),R=w(88302),I=w(12782),$=z(function(Y){return Y.push(void 0,R),m(I,void 0,Y)});Z.exports=$},68632:function(Z,oe,w){var m=w(62034),z=1/0;function R(I){var $=I==null?0:I.length;return $?m(I,z):[]}Z.exports=R},30898:function(Z,oe,w){var m=w(50343),z=w(88390),R=w(36060),I=w(5642),$=R(function(Y){var de=m(Y,I);return de.length&&de[0]===Y[0]?z(de):[]});Z.exports=$},74186:function(Z,oe,w){var m=w(50343),z=w(88390),R=w(36060),I=w(5642),$=w(56974),Y=R(function(de){var X=$(de),M=m(de,I);return X=typeof X=="function"?X:void 0,X&&M.pop(),M.length&&M[0]===de[0]?z(M,void 0,X):[]});Z.exports=Y},4335:function(Z,oe,w){var m=w(53366),z=w(15125),R="[object Boolean]";function I($){return $===!0||$===!1||z($)&&m($)==R}Z.exports=I},78911:function(Z,oe,w){var m=w(45169);function z(R,I){return R&&R.length&&I&&I.length?m(R,I):R}Z.exports=z},25497:function(Z,oe,w){var m=w(50343),z=w(51522),R=w(86152),I=w(4795),$=w(54452),Y=w(33812),de=w(66188);function X(M){return R(M)?m(M,Y):I(M)?[M]:z($(de(M)))}Z.exports=X},75652:function(Z,oe,w){var m=w(67326);function z(R){return R&&R.length?m(R):[]}Z.exports=z},49599:function(Z,oe,w){var m=w(67326);function z(R,I){return I=typeof I=="function"?I:void 0,R&&R.length?m(R,void 0,I):[]}Z.exports=z},67304:function(Z,oe,w){var m=w(85246),z=w(36060),R=w(93746),I=z(function($,Y){return R($)?m($,Y):[]});Z.exports=I},11837:function(Z,oe,w){"use strict";var m;/** @license React v17.0.2
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */w(37320);var z=w(2784),R=60103;if(m=60107,typeof Symbol=="function"&&Symbol.for){var I=Symbol.for;R=I("react.element"),m=I("react.fragment")}var $=z.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Y=Object.prototype.hasOwnProperty,de={key:!0,ref:!0,__self:!0,__source:!0};function X(M,F,V){var Q,ee={},ye=null,ae=null;V!==void 0&&(ye=""+V),F.key!==void 0&&(ye=""+F.key),F.ref!==void 0&&(ae=F.ref);for(Q in F)Y.call(F,Q)&&!de.hasOwnProperty(Q)&&(ee[Q]=F[Q]);if(M&&M.defaultProps)for(Q in F=M.defaultProps,F)ee[Q]===void 0&&(ee[Q]=F[Q]);return{$$typeof:R,type:M,key:ye,ref:ae,props:ee,_owner:$.current}}oe.jsx=X,m=X},52322:function(Z,oe,w){"use strict";Z.exports=w(11837)},87245:function(Z){"use strict";function oe(w){return Object.prototype.toString.call(w)==="[object Array]"}Z.exports=Array.isArray||oe},8615:function(Z){"use strict";function oe(w){return typeof w=="function"}Z.exports=oe},63772:function(Z,oe,w){"use strict";var m=w(87245),z=w(45002);function R(I){var $;if(!m(I)||($=I.length,!$))return!1;for(var Y=0;Y<$;Y++)if(!z(I[Y]))return!1;return!0}Z.exports=R},45002:function(Z,oe,w){"use strict";var m=w(87040);function z(R){return m(R)&&R%1===0}Z.exports=z},87040:function(Z){"use strict";function oe(w){return(typeof w=="number"||Object.prototype.toString.call(w)==="[object Number]")&&w.valueOf()===w.valueOf()}Z.exports=oe}}]);})();

//# sourceMappingURL=4267.311973ad.chunk.js.map